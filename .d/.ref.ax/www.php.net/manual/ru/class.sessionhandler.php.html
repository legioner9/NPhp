<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: SessionHandler - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="class.sessionhandler.php.html">
 <link rel="shorturl" href="https://www.php.net/sessionhandler">
 <link rel="alternate" href="https://www.php.net/sessionhandler" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="book.session.php.html">
 <link rel="prev" href="function.session-write-close.php.html">
 <link rel="next" href="sessionhandler.close.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/class.sessionhandler.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/class.sessionhandler.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/class.sessionhandler.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/class.sessionhandler.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/class.sessionhandler.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/class.sessionhandler.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/class.sessionhandler.php" hreflang="pt_BR">
 <link rel="alternate" href="class.sessionhandler.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/class.sessionhandler.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/class.sessionhandler.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="sessionhandler.close.php.html">
          SessionHandler::close &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="function.session-write-close.php.html">
          &laquo; session_write_close        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='funcref.php.html'>Справочник функций</a></li>      <li><a href='refs.basic.session.php.html'>Модули для работы с сессиями</a></li>      <li><a href='book.session.php.html'>Сессии</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/class.sessionhandler.php'>English</option>
            <option value='de/class.sessionhandler.php'>German</option>
            <option value='es/class.sessionhandler.php'>Spanish</option>
            <option value='fr/class.sessionhandler.php'>French</option>
            <option value='it/class.sessionhandler.php'>Italian</option>
            <option value='ja/class.sessionhandler.php'>Japanese</option>
            <option value='pt_BR/class.sessionhandler.php'>Brazilian Portuguese</option>
            <option value='ru/class.sessionhandler.php' selected="selected">Russian</option>
            <option value='tr/class.sessionhandler.php'>Turkish</option>
            <option value='zh/class.sessionhandler.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/reference/session/sessionhandler.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Fclass.sessionhandler%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="class.sessionhandler" class="reference">

 <h1 class="title">Класс SessionHandler</h1>
 

 <div class="partintro"><p class="verinfo">(PHP 5 &gt;= 5.4.0, PHP 7, PHP 8)</p>

  
  <div class="section" id="sessionhandler.intro">
   <h2 class="title">Введение</h2>
   <p class="para">
    <span class="classname"><strong class="classname">SessionHandler</strong></span> это специальный класс, который может использоваться для
    дополнения внутреннего обработчика сессий PHP путём создания дочерних классов от этого.
    Существует семь методов, которые являются обёртками над семью внутренними обработчиками хранения
    данных сессии (<code class="parameter">open</code>, <code class="parameter">close</code>, <code class="parameter">read</code>,
    <code class="parameter">write</code>, <code class="parameter">destroy</code>, <code class="parameter">gc</code> и
    <code class="parameter">create_sid</code>). По умолчанию этот класс оборачивает все внутренние
    обработчики хранения сессии, определённые в опции конфигурации <a href="session.configuration.php.html#ini.session.save-handler" class="link">session.save_handler</a>.
    Эта опция по умолчанию имеет значение <code class="parameter">files</code>.
    Другие внутренние обработчики сессий предоставляются PHP-модулями, такими как
    SQLite (<code class="parameter">sqlite</code>), Memcache (<code class="parameter">memcache</code>)
    и Memcached (<code class="parameter">memcached</code>).
   </p>
   <p class="para">
    Экземпляр класса <span class="classname"><strong class="classname">SessionHandler</strong></span> может устанавливаться в
    качестве обработчика сессии посредством вызова функции <span class="function"><a href="function.session-set-save-handler.php.html" class="function">session_set_save_handler()</a></span>.
    В этом случае он станет обёрткой существующего внутреннего обработчика.
    Классы, расширяющие <span class="classname"><strong class="classname">SessionHandler</strong></span> позволят переопределить
    методы обработчика сессии или перехватить/отфильтровать их путём вызова
    родительских методов-обёрток внутреннего обработчика сессий PHP.
   </p>
   <p class="para">
    Это позволит вам, к примеру, перехватить методы <code class="parameter">read</code> и
    <code class="parameter">write</code> для шифровки/дешифровки данных сессии и передачи
    результата родительскому классу и от него. Или, к примеру, вы можете полностью
    переопределить такой метод как callback-функция сборщика мусора (<code class="parameter">gc</code>).
   </p>
   <p class="para">
    Так как <span class="classname"><strong class="classname">SessionHandler</strong></span> является обёрткой над стандартным
    внутренним обработчиком сессии, то пример, приведённый выше про шифровку данных
    может быть применён к любому внутреннему обработчику сессии даже без понимания
    внутреннего устройства процесса работы сессии.
   </p>
   <p class="para">
    Для использования этого класса, во-первых, установите обработчик, который вы хотите
    дополнить используя <a href="session.configuration.php.html#ini.session.save-handler" class="link">session.save_handler</a>.
    Далее передайте экземпляр класса <span class="classname"><strong class="classname">SessionHandler</strong></span> или одного из
    классов, расширяющих его функции <span class="function"><a href="function.session-set-save-handler.php.html" class="function">session_set_save_handler()</a></span>.
   </p>
   <p class="para">
    Обратите внимание, что callback-методы этого класса предназначены для внутреннего вызова PHP
    и не предназначены для вызова из кода пользовательского пространства.
    Возвращаемые значения одинаково обрабатываются внутри PHP.
    Дополнительную информацию о работе с сессией можно узнать
    из описания функции <span class="function"><a href="function.session-set-save-handler.php.html" class="function">session_set_save_handler()</a></span>.
   </p>
  </div>
  

  <div class="section" id="sessionhandler.synopsis">
   <h2 class="title">Обзор классов</h2>


   <div class="classsynopsis"><div class="classsynopsisinfo">
    
     <span class="modifier">class</span> <strong class="classname"><strong class="classname">SessionHandler</strong></strong>
    

    
     <span class="modifier">implements</span>
      <a href="class.sessionhandlerinterface.php.html" class="interfacename">SessionHandlerInterface</a>,

     <a href="class.sessionidinterface.php.html" class="interfacename">SessionIdInterface</a> {</div>

    <div class="classsynopsisinfo classsynopsisinfo_comment">/* Методы */</div>
    <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.close.php.html" class="methodname">close</a></span>(): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.create-sid.php.html" class="methodname">create_sid</a></span>(): <span class="type">string</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.destroy.php.html" class="methodname">destroy</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$id</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.gc.php.html" class="methodname">gc</a></span>(<span class="methodparam"><span class="type">int</span> <code class="parameter">$max_lifetime</code></span>): <span class="type"><span class="type">int</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.open.php.html" class="methodname">open</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$path</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$name</code></span>): <span class="type">bool</span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.read.php.html" class="methodname">read</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$id</code></span>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>
<div class="methodsynopsis dc-description"><span class="modifier">public</span> <span class="methodname"><a href="sessionhandler.write.php.html" class="methodname">write</a></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$id</code></span>, <span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>): <span class="type">bool</span></div>

   }</div>


  </div>

  <div class="section" id="session.notes">
   <div class="warning"><strong class="warning">Внимание</strong>
    <p class="para">
     Этот класс предназначен для расширения текущего внутреннего обработчика сессии PHP.
     При этом, если вам нужно написать собственный обработчик, то необходимо написать
     собственную реализацию интерфейса <span class="classname"><a href="class.sessionhandlerinterface.php.html" class="classname">SessionHandlerInterface</a></span>
     вместо расширения класса <span class="classname"><strong class="classname">SessionHandler</strong></span>.
    </p>
   </div>
  </div>

  <div class="section" id="sessionhandler.examples">
   <div class="example" id="">
    <p><strong>Пример #1 
     Использование <span class="classname"><strong class="classname">SessionHandler</strong></span> для того, чтобы добавить
     шифровку данных ко внутреннему обработчику сессий PHP.
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br /> </span><span style="color: #FF8000">/**<br />  * расшифровать данные, используя алгоритм AES 256<br />  *<br />  * @param data $edata<br />  * @param string $password<br />  * @return расшифрованные данные<br />  */<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">decrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$edata</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">) {<br />    </span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">base64_decode</span><span style="color: #007700">(</span><span style="color: #0000BB">$edata</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$salt </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">16</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$ct </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">16</span><span style="color: #007700">);<br /><br />    </span><span style="color: #0000BB">$rounds </span><span style="color: #007700">= </span><span style="color: #0000BB">3</span><span style="color: #007700">; </span><span style="color: #FF8000">// зависит от длины ключа<br />    </span><span style="color: #0000BB">$data00 </span><span style="color: #007700">= </span><span style="color: #0000BB">$password</span><span style="color: #007700">.</span><span style="color: #0000BB">$salt</span><span style="color: #007700">;<br />    </span><span style="color: #0000BB">$hash </span><span style="color: #007700">= array();<br />    </span><span style="color: #0000BB">$hash</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">] = </span><span style="color: #0000BB">hash</span><span style="color: #007700">(</span><span style="color: #DD0000">'sha256'</span><span style="color: #007700">, </span><span style="color: #0000BB">$data00</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$result </span><span style="color: #007700">= </span><span style="color: #0000BB">$hash</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">];<br />    for (</span><span style="color: #0000BB">$i </span><span style="color: #007700">= </span><span style="color: #0000BB">1</span><span style="color: #007700">; </span><span style="color: #0000BB">$i </span><span style="color: #007700">&lt; </span><span style="color: #0000BB">$rounds</span><span style="color: #007700">; </span><span style="color: #0000BB">$i</span><span style="color: #007700">++) {<br />        </span><span style="color: #0000BB">$hash</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">] = </span><span style="color: #0000BB">hash</span><span style="color: #007700">(</span><span style="color: #DD0000">'sha256'</span><span style="color: #007700">, </span><span style="color: #0000BB">$hash</span><span style="color: #007700">[</span><span style="color: #0000BB">$i </span><span style="color: #007700">- </span><span style="color: #0000BB">1</span><span style="color: #007700">].</span><span style="color: #0000BB">$data00</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />        </span><span style="color: #0000BB">$result </span><span style="color: #007700">.= </span><span style="color: #0000BB">$hash</span><span style="color: #007700">[</span><span style="color: #0000BB">$i</span><span style="color: #007700">];<br />    }<br />    </span><span style="color: #0000BB">$key </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">32</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$iv  </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$result</span><span style="color: #007700">, </span><span style="color: #0000BB">32</span><span style="color: #007700">,</span><span style="color: #0000BB">16</span><span style="color: #007700">);<br /><br />    return </span><span style="color: #0000BB">openssl_decrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$ct</span><span style="color: #007700">, </span><span style="color: #DD0000">'AES-256-CBC'</span><span style="color: #007700">, </span><span style="color: #0000BB">$key</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">, </span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br />  }<br /><br /></span><span style="color: #FF8000">/**<br /> * зашифровать данные алгоритмом AES 256<br /> *<br /> * @param data $data<br /> * @param string $password<br /> * @return base64 зашифрованные данные<br /> */<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">encrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">$password</span><span style="color: #007700">) {<br />    </span><span style="color: #FF8000">// Генерация криптографически безопасной случайной соли с помощью функции random_bytes()<br />    </span><span style="color: #0000BB">$salt </span><span style="color: #007700">= </span><span style="color: #0000BB">random_bytes</span><span style="color: #007700">(</span><span style="color: #0000BB">16</span><span style="color: #007700">);<br /><br />    </span><span style="color: #0000BB">$salted </span><span style="color: #007700">= </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />    </span><span style="color: #0000BB">$dx </span><span style="color: #007700">= </span><span style="color: #DD0000">''</span><span style="color: #007700">;<br />    </span><span style="color: #FF8000">// Ключ соли (32) и вектор инициализации (16) = 48<br />    </span><span style="color: #007700">while (</span><span style="color: #0000BB">strlen</span><span style="color: #007700">(</span><span style="color: #0000BB">$salted</span><span style="color: #007700">) &lt; </span><span style="color: #0000BB">48</span><span style="color: #007700">) {<br />      </span><span style="color: #0000BB">$dx </span><span style="color: #007700">= </span><span style="color: #0000BB">hash</span><span style="color: #007700">(</span><span style="color: #DD0000">'sha256'</span><span style="color: #007700">, </span><span style="color: #0000BB">$dx</span><span style="color: #007700">.</span><span style="color: #0000BB">$password</span><span style="color: #007700">.</span><span style="color: #0000BB">$salt</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />      </span><span style="color: #0000BB">$salted </span><span style="color: #007700">.= </span><span style="color: #0000BB">$dx</span><span style="color: #007700">;<br />    }<br /><br />    </span><span style="color: #0000BB">$key </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$salted</span><span style="color: #007700">, </span><span style="color: #0000BB">0</span><span style="color: #007700">, </span><span style="color: #0000BB">32</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">$iv  </span><span style="color: #007700">= </span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$salted</span><span style="color: #007700">, </span><span style="color: #0000BB">32</span><span style="color: #007700">,</span><span style="color: #0000BB">16</span><span style="color: #007700">);<br /><br />    </span><span style="color: #0000BB">$encrypted_data </span><span style="color: #007700">= </span><span style="color: #0000BB">openssl_encrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #DD0000">'AES-256-CBC'</span><span style="color: #007700">, </span><span style="color: #0000BB">$key</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">, </span><span style="color: #0000BB">$iv</span><span style="color: #007700">);<br />    return </span><span style="color: #0000BB">base64_encode</span><span style="color: #007700">(</span><span style="color: #0000BB">$salt </span><span style="color: #007700">. </span><span style="color: #0000BB">$encrypted_data</span><span style="color: #007700">);<br />}<br /><br />class </span><span style="color: #0000BB">EncryptedSessionHandler </span><span style="color: #007700">extends </span><span style="color: #0000BB">SessionHandler<br /></span><span style="color: #007700">{<br />    private </span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br /><br />    public function </span><span style="color: #0000BB">__construct</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key </span><span style="color: #007700">= </span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br />    }<br /><br />    public function </span><span style="color: #0000BB">read</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">read</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br /><br />        if (!</span><span style="color: #0000BB">$data</span><span style="color: #007700">) {<br />            return </span><span style="color: #DD0000">""</span><span style="color: #007700">;<br />        } else {<br />            return </span><span style="color: #0000BB">decrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key</span><span style="color: #007700">);<br />        }<br />    }<br /><br />    public function </span><span style="color: #0000BB">write</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">)<br />    {<br />        </span><span style="color: #0000BB">$data </span><span style="color: #007700">= </span><span style="color: #0000BB">encrypt</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">, </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">key</span><span style="color: #007700">);<br /><br />        return </span><span style="color: #0000BB">parent</span><span style="color: #007700">::</span><span style="color: #0000BB">write</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">, </span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br />    }<br />}<br /><br /></span><span style="color: #FF8000">// Здесь мы перехватываем встроенный обработчик 'files', но можно использовать любой другой<br />// обработчик, например 'sqlite', 'memcache' или 'memcached',<br />// которые предоставлены модулями PHP.<br /></span><span style="color: #0000BB">ini_set</span><span style="color: #007700">(</span><span style="color: #DD0000">'session.save_handler'</span><span style="color: #007700">, </span><span style="color: #DD0000">'files'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$key </span><span style="color: #007700">= </span><span style="color: #DD0000">'secret_string'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$handler </span><span style="color: #007700">= new </span><span style="color: #0000BB">EncryptedSessionHandler</span><span style="color: #007700">(</span><span style="color: #0000BB">$key</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">session_set_save_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$handler</span><span style="color: #007700">, </span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">session_start</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">// устанавливаем и получаем значения из $_SESSION</span></span></code></div>
    </div>

   </div>
   <blockquote class="note"><p><strong class="note">Замечание</strong>: 
    <p class="para">
     Так как методы этого класса предназначены для внутренних вызовов из PHP, как часть
     нормального процесса работы сессий, вызовы родительских методов из дочернего класса
     (иными словами &quot;родных&quot; обработчиков) будет возвращать <strong><code>false</code></strong> до тех пор,
     пока сессия не будет запущена (автоматически или прямым вызовом <span class="function"><a href="function.session-start.php.html" class="function">session_start()</a></span>).
     Это важный момент для понимания, особенно при тестировании, где методы класса
     могут быть вызваны вручную.
    </p>
   </p></blockquote>
  </div>

 </div>

 











































<h2>Содержание</h2><ul class="chunklist chunklist_reference"><li><a href="sessionhandler.close.php.html">SessionHandler::close</a> — Закрывает сессию</li><li><a href="sessionhandler.create-sid.php.html">SessionHandler::create_sid</a> — Возвращает новый идентификатор сессии</li><li><a href="sessionhandler.destroy.php.html">SessionHandler::destroy</a> — Уничтожает сессию</li><li><a href="sessionhandler.gc.php.html">SessionHandler::gc</a> — Очищает старые сессии</li><li><a href="sessionhandler.open.php.html">SessionHandler::open</a> — Инициализирует сессию</li><li><a href="sessionhandler.read.php.html">SessionHandler::read</a> — Считывает данные сессии</li><li><a href="sessionhandler.write.php.html">SessionHandler::write</a> — Записывает данные сессии</li></ul>
</div>
<section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=class.sessionhandler&amp;redirect=https://www.php.net/manual/ru/class.sessionhandler.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">7 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="117756">  <div class="votes">
    <div id="Vu117756">
    <a href="https://www.php.net/manual/vote-note.php?id=117756&amp;page=class.sessionhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd117756">
    <a href="https://www.php.net/manual/vote-note.php?id=117756&amp;page=class.sessionhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V117756" title="93% like this...">
    42
    </div>
  </div>
  <a href="class.sessionhandler.php.html#117756" class="name">
  <strong class="user"><em>rasmus at mindplay dot dk</em></strong></a><a class="genanchor" href="class.sessionhandler.php.html#117756"> &para;</a><div class="date" title="2015-08-03 09:08"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom117756">
<div class="phpcode"><code><span class="html">As the life-cycle of a session handler is fairly complex, I found it difficult to understand when explained using just words - so I traced the function calls made to a custom SessionHandler, and created this overview of precisely what happens when you call various session methods:<br /><br /><a href="https://gist.github.com/mindplay-dk/623bdd50c1b4c0553cd3" rel="nofollow" target="_blank">https://gist.github.com/mindplay-dk/623bdd50c1b4c0553cd3</a><br /><br />I hope this makes it considerably easier to implement a custom SessionHandler and get it right the first time :-)</span></code></div>
  </div>
 </div>
  <div class="note" id="128184">  <div class="votes">
    <div id="Vu128184">
    <a href="https://www.php.net/manual/vote-note.php?id=128184&amp;page=class.sessionhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd128184">
    <a href="https://www.php.net/manual/vote-note.php?id=128184&amp;page=class.sessionhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V128184" title="100% like this...">
    5
    </div>
  </div>
  <a href="class.sessionhandler.php.html#128184" class="name">
  <strong class="user"><em>tuncdan dot ozdemir dot peng at gmail dot com</em></strong></a><a class="genanchor" href="class.sessionhandler.php.html#128184"> &para;</a><div class="date" title="2023-02-03 07:57"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom128184">
<div class="phpcode"><code><span class="html">Those who are planning to implement your own SessionHandler, let's say using a Database system, please make sure your 'create_sid' method creates a new record in your database with empty string '' as your 'data' using the new session ID created, otherwise when 'read' method is called (which is always called no matter if it is a brand new session or not), you will get an error because there is no record with that session ID yet.  The funny part is that the error you get will sound like PHP is trying open the session on your local drive (coming from your .ini file).</span></code></div>
  </div>
 </div>
  <div class="note" id="128181">  <div class="votes">
    <div id="Vu128181">
    <a href="https://www.php.net/manual/vote-note.php?id=128181&amp;page=class.sessionhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd128181">
    <a href="https://www.php.net/manual/vote-note.php?id=128181&amp;page=class.sessionhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V128181" title="80% like this...">
    3
    </div>
  </div>
  <a href="class.sessionhandler.php.html#128181" class="name">
  <strong class="user"><em>tuncdan dot ozdemir dot peng at gmail dot com</em></strong></a><a class="genanchor" href="class.sessionhandler.php.html#128181"> &para;</a><div class="date" title="2023-02-02 10:06"><strong>1 year ago</strong></div>
  <div class="text" id="Hcom128181">
<div class="phpcode"><code><span class="html">The best way to set up your own session handler is to extend the native SessionHandler (override the 7 methods + constructor as per your need, keeping the same signatures).  Optionally, you can also implement SessionUpdateTimestampHandlerInterface if you plan to use 'lazy_write':<br /><br />Option 1:<br /><br />class MyOwnSessionHandler extends \SessionHandler { ..... }<br /><br />Option 2:<br /><br />class MyOwnSessionHandler extends \SessionHandler implements \SessionUpdateTimestampHandlerInterface { ..... }<br /><br />I would NOT recommend to do this:<br /><br />class MyOwnSessionHandler implements \SessionHandlerInterface, \SessionIdInterface, \SessionUpdateTimestampHandlerInterface { ... }<br /><br />If you are curious, here are the methods called in the order (using PHP 8.2 with XAMPP v3.3.0 on Windows 11 64-bit):<br /><br />- open (always called)<br /><br />- validateId and/or create_sid:<br /><br />    validateId is called if you implement SessionUpdateTimestampHandlerInterface.  If validation fails, create_sid is called.     <br /><br />    create_sid is called if a new session ID is needed: new session, etc.<br /><br />- read (always called)<br /><br />- write OR updateTimestamp OR destroy:<br /><br />    if you call 'destroy', neither 'write' or 'updateTimestamp' is called,<br /><br />    if you have the 'lazy_write' on AND implemented SessionUpdateTimestampHandlerInterface, <br />    then 'updateTimestamp' is called instead of 'write' if nothing changes.<br /><br />- close (always called)</span></code></div>
  </div>
 </div>
  <div class="note" id="122826">  <div class="votes">
    <div id="Vu122826">
    <a href="https://www.php.net/manual/vote-note.php?id=122826&amp;page=class.sessionhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd122826">
    <a href="https://www.php.net/manual/vote-note.php?id=122826&amp;page=class.sessionhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V122826" title="77% like this...">
    5
    </div>
  </div>
  <a href="class.sessionhandler.php.html#122826" class="name">
  <strong class="user"><em>tony at marston-home dot demon dot co dot uk</em></strong></a><a class="genanchor" href="class.sessionhandler.php.html#122826"> &para;</a><div class="date" title="2018-06-12 07:55"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom122826">
<div class="phpcode"><code><span class="html">Your custom session handler should not contain calls to any of the session functions, such as session_name() or session_id(), as the relevant values are passed as arguments on various handler methods. Attempting to obtain values from alternative sources may not work as expected.</span></code></div>
  </div>
 </div>
  <div class="note" id="124829">  <div class="votes">
    <div id="Vu124829">
    <a href="https://www.php.net/manual/vote-note.php?id=124829&amp;page=class.sessionhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd124829">
    <a href="https://www.php.net/manual/vote-note.php?id=124829&amp;page=class.sessionhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V124829" title="60% like this...">
    1
    </div>
  </div>
  <a href="class.sessionhandler.php.html#124829" class="name">
  <strong class="user"><em>saccani dot francesco dot NOSPAM at gmail dot com</em></strong></a><a class="genanchor" href="class.sessionhandler.php.html#124829"> &para;</a><div class="date" title="2020-03-15 08:07"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom124829">
<div class="phpcode"><code><span class="html">I made this gist to provide a complete overview of the PHP session handler life cycle updated to version 7.0 or above. In particular, I wanted to emphasize what methods and in what order are called when the native PHP functions are used for session management.<br /><br /><a href="https://gist.github.com/franksacco/d6e943c41189f8ee306c182bf8f07654" rel="nofollow" target="_blank">https://gist.github.com/franksacco/d6e943c41189f8ee306c182bf8f07654</a><br /><br />I hope this analysis will help all the developers interested in understanding in detail the native session management performed by PHP and what a custom session handler should do.<br />Any comment or suggestion is appreciated.</span></code></div>
  </div>
 </div>
  <div class="note" id="118964">  <div class="votes">
    <div id="Vu118964">
    <a href="https://www.php.net/manual/vote-note.php?id=118964&amp;page=class.sessionhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd118964">
    <a href="https://www.php.net/manual/vote-note.php?id=118964&amp;page=class.sessionhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V118964" title="37% like this...">
    -4
    </div>
  </div>
  <a href="class.sessionhandler.php.html#118964" class="name">
  <strong class="user"><em>jeremie dot legrand at komori-chambon dot fr</em></strong></a><a class="genanchor" href="class.sessionhandler.php.html#118964"> &para;</a><div class="date" title="2016-03-09 09:22"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom118964">
<div class="phpcode"><code><span class="html">Here is a wrapper to log in a file each session's operations. Useful to investigate sessions locks (which prevent PHP to serve simultaneous requests for a same client).<br />Just change the file name at the end to dump logs where you want. <br /><br />class DumpSessionHandler extends SessionHandler {<br />    private $fich;<br /><br />    public function __construct($fich) {<br />        $this-&gt;fich = $fich;<br />    }<br /><br />    public function close() {<br />        $this-&gt;log('close');<br />        return parent::close();<br />    }<br /><br />    public function create_sid() {<br />        $this-&gt;log('create_sid');<br />        return parent::create_sid();<br />    }<br /><br />    public function destroy($session_id) {<br />        $this-&gt;log('destroy('.$session_id.')');<br />        return parent::destroy($session_id);<br />    }<br /><br />    public function gc($maxlifetime) {<br />        $this-&gt;log('close('.$maxlifetime.')');<br />        return parent::gc($maxlifetime);<br />    }<br /><br />    public function open($save_path, $session_name) {<br />        $this-&gt;log('open('.$save_path.', '.$session_name.')');<br />        return parent::open($save_path, $session_name);<br />    }<br /><br />    public function read($session_id) {<br />        $this-&gt;log('read('.$session_id.')');<br />        return parent::read($session_id);<br />    }<br /><br />    public function write($session_id, $session_data) {<br />        $this-&gt;log('write('.$session_id.', '.$session_data.')');<br />        return parent::write($session_id, $session_data);<br />    }<br /><br />    private function log($action) {<br />        $base_uri = explode('?', $_SERVER['REQUEST_URI'], 2)[0];<br />        $hdl = fopen($this-&gt;fich, 'a');<br />        fwrite($hdl, date('Y-m-d h:i:s').' '.$base_uri.' : '.$action."\n");<br />        fclose($hdl);<br />    }<br />}<br />ini_set('session.save_handler', 'files');<br />$handler = new DumpSessionHandler('/path/to/dump_sessions.log');<br />session_set_save_handler($handler, true);</span></code></div>
  </div>
 </div>
  <div class="note" id="123892">  <div class="votes">
    <div id="Vu123892">
    <a href="https://www.php.net/manual/vote-note.php?id=123892&amp;page=class.sessionhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd123892">
    <a href="https://www.php.net/manual/vote-note.php?id=123892&amp;page=class.sessionhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V123892" title="20% like this...">
    -3
    </div>
  </div>
  <a href="class.sessionhandler.php.html#123892" class="name">
  <strong class="user"><em>wei dot kavin at gmail dot com</em></strong></a><a class="genanchor" href="class.sessionhandler.php.html#123892"> &para;</a><div class="date" title="2019-05-29 07:38"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom123892">
<div class="phpcode"><code><span class="html">php -S localhost:8000 -t foo/<br /><br />touch index.php<br /><br />vi index.php<br />============================================================<br />class NativeSessionHandler extends \SessionHandler<br />{<br />    public function __construct($savePath = null)<br />    {<br />        if (null === $savePath) {<br />            $savePath = ini_get('session.save_path');<br />        }<br /><br />        $baseDir = $savePath;<br /><br />        if ($count = substr_count($savePath, ';')) {<br />            if ($count &gt; 2) {<br />                throw new \InvalidArgumentException(sprintf('Invalid argument $savePath \'%s\'', $savePath));<br />            }<br /><br />            // characters after last ';' are the path<br />            $baseDir = ltrim(strrchr($savePath, ';'), ';');<br />        }<br /><br />        if ($baseDir &amp;&amp; !is_dir($baseDir) &amp;&amp; !@mkdir($baseDir, 0777, true) &amp;&amp; !is_dir($baseDir)) {<br />            throw new \RuntimeException(sprintf('Session Storage was not able to create directory "%s"', $baseDir));<br />        }<br /><br />        ini_set('session.save_path', $savePath);<br />        ini_set('session.save_handler', 'files');<br />    }<br />}<br /><br />$handler = new NativeSessionHandler("/var/www/foo");<br />session_set_save_handler($handler, true);<br />session_start();<br />$a = $handler-&gt;write("aaa","bbbb");var_dump($a);exit;<br /><br />============================================================<br /><br />output：bool(false)</span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=class.sessionhandler&amp;redirect=https://www.php.net/manual/ru/class.sessionhandler.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="book.session.php.html">Сессии</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="intro.session.php.html" title="Введение">Введение</a>
                        </li>
                                                <li class="">
                            <a href="session.setup.php.html" title="Установка и настройка">Установка и настройка</a>
                        </li>
                                                <li class="">
                            <a href="session.constants.php.html" title="Предопределённые константы">Предопределённые константы</a>
                        </li>
                                                <li class="">
                            <a href="session.examples.php.html" title="Примеры">Примеры</a>
                        </li>
                                                <li class="">
                            <a href="session.upload-progress.php.html" title="Отслеживание прогресса загрузки файлов с помощью сессий">Отслеживание прогресса загрузки файлов с помощью сессий</a>
                        </li>
                                                <li class="">
                            <a href="session.security.php.html" title="Безопасность сессий">Безопасность сессий</a>
                        </li>
                                                <li class="">
                            <a href="ref.session.php.html" title="Функции для работы с сессиями">Функции для работы с сессиями</a>
                        </li>
                                                <li class="current">
                            <a href="class.sessionhandler.php.html" title="SessionHandler">SessionHandler</a>
                        </li>
                                                <li class="">
                            <a href="class.sessionhandlerinterface.php.html" title="SessionHandlerInterface">SessionHandlerInterface</a>
                        </li>
                                                <li class="">
                            <a href="class.sessionidinterface.php.html" title="SessionIdInterface">SessionIdInterface</a>
                        </li>
                                                <li class="">
                            <a href="class.sessionupdatetimestamphandlerinterface.php.html" title="SessionUpdateTimestampHandlerInterface">SessionUpdateTimestampHandlerInterface</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
