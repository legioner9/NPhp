<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: DOMXPath::query - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="domxpath.query.php.html">
 <link rel="shorturl" href="domxpath.query.php.html">
 <link rel="alternate" href="domxpath.query.php.html" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="class.domxpath.php.html">
 <link rel="prev" href="domxpath.evaluate.php.html">
 <link rel="next" href="domxpath.registernamespace.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/domxpath.query.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/domxpath.query.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/domxpath.query.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/domxpath.query.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/domxpath.query.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/domxpath.query.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/domxpath.query.php" hreflang="pt_BR">
 <link rel="alternate" href="domxpath.query.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/domxpath.query.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/domxpath.query.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="domxpath.registernamespace.php.html">
          DOMXPath::registerNamespace &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="domxpath.evaluate.php.html">
          &laquo; DOMXPath::evaluate        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='funcref.php.html'>Справочник функций</a></li>      <li><a href='refs.xml.php.html'>Обработка XML</a></li>      <li><a href='book.dom.php.html'>DOM</a></li>      <li><a href='class.domxpath.php.html'>DOMXPath</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/domxpath.query.php'>English</option>
            <option value='de/domxpath.query.php'>German</option>
            <option value='es/domxpath.query.php'>Spanish</option>
            <option value='fr/domxpath.query.php'>French</option>
            <option value='it/domxpath.query.php'>Italian</option>
            <option value='ja/domxpath.query.php'>Japanese</option>
            <option value='pt_BR/domxpath.query.php'>Brazilian Portuguese</option>
            <option value='ru/domxpath.query.php' selected="selected">Russian</option>
            <option value='tr/domxpath.query.php'>Turkish</option>
            <option value='zh/domxpath.query.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/reference/dom/domxpath/query.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Fdomxpath.query%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="domxpath.query" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">DOMXPath::query</h1>
  <p class="verinfo">(PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">DOMXPath::query</span> &mdash; <span class="dc-title">
   Выполняет заданное выражение XPath
  </span></p>

 </div>
 <div class="refsect1 description" id="refsect1-domxpath.query-description">
  <h3 class="title">Описание</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="methodname"><strong>DOMXPath::query</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$expression</code></span>, <span class="methodparam"><span class="type">?</span><span class="type"><span class="type"><a href="class.domnode.php.html" class="type DOMNode">DOMNode</a></span><span class="type"></span></span> <code class="parameter">$contextNode</code><span class="initializer"> = <strong><code>null</code></strong></span></span>, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$registerNodeNS</code><span class="initializer"> = <strong><code>true</code></strong></span></span>): <span class="type"><a href="language.types.declarations.php.html#language.types.declarations.mixed" class="type mixed">mixed</a></span></div>

  <p class="para rdfs-comment">
   Выполняет заданное XPath-выражение <code class="parameter">expression</code>.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-domxpath.query-parameters">
  <h3 class="title">Список параметров</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">expression</code></dt>

     <dd>

      <p class="para">
       Выражение XPath для выполнения.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">contextNode</code></dt>

     <dd>

      <p class="para">
       Дополнительный параметр <code class="parameter">contextNode</code> может быть
       указан для выполнения относительных запросов XPath. По
       умолчанию запросы выполняются относительно корневого элемента.
      </p>
     </dd>

    
    
 <dt>
<code class="parameter">registerNodeNS</code></dt>

 <dd>

  <p class="para">
   Нужно ли автоматически регистрировать префиксы пространства имён
   в области видимости контекстного узла для объекта <span class="classname"><a href="class.domxpath.php.html" class="classname">DOMXPath</a></span>.
   Параметр помогает избегать ручного вызова метода
   <span class="methodname"><a href="domxpath.registernamespace.php.html" class="methodname">DOMXPath::registerNamespace()</a></span>
   для каждого пространства имён в области видимости.
   Когда префиксы пространства имён конфликтуют,
   регистрируется только префикс пространства имён близлежащего потомка.
  </p>
 </dd>


   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-domxpath.query-returnvalues">
  <h3 class="title">Возвращаемые значения</h3>
  <p class="para">
   Возвращает объект <span class="classname"><a href="class.domnodelist.php.html" class="classname">DOMNodeList</a></span>, содержащий узлы,
   соответствующие выражению XPath <code class="parameter">expression</code>.
   Любое выражение, не возвращающее узлы, вернёт пустой объект
   <span class="classname"><a href="class.domnodelist.php.html" class="classname">DOMNodeList</a></span>.
  </p>
  <p class="para">
   Если <code class="parameter">expression</code> построено
   неправильно или <code class="parameter">contextNode</code> имеет неверное значение,
   <span class="methodname"><strong>DOMXPath::query()</strong></span> вернёт <strong><code>false</code></strong>.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-domxpath.query-examples">
  <h3 class="title">Примеры</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Пример #1 
     Получение списка всех книг на английском
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br />$doc </span><span style="color: #007700">= new </span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// Не хотим возиться с пробелами<br /></span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">preserveWhiteSpace </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'book.xml'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$xpath </span><span style="color: #007700">= new </span><span style="color: #0000BB">DOMXPath</span><span style="color: #007700">(</span><span style="color: #0000BB">$doc</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Начинаем с корневого элемента<br /></span><span style="color: #0000BB">$query </span><span style="color: #007700">= </span><span style="color: #DD0000">'//book/chapter/para/informaltable/tgroup/tbody/row/entry[. = "en"]'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$entries </span><span style="color: #007700">= </span><span style="color: #0000BB">$xpath</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /><br />foreach (</span><span style="color: #0000BB">$entries </span><span style="color: #007700">as </span><span style="color: #0000BB">$entry</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"Найдена книга </span><span style="color: #007700">{</span><span style="color: #0000BB">$entry</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nodeValue</span><span style="color: #007700">}</span><span style="color: #DD0000">," </span><span style="color: #007700">.<br />         </span><span style="color: #DD0000">" автор </span><span style="color: #007700">{</span><span style="color: #0000BB">$entry</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nodeValue</span><span style="color: #007700">}</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    
<div class="example-contents"><p>
 Результат выполнения приведённого примера:
</p></div>

    <div class="example-contents screen">
<div class="cdata"><pre>
Найдена книга The Grapes of Wrath, автор John Steinbeck
Найдена книга The Pearl, автор John Steinbeck
</pre></div>
    </div>
    <div class="example-contents"><p>
     Можно также использовать параметр <code class="parameter">contextNode</code>
     для более короткой записи выражения:
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br />$doc </span><span style="color: #007700">= new </span><span style="color: #0000BB">DOMDocument</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">preserveWhiteSpace </span><span style="color: #007700">= </span><span style="color: #0000BB">false</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">load</span><span style="color: #007700">(</span><span style="color: #DD0000">'book.xml'</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$xpath </span><span style="color: #007700">= new </span><span style="color: #0000BB">DOMXPath</span><span style="color: #007700">(</span><span style="color: #0000BB">$doc</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$tbody </span><span style="color: #007700">= </span><span style="color: #0000BB">$doc</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getElementsByTagName</span><span style="color: #007700">(</span><span style="color: #DD0000">'tbody'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">item</span><span style="color: #007700">(</span><span style="color: #0000BB">0</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// запрос относительно узла tbody<br /></span><span style="color: #0000BB">$query </span><span style="color: #007700">= </span><span style="color: #DD0000">'row/entry[. = "en"]'</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">$entries </span><span style="color: #007700">= </span><span style="color: #0000BB">$xpath</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">, </span><span style="color: #0000BB">$tbody</span><span style="color: #007700">);<br /><br />foreach (</span><span style="color: #0000BB">$entries </span><span style="color: #007700">as </span><span style="color: #0000BB">$entry</span><span style="color: #007700">) {<br />    echo </span><span style="color: #DD0000">"Найдена книга </span><span style="color: #007700">{</span><span style="color: #0000BB">$entry</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nodeValue</span><span style="color: #007700">}</span><span style="color: #DD0000">," </span><span style="color: #007700">.<br />         </span><span style="color: #DD0000">" автор </span><span style="color: #007700">{</span><span style="color: #0000BB">$entry</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">previousSibling</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">nodeValue</span><span style="color: #007700">}</span><span style="color: #DD0000">\n"</span><span style="color: #007700">;<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-domxpath.query-seealso">
  <h3 class="title">Смотрите также</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="methodname"><a href="domxpath.evaluate.php.html" class="methodname" rel="rdfs-seeAlso">DOMXPath::evaluate()</a> - Вычисляет переданное выражение XPath и возвращает типизированный результат,
   если возможно</span></li>
   </ul>
  </p>
 </div>

</div><section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=domxpath.query&amp;redirect=https://www.php.net/manual/ru/domxpath.query.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">18 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="99760">  <div class="votes">
    <div id="Vu99760">
    <a href="https://www.php.net/manual/vote-note.php?id=99760&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd99760">
    <a href="https://www.php.net/manual/vote-note.php?id=99760&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V99760" title="94% like this...">
    119
    </div>
  </div>
  <a href="domxpath.query.php.html#99760" class="name">
  <strong class="user"><em>kkez at example dot com</em></strong></a><a class="genanchor" href="domxpath.query.php.html#99760"> &para;</a><div class="date" title="2010-09-03 07:51"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom99760">
<div class="phpcode"><code><span class="html">If the query() function seems to ignore your $contextnode, and instead returns all the tags in the document, try to use a relative path (use a . in front of the query):<br /><br /><span class="default">&lt;?php<br />    $xml </span><span class="keyword">= </span><span class="string">"&lt;?xml version='1.0' encoding='UTF-8'?&gt;<br />        &lt;test&gt;<br />            &lt;tag1&gt;<br />                &lt;uselesstag&gt;<br />                    &lt;tag2&gt;test&lt;/tag2&gt;<br />                &lt;/uselesstag&gt;<br />            &lt;/tag1&gt;<br />            &lt;tag2&gt;test2&lt;/tag2&gt;<br />        &lt;/test&gt;"</span><span class="keyword">;<br />   <br />    </span><span class="default">$dom </span><span class="keyword">= new </span><span class="default">DomDocument</span><span class="keyword">();<br />    </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br />    </span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DomXPath</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">);<br />   <br />    </span><span class="default">$tag1 </span><span class="keyword">= </span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">getElementsByTagName</span><span class="keyword">(</span><span class="string">"tag1"</span><span class="keyword">)-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />   <br />    echo </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"//tag2"</span><span class="keyword">)-&gt;</span><span class="default">length</span><span class="keyword">; </span><span class="comment">//output 2 -&gt; correct<br />    </span><span class="keyword">echo </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"//tag2"</span><span class="keyword">, </span><span class="default">$tag1</span><span class="keyword">)-&gt;</span><span class="default">length</span><span class="keyword">; </span><span class="comment">//output 2 -&gt; wrong, the query is not relative<br />    </span><span class="keyword">echo </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">".//tag2"</span><span class="keyword">, </span><span class="default">$tag1</span><span class="keyword">)-&gt;</span><span class="default">length</span><span class="keyword">; </span><span class="comment">//output 1 -&gt; correct (note the dot in front of //)<br /></span><span class="default">?&gt;<br /></span><br />See that i couldn't use $xpath-&gt;query("tag2", $tag1) as per the documentation, since "tag2" is not a direct child of "tag1".<br />I don't know why this note was deleted, i just tested it and it's correct.<br />It's not a bug, it's simply not written in the documentation.</span></code></div>
  </div>
 </div>
  <div class="note" id="77048">  <div class="votes">
    <div id="Vu77048">
    <a href="https://www.php.net/manual/vote-note.php?id=77048&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd77048">
    <a href="https://www.php.net/manual/vote-note.php?id=77048&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V77048" title="89% like this...">
    30
    </div>
  </div>
  <a href="domxpath.query.php.html#77048" class="name">
  <strong class="user"><em>Hayley Watson</em></strong></a><a class="genanchor" href="domxpath.query.php.html#77048"> &para;</a><div class="date" title="2007-08-12 05:43"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom77048">
<div class="phpcode"><code><span class="html">Note that if your DOMDocument was loaded from HTML, where element and attribute names are case-insensitive, the DOM parser converts them all to lower-case, so your XPath queries will have to as well; '//A/@HREF' won't find anything even if the original HTML contained "&lt;A HREF='example.com'&gt;".</span></code></div>
  </div>
 </div>
  <div class="note" id="76311">  <div class="votes">
    <div id="Vu76311">
    <a href="https://www.php.net/manual/vote-note.php?id=76311&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd76311">
    <a href="https://www.php.net/manual/vote-note.php?id=76311&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V76311" title="81% like this...">
    23
    </div>
  </div>
  <a href="domxpath.query.php.html#76311" class="name">
  <strong class="user"><em>nicolas_rainardNOSPAM at yahoo dot fr</em></strong></a><a class="genanchor" href="domxpath.query.php.html#76311"> &para;</a><div class="date" title="2007-07-10 02:04"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom76311">
<div class="phpcode"><code><span class="html">Please note that what clochix says is valid for *any* document which has a default namespace (as it is the case for XHTML).<br /><br />This document :<br /><br />&lt;?xml version="1.0" encoding="UTF-8" ?&gt;<br /><br />&lt;root xmlns="<a href="http://www.exemple.org/namespace" rel="nofollow" target="_blank">http://www.exemple.org/namespace</a>"&gt;<br /><br />    &lt;element id="1"&gt;<br />    ...<br />    &lt;/element&gt;<br /><br />    &lt;element id="2"&gt;<br />    ...<br />    &lt;/element&gt;<br /><br />&lt;/element&gt;<br /><br />must be accessed this way :<br /><br />$document = new DOMDocument();<br />$document-&gt;load('document.xml');<br /><br />$xpath = new DOMXPath($document);<br />$xpath-&gt;registerNameSpace('fakeprefix', '<a href="http://www.exemple.org/namespace" rel="nofollow" target="_blank">http://www.exemple.org/namespace</a>');<br /><br />$elements = $xpath-&gt;query('//fakeprefix:element');<br /><br />Of course, there is no prefix in the original document, but the DOMXPath class *needs* one, whatever it is, if you use a default namespace. It *doesn't work* if you specify an empty prefix like this :<br /><br />$xpath-&gt;registerNameSpace('', '<a href="http://www.exemple.org/namespace" rel="nofollow" target="_blank">http://www.exemple.org/namespace</a>');<br /><br />Hope this help to spare some time...</span></code></div>
  </div>
 </div>
  <div class="note" id="113248">  <div class="votes">
    <div id="Vu113248">
    <a href="https://www.php.net/manual/vote-note.php?id=113248&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd113248">
    <a href="https://www.php.net/manual/vote-note.php?id=113248&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V113248" title="81% like this...">
    7
    </div>
  </div>
  <a href="domxpath.query.php.html#113248" class="name">
  <strong class="user"><em>RiKdnUa at mail dot ru</em></strong></a><a class="genanchor" href="domxpath.query.php.html#113248"> &para;</a><div class="date" title="2013-09-17 04:26"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom113248">
<div class="phpcode"><code><span class="html">Пример XPath запроса к XML документу. XML документ содержить элементы с именами из НЕлатинских символов (кириллица). При использовании в XPath запросе предиката, функция DOMXPath::query() выдает предупреждение и запрос не работает. Чтобы запрос работал, надо явно указывать ось. Файл этого примера должен быть в кодировке WINDOWS-1251. Тестировал в PHP 5.2.9-2 и PHP 5.2.17<br /><br />Example XPath-query to the XML-document. XML-document contains an elements with the names of non-Latin characters (cyrillic). When used predicate in XPath-query, function DOMXPath::query() gives a warning and query does not work. In order to earned the query, it is necessary to explicitly specify the axis. The file of this example is to be in the encoding WINDOWS-1251. Tested in PHP 5.2.9-2 and PHP 5.2.17<br /><span class="default">&lt;?php<br />ini_set</span><span class="keyword">(</span><span class="string">"display_errors"</span><span class="keyword">,</span><span class="string">"on"</span><span class="keyword">);<br /></span><span class="default">error_reporting</span><span class="keyword">(-</span><span class="default">1</span><span class="keyword">);<br />function </span><span class="default">utf8encode</span><span class="keyword">(</span><span class="default">$str</span><span class="keyword">){return </span><span class="default">iconv</span><span class="keyword">(</span><span class="string">'WINDOWS-1251'</span><span class="keyword">, </span><span class="string">'UTF-8'</span><span class="keyword">, </span><span class="default">$str</span><span class="keyword">);}<br /></span><span class="default">$xml</span><span class="keyword">=</span><span class="string">"&lt;?xml version='1.0' encoding='WINDOWS-1251'?&gt;<br />&lt;часть&gt;<br />&lt;ссылка href='yandex.com'&gt;Яндекс&lt;/ссылка&gt;<br />&lt;ссылка href='rik.dn.ua/fotopan.php'&gt;г.Донецк&lt;/ссылка&gt;<br />&lt;/часть&gt;<br />"</span><span class="keyword">;<br /></span><span class="default">$document</span><span class="keyword">=new </span><span class="default">domDocument</span><span class="keyword">();<br /></span><span class="default">$document</span><span class="keyword">-&gt;</span><span class="default">preserveWhiteSpace</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">;<br /></span><span class="default">$document</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br /></span><span class="default">$domxpath</span><span class="keyword">=new </span><span class="default">domXpath</span><span class="keyword">(</span><span class="default">$document</span><span class="keyword">);<br /></span><span class="default">$list</span><span class="keyword">=</span><span class="default">$domxpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">utf8encode</span><span class="keyword">(</span><span class="string">'/child::часть/child::ссылка'</span><span class="keyword">));</span><span class="comment">//Ok<br /></span><span class="keyword">echo </span><span class="string">'$list-&gt;length='</span><span class="keyword">.</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">.</span><span class="string">"\n&lt;br/&gt;\n"</span><span class="keyword">;<br /></span><span class="default">$list</span><span class="keyword">=</span><span class="default">$domxpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">utf8encode</span><span class="keyword">(</span><span class="string">'/часть/ссылка'</span><span class="keyword">));</span><span class="comment">//Ok<br /></span><span class="keyword">echo </span><span class="string">'$list-&gt;length='</span><span class="keyword">.</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">.</span><span class="string">"\n&lt;br/&gt;\n"</span><span class="keyword">;<br /></span><span class="default">$list</span><span class="keyword">=</span><span class="default">$domxpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">utf8encode</span><span class="keyword">(</span><span class="string">'/child::часть/child::ссылка[position()=1]'</span><span class="keyword">));</span><span class="comment">//Ok<br /></span><span class="keyword">echo </span><span class="string">'$list-&gt;length='</span><span class="keyword">.</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">.</span><span class="string">"\n&lt;br/&gt;\n"</span><span class="keyword">;<br /></span><span class="default">$list</span><span class="keyword">=</span><span class="default">$domxpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">utf8encode</span><span class="keyword">(</span><span class="string">'/часть/ссылка[1]'</span><span class="keyword">));</span><span class="comment">//Warning: DOMXPath::query() [domxpath.query]: Invalid expression in ...<br /></span><span class="keyword">echo </span><span class="string">'$list-&gt;length='</span><span class="keyword">.</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">.</span><span class="string">"\n&lt;br/&gt;\n"</span><span class="keyword">;<br /></span><span class="default">$list</span><span class="keyword">=</span><span class="default">$domxpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">utf8encode</span><span class="keyword">(</span><span class="string">'/часть/ссылка[position()=1]'</span><span class="keyword">));</span><span class="comment">//Warning: DOMXPath::query() [domxpath.query]: Invalid expression in ...<br /></span><span class="keyword">echo </span><span class="string">'$list-&gt;length='</span><span class="keyword">.</span><span class="default">$list</span><span class="keyword">-&gt;</span><span class="default">length</span><span class="keyword">.</span><span class="string">"\n&lt;br/&gt;\n"</span><span class="keyword">;<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="84577">  <div class="votes">
    <div id="Vu84577">
    <a href="https://www.php.net/manual/vote-note.php?id=84577&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd84577">
    <a href="https://www.php.net/manual/vote-note.php?id=84577&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V84577" title="75% like this...">
    4
    </div>
  </div>
  <a href="domxpath.query.php.html#84577" class="name">
  <strong class="user"><em>adam dot prall at thinkingman dot com</em></strong></a><a class="genanchor" href="domxpath.query.php.html#84577"> &para;</a><div class="date" title="2008-07-19 09:01"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom84577">
<div class="phpcode"><code><span class="html">If you're wondering, like I was, why your XPath queries are not returning any of the new DOMElements you create in your (X)HTML documents, and only the ones originally loaded in with (for example) loadXML(), this is why; if you're doing things right, you have registered the nameSpace 'html' after creating your DOMXPath object thus:<br /><br /><span class="default">&lt;?php<br /><br /></span><span class="keyword">class </span><span class="default">XPathQueryLength </span><span class="keyword">{<br />     private </span><span class="default">$nameSpace </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />     function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">DOMDocument $doc</span><span class="keyword">) {<br />          </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xpath </span><span class="keyword">= new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">doc</span><span class="keyword">);<br />          </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xpath</span><span class="keyword">-&gt;</span><span class="default">registerNamespace</span><span class="keyword">(<br />                 </span><span class="string">'html'</span><span class="keyword">,</span><span class="string">'<a href="http://www.w3.org/1999/xhtml" rel="nofollow" target="_blank">http://www.w3.org/1999/xhtml</a>' </span><span class="keyword">);<br />     }<br />     function </span><span class="default">queryLength</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">) {<br />          return </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">)-&gt;</span><span class="default">length</span><span class="keyword">;<br />     }<br />}<br /><br /></span><span class="default">?&gt;<br /></span><br />...but don't forget that when adding new elements to the above DOMDocument $doc, to use createElementNS() instead of createElement(), otherwise you'll have this problem:<br /><br /><span class="default">&lt;?php<br /><br /></span><span class="comment">//$doc is a previously loaded XHTML document containing a normal html, head and body structure<br />//$body is the first selected tag using $doc-&gt;getElementsByTagName('body');<br /><br /></span><span class="default">$pTag </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createElement</span><span class="keyword">(</span><span class="string">'p'</span><span class="keyword">,</span><span class="string">'This is a new paragraph!'</span><span class="keyword">);<br /></span><span class="default">$body</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$pTag</span><span class="keyword">);<br /><br /></span><span class="default">$xPath </span><span class="keyword">= new </span><span class="default">XPathQueryLength</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">);<br />print </span><span class="default">$xPath</span><span class="keyword">-&gt;</span><span class="default">queryLength</span><span class="keyword">(</span><span class="string">'//html:p'</span><span class="keyword">);<br /><br /></span><span class="default">output</span><span class="keyword">: </span><span class="default">0<br /><br /></span><span class="keyword">print </span><span class="default">$xPath</span><span class="keyword">-&gt;</span><span class="default">queryLength</span><span class="keyword">(</span><span class="string">'//p'</span><span class="keyword">);<br /><br /></span><span class="default">output</span><span class="keyword">: </span><span class="default">1<br /><br />?&gt;<br /></span><br />So do this instead:<br /><br /><span class="default">&lt;?php<br /><br /></span><span class="comment">//$doc is a previously loaded XHTML document containing a normal html, head and body structure<br />//$body is the first selected tag using $doc-&gt;getElementsByTagName('body');<br /><br /></span><span class="default">$pTag </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">createElementNS</span><span class="keyword">(</span><span class="string">'<a href="http://www.w3.org/1999/xhtml" rel="nofollow" target="_blank">http://www.w3.org/1999/xhtml</a>'</span><span class="keyword">,</span><span class="string">'p'</span><span class="keyword">,</span><span class="string">'This is a new paragraph!'</span><span class="keyword">);<br /></span><span class="default">$body</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$pTag</span><span class="keyword">);<br /><br /></span><span class="default">$xPath </span><span class="keyword">= new </span><span class="default">XPathQueryLength</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">);<br />print </span><span class="default">$xPath</span><span class="keyword">-&gt;</span><span class="default">queryLength</span><span class="keyword">(</span><span class="string">'//html:p'</span><span class="keyword">);<br /><br /></span><span class="default">output</span><span class="keyword">: </span><span class="default">2<br /><br /></span><span class="keyword">print </span><span class="default">$xPath</span><span class="keyword">-&gt;</span><span class="default">queryLength</span><span class="keyword">(</span><span class="string">'//p'</span><span class="keyword">);<br /><br /></span><span class="default">output</span><span class="keyword">: </span><span class="default">0<br /><br />?&gt;<br /></span><br />The resulting XHTML file from both example scripts looks much like this:<br /><br />&lt;html&gt;<br />  &lt;head&gt;&lt;/head&gt;<br />  &lt;body&gt;<br />     &lt;p&gt;This is a hardcoded paragraph.&lt;/p&gt;<br />     &lt;p&gt;This is a new paragraph!&lt;/p&gt;<br />  &lt;/body&gt;<br />&lt;/html&gt;<br /><br />...so you would think that a paragraph is a paragraph is a paragraph, since you never see the prefix, as in "&lt;html:p&gt;This is a new paragraph!&lt;/html:p&gt;".<br /><br />This may seem glaringly obvious, but I was writing a class that converts CSS queries into XPath queries, and the fact that a namespace had been registered was rather buried in the code.<br /><br />We love the DOM, the DOM is good to us.</span></code></div>
  </div>
 </div>
  <div class="note" id="81542">  <div class="votes">
    <div id="Vu81542">
    <a href="https://www.php.net/manual/vote-note.php?id=81542&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd81542">
    <a href="https://www.php.net/manual/vote-note.php?id=81542&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V81542" title="75% like this...">
    2
    </div>
  </div>
  <a href="domxpath.query.php.html#81542" class="name">
  <strong class="user"><em>Nibinaear</em></strong></a><a class="genanchor" href="domxpath.query.php.html#81542"> &para;</a><div class="date" title="2008-03-03 06:15"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom81542">
<div class="phpcode"><code><span class="html">I've searched the entire web looking for a way to update / modify/ change/ alter the elements of an xml file and found NOTHING! <br /><br />So here it is, the defninitive way to "Change XML elements with PHP" rather than adding / appending new ones. This uses XPATH:<br /><br /><span class="default">&lt;?php<br /><br /></span><span class="comment">// Create a DOMDocument instance<br /></span><span class="default">$xml </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br /><br /></span><span class="comment">// Ignore whitespace between nodes (default: true)<br /></span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">preserveWhiteSpace </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br /><br /></span><span class="default">$file</span><span class="keyword">=</span><span class="string">'about.xml'</span><span class="keyword">;<br /><br /></span><span class="comment">// Load the XML data source<br /></span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">Load</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br /><br /></span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br /><br /></span><span class="default">$query</span><span class="keyword">=</span><span class="string">'/regions/branch'</span><span class="keyword">;<br /><br /></span><span class="default">$entries </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br /><br />foreach (</span><span class="default">$entries </span><span class="keyword">as </span><span class="default">$entry</span><span class="keyword">)<br />{<br />  </span><span class="default">$entry</span><span class="keyword">-&gt;</span><span class="default">firstChild</span><span class="keyword">-&gt;</span><span class="default">nodeValue</span><span class="keyword">=</span><span class="string">"like this!"</span><span class="keyword">;<br />  echo </span><span class="default">$entry</span><span class="keyword">-&gt;</span><span class="default">firstChild</span><span class="keyword">-&gt;</span><span class="default">nodeValue</span><span class="keyword">;  <br />}<br /><br /></span><span class="default">$xml</span><span class="keyword">-&gt;</span><span class="default">save</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br /><br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="58729">  <div class="votes">
    <div id="Vu58729">
    <a href="https://www.php.net/manual/vote-note.php?id=58729&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd58729">
    <a href="https://www.php.net/manual/vote-note.php?id=58729&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V58729" title="75% like this...">
    2
    </div>
  </div>
  <a href="domxpath.query.php.html#58729" class="name">
  <strong class="user"><em>jakob dot voss at nichtich dot de</em></strong></a><a class="genanchor" href="domxpath.query.php.html#58729"> &para;</a><div class="date" title="2005-11-14 12:33"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom58729">
<div class="phpcode"><code><span class="html">You can transform the result nodes into new DOMDocument objects this way:<br /><br /><span class="default">&lt;?php<br />$result </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$query</span><span class="keyword">);<br /></span><span class="default">$resultNode </span><span class="keyword">= </span><span class="default">$result</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br /></span><span class="default">$newDom </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br /></span><span class="default">$newDom</span><span class="keyword">-&gt;</span><span class="default">appendChild</span><span class="keyword">(</span><span class="default">$newDom</span><span class="keyword">-&gt;</span><span class="default">importNode</span><span class="keyword">(</span><span class="default">$resultNode</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">));<br /><br />print </span><span class="string">"&lt;pre&gt;" </span><span class="keyword">. </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$newDom</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">()) . </span><span class="string">"&lt;/pre&gt;"</span><span class="keyword">;<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="77747">  <div class="votes">
    <div id="Vu77747">
    <a href="https://www.php.net/manual/vote-note.php?id=77747&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd77747">
    <a href="https://www.php.net/manual/vote-note.php?id=77747&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V77747" title="69% like this...">
    5
    </div>
  </div>
  <a href="domxpath.query.php.html#77747" class="name">
  <strong class="user"><em>jbarnett at flowershopnetwork dot com</em></strong></a><a class="genanchor" href="domxpath.query.php.html#77747"> &para;</a><div class="date" title="2007-09-11 01:46"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom77747">
<div class="phpcode"><code><span class="html">The order of nodes in the return value is not guaranteed.<br /><br />When my code was on an old server, the returned DOMNodeList was in document order.  On the new server, the returned DOMNodeList is in a consistent order, but it is not in document order.  <br /><br />PHP passes this function call off to the xmlXPathEvalExpression() function in libxml.  That function in libxml only accepts two arguments - the same two this PHP function accepts.  There must have been a change in the libxml version from the old server to the new server, and that libxml behaves differently.<br /><br />This would be okay if PHP had a way to compare nodes so I can resort the nodes manually, but there is not.<br /><br />So, there is no guaranteed way to get an ordered list of nodes like DOM 3 XPath provides.</span></code></div>
  </div>
 </div>
  <div class="note" id="119748">  <div class="votes">
    <div id="Vu119748">
    <a href="https://www.php.net/manual/vote-note.php?id=119748&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd119748">
    <a href="https://www.php.net/manual/vote-note.php?id=119748&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V119748" title="100% like this...">
    1
    </div>
  </div>
  <a href="domxpath.query.php.html#119748" class="name">
  <strong class="user"><em>chris dot russo99 at gmail dot com</em></strong></a><a class="genanchor" href="domxpath.query.php.html#119748"> &para;</a><div class="date" title="2016-08-17 03:58"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom119748">
<div class="phpcode"><code><span class="html">If you can't find a solution for PHP XPATH case sensitivity, you can always try this approach:<br /><br /><a href="http://fsockopen.com/php-programming/your-final-stop-for-php-xpath-case-insensitive" rel="nofollow" target="_blank">http://fsockopen.com/php-programming/your-final-stop-for-php-xpath-case-insensitive</a><br /><br />Instead of inserting PHP functions into a XPATH object, convert the XPATH object into an Array(), and then use any PHP function, the regular way.</span></code></div>
  </div>
 </div>
  <div class="note" id="117612">  <div class="votes">
    <div id="Vu117612">
    <a href="https://www.php.net/manual/vote-note.php?id=117612&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd117612">
    <a href="https://www.php.net/manual/vote-note.php?id=117612&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V117612" title="50% like this...">
    0
    </div>
  </div>
  <a href="domxpath.query.php.html#117612" class="name">
  <strong class="user"><em>ikmahesh at cdac dot in</em></strong></a><a class="genanchor" href="domxpath.query.php.html#117612"> &para;</a><div class="date" title="2015-07-08 09:29"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom117612">
<div class="phpcode"><code><span class="html">The parameters for $xPath-&gt;query() method is case sensitive. <br />It matches IDs exact words.</span></code></div>
  </div>
 </div>
  <div class="note" id="94842">  <div class="votes">
    <div id="Vu94842">
    <a href="https://www.php.net/manual/vote-note.php?id=94842&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd94842">
    <a href="https://www.php.net/manual/vote-note.php?id=94842&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V94842" title="0% like this...">
    -1
    </div>
  </div>
  <a href="domxpath.query.php.html#94842" class="name">
  <strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="domxpath.query.php.html#94842"> &para;</a><div class="date" title="2009-11-27 12:26"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom94842">
<div class="phpcode"><code><span class="html">I found this useful for building page templates<br /><br /><span class="default">&lt;?php<br />$xsl </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br /></span><span class="default">$xsl</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="string">'layout.xsl'</span><span class="keyword">);<br /><br /></span><span class="comment">// Set the &lt;xsl:include&gt; href attribute, the inner stylesheet to include in this layout<br /></span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DomXPath</span><span class="keyword">(</span><span class="default">$xsl</span><span class="keyword">);<br /></span><span class="default">$res </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">'//xsl:include'</span><span class="keyword">);<br /></span><span class="default">$res</span><span class="keyword">-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">)-&gt;</span><span class="default">setAttribute</span><span class="keyword">(</span><span class="string">'href'</span><span class="keyword">,</span><span class="string">'page.xsl'</span><span class="keyword">);<br /></span><span class="default">$xsl</span><span class="keyword">-&gt;</span><span class="default">save</span><span class="keyword">(</span><span class="string">'media/xsl/layout.xsl'</span><span class="keyword">);<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="78739">  <div class="votes">
    <div id="Vu78739">
    <a href="https://www.php.net/manual/vote-note.php?id=78739&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd78739">
    <a href="https://www.php.net/manual/vote-note.php?id=78739&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V78739" title="0% like this...">
    -1
    </div>
  </div>
  <a href="domxpath.query.php.html#78739" class="name">
  <strong class="user"><em>ondrej dot fischer at 4internet dot cz</em></strong></a><a class="genanchor" href="domxpath.query.php.html#78739"> &para;</a><div class="date" title="2007-10-25 06:46"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom78739">
<div class="phpcode"><code><span class="html">Unfortunately PHP's DOM extension doesn't support use of:<br />&lt;?xml-stylesheet type="text/xsl" ... ?&gt;<br />processing instruction.<br />Here is an example, how to implement it using XPath query and extending DOMDocument by a method output().<br /><br /><span class="default">&lt;?php<br /><br /></span><span class="comment">// This simple function adds missing direct usage of anonymous instances<br />// in PHP5's reference model<br /></span><span class="keyword">function </span><span class="default">a</span><span class="keyword">(</span><span class="default">$var</span><span class="keyword">) {<br />   return </span><span class="default">$var</span><span class="keyword">;<br />}<br /><br /></span><span class="comment">// Extended DOMDocument class<br /></span><span class="keyword">class </span><span class="default">MyDOMDocument </span><span class="keyword">extends </span><span class="default">DOMDocument<br /></span><span class="keyword">{<br /><br />   public function </span><span class="default">output</span><span class="keyword">()<br />   {<br />      </span><span class="default">$stylesheets </span><span class="keyword">= array();<br />      </span><span class="default">$PIs </span><span class="keyword">= </span><span class="default">a</span><span class="keyword">(new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">))<br />                  -&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">'/processing-instruction("xml-stylesheet")'</span><span class="keyword">);<br /><br />      foreach(</span><span class="default">$PIs </span><span class="keyword">as </span><span class="default">$PI</span><span class="keyword">)<br />      {<br />         </span><span class="comment">// This might be implemented cleaner by regular parsing<br />         // of DOMProcessingInstruction::data property<br />         </span><span class="keyword">if(</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">'type *= *"text/xsl" +href *= *"([^"]+)"'</span><span class="keyword">, </span><span class="default">$PI</span><span class="keyword">-&gt;</span><span class="default">data</span><span class="keyword">, </span><span class="default">$mem</span><span class="keyword">))<br />         {<br />            </span><span class="comment">// Here should be verified, that XSL file exists.<br />            </span><span class="default">a</span><span class="keyword">(</span><span class="default">$stylesheets</span><span class="keyword">[] = new </span><span class="default">DOMDocument</span><span class="keyword">())-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="default">$mem</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />         }<br />      }<br /><br />      if(</span><span class="default">$stylesheets</span><span class="keyword">)<br />      {<br />         </span><span class="default">$processor </span><span class="keyword">= new </span><span class="default">XSLTProcessor</span><span class="keyword">();<br />         foreach(</span><span class="default">$stylesheets </span><span class="keyword">as </span><span class="default">$stylesheet</span><span class="keyword">)<br />            </span><span class="default">$processor</span><span class="keyword">-&gt;</span><span class="default">importStylesheet</span><span class="keyword">(</span><span class="default">$stylesheet</span><span class="keyword">);<br />         return </span><span class="default">$processor</span><span class="keyword">-&gt;</span><span class="default">transformToDoc</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">);<br />      }<br />      </span><span class="comment">// If no stylesheet instructions present, return self directly<br />      </span><span class="keyword">else return </span><span class="default">$this</span><span class="keyword">;<br /><br />   }<br />}<br /><br /></span><span class="default">?&gt;<br /></span><br />Usage:<br /><br /><span class="default">&lt;?php<br /><br />$document </span><span class="keyword">= new </span><span class="default">MyDOMDocument</span><span class="keyword">();<br /></span><span class="default">$document</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="string">'my.xml'</span><span class="keyword">);<br />echo </span><span class="default">$document</span><span class="keyword">-&gt;</span><span class="default">output</span><span class="keyword">()-&gt;</span><span class="default">saveXML</span><span class="keyword">();<br /><br /></span><span class="default">?&gt;<br /></span><br />With following file my.xml:<br /><br />&lt;?xml version="1.0" ?&gt;<br />&lt;?xml-stylesheet type="text/xsl" href="my.xsl" ?&gt;<br />&lt;my-root /&gt;<br /><br />and existing file my.xsl that code will transform the xml file using my.xsl and output the result.</span></code></div>
  </div>
 </div>
  <div class="note" id="85381">  <div class="votes">
    <div id="Vu85381">
    <a href="https://www.php.net/manual/vote-note.php?id=85381&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd85381">
    <a href="https://www.php.net/manual/vote-note.php?id=85381&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V85381" title="40% like this...">
    -1
    </div>
  </div>
  <a href="domxpath.query.php.html#85381" class="name">
  <strong class="user"><em>Niklas</em></strong></a><a class="genanchor" href="domxpath.query.php.html#85381"> &para;</a><div class="date" title="2008-08-27 02:36"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom85381">
<div class="phpcode"><code><span class="html">For XPath escaping use the following method (of course it could be more efficient).<br /><span class="default">&lt;?php<br /></span><span class="keyword">public function </span><span class="default">xpathescape</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">)<br />{<br /></span><span class="default">$result </span><span class="keyword">= </span><span class="string">'concat('</span><span class="keyword">;<br /><br />for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">, </span><span class="default">$j</span><span class="keyword">=</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$string</span><span class="keyword">); </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$j</span><span class="keyword">; ++</span><span class="default">$i</span><span class="keyword">)<br />{<br />if(</span><span class="default">$i </span><span class="keyword">&gt; </span><span class="default">0</span><span class="keyword">)<br /></span><span class="default">$result </span><span class="keyword">.= </span><span class="string">","</span><span class="keyword">;<br /><br />if(</span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">] == </span><span class="string">'\''</span><span class="keyword">)<br /></span><span class="default">$result </span><span class="keyword">.= </span><span class="string">"\""</span><span class="keyword">.</span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">"\""</span><span class="keyword">;<br />else<br /></span><span class="default">$result </span><span class="keyword">.= </span><span class="string">'\''</span><span class="keyword">.</span><span class="default">$string</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">].</span><span class="string">'\''</span><span class="keyword">;<br />}<br /><br /></span><span class="default">$result </span><span class="keyword">.= </span><span class="string">')'</span><span class="keyword">;<br /><br />return </span><span class="default">$result</span><span class="keyword">;<br />}<br /></span><span class="default">?&gt;<br /></span><br />Use it this way:<br />&lt;php<br />$xpath-&gt;query('//example[sub='.xpathescape($acomplexstring).']');<br /><br />?&gt;</span></code></div>
  </div>
 </div>
  <div class="note" id="73557">  <div class="votes">
    <div id="Vu73557">
    <a href="https://www.php.net/manual/vote-note.php?id=73557&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd73557">
    <a href="https://www.php.net/manual/vote-note.php?id=73557&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V73557" title="40% like this...">
    -1
    </div>
  </div>
  <a href="domxpath.query.php.html#73557" class="name">
  <strong class="user"><em>clochix at clochix dot net</em></strong></a><a class="genanchor" href="domxpath.query.php.html#73557"> &para;</a><div class="date" title="2007-03-01 04:05"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom73557">
<div class="phpcode"><code><span class="html">If you want to perform queries on XHTML documents, you must fix a default namespace:<br /><br /><span class="default">&lt;?php<br />$doc </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br /></span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">preserveWhiteSpace </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br /></span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">resolveExternals </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">; </span><span class="comment">// for character entities<br /></span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">load</span><span class="keyword">(</span><span class="string">"<a href="http://www.w3.org/" rel="nofollow" target="_blank">http://www.w3.org/</a>"</span><span class="keyword">);<br /></span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">);<br /></span><span class="comment">// won't work<br /></span><span class="default">$entries </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"//div"</span><span class="keyword">);<br /></span><span class="comment">// you should use :<br /></span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">registerNamespace</span><span class="keyword">(</span><span class="string">"html"</span><span class="keyword">, </span><span class="string">"<a href="http://www.w3.org/1999/xhtml" rel="nofollow" target="_blank">http://www.w3.org/1999/xhtml</a>"</span><span class="keyword">);<br /></span><span class="default">$entries </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"//html:div"</span><span class="keyword">);<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="105881">  <div class="votes">
    <div id="Vu105881">
    <a href="https://www.php.net/manual/vote-note.php?id=105881&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd105881">
    <a href="https://www.php.net/manual/vote-note.php?id=105881&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V105881" title="33% like this...">
    -1
    </div>
  </div>
  <a href="domxpath.query.php.html#105881" class="name">
  <strong class="user"><em>info at syncgw dot com</em></strong></a><a class="genanchor" href="domxpath.query.php.html#105881"> &para;</a><div class="date" title="2011-09-22 09:05"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom105881">
<div class="phpcode"><code><span class="html">A warning to all PHP programmer using this function PHP 5.0.0.0: We needed an equivalent to upper-case() function (is not available in XPath 1.0).<br /><br />XML-Document:<br /><br />&lt;Rec&gt;<br />&lt;SourceRef&gt;./c:calendar2&lt;/SourceRef&gt;<br />&lt;SourceRef&gt;./c:calendar&lt;/SourceRef&gt;<br />&lt;/Rec&gt;<br /><br />using <br /><br />query('//DataStore[translate(SourceRef,"abcdefghijklmnopqrstuvwxyz","ABCDEFGHIJKLMNOPQRSTUVWXYZ")="./C:CALENDAR"]/.')<br /><br />returns ZERO matches.<br /><br />If you change XML-Source to<br /><br />&lt;Rec&gt;<br />&lt;SourceRef&gt;./c:calendar&lt;/SourceRef&gt;<br />&lt;SourceRef&gt;./c:calendar2&lt;/SourceRef&gt;<br />&lt;/Rec&gt;<br /><br />everything works fine</span></code></div>
  </div>
 </div>
  <div class="note" id="105692">  <div class="votes">
    <div id="Vu105692">
    <a href="https://www.php.net/manual/vote-note.php?id=105692&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd105692">
    <a href="https://www.php.net/manual/vote-note.php?id=105692&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V105692" title="33% like this...">
    -1
    </div>
  </div>
  <a href="domxpath.query.php.html#105692" class="name">
  <strong class="user"><em>yuriscom at gmail dot com</em></strong></a><a class="genanchor" href="domxpath.query.php.html#105692"> &para;</a><div class="date" title="2011-09-07 10:29"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom105692">
<div class="phpcode"><code><span class="html">I hope it will be helpful for someone:<br /><br />I spent some time to solve the problem when you query a string with quotes inside. <br /><br />Suppose you have:<br />$parameter = "aaa \"bbb\"";<br />$domxpath-&gt;query("//path[text()=\"".$parameter."\""];<br /><br />In versions &gt; 5.3.0 there is registerPhpFunctions where you can put an addslashes. But in older version you cannot do it in simple way.<br /><br />So the solution is to use a concat function. So when you have a substring with " inside, wrap it with '. And when you have a substring with ', then wrap with in ".<br /><br />The code is:<br /><br /><span class="default">&lt;?php<br />$dom </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">;<br /></span><span class="default">$dom</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="string">"&lt;name&gt;'bla' \"bla\" bla&lt;/name&gt;"</span><span class="keyword">);<br /></span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$dom</span><span class="keyword">);<br /></span><span class="default">$nodeList </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="string">"//name[text()=concat(\"'bla' \" ,'\"bla\"' ,\" bla\")]"</span><span class="keyword">);<br /></span><span class="default">?&gt;<br /></span><br />Below is the function that receives a string and returns a concat pattern for the xpath query.<br /><br /><span class="default">&lt;?php<br />    </span><span class="keyword">function </span><span class="default">getPattern_MQ</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">) {<br />        </span><span class="comment">// initiating an array of substrings<br />        </span><span class="default">$ar </span><span class="keyword">= array();<br />        </span><span class="comment">// points to the current position in a string<br />        </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />        </span><span class="default">$strlen </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">);<br />        while (</span><span class="default">true</span><span class="keyword">) {<br />            </span><span class="comment">// find a position of quotes<br />            </span><span class="default">$qPos </span><span class="keyword">= </span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="string">"\""</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">);<br />            <br />            if (!</span><span class="default">$qPos</span><span class="keyword">) {<br />                </span><span class="comment">// no more quotes<br />                </span><span class="default">$leftOver </span><span class="keyword">= </span><span class="default">$offset </span><span class="keyword">- </span><span class="default">$strlen</span><span class="keyword">;<br />                if (</span><span class="default">$leftOver </span><span class="keyword">&lt; </span><span class="default">0</span><span class="keyword">) {<br />                    </span><span class="default">$string </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$leftOver</span><span class="keyword">);<br />                    </span><span class="default">$ar</span><span class="keyword">[] = </span><span class="string">"\"" </span><span class="keyword">. </span><span class="default">$string </span><span class="keyword">. </span><span class="string">"\""</span><span class="keyword">;<br />                }<br />                break;<br />            }<br />            </span><span class="comment">// add the whole substring before the quotes into the array<br />            </span><span class="default">$ar</span><span class="keyword">[] = </span><span class="string">"\"" </span><span class="keyword">. </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$offset</span><span class="keyword">, (</span><span class="default">$qPos </span><span class="keyword">- </span><span class="default">$offset</span><span class="keyword">)) . </span><span class="string">"\""</span><span class="keyword">;<br />            </span><span class="comment">// add the quotes wrapped with single quot<br />            </span><span class="default">$ar</span><span class="keyword">[] = </span><span class="string">"'" </span><span class="keyword">. </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$pattern</span><span class="keyword">, </span><span class="default">$qPos</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">) . </span><span class="string">"'"</span><span class="keyword">;<br />            </span><span class="default">$offset </span><span class="keyword">= </span><span class="default">$qPos </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br />        }<br />        </span><span class="comment">// join the array to get: concat("aaa",'"',"bbb",'"');<br />        </span><span class="default">$pattern </span><span class="keyword">= </span><span class="string">"concat(''," </span><span class="keyword">. </span><span class="default">join</span><span class="keyword">(</span><span class="string">","</span><span class="keyword">, </span><span class="default">$dynamicPatternsAr</span><span class="keyword">) . </span><span class="string">")"</span><span class="keyword">;<br />        return </span><span class="default">$pattern</span><span class="keyword">;<br />    }<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="103461">  <div class="votes">
    <div id="Vu103461">
    <a href="https://www.php.net/manual/vote-note.php?id=103461&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd103461">
    <a href="https://www.php.net/manual/vote-note.php?id=103461&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V103461" title="33% like this...">
    -1
    </div>
  </div>
  <a href="domxpath.query.php.html#103461" class="name">
  <strong class="user"><em>chris AT cmbuckley DOT co DOT uk</em></strong></a><a class="genanchor" href="domxpath.query.php.html#103461"> &para;</a><div class="date" title="2011-04-14 07:31"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom103461">
<div class="phpcode"><code><span class="html">To help with the problem where the default namespace is not registered with the DOMXPath object, you can use the following replacement to update your paths accordingly:<br /><br /><span class="default">&lt;?php<br /><br />$xml </span><span class="keyword">= &lt;&lt;&lt;EOS<br /></span><span class="string">&lt;root xmlns="urn:test"&gt;<br />    &lt;foo&gt;bar&lt;/foo&gt;<br />&lt;/root&gt;<br /></span><span class="keyword">EOS;<br /><br /></span><span class="default">$expression </span><span class="keyword">= </span><span class="string">'//foo'</span><span class="keyword">;<br /></span><span class="default">$prefix </span><span class="keyword">= </span><span class="string">'fakeprefix'</span><span class="keyword">;<br /><br /></span><span class="default">$doc </span><span class="keyword">= new </span><span class="default">DOMDocument</span><span class="keyword">();<br /></span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">loadXML</span><span class="keyword">(</span><span class="default">$xml</span><span class="keyword">);<br /><br /></span><span class="default">$context </span><span class="keyword">= </span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">documentElement</span><span class="keyword">; </span><span class="comment">// or whichever element you choose<br /></span><span class="default">$xpath </span><span class="keyword">= new </span><span class="default">DOMXPath</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">);<br /><br /></span><span class="comment">// register namespace as below, and apply a regex to the expression<br /></span><span class="keyword">if (</span><span class="default">null </span><span class="keyword">!== </span><span class="default">$context</span><span class="keyword">-&gt;</span><span class="default">namespaceURI</span><span class="keyword">) {<br />    </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">registerNamespace</span><span class="keyword">(</span><span class="default">$prefix</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">-&gt;</span><span class="default">namespaceURI</span><span class="keyword">);<br />    </span><span class="default">$expression </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'#(::|/\s*|\A)(?![/@].+?|[a-z\-]+::)#'</span><span class="keyword">, </span><span class="string">'$1' </span><span class="keyword">. </span><span class="default">$prefix </span><span class="keyword">. </span><span class="string">':$2'</span><span class="keyword">, </span><span class="default">$expression</span><span class="keyword">);<br />    </span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$expression</span><span class="keyword">); </span><span class="comment">// string(16) "//fakeprefix:foo"<br /></span><span class="keyword">}<br /><br /></span><span class="default">$foo </span><span class="keyword">= </span><span class="default">$xpath</span><span class="keyword">-&gt;</span><span class="default">query</span><span class="keyword">(</span><span class="default">$expression</span><span class="keyword">, </span><span class="default">$context</span><span class="keyword">)-&gt;</span><span class="default">item</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br /></span><span class="default">var_dump</span><span class="keyword">(</span><span class="default">$doc</span><span class="keyword">-&gt;</span><span class="default">saveXML</span><span class="keyword">(</span><span class="default">$foo</span><span class="keyword">)); </span><span class="comment">// string(14) "&lt;foo&gt;bar&lt;/foo&gt;"<br /><br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="54692">  <div class="votes">
    <div id="Vu54692">
    <a href="https://www.php.net/manual/vote-note.php?id=54692&amp;page=domxpath.query&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd54692">
    <a href="https://www.php.net/manual/vote-note.php?id=54692&amp;page=domxpath.query&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V54692" title="25% like this...">
    -2
    </div>
  </div>
  <a href="domxpath.query.php.html#54692" class="name">
  <strong class="user"><em>Eric Hanson</em></strong></a><a class="genanchor" href="domxpath.query.php.html#54692"> &para;</a><div class="date" title="2005-07-12 05:40"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom54692">
<div class="phpcode"><code><span class="html">Two great XPath references follow.<br /><br />XPath in Five Paragraphs (finally!):<br /><a href="http://www.rpbourret.com/xml/XPathIn5.htm" rel="nofollow" target="_blank">http://www.rpbourret.com/xml/XPathIn5.htm</a><br /><br />The w3c spec actually has a bunch of helpful examples:<br /><a href="http://www.w3.org/TR/xpath#location-paths" rel="nofollow" target="_blank">http://www.w3.org/TR/xpath#location-paths</a></span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=domxpath.query&amp;redirect=https://www.php.net/manual/ru/domxpath.query.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="class.domxpath.php.html">DOMXPath</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="domxpath.construct.php.html" title="_&#8203;_&#8203;construct">_&#8203;_&#8203;construct</a>
                        </li>
                                                <li class="">
                            <a href="domxpath.evaluate.php.html" title="evaluate">evaluate</a>
                        </li>
                                                <li class="current">
                            <a href="domxpath.query.php.html" title="query">query</a>
                        </li>
                                                <li class="">
                            <a href="domxpath.registernamespace.php.html" title="registerNamespace">registerNamespace</a>
                        </li>
                                                <li class="">
                            <a href="domxpath.registerphpfunctions.php.html" title="registerPhpFunctions">registerPhpFunctions</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
