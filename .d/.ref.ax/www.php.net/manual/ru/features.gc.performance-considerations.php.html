<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: Вопросы производительности - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="features.gc.performance-considerations.php.html">
 <link rel="shorturl" href="https://www.php.net/gc.performance-considerations">
 <link rel="alternate" href="https://www.php.net/gc.performance-considerations" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="features.gc.php.html">
 <link rel="prev" href="features.gc.collecting-cycles.php.html">
 <link rel="next" href="features.dtrace.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/features.gc.performance-considerations.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/features.gc.performance-considerations.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/features.gc.performance-considerations.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/features.gc.performance-considerations.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/features.gc.performance-considerations.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/features.gc.performance-considerations.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/features.gc.performance-considerations.php" hreflang="pt_BR">
 <link rel="alternate" href="features.gc.performance-considerations.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/features.gc.performance-considerations.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/features.gc.performance-considerations.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="features.dtrace.php.html">
          Динамическая трассировка DTrace &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="features.gc.collecting-cycles.php.html">
          &laquo; Сбор циклических ссылок        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='features.php.html'>Особенности</a></li>      <li><a href='features.gc.php.html'>Сборка мусора</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/features.gc.performance-considerations.php'>English</option>
            <option value='de/features.gc.performance-considerations.php'>German</option>
            <option value='es/features.gc.performance-considerations.php'>Spanish</option>
            <option value='fr/features.gc.performance-considerations.php'>French</option>
            <option value='it/features.gc.performance-considerations.php'>Italian</option>
            <option value='ja/features.gc.performance-considerations.php'>Japanese</option>
            <option value='pt_BR/features.gc.performance-considerations.php'>Brazilian Portuguese</option>
            <option value='ru/features.gc.performance-considerations.php' selected="selected">Russian</option>
            <option value='tr/features.gc.performance-considerations.php'>Turkish</option>
            <option value='zh/features.gc.performance-considerations.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/features/gc.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Ffeatures.gc.performance-considerations%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="features.gc.performance-considerations" class="sect1">
   <h2 class="title">Вопросы производительности</h2>
   <p class="para">
    В предыдущем разделе нами уже говорилось, что простой сбор корней меньше
    влияет на производительность.
    Хотя запись корней в буфер по сравнению с полным отсутствием
    таковой в PHP 5.2 работает медленней, другие изменения в работе
    PHP 5.3 сделали эту потерю производительности незаметной.
   </p>
   <p class="para">
    Есть две основные области влияющие на производительность:
    уменьшение размера используемой памяти и замедление работы при
    сборке мусора. Рассмотрим их.
   </p>

   <div class="sect2" id="features.gc.performance-considerations.reduced-mem">
    <h3 class="title">Уменьшение размера используемой памяти</h3>
    <p class="para">
     Прежде всего, основной причиной реализации механизма сборки
     мусора является уменьшение размера используемой памяти с помощью
     чистки циклических ссылок, которая происходит при достижении
     соответствующих условий. В реализации PHP это происходит как
     только заполнится корневой буфер или при вызове функции
     <span class="function"><a href="function.gc-collect-cycles.php.html" class="function">gc_collect_cycles()</a></span>.
     На графике ниже приведено использование памяти скрипта,
     запущенного в PHP 5.2 и PHP 5.3, без учёта памяти,
     используемой самим PHP при запуске.
    </p>
    <p class="para">
     <div class="example" id="example-1489">
      <p><strong>Пример #1 Пример использования памяти</strong></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">Foo<br /></span><span style="color: #007700">{<br />    public </span><span style="color: #0000BB">$var </span><span style="color: #007700">= </span><span style="color: #DD0000">'3.14159265359'</span><span style="color: #007700">;<br />    public </span><span style="color: #0000BB">$self</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$baseMemory </span><span style="color: #007700">= </span><span style="color: #0000BB">memory_get_usage</span><span style="color: #007700">();<br /><br />for ( </span><span style="color: #0000BB">$i </span><span style="color: #007700">= </span><span style="color: #0000BB">0</span><span style="color: #007700">; </span><span style="color: #0000BB">$i </span><span style="color: #007700">&lt;= </span><span style="color: #0000BB">100000</span><span style="color: #007700">; </span><span style="color: #0000BB">$i</span><span style="color: #007700">++ )<br />{<br />    </span><span style="color: #0000BB">$a </span><span style="color: #007700">= new </span><span style="color: #0000BB">Foo</span><span style="color: #007700">;<br />    </span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">self </span><span style="color: #007700">= </span><span style="color: #0000BB">$a</span><span style="color: #007700">;<br />    if ( </span><span style="color: #0000BB">$i </span><span style="color: #007700">% </span><span style="color: #0000BB">500 </span><span style="color: #007700">=== </span><span style="color: #0000BB">0 </span><span style="color: #007700">)<br />    {<br />        echo </span><span style="color: #0000BB">sprintf</span><span style="color: #007700">( </span><span style="color: #DD0000">'%8d: '</span><span style="color: #007700">, </span><span style="color: #0000BB">$i </span><span style="color: #007700">), </span><span style="color: #0000BB">memory_get_usage</span><span style="color: #007700">() - </span><span style="color: #0000BB">$baseMemory</span><span style="color: #007700">, </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br />    }<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
      </div>

      <div class="mediaobject">
       
       <div class="imageobject">
        <img src="images/12f37b1c6963c1c5c18f30495416a197-gc-benchmark.png" alt="Сравнение использования памяти в PHP 5.2 и PHP 5.3" width="850" height="480" />
       </div>
      </div>
     </div>
    </p>
    <p class="para">
     В этом очень академическом примере мы создаём объект, свойство a которого
     задаётся ссылкой на сам объект. Когда в скрипте в следующей итерации цикла переопределяется
     переменная <var class="varname">$a</var>, то происходит типичная утечка памяти.
     В данном случае пропадают два контейнера zval (контейнер объекта и контейнер свойства объекта),
     но определяется только один корень — удалённая переменная.
     Как только пройдут 10 000 итераций (максимально в корневом буфере
     будет 10 000 корней), то запустится механизм сборки мусора и
     память, занимаемая этими корнями, будет освобождена.
     Этот процесс хорошо виден на графике использования памяти для PHP 5.3:
     после каждых 10 000 итераций график проседает.
     Сам по себе механизм в данном примере совершает не так много работы, потому что
     структура утечек слишком проста. Из графика видно, что максимальное использование памяти
     в PHP 5.3 составило около 9 Мб, тогда как в PHP 5.2 оно продолжает возрастать.
    </p>
   </div>

   <div class="sect2" id="features.gc.performance-considerations.slowdowns">
    <h3 class="title">Замедление работы</h3>
    <p class="para">
     Второй областью, где сборка мусора влияет на производительность,
     является потеря времени, когда сборщик мусора освобождает память.
     Чтобы понять степень этого влияния, мы немного изменим предыдущий скрипт,
     добавив большее число итераций и промежуточных переменных.
     Изменённый скрипт:
    </p>
    <p class="para">
     <div class="example" id="example-1492">
      <p><strong>Пример #2 Влияние на производительность</strong></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class </span><span style="color: #0000BB">Foo<br /></span><span style="color: #007700">{<br />    public </span><span style="color: #0000BB">$var </span><span style="color: #007700">= </span><span style="color: #DD0000">'3.14159265359'</span><span style="color: #007700">;<br />    public </span><span style="color: #0000BB">$self</span><span style="color: #007700">;<br />}<br /><br />for ( </span><span style="color: #0000BB">$i </span><span style="color: #007700">= </span><span style="color: #0000BB">0</span><span style="color: #007700">; </span><span style="color: #0000BB">$i </span><span style="color: #007700">&lt;= </span><span style="color: #0000BB">1000000</span><span style="color: #007700">; </span><span style="color: #0000BB">$i</span><span style="color: #007700">++ )<br />{<br />    </span><span style="color: #0000BB">$a </span><span style="color: #007700">= new </span><span style="color: #0000BB">Foo</span><span style="color: #007700">;<br />    </span><span style="color: #0000BB">$a</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">self </span><span style="color: #007700">= </span><span style="color: #0000BB">$a</span><span style="color: #007700">;<br />}<br /><br />echo </span><span style="color: #0000BB">memory_get_peak_usage</span><span style="color: #007700">(), </span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
      </div>

     </div>
    </p>
    <p class="para">
     Запустим скрипт два раза: с включённой опцией
     <a href="info.configuration.php.html#ini.zend.enable-gc" class="link">zend.enable_gc</a> и без неё.
    </p>
    <p class="para">
     <div class="example" id="example-1495">
      <p><strong>Пример #3 Запуск скрипта</strong></p>
      <div class="example-contents">
<div class="shellcode"><pre class="shellcode">time php -dzend.enable_gc=0 -dmemory_limit=-1 -n example2.php
# и
time php -dzend.enable_gc=1 -dmemory_limit=-1 -n example2.php</pre>
</div>
      </div>

     </div>
    </p>
    <p class="para">
     На тестовой машине первая команда примерно выполняется 10.7 секунд, а
     вторая примерно 11.4 секунды. Это примерно на 7 % медленнее. Однако,
     максимальное использование памяти скриптом уменьшилось на 98 % с 931 МБ до 10 МБ.
     Этот тест не очень научный, но он действительно демонстрирует преимущество
     по использованию памяти, обеспечиваемое сборщиком мусора. Также хорошо то, что
     замедление для этого скрипта всегда примерно 7 %, тогда как экономия памяти
     увеличивается все больше и больше при нахождении нового мусора.
    </p>
   </div>

   <div class="sect2" id="features.gc.performance-considerations.internal-stats">
    <h3 class="title">Внутренняя статистика сборщика мусора</h3>
    <p class="para">
     Можно получить немного больше информации о том, как механизм сборки
     мусора выполняется в PHP. Но для этого необходимо пересобрать PHP
     для включения теста производительности и кода для дополнительного сбора данных. Необходимо
     установить переменную окружения <code class="literal">CFLAGS</code> в значение
     <code class="literal">-DGC_BENCH=1</code> до выполнения команды <code class="literal">./configure</code>
     с вашими параметрами. Следующие команды должны сработать:
    </p>
    <p class="para">
     <div class="example" id="example-1498">
      <p><strong>Пример #4 Сборка PHP для включения теста производительности GC</strong></p>
      <div class="example-contents">
<div class="shellcode"><pre class="shellcode">export CFLAGS=-DGC_BENCH=1
./config.nice
make clean
make</pre>
</div>
      </div>

     </div>
    </p>
    <p class="para">
     При запуске вышеприведённого примера с обновлённым PHP, можно
     увидеть следующую информацию по завершении работы скрипта:
    </p>
    <p class="para">
     <div class="example" id="example-1501">
      <p><strong>Пример #5 Статистика GC</strong></p>
      <div class="example-contents">
<div class="shellcode"><pre class="shellcode">GC Statistics
-------------
Runs:               110
Collected:          2072204
Root buffer length: 0
Root buffer peak:   10000

      Possible            Remove from  Marked
        Root    Buffered     buffer     grey
      --------  --------  -----------  ------
ZVAL   7175487   1491291    1241690   3611871
ZOBJ  28506264   1527980     677581   1025731</pre>
</div>
      </div>

     </div>
    </p>
    <p class="para">
     Наиболее полезная статистика отображена в первом блоке. Можно увидеть,
     что механизм сборки мусора был запущен 110 раз, и суммарно было освобождено
     свыше 2 миллионов записей в памяти. Если сборка мусора была запущена хотя бы раз, то
     максимальное число корней в буфере всегда будет равно 10 000.
    </p>
   </div>

   <div class="sect2" id="features.gc.performance-considerations.conclusion">
    <h3 class="title">Заключение</h3>
    <p class="para">
     В целом, сборщик мусора в PHP вызовет ощутимые замедления только во
     время непосредственной работы механизма сборки циклических ссылок, тогда как
     в обычных (небольших) скриптах не должно быть никакого падения производительности.
    </p>
    <p class="para">
     Однако в тех случаях, когда механизм сборки должен срабатывать
     и в обычных скриптах, снижение используемой памяти позволяет
     одновременно работать на сервере большему их количеству.
    </p>
    <p class="para">
     Преимущества наиболее очевидны для долгоработающих скриптов, таких как
     большие наборы тестов или демоны. Новый механизм также должен снизить утечки памяти
     для приложений <a href="http://gtk.php.net/" class="link external">&raquo;&nbsp;PHP-GTK</a>, которые выполняются
     обычно дольше, чем веб-скрипты.
    </p>
   </div>
  </div><section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=features.gc.performance-considerations&amp;redirect=https://www.php.net/manual/ru/features.gc.performance-considerations.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">2 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="118427">  <div class="votes">
    <div id="Vu118427">
    <a href="https://www.php.net/manual/vote-note.php?id=118427&amp;page=features.gc.performance-considerations&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd118427">
    <a href="https://www.php.net/manual/vote-note.php?id=118427&amp;page=features.gc.performance-considerations&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V118427" title="65% like this...">
    19
    </div>
  </div>
  <a href="features.gc.performance-considerations.php.html#118427" class="name">
  <strong class="user"><em>Talisman</em></strong></a><a class="genanchor" href="features.gc.performance-considerations.php.html#118427"> &para;</a><div class="date" title="2015-12-04 08:25"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom118427">
<div class="phpcode"><code><span class="html">The GC, unfortunately, as expounded in the examples above, has the tendency to promote lazy programming.<br />Clearly the benefits of the GC to assist in memory management are there, and help to maintain a stable system, but it is no excuse to not plan and test your code properly.<br />Always re-read your code critically and objectively to ensure that you are not introducing memory leaks unintentionally.</span></code></div>
  </div>
 </div>
  <div class="note" id="122714">  <div class="votes">
    <div id="Vu122714">
    <a href="https://www.php.net/manual/vote-note.php?id=122714&amp;page=features.gc.performance-considerations&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd122714">
    <a href="https://www.php.net/manual/vote-note.php?id=122714&amp;page=features.gc.performance-considerations&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V122714" title="100% like this...">
    18
    </div>
  </div>
  <a href="features.gc.performance-considerations.php.html#122714" class="name">
  <strong class="user"><em>Dmitry dot Balabka at gmail dot com</em></strong></a><a class="genanchor" href="features.gc.performance-considerations.php.html#122714"> &para;</a><div class="date" title="2018-05-09 11:13"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom122714">
<div class="phpcode"><code><span class="html">There is a possibility to get GC performance stats without PHP recompilation. Starting from Xdebug version 2.6 you are able to enable stats collection into the file (default dir /tmp with name gcstats.%p):<br /><br />php -dxdebug.gc_stats_enable=1 your_script.php</span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=features.gc.performance-considerations&amp;redirect=https://www.php.net/manual/ru/features.gc.performance-considerations.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="features.gc.php.html">Сборка мусора</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="features.gc.refcounting-basics.php.html" title="Основы подсчёта ссылок">Основы подсчёта ссылок</a>
                        </li>
                                                <li class="">
                            <a href="features.gc.collecting-cycles.php.html" title="Сбор циклических ссылок">Сбор циклических ссылок</a>
                        </li>
                                                <li class="current">
                            <a href="features.gc.performance-considerations.php.html" title="Вопросы производительности">Вопросы производительности</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
