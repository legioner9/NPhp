<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: Постоянные соединения с базами данных - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="features.persistent-connections.php.html">
 <link rel="shorturl" href="https://www.php.net/persistent-connections">
 <link rel="alternate" href="https://www.php.net/persistent-connections" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="features.php.html">
 <link rel="prev" href="features.connection-handling.php.html">
 <link rel="next" href="features.commandline.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/features.persistent-connections.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/features.persistent-connections.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/features.persistent-connections.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/features.persistent-connections.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/features.persistent-connections.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/features.persistent-connections.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/features.persistent-connections.php" hreflang="pt_BR">
 <link rel="alternate" href="features.persistent-connections.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/features.persistent-connections.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/features.persistent-connections.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="features.commandline.php.html">
          Работа с PHP из командной строки &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="features.connection-handling.php.html">
          &laquo; Работа с соединениями        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='features.php.html'>Особенности</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/features.persistent-connections.php'>English</option>
            <option value='de/features.persistent-connections.php'>German</option>
            <option value='es/features.persistent-connections.php'>Spanish</option>
            <option value='fr/features.persistent-connections.php'>French</option>
            <option value='it/features.persistent-connections.php'>Italian</option>
            <option value='ja/features.persistent-connections.php'>Japanese</option>
            <option value='pt_BR/features.persistent-connections.php'>Brazilian Portuguese</option>
            <option value='ru/features.persistent-connections.php' selected="selected">Russian</option>
            <option value='tr/features.persistent-connections.php'>Turkish</option>
            <option value='zh/features.persistent-connections.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/features/persistent-connections.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Ffeatures.persistent-connections%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="features.persistent-connections" class="chapter">
  <h1>Постоянные соединения с базами данных</h1>


  <p class="simpara">
   Постоянные соединения представляют собой связи с базами данных,
   которые не закрываются при завершении скрипта. При получении запроса
   на постоянное соединение PHP вначале проверяет, имеется ли
   идентичное постоянное соединение (которое было открыто при предыдущих
   обращениях) и, если таковое было найдено, использует его.
   В случае, если идентичного соединения нет, PHP создаёт новое. Под
   &quot;идентичным&quot; подразумевается соединение, открытое на том же хосте с
   таким же именем пользователя и паролем (если они указаны).
  </p>
  <p class="simpara">
   Та часть разработчиков, которая не имеет чёткого представления о том,
   как работает веб-сервер и как распределяется нагрузка, могут получить
   ошибочное представление о том, чем на самом деле являются постоянные
   соединения. В частности, постоянные соединения <em>не</em>
   предоставляют возможность открывать &#039;пользовательские сессии&#039; в том же
   самом соединении, они <em>не</em> предоставляют возможность
   организовывать более эффективные транзакции, также они не предоставляют
   множества других полезных возможностей. Фактически, постоянные соединения
   не предоставляют <em>никакой</em> функциональности, которая
   была бы невозможна в непостоянных аналогичных соединениях.
  </p>
  <p class="simpara">
   Почему?
  </p>
  <p class="simpara">
   Это зависит от того, как происходит взаимодействие с веб-сервером. Существует
   три основных способа использования PHP сервером для генерации веб-страниц.
  </p>
  <p class="simpara">
   Первый способ заключается в том, чтобы использовать PHP как CGI-обёртку.
   При этом PHP-интерпретатор создаётся и уничтожается при каждом
   обращении к странице (PHP-скрипту). Поскольку интерпретатор
   уничтожается после каждого запроса к серверу, все используемые им ресурсы
   (в том числе и соединение с базой данных) закрываются. Следовательно,
   в этом случае вы не получите ничего от использования постоянных соединений -
   их просто нет.
  </p>
  <p class="simpara">
   Второй, и наиболее популярный способ - использовать PHP как модуль
   в сервере, который использует несколько процессов. В число таких серверов
   сейчас входит только Apache. В таком случае, можно выделить один процесс
   (родительский), который координирует работу всех остальных процессов
   (дочерних), которые фактически и выполняют работу по обслуживанию веб-страниц.
   При каждом обращении клиента к серверу запрос перенаправляется одному из
   дочерних процессов, который в данный момент не занят обслуживанием другого
   клиента. Это означает, что когда тот же самый клиент выполняет повторный
   запрос к серверу, он может быть обработан другим дочерним процессом, отличным
   от того, который был при первом обращении. После открытия постоянного
   соединения каждая последующая страница, требующая соединения с базой данных,
   может использовать уже установленное ранее соединение с SQL-сервером.
  </p>
  <p class="simpara">
   Третий способ - использовать PHP в качестве плагина в многопоточном
   веб-сервере. В настоящее время в PHP реализована поддержка ISAPI,
   WSAPI, и NSAPI (для Windows-платформ), которые позволяют
   подключать PHP к таким многопоточным серверам, как Netscape FastTrack
   (iPlanet), Microsoft&#039;s Internet Information  Server (IIS) и
   O&#039;Reilly WebSite Pro. В этом случае поведение PHP полностью аналогично
   рассмотренной ранее модели с использованием нескольких процессов.
  </p>
  <p class="simpara">
   Если постоянные соединения не предоставляют никакой дополнительной функциональности,
   чем же они тогда так хороши?
  </p>
  <p class="simpara">
   Ответ содержится в повышении эффективности. Постоянные соединения
   полезны в том случае, если при открытии большого количества SQL-соединений
   возникает ощутимая нагрузка на сервер. То, насколько велика эта нагрузка,
   зависит от многих факторов. Например, от того, какая именно база данных
   используется, находится ли она на том же компьютере что и ваш веб-сервер,
   насколько загружена машина, на которой установлен SQL-сервер, и так далее.
   В случае, если затраты на установку соединения велики, постоянные соединения
   могут вам существенно помочь. Они позволяют дочернему процессу на
   протяжении всего жизненного цикла использовать одно и то же соединение
   вместо того, чтобы создавать его при обработке каждой страницы,
   которая взаимодействует с SQL-сервером. Это означает, что каждый дочерний
   процесс, открывший постоянное соединение, будет иметь своё собственное
   соединение с сервером. Например, если у вас запущено 20 дочерних процессов,
   которые выполнили скрипт, использовавший постоянное соединение с SQL-сервером,
   вы получите 20 различных соединений с SQL-сервером, по одному на каждый дочерний
   процесс.
  </p>
  <p class="simpara">
   Следует заметить, что этот подход имеет некоторые недостатки: если
   вы используете базу данных с ограниченным количеством возможных
   подключений, оно может быть превышено количеством запрашиваемых
   дочерними процессами постоянных соединений. Например, если ваша база
   данных позволяет 16 одновременных соединений, и во время нагрузки
   на сервер 17 дочерних процессов попробуют открыть соединение, одна из
   попыток потерпит неудачу. Если в вашем коде содержатся ошибки, не позволяющие
   закрывать соединение (например, бесконечные циклы), база данных с
   32 одновременными подключениями вскоре может оказаться заблокированной.
   Информацию о том, как обрабатывать открытые и неиспользуемые соединения, вы можете
   найти в документации к вашей базе данных.
  </p>
  <div class="warning"><strong class="warning">Внимание</strong>
   <p class="simpara">
    Есть ещё два дополнительных предостережения, которые следует
    помнить при работе с постоянными соединениями. В случае, если скрипт
    блокирует таблицу и по каким-либо причинам не может её освободить,
    при использовании постоянного соединения все последующие скрипты,
    которые используют это соединение будут блокированы бесконечно
    долго и могут потребовать рестарта веб-сервера или сервера баз данных.
    Второе предостережение заключается в том, что открытые транзакции,
    если они не были закрыты до завершения работы скрипта, будут продолжены
    в следующем скрипте, использующем это же постоянное соединение.
    Исходя из этого, вы можете использовать функцию
    <span class="function"><a href="function.register-shutdown-function.php.html" class="function">register_shutdown_function()</a></span> для указания простой функции,
    которая снимает блокировку таблиц или отката ваших транзакций.
    Ещё лучше избежать этих проблем полностью, не используя постоянные
    соединения в скриптах, которые используют блокировку таблиц или транзакции
    (при этом вы всё ещё можете использовать их где-то в другом месте).
   </p>
  </div>
  <p class="simpara">
   Важное резюме. Постоянные соединения были созданы для точного отображения
   обыкновенных соединений. Это означает, что у вас <em>всегда</em>
   есть возможность заменить все постоянные соединения непостоянными, и это
   никак не отразится на поведении скрипта. Такая замена <em>может</em>
   повлиять (и, наверное, повлияет) на эффективность работы скрипта, но
   никак не на его поведение.
  </p>
  <p class="para">
   Смотрите также <span class="function"><a href="function.ibase-pconnect.php.html" class="function">ibase_pconnect()</a></span>, <span class="function"><a href="function.ociplogon.php.html" class="function">ociplogon()</a></span>,
   <span class="function"><a href="function.odbc-pconnect.php.html" class="function">odbc_pconnect()</a></span>, <span class="function"><a href="function.oci-pconnect.php.html" class="function">oci_pconnect()</a></span>,
   <span class="function"><a href="function.pfsockopen.php.html" class="function">pfsockopen()</a></span> и <span class="function"><a href="function.pg-pconnect.php.html" class="function">pg_pconnect()</a></span>.
  </p>
 </div>
<section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=features.persistent-connections&amp;redirect=https://www.php.net/manual/ru/features.persistent-connections.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">12 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="95340">  <div class="votes">
    <div id="Vu95340">
    <a href="https://www.php.net/manual/vote-note.php?id=95340&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd95340">
    <a href="https://www.php.net/manual/vote-note.php?id=95340&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V95340" title="56% like this...">
    17
    </div>
  </div>
  <a href="features.persistent-connections.php.html#95340" class="name">
  <strong class="user"><em>Tom</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#95340"> &para;</a><div class="date" title="2009-12-28 05:37"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom95340">
<div class="phpcode"><code><span class="html">There's a third case for PHP: run on a fastCGI interface. In this case, PHP processes are NOT destroyed after each request, and so persistent connections do persist. Set PHP_FCGI_CHILDREN &lt;&lt; mysql's max_connections and you'll be fine.</span></code></div>
  </div>
 </div>
  <div class="note" id="114190">  <div class="votes">
    <div id="Vu114190">
    <a href="https://www.php.net/manual/vote-note.php?id=114190&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd114190">
    <a href="https://www.php.net/manual/vote-note.php?id=114190&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V114190" title="53% like this...">
    11
    </div>
  </div>
  <a href="features.persistent-connections.php.html#114190" class="name">
  <strong class="user"><em>php at alfadog dot net</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#114190"> &para;</a><div class="date" title="2014-01-22 04:07"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom114190">
<div class="phpcode"><code><span class="html">One additional not regarding odbc_pconnect  and possibly other variations of pconnect:<br /> <br />If the connection encounters an error (bad SQL, incorrect request, etc), that error will return with  be present in odbc_errormsg for every subsequent action on that connection, even if subsequent actions don't cause another error.<br /><br />For example:<br /><br />A script connects with odbc_pconnect.<br />The connection is created on it's first use.<br />The script calls a query "Select * FROM Table1".<br />Table1 doesn't exist and odbc_errormsg contains that error.<br /><br />Later(days, perhaps), a different script is called using the same parameters to odbc_pconnect.<br />The connection already exists, to it is reused.<br />The script calls a query "Select * FROM Table0".<br />The query runs fine, but odbc_errormsg still returns the error about Table1 not existing.<br /><br />I'm not seeing a way to clear that error using odbc_ functions, so keep your eyes open for this gotcha or use odbc_connect instead.</span></code></div>
  </div>
 </div>
  <div class="note" id="89465">  <div class="votes">
    <div id="Vu89465">
    <a href="https://www.php.net/manual/vote-note.php?id=89465&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd89465">
    <a href="https://www.php.net/manual/vote-note.php?id=89465&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V89465" title="54% like this...">
    8
    </div>
  </div>
  <a href="features.persistent-connections.php.html#89465" class="name">
  <strong class="user"><em>ynzhang from lakeheadu canada</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#89465"> &para;</a><div class="date" title="2009-03-09 10:49"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom89465">
<div class="phpcode"><code><span class="html">It seems that using pg_pconnect() will not persist the temporary views/tables. So if you are trying to create temporary views/tables with the query results and then access them with the next script of the same session, you are out of luck. Those temporary view/tables are gone after each PHP script ended. One way to get around this problem is to create real view/table with session ID as part of the name and record the name&amp;creation time in a common table. Have a garbage collection script to drop the view/table who's session is expired.</span></code></div>
  </div>
 </div>
  <div class="note" id="117523">  <div class="votes">
    <div id="Vu117523">
    <a href="https://www.php.net/manual/vote-note.php?id=117523&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd117523">
    <a href="https://www.php.net/manual/vote-note.php?id=117523&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V117523" title="53% like this...">
    7
    </div>
  </div>
  <a href="features.persistent-connections.php.html#117523" class="name">
  <strong class="user"><em>pacerier at gmail dot com</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#117523"> &para;</a><div class="date" title="2015-06-24 09:57"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom117523">
<div class="phpcode"><code><span class="html">Did anyone else notice that the last paragraph contradicts everything above it?<br /><br />( cached page: <a href="https://archive.is/ZAOwy" rel="nofollow" target="_blank">https://archive.is/ZAOwy</a> )</span></code></div>
  </div>
 </div>
  <div class="note" id="76013">  <div class="votes">
    <div id="Vu76013">
    <a href="https://www.php.net/manual/vote-note.php?id=76013&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd76013">
    <a href="https://www.php.net/manual/vote-note.php?id=76013&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V76013" title="53% like this...">
    8
    </div>
  </div>
  <a href="features.persistent-connections.php.html#76013" class="name">
  <strong class="user"><em>christopher dot jones at oracle dot com</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#76013"> &para;</a><div class="date" title="2007-06-26 10:46"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom76013">
<div class="phpcode"><code><span class="html">For the oci8 extension it is not true that " [...] when using transactions, a transaction block will also carry over to the next script which uses that connection if script execution ends before the transaction block does.".  The oci8 extension does a rollback at the end scripts using persistent connections, thus ending the transaction.  The rollback also releases locks. However any ALTER SESSION command (e.g. changing the date format) on a persistent connection will be retained over to the next script.</span></code></div>
  </div>
 </div>
  <div class="note" id="100009">  <div class="votes">
    <div id="Vu100009">
    <a href="https://www.php.net/manual/vote-note.php?id=100009&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd100009">
    <a href="https://www.php.net/manual/vote-note.php?id=100009&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V100009" title="53% like this...">
    6
    </div>
  </div>
  <a href="features.persistent-connections.php.html#100009" class="name">
  <strong class="user"><em>ambrish at php dot net</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#100009"> &para;</a><div class="date" title="2010-09-20 01:37"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom100009">
<div class="phpcode"><code><span class="html">In IBM_DB2 extension v1.9.0 or later performs a transaction rollback on persistent connections at the end of a request, thus ending the transaction. This prevents the transaction block from carrying over to the next request which uses that connection if script execution ends before the transaction block does.</span></code></div>
  </div>
 </div>
  <div class="note" id="73370">  <div class="votes">
    <div id="Vu73370">
    <a href="https://www.php.net/manual/vote-note.php?id=73370&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd73370">
    <a href="https://www.php.net/manual/vote-note.php?id=73370&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V73370" title="51% like this...">
    3
    </div>
  </div>
  <a href="features.persistent-connections.php.html#73370" class="name">
  <strong class="user"><em>andy at paradigm-reborn dot com</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#73370"> &para;</a><div class="date" title="2007-02-20 08:13"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom73370">
<div class="phpcode"><code><span class="html">To those using MySQL and finding a lot of leftover sleeping processes, take a look at MySQL's wait_timeout directive. By default it is set to 8 hours, but almost any decent production server will have been lowered to the 60 second range. Even on my testing server, I was having problems with too many connections from leftover persistent connections.</span></code></div>
  </div>
 </div>
  <div class="note" id="24393">  <div class="votes">
    <div id="Vu24393">
    <a href="https://www.php.net/manual/vote-note.php?id=24393&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd24393">
    <a href="https://www.php.net/manual/vote-note.php?id=24393&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V24393" title="48% like this...">
    -2
    </div>
  </div>
  <a href="features.persistent-connections.php.html#24393" class="name">
  <strong class="user"><em>jean_christian at myrealbox dot com</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#24393"> &para;</a><div class="date" title="2002-08-15 03:13"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom24393">
<div class="phpcode"><code><span class="html">If anyone ever wonders why the number of idle db process (open connections) seems to grow even though you are using persistent connections, here's why:<br /><br />"You are probably using a multi-process web server such as Apache. Since<br />database connections cannot be shared among different processes a new<br />one is created if the request happen to come to a different web server<br />child process."</span></code></div>
  </div>
 </div>
  <div class="note" id="62646">  <div class="votes">
    <div id="Vu62646">
    <a href="https://www.php.net/manual/vote-note.php?id=62646&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd62646">
    <a href="https://www.php.net/manual/vote-note.php?id=62646&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V62646" title="47% like this...">
    -5
    </div>
  </div>
  <a href="features.persistent-connections.php.html#62646" class="name">
  <strong class="user"><em>RQuadling at GMail dot com</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#62646"> &para;</a><div class="date" title="2006-03-06 03:43"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom62646">
<div class="phpcode"><code><span class="html">If you have multiple databases on the same server AND you are using persistent connections, you MUST prefix all the table names with the specific database name.<br /><br />Changing the database using the xxx_select_db functions alters the database for the connection for all users who are sharing that connection (assuming PHP is running shared and not CGI/CLI).<br /><br />If you have 2 databases (live and archive) and your script is talking to both, you cannot use 2 persistent connections and change the database for each one.<br /><br />Internally, persistent connections are used even if you do not specify that you want to use persistent connections. This is why new_link was added to mysql_connect/mssql_connect (PHPV4.2.0+).</span></code></div>
  </div>
 </div>
  <div class="note" id="60614">  <div class="votes">
    <div id="Vu60614">
    <a href="https://www.php.net/manual/vote-note.php?id=60614&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd60614">
    <a href="https://www.php.net/manual/vote-note.php?id=60614&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V60614" title="46% like this...">
    -6
    </div>
  </div>
  <a href="features.persistent-connections.php.html#60614" class="name">
  <strong class="user"><em>fabio</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#60614"> &para;</a><div class="date" title="2006-01-12 03:54"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom60614">
<div class="phpcode"><code><span class="html">You can in fact provide a port for the connection, take a look at <a href="http://de2.php.net/manual/en/function.mysql-pconnect.php#AEN101879" rel="nofollow" target="_blank">http://de2.php.net/manual/en/function.mysql-pconnect.php#AEN101879</a><br /><br />Just use "hostname:port" for the server address.</span></code></div>
  </div>
 </div>
  <div class="note" id="71389">  <div class="votes">
    <div id="Vu71389">
    <a href="https://www.php.net/manual/vote-note.php?id=71389&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd71389">
    <a href="https://www.php.net/manual/vote-note.php?id=71389&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V71389" title="44% like this...">
    -9
    </div>
  </div>
  <a href="features.persistent-connections.php.html#71389" class="name">
  <strong class="user"><em>whatspaz at g NO dot SPAM mail dot c o m</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#71389"> &para;</a><div class="date" title="2006-11-26 03:02"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom71389">
<div class="phpcode"><code><span class="html">in response to web at nick, have you tried FLUSH PRIVILEGES. this should reload those privileges.</span></code></div>
  </div>
 </div>
  <div class="note" id="39067">  <div class="votes">
    <div id="Vu39067">
    <a href="https://www.php.net/manual/vote-note.php?id=39067&amp;page=features.persistent-connections&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd39067">
    <a href="https://www.php.net/manual/vote-note.php?id=39067&amp;page=features.persistent-connections&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V39067" title="40% like this...">
    -23
    </div>
  </div>
  <a href="features.persistent-connections.php.html#39067" class="name">
  <strong class="user"><em>aaryal at foresightint dot com</em></strong></a><a class="genanchor" href="features.persistent-connections.php.html#39067"> &para;</a><div class="date" title="2004-01-15 03:21"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom39067">
<div class="phpcode"><code><span class="html">this one bit quite a bit of chunk out of my you-know-what. seems like if you're running multiple database servers on the same host (for eg. MySQL on a number of ports) you can't use pconnect since the port number isn't part of the key for database connections. especially if you have the same username and password to connect to all the database servers running on different ports. but then it might be php-MySQL specific. you might get a connection for an entirely different port than the one you asked for.</span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=features.persistent-connections&amp;redirect=https://www.php.net/manual/ru/features.persistent-connections.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="features.php.html">Особенности</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="features.http-auth.php.html" title="HTTP-&#8203;аутентификация в PHP">HTTP-&#8203;аутентификация в PHP</a>
                        </li>
                                                <li class="">
                            <a href="features.cookies.php.html" title="Cookies">Cookies</a>
                        </li>
                                                <li class="">
                            <a href="features.sessions.php.html" title="Сессии">Сессии</a>
                        </li>
                                                <li class="">
                            <a href="features.xforms.php.html" title="Работа с XForms">Работа с XForms</a>
                        </li>
                                                <li class="">
                            <a href="features.file-upload.php.html" title="Загрузка файлов на сервер">Загрузка файлов на сервер</a>
                        </li>
                                                <li class="">
                            <a href="features.remote-files.php.html" title="Работа с удалёнными файлами">Работа с удалёнными файлами</a>
                        </li>
                                                <li class="">
                            <a href="features.connection-handling.php.html" title="Работа с соединениями">Работа с соединениями</a>
                        </li>
                                                <li class="current">
                            <a href="features.persistent-connections.php.html" title="Постоянные соединения с базами данных">Постоянные соединения с базами данных</a>
                        </li>
                                                <li class="">
                            <a href="features.commandline.php.html" title="Работа с PHP из командной строки">Работа с PHP из командной строки</a>
                        </li>
                                                <li class="">
                            <a href="features.gc.php.html" title="Сборка мусора">Сборка мусора</a>
                        </li>
                                                <li class="">
                            <a href="features.dtrace.php.html" title="Динамическая трассировка DTrace">Динамическая трассировка DTrace</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
