<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: Базовые принципы управления сессиями - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="features.session.security.management.php.html">
 <link rel="shorturl" href="https://www.php.net/session.security.management">
 <link rel="alternate" href="https://www.php.net/session.security.management" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="session.security.php.html">
 <link rel="prev" href="session.security.php.html">
 <link rel="next" href="session.security.ini.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/features.session.security.management.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/features.session.security.management.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/features.session.security.management.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/features.session.security.management.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/features.session.security.management.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/features.session.security.management.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/features.session.security.management.php" hreflang="pt_BR">
 <link rel="alternate" href="features.session.security.management.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/features.session.security.management.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/features.session.security.management.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="session.security.ini.php.html">
          INI-настройки безопасности сессий &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="session.security.php.html">
          &laquo; Безопасность сессий        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='funcref.php.html'>Справочник функций</a></li>      <li><a href='refs.basic.session.php.html'>Модули для работы с сессиями</a></li>      <li><a href='book.session.php.html'>Сессии</a></li>      <li><a href='session.security.php.html'>Безопасность сессий</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/features.session.security.management.php'>English</option>
            <option value='de/features.session.security.management.php'>German</option>
            <option value='es/features.session.security.management.php'>Spanish</option>
            <option value='fr/features.session.security.management.php'>French</option>
            <option value='it/features.session.security.management.php'>Italian</option>
            <option value='ja/features.session.security.management.php'>Japanese</option>
            <option value='pt_BR/features.session.security.management.php'>Brazilian Portuguese</option>
            <option value='ru/features.session.security.management.php' selected="selected">Russian</option>
            <option value='tr/features.session.security.management.php'>Turkish</option>
            <option value='zh/features.session.security.management.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/reference/session/security.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Ffeatures.session.security.management%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="features.session.security.management" class="sect1">
  <h2 class="title">Базовые принципы управления сессиями</h2>

  <div class="sect2" id="features.session.security.management.basic">
   <h3 class="title">Безопасность сессии</h3>

   <p class="para">
    Модуль сессии не гарантирует, что хранимая сессионная информация доступна
    только пользователю, который создал сессию. Необходимо принять дополнительные
    меры по защите конфиденциальности сессии, основываясь на связанных с ней данных.
   </p>

   <p class="para">
    Оценка важности данных, передаваемых в рамках сессии, важна для выбора мер по
    защите этой информации; все имеет свою цену и обычно дополнительные меры защиты
    приводят к ухудшению удобства для конечного пользователя.
    Например, если необходимо защитить пользователя от
    простейших методов социальной инженерии, следует включить
    <a href="session.configuration.php.html#ini.session.use-only-cookies" class="link">session.use_only_cookies</a>. В данном случае со стороны
    пользовательского ПО обязательна поддержка cookie, иначе механизм сессий не
    будет работать.
   </p>

   <p class="para">
    Существует несколько способов утечки существующего идентификатора сессии
    третьим лицам. Например инъекции JavaScript, передача идентификатора
    сессии в URL, перехват пакетов, физический доступ к устройству и т.д.
    Перехваченный идентификатор сессии позволит третьим лицам получить
    доступ ко всем ресурсам, связанным с данной сессией.  Во-первых,
    передача идентификатора сессии в URL. При переходе на внешний сайт
    идентификатор сессии пользователя и адрес ресурса могут попасть в статистику
    переходов данного сайта. Во-вторых, при более активной атаке возможно
    прослушивание сетевого трафика злоумышленником. Если канал передачи данных не
    зашифрован, идентификаторы сессии будут переданы в виде простого текста. В
    таком случае решением является обязательное использование SSL/TLS пользователями
    при доступе к сайту. Для этих целей следует применять HSTS.
   </p>

   <blockquote class="note"><p><strong class="note">Замечание</strong>: 
    <span class="simpara">
     Даже HTTPS иногда может не защитить конфиденциальные данные. Например,
     уязвимости типа CRIME, BEAST могут позволить злоумышленнику получить доступ к
     данным. Многие сети используют прокси HTTPS MITM
     для аудита. Атакующие также могут настроить такие прокси.
    </span>
   </p></blockquote>

  </div>

  <div class="sect2" id="features.session.security.management.non-adaptive-session">
   <h3 class="title">Неадаптивное управление сессиями</h3>

   <p class="para">
    В настоящее время PHP использует адаптивное управление сессиями по умолчанию.
    Адаптивное управление сессиями несёт дополнительные риски.
   </p>

   <p class="para">
    Если <a href="session.configuration.php.html#ini.session.use-strict-mode" class="link">session.use_strict_mode</a> включён и обработчик сохранения сессии это поддерживает,
    неинициализированный сессионный ID отвергается и создаётся новый.
    Это защищает от атак, которые принуждают пользователя использовать
    заранее известный ID. Атакующий может размещать ссылки или отправлять письма,
    которые содержат сессионный ID. Например http://example.com/page.php?PHPSESSID=123456789 .
    Если опция <a href="session.configuration.php.html#ini.session.use-trans-sid" class="link">session.use_trans_sid</a> включена, то
    жертва откроет сессию с этим идентификатором.
    Опция <a href="session.configuration.php.html#ini.session.use-strict-mode" class="link">session.use_strict_mode</a> уменьшает этот риск.
   </p>

   <div class="warning"><strong class="warning">Внимание</strong>
    <p class="simpara">
     Определённый пользователем обработчик сохранения также может поддерживать
     строгий сессионный режим, путём реализации функции/метода проверки корректности
     идентификатора сессии. Все определённые пользователем обработчики сохранения
     обязаны его реализовывать.
    </p>
   </div>

   <p class="para">
    Cookie с сессионным ID должна устанавливаться с указанием параметров domain, path,
    httponly, secure и, начиная с PHP 7.3, атрибут SameSite.
    
    Их приоритетность определяется браузерами.
    Опираясь на эту приоритетность, атакующий может установить сессионный ID, который
    будет использоваться бесконечно. Применение <a href="session.configuration.php.html#ini.session.use-only-cookies" class="link">session.use_only_cookies</a>
    не решает эту проблему. <a href="session.configuration.php.html#ini.session.use-strict-mode" class="link">session.use_strict_mode</a>
    уменьшает риск. <a href="session.configuration.php.html#ini.session.use-strict-mode" class="link">session.use_strict_mode</a>=On,
    не допускает использование неинициализированных сессионных ID.
   </p>

   <blockquote class="note"><p><strong class="note">Замечание</strong>: 
    <span class="simpara">
     Даже при уменьшении риска с помощью <a href="session.configuration.php.html#ini.session.use-strict-mode" class="link">session.use_strict_mode</a>
     атакующий всё ещё может заставить пользователя использовать
     уже инициализированную сессию, созданную атакующим. Например JavaScript-инъекция.
     Эта атака может быть смягчена, если следовать рекомендациям этого руководства.
    </span>

    <span class="simpara">
     Если вы следуете этому руководству, вы должны включить <a href="session.configuration.php.html#ini.session.use-strict-mode" class="link">session.use_strict_mode</a>,
     использовать управление сессиями на основе временных меток и
     пересоздавать идентификатор сессии с помощью <span class="function"><a href="function.session-regenerate-id.php.html" class="function">session_regenerate_id()</a></span>,
     как рекомендуется. Если вы всё это сделаете, идентификатор сессии
     злоумышленника в итоге будет удалён.
    </span>

    <span class="simpara">
     Если произошёл доступ к истёкшей сессией, вы должны сохранить все
     данные активных сессий пользователя. Это позволит для дальнейшего
     расследования причин произошедшего. После этого, принудительно
     заставьте пользователя выйти из всех активных сессий, то есть потребуйте от
     пользователей переавторизации. Это позволит предотвратить
     атаку с использованием краденной сессии.
    </span>
   </p></blockquote>

   <div class="warning"><strong class="warning">Внимание</strong>
    <p class="simpara">
     Доступ к истёкшей сессии не всегда означает атаку.
     Нестабильное сетевое соединение и/или немедленное удаление
     активной сессии может повлечь за собой подобное поведение.
    </p>
   </div>

   <p class="para">
    С PHP 7.1.0 добавлена функция <span class="function"><a href="function.session-create-id.php.html" class="function">session_create_id()</a></span>.
    Эта функция может быть полезна для создания идентификатора сессии с
    использованием идентификатора пользователя в качестве префикса
    для достижения большей управляемости. При её использовании крайне важно
    разрешать <a href="session.configuration.php.html#ini.session.use-strict-mode" class="link">session.use_strict_mode</a>.
    В противном случае недобросовестные пользователи смогут устанавливать поддельные
    идентификаторы сессий для других пользователей.
   </p>

   <blockquote class="note"><p><strong class="note">Замечание</strong>: 
    <span class="simpara">
     В версиях PHP до 7.1.0 <em>необходимо</em> использовать <abbr title="Cryptographically Secure PseudoRandom Number Generator">CSPRNG</abbr>,
     например, <var class="filename">/dev/urandom</var> или
     <span class="function"><a href="function.random-bytes.php.html" class="function">random_bytes()</a></span> и функции хеширования для генерации
     нового идентификатора сессии. <span class="function"><a href="function.session-create-id.php.html" class="function">session_create_id()</a></span> имеет
     встроенная функциональность обнаружения коллизий и генерирует идентификатор
     основываясь на INI-настройках. Использование <span class="function"><a href="function.session-create-id.php.html" class="function">session_create_id()</a></span>
     является предпочтительной практикой.
    </span>
   </p></blockquote>

  </div>

  <div class="sect2" id="features.session.security.management.session-id-regeneration">
   <h3 class="title">Пересоздание идентификатора сессии</h3>

   <p class="para">
    Использование <a href="session.configuration.php.html#ini.session.use-strict-mode" class="link">session.use_strict_mode</a>
    - это хорошо, но недостаточно. Разработчик также должен использовать
    <span class="function"><a href="function.session-regenerate-id.php.html" class="function">session_regenerate_id()</a></span> для обеспечения безопасности сессий.
   </p>

   <p class="para">
    Пересоздание идентификаторов сессий сильно уменьшает риск кражи сессии,
    соответственно надо на периодической основе запускать
    <span class="function"><a href="function.session-regenerate-id.php.html" class="function">session_regenerate_id()</a></span>. Например, пересоздавать идентификатор сессии
    каждые 15 минут для особо секретных данных. Даже если сессию украдут,
    она достаточно скоро станет истёкшей и попытка её использовать
    приведёт к ошибке истёкшей сессии.
   </p>

   <p class="para">
    Идентификатор сессии <em>должен</em> пересоздаваться при
    повышении привилегий пользователя, например при аутентификации.
    Функция <span class="function"><a href="function.session-regenerate-id.php.html" class="function">session_regenerate_id()</a></span> должна вызываться до записи
    авторизационной информации в <var class="varname"><a href="reserved.variables.session.php.html" class="classname">$_SESSION</a></var>.
    (<span class="function"><a href="function.session-regenerate-id.php.html" class="function">session_regenerate_id()</a></span> сохраняет данные текущей сессии
    автоматически). Убедитесь, что только текущая сессия отмечена как
    авторизованная.
   </p>

   <p class="para">
    Разработчики <em>НЕ ДОЛЖНЫ</em> полагаться на механизм истечения срока действия
    идентификатора сессии с помощью <a href="session.configuration.php.html#ini.session.gc-maxlifetime" class="link">session.gc_maxlifetime</a>.
    Атакующие могут периодически получать доступ к сессии для
    предотвращения её срока действия и продолжать использовать идентификатор жертвы,
    включая аутентифицированные сессии.
   </p>

   <p class="para">
    Вместо этого, вы должны самостоятельно реализовать управление данными сессии
    базируясь на временной метке.
   </p>

   <div class="warning"><strong class="warning">Внимание</strong>
    <p class="simpara">
     Несмотря на то, что менеджер сессий может прозрачно управлять
     временными метками, эта функциональность не реализована. Данные
     старых сессий сохраняются до момента запуска сборщика мусора.
     В то же время, разработчики должны убедиться, что данные
     истёкших сессий удалены. Однако разработчики НЕ должны удалять данные активных сессий немедленно.
     Например, никогда не вызывайте <code class="code">session_regenerate_id(true);</code>
     и <span class="function"><a href="function.session-destroy.php.html" class="function">session_destroy()</a></span> совместно для активных сессий.
     Это может показаться противоречивым, но это обязательное требование.
    </p>
   </div>

   <p class="para">
    <span class="function"><a href="function.session-regenerate-id.php.html" class="function">session_regenerate_id()</a></span> по умолчанию <em>не</em>
    удаляет старые сессии. Устаревшие авторизованные сессии могут быть доступны
    для использования. Разработчики должны пресечь любую возможность
    использования старых сессий кем-либо, запретив доступ
    к истёкшим сессиям самостоятельно, используя временные метки.
   </p>

   <div class="warning"><strong class="warning">Внимание</strong>
    <p class="simpara">
     Немедленное удаление активных сессий может повлечь нежелательные
     побочные эффекты. Сессия может прерваться из-за нестабильности
     сети или конкурентного доступа к сайту/приложению.
    </p>
    <p class="simpara">
     Потенциальный недобросовестный доступ будет невозможно отследить и
     проанализировать, если данные сессий будут немедленно удаляться.
    </p>
    <p class="simpara">
     Вместо немедленного удаления старых сессий вы должны сохранять их
     непродолжительное время, например, установив специальный флаг и
     время окончательного истечения сессии в <var class="varname"><a href="reserved.variables.session.php.html" class="classname">$_SESSION</a></var>, запретив
     кому-либо обращаться к этим данным.
    </p>
    <p class="simpara">
     Вы не должны запрещать доступ к старым сессиям сразу же после вызова
     <span class="function"><a href="function.session-regenerate-id.php.html" class="function">session_regenerate_id()</a></span>. Необходимо подождать несколько
     секунд для стабильных сетевых соединений и несколько минут для нестабильных,
     например для WiFi или мобильного интернета.
    </p>
    <p class="simpara">
     Если пользователь пытается получить доступ к истёкшей сессии, вы не должны
     его предоставлять. В этом случае рекомендуется удалять статус &quot;авторизован&quot;
     со всех активных сессий пользователя, поскольку это очень похоже на атаку.
    </p>
   </div>

   <p class="para">
    <a href="session.configuration.php.html#ini.session.use-only-cookies" class="link">session.use_only_cookies</a>
    и правильное использование <span class="function"><a href="function.session-regenerate-id.php.html" class="function">session_regenerate_id()</a></span> могут
    привести к персональной DoS посредством установки неудаляемой cookie.
    Если такое происходит, то вы можете попросить
    пользователя удалить cookie и предупредить его о возможных проблемах
    с безопасностью. Атакующий может устанавливать вредные cookie через уязвимость
    в веб-приложении (то есть JavaScript-инъекция), уязвимость в браузерном плагине и т.д.
   </p>

   <div class="warning"><strong class="warning">Внимание</strong>
    <p class="simpara">
     Не недооценивайте риск DoS. <a href="session.configuration.php.html#ini.session.use-strict-mode" class="link">session.use_strict_mode</a>=On
     обязателен для общей безопасности идентификаторов сессий!
     Все сайты должны использовать <a href="session.configuration.php.html#ini.session.use-strict-mode" class="link">session.use_strict_mode</a>.
    </p>
    <p class="simpara">
     DoS (отказ в обслуживании) может произойти только тогда, когда аккаунт
     находится под атакой. Наиболее частая предпосылка для него
     - JavaScript-инъекция.
    </p>
   </div>

  </div>

  <div class="sect2" id="features.session.security.management.session-data-deletion">
   <h3 class="title">Удаление данных сессии</h3>

   <p class="para">
    Данные истёкших сессий должны быть недоступны и удалены. Существующий
    механизм управления сессиями делает это не очень хорошо.
   </p>

   <p class="para">
    Данные истёкших сессий надо удалять так быстро, как только возможно.
    С другой стороны, данные активных сессий НЕ ДОЛЖНЫ удаляться сразу же.
    Для обеспечения этих противоречивых требований, вы ДОЛЖНЫ самостоятельно
    реализовать механизм контроля за истёкшими сессиями на базе
    временных меток.
   </p>

   <p class="para">
    Устанавливайте и управляйте временными метками жизни сессии через $_SESSION.
    Запрещайте доступ к данным истёкших сессий. Если обнаружена попытка доступа
    к данным устаревшей сессии, снимайте статус авторизации со всех активных
    сессий пользователя и вынуждайте его переавторизоваться. Доступ к данным
    истёкшей сессии может означать атаку. Для обеспечения такого поведения
    вы должны отслеживать все активные сессии пользователя.
   </p>

   <blockquote class="note"><p><strong class="note">Замечание</strong>: 
    <span class="simpara">
     Доступ к истёкшей сессии может также произойти из-за нестабильного
     сетевого доступа и/или конкурентного доступа к приложению/сайту.
     Сервер может попытаться установить новый идентификатор сессии через
     cookie, но пакет &quot;Set-Cookie&quot; может не дойти до клиента из-за плохой связи.
     Одно соединение может вызвать пересоздание идентификатора посредством
     <span class="function"><a href="function.session-regenerate-id.php.html" class="function">session_regenerate_id()</a></span>, а другое, в то же время,
     может не получить нового идентификатора.
     Следовательно, вы должны запретить доступ к истёкшим сессиям чуть-чуть позже.
     То есть управление сессиями на базе временных меток является обязательным.
    </span>
   </p></blockquote>

   <p class="para">
    Короче говоря, не уничтожайте данные сессии ни с помощью <span class="function"><a href="function.session-regenerate-id.php.html" class="function">session_regenerate_id()</a></span>,
    ни <span class="function"><a href="function.session-destroy.php.html" class="function">session_destroy()</a></span>, а используйте механизм
    доступа к сессии на базе временных меток. Пусть <span class="function"><a href="function.session-gc.php.html" class="function">session_gc()</a></span>
    сам удаляет старые сессии из хранилища.
   </p>

  </div>

  <div class="sect2" id="features.session.security.management.session-locking">
   <h3 class="title">Сессии и блокировки</h3>

   <p class="para">
    По умолчанию данные сессии заблокированы, чтобы избежать состояния гонки.
    Блокировка обязательна для обеспечения консистентности данных сессии между
    запросами.
   </p>

   <p class="para">
    Однако блокировка может быть использована атакующим для организации DoS-атаки.
    Для уменьшения риска DoS с использованием блокировки сессий, минимизируйте их.
    Используйте блокировку &quot;read only&quot;, когда сессию не нужно обновлять.
    Используйте опцию &#039;read_and_close&#039; с <span class="function"><a href="function.session-start.php.html" class="function">session_start()</a></span>.
    <code class="code">session_start([&#039;read_and_close&#039;=&gt;1]);</code>
    Закрывайте сессию с помощью <span class="function"><a href="function.session-commit.php.html" class="function">session_commit()</a></span> сразу, как только
    вы закончили обновлять $_SESSION.
   </p>

   <p class="para">
    Текущий механизм управления сессиями <em>не следит</em> за изменениями
    $_SESSION, пока сессия неактивна. Это ваша зона ответственности, следить
    за тем, чтобы подобного не случалось.
   </p>

  </div>

  <div class="sect2" id="features.session.security.management.active-sessions">
   <h3 class="title">Активные сессии</h3>

   <p class="para">
    Разработчики должны следить за активными сессиями каждого пользователя и
    оповещать его, сколько есть активных сессий, с каких IP (и где географически),
    как долго они активны и т.д. PHP не сделает этого за вас. Вы должны это делать.
   </p>

   <p class="para">
    Есть несколько путей реализации. Вы можете хранить всю нужную информацию
    в специальной базе данных. Так что, когда сессия будет удалена сборщиком мусора,
    вы должны это отслеживать и соответственно обновлять свою базу данных.
   </p>

   <p class="para">
    Самый простой способ - использовать идентификатор пользователя в качестве префикса
    для идентификатора сессии и хранить всю требуемую информацию в $_SESSION.
    Многие базы данных умеют достаточно быстро выбирать строки по префиксу.
    Вы можете использовать <span class="function"><a href="function.session-regenerate-id.php.html" class="function">session_regenerate_id()</a></span> и
    <span class="function"><a href="function.session-create-id.php.html" class="function">session_create_id()</a></span> для этого.
   </p>

   <div class="warning"><strong class="warning">Внимание</strong>
    <p class="simpara">
     Никогда в качестве префикса не используйте конфиденциальные данные.
     Если идентификатор пользователя конфиденциален, рассмотрите возможность
     использовать функцию <span class="function"><a href="function.hash-hmac.php.html" class="function">hash_hmac()</a></span>.
    </p>
   </div>

   <div class="warning"><strong class="warning">Внимание</strong>
    <p class="simpara">
     Для подобной настройки требуется включение <a href="session.configuration.php.html#ini.session.use-strict-mode" class="link">session.use_strict_mode</a>.
     Убедитесь, что эта опция включена, иначе база данных
     активных сессий может быть скомпрометирована.
    </p>
   </div>

   <p class="para">
    Управление сессиями на базе временных меток является обязательным для
    определения устаревших сессий. Если обнаружена попытка доступа к
    устаревшей сессии, необходимо сбросить флаги авторизации для
    всех активных сессий пользователя.
   </p>

  </div>

  <div class="sect2" id="features.session.security.management.session-and-autologin">
   <h3 class="title">Сессии и автоматический вход</h3>

   <p class="para">
    Разработчики НЕ ДОЛЖНЫ использовать долгоживущие сессии для реализации
    автоматического входа в систему, потому что это резко повышает вероятность
    кражи сессии. Автоматический вход в систему должен реализовываться
    разработчиком самостоятельно.
   </p>

   <p class="para">
    Устанавливайте безопасные хешированные одноразовые ключи
    в качестве ключей автологина с помощью <span class="function"><a href="function.setcookie.php.html" class="function">setcookie()</a></span>.
    Используйте безопасное хеширование, посильнее чем SHA-2, например
    SHA-256 или выше со случайными данными из <span class="function"><a href="function.random-bytes.php.html" class="function">random_bytes()</a></span>
    или <var class="filename">/dev/urandom</var>.
   </p>

   <p class="para">
    Если пользователь не авторизован, проверьте, корректен ли одноразовый
    ключ автологина. Если ключ корректен, авторизуйте пользователя и
    установите ему новый одноразовый ключ.
    Ключ автологина обязательно должен быть одноразовым, то есть никогда
    не используйте его повторно, а всегда создавайте новый.
   </p>

   <p class="para">
    Ключ автологина - это очень долгоживущий ключ авторизации. Его надо защищать
    по максимуму. Используйте параметры path/httponly/secure/SameSite при
    установке cookie для его защиты.
    Никогда не передавайте ключ автологина, кроме случаев, когда это необходимо.
   </p>

   <p class="para">
    Разработчик должен реализовать функционал, который отключает автоматический
    вход в систему и удаляет ненужные &quot;cookie&quot;, установленные для его реализации.
   </p>

  </div>

  <div class="sect2" id="features.session.security.management.csrf">
   <h3 class="title">CSRF (Межсайтовая подделка запроса)</h3>

   <p class="para">
    Сессии и авторизация не защищают от атак типа CSRF.
    Разработчики должны самостоятельно реализовывать защиту.
   </p>

   <p class="para">
    <span class="function"><a href="function.output-add-rewrite-var.php.html" class="function">output_add_rewrite_var()</a></span> может быть использована
    для защиты от CSRF. Читайте руководство для подробностей.
   </p>

   <blockquote class="note"><p><strong class="note">Замечание</strong>: 
    <span class="simpara">
     До PHP 7.2.0 использовался один и тот же буфер вывода и INI-настройки
     для &quot;trans sid&quot;. Так что использование <span class="function"><a href="function.output-add-rewrite-var.php.html" class="function">output_add_rewrite_var()</a></span>
     с PHP более ранних версий не рекомендуется.
    </span>
   </p></blockquote>

   <p class="para">
    Многие фреймворки поддерживают защиту от CSRF. Обратитесь к документации
    своего фреймворка для более подробной информации.
   </p>

   <p class="para">
    Начиная с PHP 7.3, для сессионной cookie можно установить атрибут SameSite.
    Это обеспечит дополнительную защиту против CSRF.
   </p>
  </div>
 </div><section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=features.session.security.management&amp;redirect=https://www.php.net/manual/ru/features.session.security.management.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes </h3>
 </div>
 <div class="note">There are no user contributed notes for this page.</div></section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="session.security.php.html">Безопасность сессий</a>

                                    <ul class='child-menu-list'>

                                                <li class="current">
                            <a href="features.session.security.management.php.html" title="Базовые принципы управления сессиями">Базовые принципы управления сессиями</a>
                        </li>
                                                <li class="">
                            <a href="session.security.ini.php.html" title="INI-&#8203;настройки безопасности сессий">INI-&#8203;настройки безопасности сессий</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
