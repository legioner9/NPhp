<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: connection_aborted - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.connection-aborted.php.html">
 <link rel="shorturl" href="https://www.php.net/connection-aborted">
 <link rel="alternate" href="https://www.php.net/connection-aborted" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="ref.misc.php.html">
 <link rel="prev" href="ref.misc.php.html">
 <link rel="next" href="function.connection-status.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/function.connection-aborted.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/function.connection-aborted.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/function.connection-aborted.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.connection-aborted.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/function.connection-aborted.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.connection-aborted.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.connection-aborted.php" hreflang="pt_BR">
 <link rel="alternate" href="function.connection-aborted.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.connection-aborted.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.connection-aborted.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="function.connection-status.php.html">
          connection_status &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="ref.misc.php.html">
          &laquo; Разные функции        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='funcref.php.html'>Справочник функций</a></li>      <li><a href='refs.basic.other.php.html'>Другие базовые модули</a></li>      <li><a href='book.misc.php.html'>Misc.</a></li>      <li><a href='ref.misc.php.html'>Разные функции</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/function.connection-aborted.php'>English</option>
            <option value='de/function.connection-aborted.php'>German</option>
            <option value='es/function.connection-aborted.php'>Spanish</option>
            <option value='fr/function.connection-aborted.php'>French</option>
            <option value='it/function.connection-aborted.php'>Italian</option>
            <option value='ja/function.connection-aborted.php'>Japanese</option>
            <option value='pt_BR/function.connection-aborted.php'>Brazilian Portuguese</option>
            <option value='ru/function.connection-aborted.php' selected="selected">Russian</option>
            <option value='tr/function.connection-aborted.php'>Turkish</option>
            <option value='zh/function.connection-aborted.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/reference/misc/functions/connection-aborted.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Ffunction.connection-aborted%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="function.connection-aborted" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">connection_aborted</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">connection_aborted</span> &mdash; <span class="dc-title">Проверить, отключён ли клиент</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.connection-aborted-description">
  <h3 class="title">Описание</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>connection_aborted</strong></span>(): <span class="type">int</span></div>

  <p class="para rdfs-comment">
   Проверяет, отключён ли клиент.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.connection-aborted-parameters">
  <h3 class="title">Список параметров</h3>
  
<p class="para">
 У этой функции нет параметров.
</p>

 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.connection-aborted-returnvalues">
  <h3 class="title">Возвращаемые значения</h3>
  <p class="para">
   Возвращает 1, если клиент отключён, 0 в противном случае.
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.connection-aborted-seealso">
  <h3 class="title">Смотрите также</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.connection-status.php.html" class="function" rel="rdfs-seeAlso">connection_status()</a> - Возвращает битовое поле состояния соединения</span></li>
    <li class="member"><span class="function"><a href="function.ignore-user-abort.php.html" class="function" rel="rdfs-seeAlso">ignore_user_abort()</a> - Установить, должно ли отключение клиента прерывать выполнение скрипта</span></li>
    <li class="member">
     Смотрите <a href="features.connection-handling.php.html" class="link">Управление подключениями</a>
     для получения полного описания управления подключениями в PHP.
    </li>
   </ul>
  </p>
 </div>


</div><section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=function.connection-aborted&amp;redirect=https://www.php.net/manual/ru/function.connection-aborted.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">8 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="111167">  <div class="votes">
    <div id="Vu111167">
    <a href="https://www.php.net/manual/vote-note.php?id=111167&amp;page=function.connection-aborted&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd111167">
    <a href="https://www.php.net/manual/vote-note.php?id=111167&amp;page=function.connection-aborted&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V111167" title="51% like this...">
    4
    </div>
  </div>
  <a href="function.connection-aborted.php.html#111167" class="name">
  <strong class="user"><em>nathanb at php dot net</em></strong></a><a class="genanchor" href="function.connection-aborted.php.html#111167"> &para;</a><div class="date" title="2013-01-21 08:50"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom111167">
<div class="phpcode"><code><span class="html">A trick to detecting if a connection is closed without having to send data that will otherwise corrupt the stream of data (like a binary file) you can use a combination of chunking the data on HTTP/1.1 by sending a "0" ("zero") as a leading chunk size without anything else.<br /><br />*NOTE* it's important to note that it's not a good idea to check the stream more then once every few seconds. By doing this you are potentially increasing the data sent to the user with no gain to the user.<br /><br />A good reason to do it this way is if you are generating a report that takes a long time to run and takes a lot of server resources. This would allow the server to detect if a user canceled the download and do any cleanup without corrupting the file file being download.<br /><br />Here is an example:<br /><br /><span class="default">&lt;?php<br />ignore_user_abort</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br /></span><span class="default">header</span><span class="keyword">(</span><span class="string">'Transfer-Encoding:chunked'</span><span class="keyword">);<br /></span><span class="default">ob_flush</span><span class="keyword">();<br /></span><span class="default">flush</span><span class="keyword">();<br /></span><span class="default">$start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br /></span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br /></span><span class="comment">// Use this function to echo anything to the browser.<br /></span><span class="keyword">function </span><span class="default">vPrint</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">){<br />    if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">))<br />        echo </span><span class="default">dechex</span><span class="keyword">(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">)), </span><span class="string">"\r\n"</span><span class="keyword">, </span><span class="default">$data</span><span class="keyword">, </span><span class="string">"\r\n"</span><span class="keyword">;<br />    </span><span class="default">ob_flush</span><span class="keyword">();<br />    </span><span class="default">flush</span><span class="keyword">();<br />}<br /></span><span class="comment">// You MUST execute this function after you are done streaming information to the browser.<br /></span><span class="keyword">function </span><span class="default">endPacket</span><span class="keyword">(){<br />    echo </span><span class="string">"0\r\n\r\n"</span><span class="keyword">;<br />    </span><span class="default">ob_flush</span><span class="keyword">();<br />    </span><span class="default">flush</span><span class="keyword">();<br />}<br />do{<br />    echo </span><span class="string">"0"</span><span class="keyword">;<br />    </span><span class="default">ob_flush</span><span class="keyword">();<br />    </span><span class="default">flush</span><span class="keyword">();<br />    if(</span><span class="default">connection_aborted</span><span class="keyword">()){<br />        </span><span class="comment">// This happens when connection is closed<br />        </span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">'/tmp/test.tmp'</span><span class="keyword">, </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">"Conn Closed\nTime spent with connection open: %01.5f sec\nLoop itterations: %s\n\n"</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$start</span><span class="keyword">, </span><span class="default">$i</span><span class="keyword">), </span><span class="default">FILE_APPEND</span><span class="keyword">);<br />        </span><span class="default">endPacket</span><span class="keyword">();<br />        exit;<br />    }<br />    </span><span class="default">usleep</span><span class="keyword">(</span><span class="default">50000</span><span class="keyword">);<br />    </span><span class="default">vPrint</span><span class="keyword">(</span><span class="string">"I get echo'ed every itteration (every .5 second)&lt;br /&gt;\n"</span><span class="keyword">);<br />}while(</span><span class="default">$i</span><span class="keyword">++ &lt; </span><span class="default">200</span><span class="keyword">);<br /></span><span class="default">endPacket</span><span class="keyword">();<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="128736">  <div class="votes">
    <div id="Vu128736">
    <a href="https://www.php.net/manual/vote-note.php?id=128736&amp;page=function.connection-aborted&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd128736">
    <a href="https://www.php.net/manual/vote-note.php?id=128736&amp;page=function.connection-aborted&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V128736" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.connection-aborted.php.html#128736" class="name">
  <strong class="user"><em>Rupak Bajgain</em></strong></a><a class="genanchor" href="function.connection-aborted.php.html#128736"> &para;</a><div class="date" title="2023-07-14 04:25"><strong>6 months ago</strong></div>
  <div class="text" id="Hcom128736">
<div class="phpcode"><code><span class="html">One trick i used uas to send values in comment to get long pooling with disconnect check<br /><br />Like for json:<br />Send 0 and flush before connection aborted.<br />Eg. {"x":"000000<br />And after result is ready send ", and json after removing 1st {<br />So it looks like<br />{"x":"00000000000","y":"result","z":"result2"}</span></code></div>
  </div>
 </div>
  <div class="note" id="95202">  <div class="votes">
    <div id="Vu95202">
    <a href="https://www.php.net/manual/vote-note.php?id=95202&amp;page=function.connection-aborted&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd95202">
    <a href="https://www.php.net/manual/vote-note.php?id=95202&amp;page=function.connection-aborted&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V95202" title="40% like this...">
    -10
    </div>
  </div>
  <a href="function.connection-aborted.php.html#95202" class="name">
  <strong class="user"><em>Luciano</em></strong></a><a class="genanchor" href="function.connection-aborted.php.html#95202"> &para;</a><div class="date" title="2009-12-18 01:01"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom95202">
<div class="phpcode"><code><span class="html">In order to detect a disconnection inside the script we need to flush the buffer (it is only when the the server tries to send the buffer content that it will see that the connection is broken).<br /><br />Thus we need to use the ob_implicit_flush() function to flush automatically the buffer<br /><br />This is an example of a disconnection detection :<br /><br /><span class="default">&lt;?php<br />  </span><span class="comment">// enables the automatic flush<br />  </span><span class="default">ob_implicit_flush</span><span class="keyword">();<br /><br />  function </span><span class="default">verifyCommunication</span><span class="keyword">() {<br />    </span><span class="default">$status </span><span class="keyword">= (</span><span class="default">connection_aborted</span><span class="keyword">()?</span><span class="string">"not "</span><span class="keyword">:</span><span class="string">""</span><span class="keyword">) .</span><span class="string">"sent"</span><span class="keyword">;<br />    </span><span class="default">persistCommunication</span><span class="keyword">(new </span><span class="default">Communication</span><span class="keyword">(</span><span class="default">$status</span><span class="keyword">));<br />  }<br /><br />  </span><span class="comment">// we will check the communication state when the script finished<br />  </span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="default">verifyCommunication</span><span class="keyword">);<br />  echo </span><span class="string">"blabla"</span><span class="keyword">;<br />  </span><span class="comment">// this sleep is used to have time to break the connection on the client side<br />  </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />  echo</span><span class="string">"tata"</span><span class="keyword">;<br /></span><span class="default">?&gt;<br /></span><br />I use such a process to cancel a request if the client didn't get the acknowledgement because he will redo his request...</span></code></div>
  </div>
 </div>
  <div class="note" id="119111">  <div class="votes">
    <div id="Vu119111">
    <a href="https://www.php.net/manual/vote-note.php?id=119111&amp;page=function.connection-aborted&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd119111">
    <a href="https://www.php.net/manual/vote-note.php?id=119111&amp;page=function.connection-aborted&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V119111" title="35% like this...">
    -11
    </div>
  </div>
  <a href="function.connection-aborted.php.html#119111" class="name">
  <strong class="user"><em>sivann at gmail dot com</em></strong></a><a class="genanchor" href="function.connection-aborted.php.html#119111"> &para;</a><div class="date" title="2016-04-03 08:06"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom119111">
<div class="phpcode"><code><span class="html">I have failed to get accurate results from this even with echo, flush(), and other buffer manipulation trickery. The following function detects connection status from the OS netstat(1) in linux, even without echoing anything. You may need to alter the parsing for windows or older versions of netstat. It calls an external command so it consume some resources, use it with care e.g. you can call it every some seconds while waiting for long-poll requests. Not tested with ipv6.<br /><br />//returns connection status (ESTABLISHED, TIME_WAIT, etc) or NOT_FOUND<br />function getConnectionStatus() {<br />            $remote_ip = $_SERVER['REMOTE_ADDR']?:($_SERVER['HTTP_X_FORWARDED_FOR']?:$_SERVER['HTTP_CLIENT_IP']);<br />            $remote_port=$_SERVER['REMOTE_PORT'];<br /><br />            $cmd="netstat -tn | fgrep ' $remote_ip:$remote_port '";<br /><br />            $pfp=popen($cmd,"r");<br />                        if(!$pfp) {<br />                                error_log ("getConnectionStatus: $cmd");<br />                        }<br /><br />            $buf = fgets($pfp, 1024);<br />            pclose($pfp);<br /><br />            $buf=preg_replace('!\s+!', ' ', $buf); //remove multiple spaces<br />            $buf=trim($buf);<br /><br />            $buf_r=explode(" ",$buf);<br /><br />            if (count($buf_r)) {<br />                    $state=$buf_r[count($buf_r)-1];<br />                    return trim($state);<br />            }<br /><br />            return "NOTFOUND";<br />    }<br /><br />//check for it:<br />if (getConnectionStatus() != "ESTABLISHED") { ...}</span></code></div>
  </div>
 </div>
  <div class="note" id="118216">  <div class="votes">
    <div id="Vu118216">
    <a href="https://www.php.net/manual/vote-note.php?id=118216&amp;page=function.connection-aborted&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd118216">
    <a href="https://www.php.net/manual/vote-note.php?id=118216&amp;page=function.connection-aborted&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V118216" title="32% like this...">
    -10
    </div>
  </div>
  <a href="function.connection-aborted.php.html#118216" class="name">
  <strong class="user"><em>jeff1326 at hotmail dot com</em></strong></a><a class="genanchor" href="function.connection-aborted.php.html#118216"> &para;</a><div class="date" title="2015-10-27 09:21"><strong>8 years ago</strong></div>
  <div class="text" id="Hcom118216">
<div class="phpcode"><code><span class="html">From ignore_user_abort function : <br /><br />PHP will not detect that the user has aborted the connection until an attempt is made to send information to the client. Simply using an echo statement does not guarantee that information is sent, see flush().<br /><br />This rule seems to apply here too.</span></code></div>
  </div>
 </div>
  <div class="note" id="122262">  <div class="votes">
    <div id="Vu122262">
    <a href="https://www.php.net/manual/vote-note.php?id=122262&amp;page=function.connection-aborted&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd122262">
    <a href="https://www.php.net/manual/vote-note.php?id=122262&amp;page=function.connection-aborted&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V122262" title="27% like this...">
    -13
    </div>
  </div>
  <a href="function.connection-aborted.php.html#122262" class="name">
  <strong class="user"><em>jamest344 at gmail dot com</em></strong></a><a class="genanchor" href="function.connection-aborted.php.html#122262"> &para;</a><div class="date" title="2018-01-11 12:22"><strong>6 years ago</strong></div>
  <div class="text" id="Hcom122262">
<div class="phpcode"><code><span class="html">Declaration: I'm a novice.<br />The action on client connection loss which I wanted occurred upon browser or tab closure but not upon network link severance.  This was remedied by nobbling apache2's mod_deflate.  Other conf settings I changed may also be important (timeout?).  Thus at the bottom of my page.html I have:<br />&lt;script&gt;<br />var xhttp = new XMLHttpRequest();<br />xhttp.onreadystatechange = function() {<br />if (this.readyState == 4 &amp;&amp; this.status == 200) {<br />}<br />};<br />xhttp.open("GET", "Caller.php", true);<br />xhttp.send();<br />&lt;/script&gt;<br />Then in Caller.php I have:<br /><span class="default">&lt;?php<br />ignore_user_abort</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">);<br /></span><span class="default">Header</span><span class="keyword">(</span><span class="string">'Location: monitor.php'</span><span class="keyword">);<br /></span><span class="default">?&gt;<br /></span>And in monitor.php:<br /><span class="default">&lt;?php<br />ignore_user_abort</span><span class="keyword">(</span><span class="default">TRUE</span><span class="keyword">);<br /></span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />echo </span><span class="default">connection_status</span><span class="keyword">();<br />                                                while(</span><span class="default">1</span><span class="keyword">)<br />                                                {<br />                                                echo </span><span class="string">"something - anything - to go here - need a good few lines of it"</span><span class="keyword">;<br />                                                </span><span class="default">ob_flush</span><span class="keyword">();<br />                                                </span><span class="default">flush</span><span class="keyword">();<br />                                                </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />                                          <br />if(</span><span class="default">connection_status</span><span class="keyword">()!=</span><span class="default">0</span><span class="keyword">)<br />                                                {<br />                                                break;<br />                                                }<br />                                                }<br /><br /></span><span class="default">shell_exec</span><span class="keyword">(</span><span class="string">"DESIRED ACTION HERE"</span><span class="keyword">);<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="76048">  <div class="votes">
    <div id="Vu76048">
    <a href="https://www.php.net/manual/vote-note.php?id=76048&amp;page=function.connection-aborted&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd76048">
    <a href="https://www.php.net/manual/vote-note.php?id=76048&amp;page=function.connection-aborted&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V76048" title="31% like this...">
    -16
    </div>
  </div>
  <a href="function.connection-aborted.php.html#76048" class="name">
  <strong class="user"><em>phpcoder at cyberpimp dot techlab dot info</em></strong></a><a class="genanchor" href="function.connection-aborted.php.html#76048"> &para;</a><div class="date" title="2007-06-27 11:50"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom76048">
<div class="phpcode"><code><span class="html">Although the documentation indicates it returns an int, I found comparing the return value with numeric values does not seem to work.<br /><br />Example (does not work):<br /><span class="default">&lt;?php<br /></span><span class="keyword">if (</span><span class="default">connection_aborted</span><span class="keyword">()==</span><span class="default">1</span><span class="keyword">) {<br /></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$filehandle</span><span class="keyword">, </span><span class="string">'aborted!'</span><span class="keyword">);<br />}<br /></span><span class="default">?&gt;<br /></span><br />You're better off just assuming it returns boolean<br /><br />Example (does work):<br /><span class="default">&lt;?php<br /></span><span class="keyword">if (</span><span class="default">connection_aborted</span><span class="keyword">()) {<br /></span><span class="default">fwrite</span><span class="keyword">(</span><span class="default">$filehandle</span><span class="keyword">, </span><span class="string">'aborted!'</span><span class="keyword">);<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="94603">  <div class="votes">
    <div id="Vu94603">
    <a href="https://www.php.net/manual/vote-note.php?id=94603&amp;page=function.connection-aborted&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd94603">
    <a href="https://www.php.net/manual/vote-note.php?id=94603&amp;page=function.connection-aborted&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V94603" title="28% like this...">
    -17
    </div>
  </div>
  <a href="function.connection-aborted.php.html#94603" class="name">
  <strong class="user"><em>rickyale at ig dot com dot br</em></strong></a><a class="genanchor" href="function.connection-aborted.php.html#94603"> &para;</a><div class="date" title="2009-11-13 11:49"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom94603">
<div class="phpcode"><code><span class="html">(connection_aborted not working)<br />I had this problem years ago, now the problem came back after upgrading php... i tried everything i found and in the end the function ob_end_flush();  on top of script as post in php bug track solved the problem. Im using windows 7 x64 / php 5.2.4 / apache 2.2.14 (win32)<br /><br />try adding ob_end_flush(); on top of you script. <br />i read something about this but can't remember where, it was related to a bug or something. <br /><br />hope this help.</span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=function.connection-aborted&amp;redirect=https://www.php.net/manual/ru/function.connection-aborted.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="ref.misc.php.html">Разные функции</a>

                                    <ul class='child-menu-list'>

                                                <li class="current">
                            <a href="function.connection-aborted.php.html" title="connection_&#8203;aborted">connection_&#8203;aborted</a>
                        </li>
                                                <li class="">
                            <a href="function.connection-status.php.html" title="connection_&#8203;status">connection_&#8203;status</a>
                        </li>
                                                <li class="">
                            <a href="function.constant.php.html" title="constant">constant</a>
                        </li>
                                                <li class="">
                            <a href="function.define.php.html" title="define">define</a>
                        </li>
                                                <li class="">
                            <a href="function.defined.php.html" title="defined">defined</a>
                        </li>
                                                <li class="">
                            <a href="function.die.php.html" title="die">die</a>
                        </li>
                                                <li class="">
                            <a href="function.eval.php.html" title="eval">eval</a>
                        </li>
                                                <li class="">
                            <a href="function.exit.php.html" title="exit">exit</a>
                        </li>
                                                <li class="">
                            <a href="function.get-browser.php.html" title="get_&#8203;browser">get_&#8203;browser</a>
                        </li>
                                                <li class="">
                            <a href="function.halt-compiler.php.html" title="_&#8203;_&#8203;halt_&#8203;compiler">_&#8203;_&#8203;halt_&#8203;compiler</a>
                        </li>
                                                <li class="">
                            <a href="function.highlight-file.php.html" title="highlight_&#8203;file">highlight_&#8203;file</a>
                        </li>
                                                <li class="">
                            <a href="function.highlight-string.php.html" title="highlight_&#8203;string">highlight_&#8203;string</a>
                        </li>
                                                <li class="">
                            <a href="function.hrtime.php.html" title="hrtime">hrtime</a>
                        </li>
                                                <li class="">
                            <a href="function.ignore-user-abort.php.html" title="ignore_&#8203;user_&#8203;abort">ignore_&#8203;user_&#8203;abort</a>
                        </li>
                                                <li class="">
                            <a href="function.pack.php.html" title="pack">pack</a>
                        </li>
                                                <li class="">
                            <a href="function.php-strip-whitespace.php.html" title="php_&#8203;strip_&#8203;whitespace">php_&#8203;strip_&#8203;whitespace</a>
                        </li>
                                                <li class="">
                            <a href="function.sapi-windows-cp-conv.php.html" title="sapi_&#8203;windows_&#8203;cp_&#8203;conv">sapi_&#8203;windows_&#8203;cp_&#8203;conv</a>
                        </li>
                                                <li class="">
                            <a href="function.sapi-windows-cp-get.php.html" title="sapi_&#8203;windows_&#8203;cp_&#8203;get">sapi_&#8203;windows_&#8203;cp_&#8203;get</a>
                        </li>
                                                <li class="">
                            <a href="function.sapi-windows-cp-is-utf8.php.html" title="sapi_&#8203;windows_&#8203;cp_&#8203;is_&#8203;utf8">sapi_&#8203;windows_&#8203;cp_&#8203;is_&#8203;utf8</a>
                        </li>
                                                <li class="">
                            <a href="function.sapi-windows-cp-set.php.html" title="sapi_&#8203;windows_&#8203;cp_&#8203;set">sapi_&#8203;windows_&#8203;cp_&#8203;set</a>
                        </li>
                                                <li class="">
                            <a href="function.sapi-windows-generate-ctrl-event.php.html" title="sapi_&#8203;windows_&#8203;generate_&#8203;ctrl_&#8203;event">sapi_&#8203;windows_&#8203;generate_&#8203;ctrl_&#8203;event</a>
                        </li>
                                                <li class="">
                            <a href="function.sapi-windows-set-ctrl-handler.php.html" title="sapi_&#8203;windows_&#8203;set_&#8203;ctrl_&#8203;handler">sapi_&#8203;windows_&#8203;set_&#8203;ctrl_&#8203;handler</a>
                        </li>
                                                <li class="">
                            <a href="function.sapi-windows-vt100-support.php.html" title="sapi_&#8203;windows_&#8203;vt100_&#8203;support">sapi_&#8203;windows_&#8203;vt100_&#8203;support</a>
                        </li>
                                                <li class="">
                            <a href="function.show-source.php.html" title="show_&#8203;source">show_&#8203;source</a>
                        </li>
                                                <li class="">
                            <a href="function.sleep.php.html" title="sleep">sleep</a>
                        </li>
                                                <li class="">
                            <a href="function.sys-getloadavg.php.html" title="sys_&#8203;getloadavg">sys_&#8203;getloadavg</a>
                        </li>
                                                <li class="">
                            <a href="function.time-nanosleep.php.html" title="time_&#8203;nanosleep">time_&#8203;nanosleep</a>
                        </li>
                                                <li class="">
                            <a href="function.time-sleep-until.php.html" title="time_&#8203;sleep_&#8203;until">time_&#8203;sleep_&#8203;until</a>
                        </li>
                                                <li class="">
                            <a href="function.uniqid.php.html" title="uniqid">uniqid</a>
                        </li>
                                                <li class="">
                            <a href="function.unpack.php.html" title="unpack">unpack</a>
                        </li>
                                                <li class="">
                            <a href="function.usleep.php.html" title="usleep">usleep</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
