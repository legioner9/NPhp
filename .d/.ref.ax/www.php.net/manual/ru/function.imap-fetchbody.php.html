<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: imap_fetchbody - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.imap-fetchbody.php.html">
 <link rel="shorturl" href="https://www.php.net/imap-fetchbody">
 <link rel="alternate" href="https://www.php.net/imap-fetchbody" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="ref.imap.php.html">
 <link rel="prev" href="function.imap-fetch-overview.php.html">
 <link rel="next" href="function.imap-fetchheader.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/function.imap-fetchbody.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/function.imap-fetchbody.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/function.imap-fetchbody.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.imap-fetchbody.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/function.imap-fetchbody.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.imap-fetchbody.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.imap-fetchbody.php" hreflang="pt_BR">
 <link rel="alternate" href="function.imap-fetchbody.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.imap-fetchbody.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.imap-fetchbody.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="function.imap-fetchheader.php.html">
          imap_fetchheader &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="function.imap-fetch-overview.php.html">
          &laquo; imap_fetch_overview        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='funcref.php.html'>Справочник функций</a></li>      <li><a href='refs.remote.mail.php.html'>Модули для работы с почтой</a></li>      <li><a href='book.imap.php.html'>IMAP</a></li>      <li><a href='ref.imap.php.html'>Функции IMAP</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/function.imap-fetchbody.php'>English</option>
            <option value='de/function.imap-fetchbody.php'>German</option>
            <option value='es/function.imap-fetchbody.php'>Spanish</option>
            <option value='fr/function.imap-fetchbody.php'>French</option>
            <option value='it/function.imap-fetchbody.php'>Italian</option>
            <option value='ja/function.imap-fetchbody.php'>Japanese</option>
            <option value='pt_BR/function.imap-fetchbody.php'>Brazilian Portuguese</option>
            <option value='ru/function.imap-fetchbody.php' selected="selected">Russian</option>
            <option value='tr/function.imap-fetchbody.php'>Turkish</option>
            <option value='zh/function.imap-fetchbody.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/reference/imap/functions/imap-fetchbody.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Ffunction.imap-fetchbody%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="function.imap-fetchbody" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imap_fetchbody</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imap_fetchbody</span> &mdash; <span class="dc-title">Извлекает конкретную секцию тела сообщения</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imap-fetchbody-description">
  <h3 class="title">Описание</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imap_fetchbody</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><a href="class.imap-connection.php.html" class="type IMAP\Connection">IMAP\Connection</a></span> <code class="parameter">$imap</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$message_num</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">string</span> <code class="parameter">$section</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span><br>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   Извлекает конкретную секцию тела сообщения.
   Секции сообщения в этой функции не декодируются.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imap-fetchbody-parameters">
  <h3 class="title">Список параметров</h3>
  <p class="para">
   <dl>
    <dt>

<code class="parameter">imap</code></dt>
<dd>
<p class="para">Экземпляр <span class="classname"><a href="class.imap-connection.php.html" class="classname">IMAP\Connection</a></span>.</p></dd>

    
     <dt>
<code class="parameter">message_num</code></dt>

     <dd>

      <p class="para">
       Номер сообщения
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">section</code></dt>

     <dd>

      <p class="para">
       Номер секции сообщения. Строка целых чисел, разделённых точками,
       определяющая часть тела сообщения в соответствии со спецификацией IMAP4
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       Битовая маска из одной или нескольких опций:
       <ul class="itemizedlist">
        <li class="listitem">
         <span class="simpara">
          <strong><code>FT_UID</code></strong> - параметр  <code class="parameter">message_num</code> является UID
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          <strong><code>FT_PEEK</code></strong> - Не устанавливать флаг \Seen, если он уже
          не установлен
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          <strong><code>FT_INTERNAL</code></strong> - возвращать строку во внутреннем
          формате, без преобразования концов строк к CRLF.
         </span>
        </li>
       </ul>
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imap-fetchbody-returnvalues">
  <h3 class="title">Возвращаемые значения</h3>
  <p class="para">
   Возвращает конкретную секцию тела сообщения в виде строки или <strong><code>false</code></strong> в случае возникновения ошибки.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.imap-fetchbody-changelog">
  <h3 class="title">Список изменений</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>Версия</th>
      <th>Описание</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
 <td>8.1.0</td>
 <td>
  Параметр <code class="parameter">imap</code> теперь ожидает экземпляр <span class="classname"><a href="class.imap-connection.php.html" class="classname">IMAP\Connection</a></span>; ранее ожидался ресурс (<a href="language.types.resource.php.html" class="link">resource</a>) <code class="literal">imap</code>.
 </td>
</tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 seealso" id="refsect1-function.imap-fetchbody-seealso">
  <h3 class="title">Смотрите также</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imap-savebody.php.html" class="function" rel="rdfs-seeAlso">imap_savebody()</a> - Сохраняет часть тела сообщения в файл</span></li>
    <li class="member"><span class="function"><a href="function.imap-fetchstructure.php.html" class="function" rel="rdfs-seeAlso">imap_fetchstructure()</a> - Читает структуру указанного сообщения</span></li>
   </ul>
  </p>
 </div>

</div><section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=function.imap-fetchbody&amp;redirect=https://www.php.net/manual/ru/function.imap-fetchbody.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">37 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="89002">  <div class="votes">
    <div id="Vu89002">
    <a href="https://www.php.net/manual/vote-note.php?id=89002&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd89002">
    <a href="https://www.php.net/manual/vote-note.php?id=89002&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V89002" title="79% like this...">
    74
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#89002" class="name">
  <strong class="user"><em>atamido at gmail dot remove dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#89002"> &para;</a><div class="date" title="2009-02-17 10:54"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom89002">
<div class="phpcode"><code><span class="html">imap-fetchbody() will decode attached email messages inline with the rest of the email parts, however the way it works when handling attached email messages is inconsistent with the main email message.<br /><br />With an email message that only has a text body and does not have any mime attachments, imap-fetchbody() will return the following for each requested part number:<br /><br />(empty) - Entire message<br />0 - Message header<br />1 - Body text<br /><br />With an email message that is a multi-part message in MIME format, and contains the message text in plain text and HTML, and has a file.ext attachment, imap-fetchbody() will return something like the following for each requested part number:<br /><br />(empty) - Entire message<br />0 - Message header<br />1 - MULTIPART/ALTERNATIVE<br />1.1 - TEXT/PLAIN<br />1.2 - TEXT/HTML<br />2 - file.ext<br /><br />Now if you attach the above email to an email with the message text in plain text and HTML, imap_fetchbody() will use this type of part number system:<br /><br />(empty) - Entire message<br />0 - Message header<br />1 - MULTIPART/ALTERNATIVE<br />1.1 - TEXT/PLAIN<br />1.2 - TEXT/HTML<br />2 - MESSAGE/RFC822 (entire attached message)<br />2.0 - Attached message header<br />2.1 - TEXT/PLAIN<br />2.2 - TEXT/HTML<br />2.3 - file.ext<br /><br />Note that the file.ext is on the same level now as the plain text and HTML, and that there is no way to access the MULTIPART/ALTERNATIVE in the attached message.<br /><br />Here is a modified version of some of the code from previous posts that will build an easily accessible array that includes accessible attached message parts and the message body if there aren't multipart mimes.  The $structure variable is the output of the imap_fetchstructure() function.  The returned $part_array has the field 'part_number' which contains the part number to be fed directly into the imap_fetchbody() function.<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">function </span><span class="default">create_part_array</span><span class="keyword">(</span><span class="default">$structure</span><span class="keyword">, </span><span class="default">$prefix</span><span class="keyword">=</span><span class="string">""</span><span class="keyword">) {<br />    </span><span class="comment">//print_r($structure);<br />    </span><span class="keyword">if (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$structure</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {    </span><span class="comment">// There some sub parts<br />        </span><span class="keyword">foreach (</span><span class="default">$structure</span><span class="keyword">-&gt;</span><span class="default">parts </span><span class="keyword">as </span><span class="default">$count </span><span class="keyword">=&gt; </span><span class="default">$part</span><span class="keyword">) {<br />            </span><span class="default">add_part_to_array</span><span class="keyword">(</span><span class="default">$part</span><span class="keyword">, </span><span class="default">$prefix</span><span class="keyword">.(</span><span class="default">$count</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">), </span><span class="default">$part_array</span><span class="keyword">);<br />        }<br />    }else{    </span><span class="comment">// Email does not have a seperate mime attachment for text<br />        </span><span class="default">$part_array</span><span class="keyword">[] = array(</span><span class="string">'part_number' </span><span class="keyword">=&gt; </span><span class="default">$prefix</span><span class="keyword">.</span><span class="string">'1'</span><span class="keyword">, </span><span class="string">'part_object' </span><span class="keyword">=&gt; </span><span class="default">$obj</span><span class="keyword">);<br />    }<br />   return </span><span class="default">$part_array</span><span class="keyword">;<br />}<br /></span><span class="comment">// Sub function for create_part_array(). Only called by create_part_array() and itself. <br /></span><span class="keyword">function </span><span class="default">add_part_to_array</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">, </span><span class="default">$partno</span><span class="keyword">, &amp; </span><span class="default">$part_array</span><span class="keyword">) {<br />    </span><span class="default">$part_array</span><span class="keyword">[] = array(</span><span class="string">'part_number' </span><span class="keyword">=&gt; </span><span class="default">$partno</span><span class="keyword">, </span><span class="string">'part_object' </span><span class="keyword">=&gt; </span><span class="default">$obj</span><span class="keyword">);<br />    if (</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">type </span><span class="keyword">== </span><span class="default">2</span><span class="keyword">) { </span><span class="comment">// Check to see if the part is an attached email message, as in the RFC-822 type<br />        //print_r($obj);<br />        </span><span class="keyword">if (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {    </span><span class="comment">// Check to see if the email has parts<br />            </span><span class="keyword">foreach (</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">parts </span><span class="keyword">as </span><span class="default">$count </span><span class="keyword">=&gt; </span><span class="default">$part</span><span class="keyword">) {<br />                </span><span class="comment">// Iterate here again to compensate for the broken way that imap_fetchbody() handles attachments<br />                </span><span class="keyword">if (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {<br />                    foreach (</span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">parts </span><span class="keyword">as </span><span class="default">$count2 </span><span class="keyword">=&gt; </span><span class="default">$part2</span><span class="keyword">) {<br />                        </span><span class="default">add_part_to_array</span><span class="keyword">(</span><span class="default">$part2</span><span class="keyword">, </span><span class="default">$partno</span><span class="keyword">.</span><span class="string">"."</span><span class="keyword">.(</span><span class="default">$count2</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">), </span><span class="default">$part_array</span><span class="keyword">);<br />                    }<br />                }else{    </span><span class="comment">// Attached email does not have a seperate mime attachment for text<br />                    </span><span class="default">$part_array</span><span class="keyword">[] = array(</span><span class="string">'part_number' </span><span class="keyword">=&gt; </span><span class="default">$partno</span><span class="keyword">.</span><span class="string">'.'</span><span class="keyword">.(</span><span class="default">$count</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">), </span><span class="string">'part_object' </span><span class="keyword">=&gt; </span><span class="default">$obj</span><span class="keyword">);<br />                }<br />            }<br />        }else{    </span><span class="comment">// Not sure if this is possible<br />            </span><span class="default">$part_array</span><span class="keyword">[] = array(</span><span class="string">'part_number' </span><span class="keyword">=&gt; </span><span class="default">$prefix</span><span class="keyword">.</span><span class="string">'.1'</span><span class="keyword">, </span><span class="string">'part_object' </span><span class="keyword">=&gt; </span><span class="default">$obj</span><span class="keyword">);<br />        }<br />    }else{    </span><span class="comment">// If there are more sub-parts, expand them out.<br />        </span><span class="keyword">if (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {<br />            foreach (</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">parts </span><span class="keyword">as </span><span class="default">$count </span><span class="keyword">=&gt; </span><span class="default">$p</span><span class="keyword">) {<br />                </span><span class="default">add_part_to_array</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$partno</span><span class="keyword">.</span><span class="string">"."</span><span class="keyword">.(</span><span class="default">$count</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">), </span><span class="default">$part_array</span><span class="keyword">);<br />            }<br />        }<br />    }<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="81776">  <div class="votes">
    <div id="Vu81776">
    <a href="https://www.php.net/manual/vote-note.php?id=81776&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd81776">
    <a href="https://www.php.net/manual/vote-note.php?id=81776&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V81776" title="78% like this...">
    73
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#81776" class="name">
  <strong class="user"><em>tom at tomwardrop dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#81776"> &para;</a><div class="date" title="2008-03-12 11:08"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom81776">
<div class="phpcode"><code><span class="html">If text has been encoded as quoted-printable (most body text is encoded as this), it must be decoded for it to be displayed correctly (without '=', '=20' and other strange text chunks all through the string).<br /><br />To decode, you can use the following built-in php function...<br /><br />quoted_printable_decode($string)<br /><br />Hopefully I've just saved a few people from having to do a preg_replace on there email bodies.</span></code></div>
  </div>
 </div>
  <div class="note" id="125468">  <div class="votes">
    <div id="Vu125468">
    <a href="https://www.php.net/manual/vote-note.php?id=125468&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd125468">
    <a href="https://www.php.net/manual/vote-note.php?id=125468&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V125468" title="100% like this...">
    15
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#125468" class="name">
  <strong class="user"><em>jab_creations at yahoo dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#125468"> &para;</a><div class="date" title="2020-10-28 03:08"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom125468">
<div class="phpcode"><code><span class="html">The third parameter, the section parameter is not properly documented and I've seen a dozen or two developers in my research to figure this issue out come to hopeless conclusions. It's critical to understand that various email providers (e.g. AOL, Gmail, Microsoft, Yahoo and client programs like Thunderbird and...yes, the five thousand versions of Outlook) do NOT follow some "standard".<br /><br /> - Unlike JavaScript and how PHP normally function all index numbers start at 1, NOT 0.<br /> - Your third/section parameter will be a whole number if there is not a second 'parts' array (I am NOT using classes here).<br /> - If the 'parts' array contains a 'parts' subarray you will have floating-point numbers (e.g. 1.1 or 2.1 instead of 1 or 2). If you have two parts in the 'parts' subarray you will have something such as 1.1 and 1.2 or 2.1 and 2.2 - REMEMBER: these vary by provider and there is no "STANDARD" as this is a PHP-specific issue!<br /> - None, some or all 'parts' arrays may be singular or contain child 'parts' subarrays, this is completely dynamic and may NOT be consistent from even the same provider!<br /><br />The following presumes you have a $mail_connection and know which $email_number number you're working with:<br /><br /><span class="default">&lt;?php<br />     $i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="comment">//Level 1 part references.<br />     </span><span class="default">$j </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;</span><span class="comment">//Level 2 part references.<br />     </span><span class="default">$mail_message_structure </span><span class="keyword">= </span><span class="default">json_decode</span><span class="keyword">(</span><span class="default">json_encode</span><span class="keyword">(</span><span class="default">imap_fetchstructure</span><span class="keyword">(</span><span class="default">$mail_connection</span><span class="keyword">, </span><span class="default">$email_number</span><span class="keyword">)), </span><span class="default">true</span><span class="keyword">);</span><span class="comment">//Convert AWAY from class style.<br /><br />     </span><span class="keyword">while (</span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">]))<br />     {<br />      if (isset(</span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'parts'</span><span class="keyword">]))<br />      {</span><span class="comment">//Multiple, contains secondary 'parts' array.<br />       </span><span class="keyword">while (</span><span class="default">$j </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'parts'</span><span class="keyword">]))<br />       {<br />        </span><span class="comment">//Remove subjectivity of "Png/PNG/png" with always lower-case.<br />        </span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$j</span><span class="keyword">][</span><span class="string">'subtype'</span><span class="keyword">] = </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$j</span><span class="keyword">][</span><span class="string">'subtype'</span><span class="keyword">]);<br />        </span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$j</span><span class="keyword">][</span><span class="string">'id_imap_fetchbody'</span><span class="keyword">] = (</span><span class="default">$i </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">).</span><span class="string">'.'</span><span class="keyword">.(</span><span class="default">$j </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />        echo </span><span class="string">'&lt;p&gt;'</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">': multi, '</span><span class="keyword">.</span><span class="default">$j</span><span class="keyword">.</span><span class="string">' '</span><span class="keyword">.</span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$j</span><span class="keyword">][</span><span class="string">'subtype'</span><span class="keyword">].</span><span class="string">': '</span><span class="keyword">.(</span><span class="default">$i </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">).</span><span class="string">'.'</span><span class="keyword">.(</span><span class="default">$j </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">).</span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;<br />        </span><span class="default">$j</span><span class="keyword">++;<br />       }<br />      }<br />      else<br />      {</span><span class="comment">//Single, first level.<br />       //Remove subjectivity of "Png/PNG/png" with always lower-case.<br />       </span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'subtype'</span><span class="keyword">] = </span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'subtype'</span><span class="keyword">]);<br />       </span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'id_imap_fetchbody'</span><span class="keyword">] = (</span><span class="default">$i </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />       echo </span><span class="string">'&lt;p&gt;'</span><span class="keyword">.</span><span class="default">$i</span><span class="keyword">.</span><span class="string">': single: '</span><span class="keyword">.</span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">][</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'subtype'</span><span class="keyword">].</span><span class="string">': '</span><span class="keyword">.(</span><span class="default">$i </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">).</span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;<br />      }<br />      </span><span class="default">$i</span><span class="keyword">++;<br />     }<br /></span><span class="default">?&gt;<br /></span><br />Now that we can actually understand HOW to access specific PARTS of the email body it is a simple manner to iterate over the structure array:<br /><br /><span class="default">&lt;?php<br />     </span><span class="keyword">foreach (</span><span class="default">$mail_message_structure</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">] as </span><span class="default">$k4 </span><span class="keyword">=&gt; </span><span class="default">$v4</span><span class="keyword">)<br />     {<br />      if (isset(</span><span class="default">$v4</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">]))<br />      {<br />       foreach (</span><span class="default">$v4</span><span class="keyword">[</span><span class="string">'parts'</span><span class="keyword">] as </span><span class="default">$k5 </span><span class="keyword">=&gt; </span><span class="default">$v5</span><span class="keyword">) {</span><span class="default">mail_imap_body</span><span class="keyword">(</span><span class="default">$mail_connection</span><span class="keyword">, </span><span class="default">$email_number</span><span class="keyword">, </span><span class="default">$v5</span><span class="keyword">);}</span><span class="comment">//echo '&lt;div&gt;MULTI: '.$v5['id_imap_fetchbody'].'; &lt;pre&gt;'.htmlspecialchars(print_r($v4['parts'],1)).'&lt;/pre&gt;&lt;/div&gt;';<br />      </span><span class="keyword">}<br />      else {</span><span class="default">mail_imap_body</span><span class="keyword">(</span><span class="default">$mail_connection</span><span class="keyword">, </span><span class="default">$email_number</span><span class="keyword">, </span><span class="default">$v4</span><span class="keyword">);}</span><span class="comment">//echo '&lt;div&gt;SINGLE: '.$v4['id_imap_fetchbody'].'&lt;pre&gt;'.htmlspecialchars(print_r($v4,1)).'&lt;/pre&gt;&lt;/div&gt;';<br />     </span><span class="keyword">}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="71775">  <div class="votes">
    <div id="Vu71775">
    <a href="https://www.php.net/manual/vote-note.php?id=71775&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd71775">
    <a href="https://www.php.net/manual/vote-note.php?id=71775&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V71775" title="75% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#71775" class="name">
  <strong class="user"><em>jbr at ya-right dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#71775"> &para;</a><div class="date" title="2006-12-14 08:38"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom71775">
<div class="phpcode"><code><span class="html">Musawir Ali comment is not totally correct, ifdisposition= 1 will never tell you 100% if there is an attachment. You must look at (ifdparameters, ifparameters) if (1) of them is greater then (0), then you need to look inside (parameters), looking at each ($obj-&gt;parameters) and check the (attribute) for (NAME, FILENAME), also be sure to set them to upper or lower case before doing your testing. That's the only way to know if you have an attachment. inline attachments will have $obj-&gt;ifid equal to 1, the $obj-&gt;id will contain the (cid). If $obj-&gt;ifid equals 0 then it's also an attachment (file type) if you have (NAME, FILENAME) as the current parameters (attribute).<br /><br /><span class="default">&lt;?php<br />        $name </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br /><br />        if ( </span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">ifdparameters </span><span class="keyword">&amp;&amp; </span><span class="default">sizeof </span><span class="keyword">( </span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">dparameters </span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">)<br />        {<br />            foreach ( </span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">dparameters </span><span class="keyword">as </span><span class="default">$child </span><span class="keyword">)<br />            {<br />                if ( </span><span class="default">strtolower </span><span class="keyword">( </span><span class="default">$child</span><span class="keyword">-&gt;</span><span class="default">attribute </span><span class="keyword">) == </span><span class="string">'name' </span><span class="keyword">|| </span><span class="default">strtolower </span><span class="keyword">( </span><span class="default">$child</span><span class="keyword">-&gt;</span><span class="default">attribute </span><span class="keyword">) == </span><span class="string">'filename' </span><span class="keyword">)<br />                {<br />                    </span><span class="default">$name </span><span class="keyword">= </span><span class="default">strtolower </span><span class="keyword">( </span><span class="default">$child</span><span class="keyword">-&gt;</span><span class="default">value </span><span class="keyword">);<br />                }<br />            }<br />        }<br /><br />        if ( empty ( </span><span class="default">$name </span><span class="keyword">) )<br />        {<br />            if ( </span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">ifparameters </span><span class="keyword">&amp;&amp; </span><span class="default">sizeof </span><span class="keyword">( </span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">parameters </span><span class="keyword">) &gt; </span><span class="default">0 </span><span class="keyword">)<br />            {<br />                foreach ( </span><span class="default">$parent</span><span class="keyword">-&gt;</span><span class="default">parameters </span><span class="keyword">as </span><span class="default">$child </span><span class="keyword">)<br />                {<br />                    if ( </span><span class="default">strtolower </span><span class="keyword">( </span><span class="default">$child</span><span class="keyword">-&gt;</span><span class="default">attribute </span><span class="keyword">) == </span><span class="string">'name' </span><span class="keyword">|| </span><span class="default">strtolower </span><span class="keyword">( </span><span class="default">$child</span><span class="keyword">-&gt;</span><span class="default">attribute </span><span class="keyword">) == </span><span class="string">'filename' </span><span class="keyword">)<br />                    {<br />                        </span><span class="default">$name </span><span class="keyword">= </span><span class="default">strtolower </span><span class="keyword">( </span><span class="default">$child</span><span class="keyword">-&gt;</span><span class="default">value </span><span class="keyword">);<br />                    }<br />                }<br />            }<br />        }<br /></span><span class="default">?&gt;<br /></span><br />$parent is derived from imap_fetchstructure(), as a child object if $obj-&gt;parts is set or as the $parent if $obj-&gt;parts is not set!</span></code></div>
  </div>
 </div>
  <div class="note" id="111031">  <div class="votes">
    <div id="Vu111031">
    <a href="https://www.php.net/manual/vote-note.php?id=111031&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd111031">
    <a href="https://www.php.net/manual/vote-note.php?id=111031&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V111031" title="67% like this...">
    10
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#111031" class="name">
  <strong class="user"><em>red dot ender at yahoo dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#111031"> &para;</a><div class="date" title="2013-01-08 01:29"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom111031">
<div class="phpcode"><code><span class="html">I had some problems with the german umlauts from a gmail fetched text. I lost an hour trying to find a solution. <br /><br />Hopefully this helps someone in need :)<br /><br /><span class="default">&lt;?php<br />$text </span><span class="keyword">= </span><span class="default">trim</span><span class="keyword">( </span><span class="default">utf8_encode</span><span class="keyword">( </span><span class="default">quoted_printable_decode</span><span class="keyword">(<br />                        </span><span class="default">imap_fetchbody</span><span class="keyword">( </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">inbox</span><span class="keyword">, </span><span class="default">$emailNo</span><span class="keyword">, </span><span class="default">$section </span><span class="keyword">) ) ) );<br /><br /></span><span class="default">$section was previously defined</span><span class="keyword">:<br /></span><span class="default">$section </span><span class="keyword">= empty( </span><span class="default">$attachments </span><span class="keyword">) ? </span><span class="default">1 </span><span class="keyword">: </span><span class="default">1.1</span><span class="keyword">;<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="109130">  <div class="votes">
    <div id="Vu109130">
    <a href="https://www.php.net/manual/vote-note.php?id=109130&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd109130">
    <a href="https://www.php.net/manual/vote-note.php?id=109130&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V109130" title="68% like this...">
    8
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#109130" class="name">
  <strong class="user"><em>gesti at gmx dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#109130"> &para;</a><div class="date" title="2012-06-22 11:10"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom109130">
<div class="phpcode"><code><span class="html">How to give more then one option in the "options" parameter:<br />It took me some time to realize how easy it is, so just in case some one else would be puzzled at this point:<br /><span class="default">&lt;?php<br />imap_fetchbody</span><span class="keyword">(</span><span class="default">$imap_stream</span><span class="keyword">, </span><span class="default">$msg_number</span><span class="keyword">, </span><span class="default">$section</span><span class="keyword">, </span><span class="default">FT_UID </span><span class="keyword">| </span><span class="default">FT_PEEK</span><span class="keyword">);<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="116428">  <div class="votes">
    <div id="Vu116428">
    <a href="https://www.php.net/manual/vote-note.php?id=116428&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd116428">
    <a href="https://www.php.net/manual/vote-note.php?id=116428&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V116428" title="70% like this...">
    4
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#116428" class="name">
  <strong class="user"><em>mike at lathyrus dot net</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#116428"> &para;</a><div class="date" title="2015-01-01 04:37"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom116428">
<div class="phpcode"><code><span class="html">I spent hours religously thinking that<br /><br />imap_fetchbody($mbox,$email_number,1.2) <br /><br />would fetch the html body, and in many cases this did not work.  It turns out that simple message can have a simple [parts] stucture so this became true:<br /><br />imap_fetchbody($mbox,$email_number,1) - PLAIN<br />imap_fetchbody($inbox,$email_number,2) - HTML<br /><br />Check for empty string before using the latter.</span></code></div>
  </div>
 </div>
  <div class="note" id="10124">  <div class="votes">
    <div id="Vu10124">
    <a href="https://www.php.net/manual/vote-note.php?id=10124&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd10124">
    <a href="https://www.php.net/manual/vote-note.php?id=10124&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V10124" title="66% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#10124" class="name">
  <strong class="user"><em>rfinnie at kefta dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#10124"> &para;</a><div class="date" title="2000-12-14 02:23"><strong>23 years ago</strong></div>
  <div class="text" id="Hcom10124">
<div class="phpcode"><code><span class="html">With regard to message/rfc822 parts, it appears that the IMAP c-client that PHP uses does not follow the IMAP RFC (#2060) correctly.  The RFC specifies that to grab the headers for a message/rfc822 part, you would request part "2.HEADER" (assuming 2 is your part number), and the full text of the part would be "2.TEXT".  Instead, "2.0" will grab the headers, and just "2" will get the text.</span></code></div>
  </div>
 </div>
  <div class="note" id="108884">  <div class="votes">
    <div id="Vu108884">
    <a href="https://www.php.net/manual/vote-note.php?id=108884&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd108884">
    <a href="https://www.php.net/manual/vote-note.php?id=108884&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V108884" title="62% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#108884" class="name">
  <strong class="user"><em>caevan at amkd dot com dot au</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#108884"> &para;</a><div class="date" title="2012-06-01 02:52"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom108884">
<div class="phpcode"><code><span class="html">I tried using the function add_part_to_array below and noticed a few errors were thrown. If there are no 'parts' in the structure then if (sizeof($obj-&gt;parts) &gt; 0) will throw an error. As well $prefix is not defined here is the code I have updated. I have left the original lines commented out. I have tested reading emails from a gmail account and so far so good.<br /><br /><span class="default">&lt;?php<br /><br /></span><span class="comment">// Sub function for create_part_array(). Only called by create_part_array() and itself. <br /></span><span class="keyword">function </span><span class="default">add_part_to_array</span><span class="keyword">(</span><span class="default">$obj</span><span class="keyword">, </span><span class="default">$partno</span><span class="keyword">, &amp; </span><span class="default">$part_array</span><span class="keyword">) {<br />    </span><span class="default">$part_array</span><span class="keyword">[] = array(</span><span class="string">'part_number' </span><span class="keyword">=&gt; </span><span class="default">$partno</span><span class="keyword">, </span><span class="string">'part_object' </span><span class="keyword">=&gt; </span><span class="default">$obj</span><span class="keyword">);<br /><br />   if (</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">type </span><span class="keyword">== </span><span class="default">2</span><span class="keyword">) { </span><span class="comment">// Check to see if the part is an attached email message, as in the RFC-822 type<br />//        if (sizeof($obj-&gt;parts) &gt; 0) {    // Check to see if the email has parts<br />    </span><span class="keyword">if(</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'parts'</span><span class="keyword">,</span><span class="default">$obj</span><span class="keyword">){<br />            foreach (</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">parts </span><span class="keyword">as </span><span class="default">$count </span><span class="keyword">=&gt; </span><span class="default">$part</span><span class="keyword">) {<br />                </span><span class="comment">// Iterate here again to compensate for the broken way that imap_fetchbody() handles attachments<br />                </span><span class="keyword">if (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {<br />                    foreach (</span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">parts </span><span class="keyword">as </span><span class="default">$count2 </span><span class="keyword">=&gt; </span><span class="default">$part2</span><span class="keyword">) {<br />                        </span><span class="default">add_part_to_array</span><span class="keyword">(</span><span class="default">$part2</span><span class="keyword">, </span><span class="default">$partno</span><span class="keyword">.</span><span class="string">"."</span><span class="keyword">.(</span><span class="default">$count2</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">), </span><span class="default">$part_array</span><span class="keyword">);<br />                    }<br />                }else{    </span><span class="comment">// Attached email does not have a seperate mime attachment for text<br />                    </span><span class="default">$part_array</span><span class="keyword">[] = array(</span><span class="string">'part_number' </span><span class="keyword">=&gt; </span><span class="default">$partno</span><span class="keyword">.</span><span class="string">'.'</span><span class="keyword">.(</span><span class="default">$count</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">), </span><span class="string">'part_object' </span><span class="keyword">=&gt; </span><span class="default">$obj</span><span class="keyword">);<br />                }<br />            }<br />        }else{    </span><span class="comment">// Not sure if this is possible<br />//            $part_array[] = array('part_number' =&gt; $prefix.'.1', 'part_object' =&gt; $obj);<br />            </span><span class="default">$part_array</span><span class="keyword">[] = array(</span><span class="string">'part_number' </span><span class="keyword">=&gt; </span><span class="default">$partno</span><span class="keyword">.</span><span class="string">'.1'</span><span class="keyword">, </span><span class="string">'part_object' </span><span class="keyword">=&gt; </span><span class="default">$obj</span><span class="keyword">);<br />        }<br />    }else{    </span><span class="comment">// If there are more sub-parts, expand them out.<br />//        if (sizeof($obj-&gt;parts) &gt; 0) {<br />                    </span><span class="keyword">if(</span><span class="default">array_key_exists</span><span class="keyword">(</span><span class="string">'parts'</span><span class="keyword">,</span><span class="default">$obj</span><span class="keyword">)){<br />            foreach (</span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">parts </span><span class="keyword">as </span><span class="default">$count </span><span class="keyword">=&gt; </span><span class="default">$p</span><span class="keyword">) {<br />                </span><span class="default">add_part_to_array</span><span class="keyword">(</span><span class="default">$p</span><span class="keyword">, </span><span class="default">$partno</span><span class="keyword">.</span><span class="string">"."</span><span class="keyword">.(</span><span class="default">$count</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">), </span><span class="default">$part_array</span><span class="keyword">);<br />            }<br />        }<br />    }<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="31685">  <div class="votes">
    <div id="Vu31685">
    <a href="https://www.php.net/manual/vote-note.php?id=31685&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd31685">
    <a href="https://www.php.net/manual/vote-note.php?id=31685&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V31685" title="62% like this...">
    4
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#31685" class="name">
  <strong class="user"><em>ulrich at kaldamar dot de</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#31685"> &para;</a><div class="date" title="2003-04-30 04:54"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom31685">
<div class="phpcode"><code><span class="html">The function imap_fetchbody() seems uncapable of getting subordinate parts of a message/rfc822-part. I had problems with getting an attachment that was forwarded in such a part, because the object given by imap_fetchstructure() would assume that the part was represented by the string "2.1.2.1.2". <br /><br />So I wrote this set of functions which parses the raw message-body and creates an array with the struture corresponding to the structure given by imap_fetchstructure(). The function mail_fetchpart() (see below) will work on the array and return even those parts that I could not get with imap_fetchbody().<br /><br />Example usage of this function: mail_fetchpart($mbox, 2, "2.1.2.1.2");<br /><br />Note: If the message does not contain multiple pars, the body of the message can be accessed by the part-string "1".<br />I have more functions for parsing and decoding messages, just email me.<br /><br />    // get the body of a part of a message according to the<br />    // string in $part<br />    function mail_fetchpart($mbox, $msgNo, $part) {<br />        $parts = mail_fetchparts($mbox, $msgNo);<br />        <br />        $partNos = explode(".", $part);<br />        <br />        $currentPart = $parts;<br />        while(list ($key, $val) = each($partNos)) {<br />            $currentPart = $currentPart[$val];<br />        }<br />        <br />        if ($currentPart != "") return $currentPart;<br />          else return false;<br />    }<br /><br />    // splits a message given in the body if it is<br />    // a mulitpart mime message and returns the parts,<br />    // if no parts are found, returns false<br />    function mail_mimesplit($header, $body) {<br />        $parts = array();<br />        <br />        $PN_EREG_BOUNDARY = "Content-Type:(.*)boundary=\"([^\"]+)\"";<br /><br />        if (eregi ($PN_EREG_BOUNDARY, $header, $regs)) {<br />            $boundary = $regs[2];<br /><br />            $delimiterReg = "([^\r\n]*)$boundary([^\r\n]*)";<br />            if (eregi ($delimiterReg, $body, $results)) {<br />                $delimiter = $results[0];<br />                $parts = explode($delimiter, $body);<br />                $parts = array_slice ($parts, 1, -1);<br />            }<br />            <br />            return $parts;<br />        } else {<br />            return false;<br />        }    <br />        <br />        <br />    }<br /><br />    // returns an array with all parts that are<br />    // subparts of the given part<br />    // if no subparts are found, return the body of <br />    // the current part<br />    function mail_mimesub($part) {<br />        $i = 1;<br />        $headDelimiter = "\r\n\r\n";<br />        $delLength = strlen($headDelimiter);<br />    <br />        // get head &amp; body of the current part<br />        $endOfHead = strpos( $part, $headDelimiter);<br />        $head = substr($part, 0, $endOfHead);<br />        $body = substr($part, $endOfHead + $delLength, strlen($part));<br />        <br />        // check whether it is a message according to rfc822<br />        if (stristr($head, "Content-Type: message/rfc822")) {<br />            $part = substr($part, $endOfHead + $delLength, strlen($part));<br />            $returnParts[1] = mail_mimesub($part);<br />            return $returnParts;<br />        // if no message, get subparts and call function recursively<br />        } elseif ($subParts = mail_mimesplit($head, $body)) {<br />            // got more subparts<br />            while (list ($key, $val) = each($subParts)) {<br />                $returnParts[$i] = mail_mimesub($val);<br />                $i++;<br />            }            <br />            return $returnParts;<br />        } else {<br />            return $body;<br />        }<br />    }<br /><br />    // get an array with the bodies all parts of an email<br />    // the structure of the array corresponds to the <br />    // structure that is available with imap_fetchstructure<br />    function mail_fetchparts($mbox, $msgNo) {<br />        $parts = array();<br />        $header = imap_fetchheader($mbox,$msgNo);<br />        $body = imap_body($mbox,$msgNo, FT_INTERNAL);<br />        <br />        $i = 1;<br />        <br />        if ($newParts = mail_mimesplit($header, $body)) {<br />            while (list ($key, $val) = each($newParts)) {<br />                $parts[$i] = mail_mimesub($val);<br />                $i++;                <br />            }<br />        } else {<br />            $parts[$i] = $body;<br />        }<br />        return $parts;<br />        <br />    }</span></code></div>
  </div>
 </div>
  <div class="note" id="72951">  <div class="votes">
    <div id="Vu72951">
    <a href="https://www.php.net/manual/vote-note.php?id=72951&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd72951">
    <a href="https://www.php.net/manual/vote-note.php?id=72951&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V72951" title="60% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#72951" class="name">
  <strong class="user"><em>web at i-ps dot net</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#72951"> &para;</a><div class="date" title="2007-02-05 10:35"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom72951">
<div class="phpcode"><code><span class="html">I had an issue with the content that was returned by imap_fetchbody - either the function itself, or the mail-server, was inserting "=\r\n" at points into the text body returned. This may depend upon the content type (i.e. plain text / csv, as opposed to something like a Word document), but you may need to do something like:<br /><br />$body = preg_replace("/=(\r?)\n/", '', imap_fetchbody($mailbox, $message, $part));</span></code></div>
  </div>
 </div>
  <div class="note" id="42633">  <div class="votes">
    <div id="Vu42633">
    <a href="https://www.php.net/manual/vote-note.php?id=42633&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd42633">
    <a href="https://www.php.net/manual/vote-note.php?id=42633&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V42633" title="58% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#42633" class="name">
  <strong class="user"><em>jsimlo yahoo com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#42633"> &para;</a><div class="date" title="2004-05-24 01:38"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom42633">
<div class="phpcode"><code><span class="html">this may be the way, how to obtain all those part_numbers.... even when a message contains another message attached, and it contains another message attached...<br /><br />&lt;?<br /> $parttypes = array ("text", "multipart", "message", "application", "audio", "image", "video", "other");<br /> function buildparts ($struct, $pno = "") {<br />   global $parttypes;<br />   switch ($struct-&gt;type):<br />     case 1:<br />       $r = array (); $i = 1;<br />       foreach ($struct-&gt;parts as $part)<br />         $r[] = buildparts ($part, $pno.".".$i++);<br /><br />       return implode (", ", $r);<br />     case 2: <br />       return "{".buildparts ($struct-&gt;parts[0], $pno)."}";<br />     default:<br />       return '&lt;a href="?p='.substr ($pno, 1).'"&gt;'.$parttypes[$struct-&gt;type]."/".strtolower ($struct-&gt;subtype)."&lt;/a&gt;";<br />   endswitch;<br /> }<br /><br />  $struct = imap_fetchstructure ($pop3mbox, $msguid, FT_UID);<br />  echo buildparts ($struct);<br />?&gt;<br /><br />it will print something like: <br /><br />&lt;a href="?p=1"&gt;text/plain&lt;/a&gt;, {&lt;a href="?p=2.1"&gt;text/plain&lt;/a&gt;, &lt;a href="?p=2.2"&gt;text/html&lt;/a&gt;}</span></code></div>
  </div>
 </div>
  <div class="note" id="88662">  <div class="votes">
    <div id="Vu88662">
    <a href="https://www.php.net/manual/vote-note.php?id=88662&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd88662">
    <a href="https://www.php.net/manual/vote-note.php?id=88662&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V88662" title="55% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#88662" class="name">
  <strong class="user"><em>atamido at gmail dot remove dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#88662"> &para;</a><div class="date" title="2009-02-02 11:50"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom88662">
<div class="phpcode"><code><span class="html">If you download an attachment labeled "winmail.dat" or "win.dat", or with the mime-type of "APPLICATION/MS-TNEF", this is a Microsoft Transport Neutral Encapsulation Format file.  It is a proprietary method for encoding several files together in a single file.  AFAIK only Outlook sends it with its default setting of sending emails in Rich Text Format.<br /><br />As of PHP 5.2 there is no internal method of breaking apart these attachments.<br /><br />There are external command line utilities that can be called from PHP.  Alternately, it is possible to decode these files entirely in PHP.  It appears that all current libraries are based on a plugin written by Graham Norbury for Squirrel Mail.  The only ones I've seen are in IlohaMail, Telean, Horde-Imp, and NaSMail.  The only one that I know that will also decode the RTF message is from NaSMail.<br /><br />To use the NaSMail code, download the "TNEF Attachment Decoder" plugin and extract it to <br />plugins/attachment_tnef/<br /><br />Then use this bit of code:<br /><span class="default">&lt;?php<br /></span><span class="keyword">include_once(</span><span class="string">'plugins/attachment_tnef/constants.php'</span><span class="keyword">);<br />include_once(</span><span class="string">'plugins/attachment_tnef/functions.php'</span><span class="keyword">);<br />include_once(</span><span class="string">'plugins/attachment_tnef/class/tnef.php'</span><span class="keyword">);<br /><br /></span><span class="comment">// $tnef is a binary variable containing only the contents of winmail.dat<br /></span><span class="default">$attachment </span><span class="keyword">= &amp;new </span><span class="default">TnefAttachment</span><span class="keyword">(</span><span class="default">$tnef_debug</span><span class="keyword">);<br /></span><span class="default">$result </span><span class="keyword">= </span><span class="default">$attachment</span><span class="keyword">-&gt;</span><span class="default">decodeTnef</span><span class="keyword">(</span><span class="default">$tnef</span><span class="keyword">);<br /></span><span class="default">$tnef_files </span><span class="keyword">= &amp;</span><span class="default">$attachment</span><span class="keyword">-&gt;</span><span class="default">getFilesNested</span><span class="keyword">();<br /></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$tnef_files</span><span class="keyword">); </span><span class="comment">// See the format of the returned array<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="41262">  <div class="votes">
    <div id="Vu41262">
    <a href="https://www.php.net/manual/vote-note.php?id=41262&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd41262">
    <a href="https://www.php.net/manual/vote-note.php?id=41262&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V41262" title="55% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#41262" class="name">
  <strong class="user"><em>php at NOSPAM dot sibyla dot cz</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#41262"> &para;</a><div class="date" title="2004-04-04 03:56"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom41262">
<div class="phpcode"><code><span class="html">// $uid - msg number<br /><br />function read_all_parts($uid){<br /> global $mime,$ret_info,$enc;<br />  $mime = array("text","multipart","message","application","audio",<br />"image","video","other","unknow");<br />  $enc  = array("7BIT","8BIT","BINARY","BASE64",<br />"QUOTED-PRINTABLE","OTHER");<br />      <br /><br /> $struct = imap_fetchstructure( $this -&gt; Link, $uid );<br /><br /> $ret_info = array();<br /><br />function scan($struct,$subkey){<br /> global $mime,$enc,$ret_info;<br /> <br /> foreach($struct as $key =&gt; $value){ <br /><br />  <br />  if($subkey!=0){<br />  $pid = $subkey.".".($key+1); }<br />  else { $pid = ($key+1); }<br />  <br />  $ret_info[]['pid'] = $pid;<br />  $ret_info[key($ret_info)]['type'] = $mime["$value-&gt;type"];<br />  $ret_info[key($ret_info)]['encoding'] = $enc["$value-&gt;encoding"]; <br /><br />  next($ret_info);<br />  <br />  if(($value-&gt;parts)!= null) {scan($value-&gt;parts,$pid); }<br /> }<br /> <br /> }<br /><br />scan($struct-&gt;parts,0);<br /><br />return $ret_info;<br /><br />}</span></code></div>
  </div>
 </div>
  <div class="note" id="43405">  <div class="votes">
    <div id="Vu43405">
    <a href="https://www.php.net/manual/vote-note.php?id=43405&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd43405">
    <a href="https://www.php.net/manual/vote-note.php?id=43405&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V43405" title="52% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#43405" class="name">
  <strong class="user"><em>noose (at) nospam (dot) tweak (dot) pl</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#43405"> &para;</a><div class="date" title="2004-06-20 04:04"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom43405">
<div class="phpcode"><code><span class="html">Sorry for my english....<br /><br />for read the attachment's:<br /><br />&lt;?<br /> foreach ($_GET as $k =&gt; $v)<br /> {<br />     $$k = $v;<br /> }<br /> $login = 'mylogin';<br /> $password = 'mypassword';<br /> $host = '{myhost:110/pop3}';<br /><br />$mbox = imap_open("$host", "$login", "$password");<br />$struckture = imap_fetchstructure($mbox, $id);<br />$message = imap_fetchbody($mbox,$id,$part);    <br />$name = $struckture-&gt;parts[$part]-&gt;dparameters[0]-&gt;value;<br />$type = $struckture-&gt;parts[$part]-&gt;typee;<br />############## type<br />if ($type == 0)<br />{<br />    $type = "text/";<br />}<br />elseif ($type == 1)<br />{<br />    $type = "multipart/";<br />}<br />elseif ($type == 2)<br />{<br />    $type = "message/";<br />}<br />elseif ($type == 3)<br />{<br />    $type = "application/";<br />}<br />elseif ($type == 4)<br />{<br />    $type = "audio/";<br />}<br />elseif ($type == 5)<br />{<br />    $type = "image/";<br />}<br />elseif ($type == 6)<br />{<br />    $type = "video";<br />}<br />elseif($type == 7)<br />{<br />    $type = "other/";<br />}<br />$type .= $struckture-&gt;parts[$part]-&gt;subtypee;<br />######## Type end<br /><br />header("Content-typee: ".$type);<br />header("Content-Disposition: attachment; filename=".$name);<br /><br />######## coding<br />$coding = $struckture-&gt;parts[$part]-&gt;encoding;<br />if ($coding == 0)<br />{<br />    $message = imap_7bit($message);<br />}<br />elseif ($coding == 1)<br />{<br />    $wiadomsoc = imap_8bit($message);<br />}<br />elseif ($coding == 2)<br />{<br />    $message = imap_binary($message);<br />}<br />elseif ($coding == 3)<br />{<br />    $message = imap_base64($message);<br />}<br />elseif ($coding == 4)<br />{<br />    $message = quoted_printable($message);<br />}<br />elseif ($coding == 5)<br />{<br />    $message = $message;<br />}<br />echo $message;<br />########## coding end<br /> imap_close($mbox);<br />?&gt;</span></code></div>
  </div>
 </div>
  <div class="note" id="115668">  <div class="votes">
    <div id="Vu115668">
    <a href="https://www.php.net/manual/vote-note.php?id=115668&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd115668">
    <a href="https://www.php.net/manual/vote-note.php?id=115668&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V115668" title="no votes...">
    0
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#115668" class="name">
  <strong class="user"><em>tabaccoandcoffee at gmail dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#115668"> &para;</a><div class="date" title="2014-09-05 08:01"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom115668">
<div class="phpcode"><code><span class="html">Sorry for my English. <br />Rather than quoted_printable_decode, you can use the function imap_qprint ($body)</span></code></div>
  </div>
 </div>
  <div class="note" id="73426">  <div class="votes">
    <div id="Vu73426">
    <a href="https://www.php.net/manual/vote-note.php?id=73426&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd73426">
    <a href="https://www.php.net/manual/vote-note.php?id=73426&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V73426" title="100% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#73426" class="name">
  <strong class="user"><em>anonymous at coward dot village</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#73426"> &para;</a><div class="date" title="2007-02-22 11:08"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom73426">
<div class="phpcode"><code><span class="html">A very easy way to handle attachments is just using munpack, with a subdirectory called attachments chmod it to 777 and then use the following bit of code (with mpack installed) on the MIME encoded body:<br /><br /><span class="default">&lt;?php<br /></span><span class="comment">//email MIME body in $input<br /></span><span class="default">file_put_contents</span><span class="keyword">(</span><span class="string">"attachments/body.eml"</span><span class="keyword">,</span><span class="default">$input</span><span class="keyword">);<br /></span><span class="default">$command </span><span class="keyword">= </span><span class="string">"munpack -C attachments -fq body.eml"</span><span class="keyword">;<br /></span><span class="default">exec</span><span class="keyword">(</span><span class="default">$command</span><span class="keyword">,</span><span class="default">$output</span><span class="keyword">);<br />if(</span><span class="default">$output</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]!=</span><span class="string">'Did not find anything to unpack from body.eml'</span><span class="keyword">) {<br />    foreach (</span><span class="default">$output </span><span class="keyword">as </span><span class="default">$attach</span><span class="keyword">) {<br />        </span><span class="default">$pieces </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">$attach</span><span class="keyword">);<br />        </span><span class="default">$part </span><span class="keyword">= </span><span class="default">$pieces</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">];<br />        echo </span><span class="string">"&lt;a href=\"attachments/</span><span class="default">$part</span><span class="string">\"&gt;</span><span class="default">$part</span><span class="string">&lt;/a&gt;&lt;br&gt;"</span><span class="keyword">;<br />        }<br />    }<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="93855">  <div class="votes">
    <div id="Vu93855">
    <a href="https://www.php.net/manual/vote-note.php?id=93855&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd93855">
    <a href="https://www.php.net/manual/vote-note.php?id=93855&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V93855" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#93855" class="name">
  <strong class="user"><em>atamido at gmail dot remove dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#93855"> &para;</a><div class="date" title="2009-10-03 11:32"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom93855">
<div class="phpcode"><code><span class="html">The previous post contains a copy/paste error and a little added complexity.  The first function should look like this:<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">function </span><span class="default">create_part_array</span><span class="keyword">(</span><span class="default">$struct</span><span class="keyword">) {<br />    if (</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$struct</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {    </span><span class="comment">// There some sub parts<br />        </span><span class="keyword">foreach (</span><span class="default">$struct</span><span class="keyword">-&gt;</span><span class="default">parts </span><span class="keyword">as </span><span class="default">$count </span><span class="keyword">=&gt; </span><span class="default">$part</span><span class="keyword">) {<br />            </span><span class="default">add_part_to_array</span><span class="keyword">(</span><span class="default">$part</span><span class="keyword">, (</span><span class="default">$count</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">), </span><span class="default">$part_array</span><span class="keyword">);<br />        }<br />    }else{    </span><span class="comment">// Email does not have a seperate mime attachment for text<br />        </span><span class="default">$part_array</span><span class="keyword">[] = array(</span><span class="string">'part_number' </span><span class="keyword">=&gt; </span><span class="string">'1'</span><span class="keyword">, </span><span class="string">'part_object' </span><span class="keyword">=&gt; </span><span class="default">$struct</span><span class="keyword">);<br />    }<br />   return </span><span class="default">$part_array</span><span class="keyword">;<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="81983">  <div class="votes">
    <div id="Vu81983">
    <a href="https://www.php.net/manual/vote-note.php?id=81983&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd81983">
    <a href="https://www.php.net/manual/vote-note.php?id=81983&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V81983" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#81983" class="name">
  <strong class="user"><em>anonymous lazy person</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#81983"> &para;</a><div class="date" title="2008-03-22 08:51"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom81983">
<div class="phpcode"><code><span class="html">Expanding on a comment below about using munpack to extract attachments, here's a lazy person's function that extracts attachments from mail with $msg_number from $mailbox and writes them to $dir. It returns an array of filenames or false if there are no attachments. <br /><br />function writeAttachmentsToDisk($mailbox, $msg_number, $dir){<br />  <br />  if (!file_exists($dir)){<br />    mkdir($dir);<br />  }<br />  $filename = "tmp.eml";<br />  $email_file = $dir."/".$filename;<br />  // write the message body to disk<br />  imap_savebody  ($mailbox, $email_file, $msg_number);<br />  $command = "munpack -C $dir -fq $email_file";<br />  // invoke munpack which will <br />  // write all the attachments to $dir<br />  exec($command,$output);<br /><br />  // if($output[0]!='Did not find anything to unpack from $filename') {<br />  $found_file = false;<br />  foreach ($output as $attach) {<br />    $pieces = explode(" ", $attach);<br />    $part = $pieces[0];<br />    if (file_exists($dir.$part)){<br />      $found_file = true;<br />      $files[] = $part;<br />    }<br />  }<br />  if (!$found_file){<br />    //echo ("\nMail.php : no files found - cleaning up. ");<br />    // didn't find any output files - delete the directory and email file<br />    unlink($email_file);<br />    rmdir($dir);<br />    return false;<br />  }<br />  else {<br />    // found some files-  just delete the email file<br />    unlink($email_file);<br />    return $files;<br />  }<br />}</span></code></div>
  </div>
 </div>
  <div class="note" id="80358">  <div class="votes">
    <div id="Vu80358">
    <a href="https://www.php.net/manual/vote-note.php?id=80358&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd80358">
    <a href="https://www.php.net/manual/vote-note.php?id=80358&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V80358" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#80358" class="name">
  <strong class="user"><em>bryn</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#80358"> &para;</a><div class="date" title="2008-01-11 11:58"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom80358">
<div class="phpcode"><code><span class="html">An alternative to munpack for rfc822 messages is ripmime <a href="http://www.pldaniels.com/ripmime/" rel="nofollow" target="_blank">http://www.pldaniels.com/ripmime/</a><br /><br />It lets you pass it the rfc822 attachment (usually something.eml) and it recursively writes out attachments (and text and html files)</span></code></div>
  </div>
 </div>
  <div class="note" id="42622">  <div class="votes">
    <div id="Vu42622">
    <a href="https://www.php.net/manual/vote-note.php?id=42622&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd42622">
    <a href="https://www.php.net/manual/vote-note.php?id=42622&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V42622" title="100% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#42622" class="name">
  <strong class="user"><em>Sito</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#42622"> &para;</a><div class="date" title="2004-05-24 04:54"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom42622">
<div class="phpcode"><code><span class="html">Better, a fix on a fix... ;)<br /><br />function read_all_parts($uid){<br /> global $mime,$ret_info,$enc;<br />  $mime = array("text","multipart","message","application","audio",<br />"image","video","other","unknow");<br />  $enc  = array("7BIT","8BIT","BINARY","BASE64",<br />"QUOTED-PRINTABLE","OTHER");<br />     <br /><br /> $struct = imap_fetchstructure( $this -&gt; Link, $uid );<br /><br /> $ret_info = array();<br /><br />function scan($struct,$subkey){<br /> global $mime,$enc,$ret_info;<br /> <br />   foreach($struct as $key =&gt; $value){ <br /><br />  <br />    if($subkey!=0){<br />    $pid = $subkey.".".($key+1); }<br />    else { $pid = ($key+1); }<br />  <br />    $ret_info[]['pid'] = $pid;<br />    $ret_info[key($ret_info)]['type'] = $mime["$value-&gt;type"];<br />    $ret_info[key($ret_info)]['encoding'] = $enc["$value-&gt;encoding"]; <br /><br />    next($ret_info);<br />  <br />    if(($value-&gt;parts)!= null) {scan($value-&gt;parts,$pid); }<br />   } <br /> }<br /><br />if(!is_null($struct-&gt;parts))<br />{<br /> scan($struct-&gt;parts,0);<br />}<br />else<br />{<br />    print_r($struct);<br />    echo("&lt;hr&gt;");<br />    $ret_info[]['pid']=1;<br />    $ret_info[key($ret_info)]['type']=$mime["$struct-&gt;type"];    <br />    $ret_info[key($ret_info)]['encoding']=$enc["$struct-&gt;encoding"];    <br />}<br /><br />return $ret_info;<br /><br />}</span></code></div>
  </div>
 </div>
  <div class="note" id="18206">  <div class="votes">
    <div id="Vu18206">
    <a href="https://www.php.net/manual/vote-note.php?id=18206&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd18206">
    <a href="https://www.php.net/manual/vote-note.php?id=18206&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V18206" title="100% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#18206" class="name">
  <strong class="user"><em>bubblocity at yahoo dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#18206"> &para;</a><div class="date" title="2002-01-14 01:58"><strong>22 years ago</strong></div>
  <div class="text" id="Hcom18206">
<div class="phpcode"><code><span class="html">If you are trying to fetch the body part and don't know what to fetch,<br />here is a function that will return all the body parts as a single string with each part separated by '|' character.<br />Followed by a fuction which will retrieve the structure of that part.<br /><br />You can then parse the return string by explode() and call imap_fetchbody() on each of the parts.<br /><br />Chunks of this code was stolen from the following site:<br /><a href="http://www.bitsense.net/PHPNotes/IMAP/imap_fetchstructure.asp" rel="nofollow" target="_blank">http://www.bitsense.net/PHPNotes/IMAP/imap_fetchstructure.asp</a><br /><br />&lt;pre&gt;<br />#Function Gets all the subparts , but does not get part: ''<br />function GetParts($this_part, $part_no) {<br /><br />        //If it is type message(2)=msg envelope,<br />    //Not sure about this assumption : the if statement<br />    //double check with RFC822 on this one.<br /><br />    if($this_part-&gt;type==2){<br />        //and there is only 1 subpart of the envelope<br />        //and that subpart is multipart<br />        //otherwise will generate excessive '.1' and <br />        //send wrong part_no to imap_fetchbody<br />                if($this_part-&gt;parts[0]-&gt;type==1){<br />                $this_part=$this_part-&gt;parts[0];<br />                }<br />        }<br /><br />        if (count($this_part-&gt;parts)&gt;0) {<br />                for ($i = 0; $i &lt; count($this_part-&gt;parts); $i++) {<br />                        if ($part_no != "") {<br />                $newpartno = $part_no . '.' . ($i +1);<br />            }<br />                        else $newpartno = $i+1;<br />                        <br />            $partstringary[$i] = <br />                GetParts($this_part-&gt;parts[$i], $newpartno);<br />                }//for<br />                $partstring = implode('|', $partstringary);<br /><br />        }//if<br />        $partstring = concat_ws('|', $part_no , $partstring);<br />        //echo $partstring ;<br />        return $partstring;<br />}<br /><br />#########################################<br />#Companion function go to GetParts();<br />#Given the partno - returns the structure<br />#########################################<br />function GetSubPartStructure($mbox, $msgno, $partno){<br />    <br />        $msg_struct = imap_fetchstructure($mbox, $msgno);<br />        $partsary = explode ('.', $partno);<br />        $subpartstruct = $msg_struct;<br /><br />        for ($i=0; $i&lt; count($partsary); $i++){<br />        //Not sure about this, if assumption<br />        // you should probably double check with RFC822 on this one.<br />                if($subpartstruct-&gt;type==2){<br />                        if($subpartstruct-&gt;parts[0]-&gt;type==1){<br />                          $subpartstruct=$subpartstruct-&gt;parts[0];<br />                        }<br />                }<br />                $subpartstruct = $subpartstruct-&gt;parts[$partsary[$i]-1];<br />        }<br />        return $subpartstruct;<br />}<br /><br />function decodemsg($msgstring, $encoding){<br />        //Write your own function to decode,<br />    //or lots of examples within PHP already.<br />    return $decodemsg;<br />}<br /><br />#Usage:<br />$msg_struct = imap_fetchstructure($mbox, $msgno);<br />$msgparts= GetParts($msg_struct, $part_no);<br />$partsary = explode($msgparts, '|');<br />for($i=0; $i&lt;count($parsary);$i++){<br />    $substruct = GetSubPartStructure($mbox, $msgno, $partsary[$i]);<br />    if($substruct-&gt;type==''){  <br />        //then this is type TEXT<br />        $msg = imap_fetchbody($mbox, $msgno, $msgpartsary[$i]);<br />        //Do the decoding<br />        $msg = decodemsg($msg, $struct-&gt;encoding);<br />        echo $msg; //or do whatever you want with it.<br />    }<br />    else{ //Not TEXT<br />        //Do whatever you want<br />        //i.e. write the attachment...etc<br />    }<br />}<br /><br />&lt;/pre&gt;</span></code></div>
  </div>
 </div>
  <div class="note" id="13919">  <div class="votes">
    <div id="Vu13919">
    <a href="https://www.php.net/manual/vote-note.php?id=13919&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd13919">
    <a href="https://www.php.net/manual/vote-note.php?id=13919&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V13919" title="100% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#13919" class="name">
  <strong class="user"><em>pmzandbergen at yahoo dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#13919"> &para;</a><div class="date" title="2001-07-10 07:56"><strong>22 years ago</strong></div>
  <div class="text" id="Hcom13919">
<div class="phpcode"><code><span class="html">Nice function above. However, there are some webmail (normaly plain text) services like you which don't use structure type 'ATTACHMENT' with the attachments, but 'INLINE' (also plain text is called like this). Just replace<br />if (strtoupper ($structure-&gt;disposition) == "ATTACHMENT"){<br />with<br /><br />            if (strtoupper ($structure-&gt;disposition) == "ATTACHMENT" || strtoupper ($structure-&gt;disposition) == "INLINE" &amp;&amp; strtoupper ($structure-&gt;subtype) != "PLAIN") {<br /><br />But remember, when uou send a message with plaintext &amp; attachment, also the plaintext is an attachment</span></code></div>
  </div>
 </div>
  <div class="note" id="82766">  <div class="votes">
    <div id="Vu82766">
    <a href="https://www.php.net/manual/vote-note.php?id=82766&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd82766">
    <a href="https://www.php.net/manual/vote-note.php?id=82766&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V82766" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#82766" class="name">
  <strong class="user"><em>fortega  dot  no spam plz  at  uamericas dot net</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#82766"> &para;</a><div class="date" title="2008-04-24 01:37"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom82766">
<div class="phpcode"><code><span class="html">To fetch the body of a "sub part" do the following thing:<br /><span class="default">&lt;?php<br />$partno </span><span class="keyword">= </span><span class="string">"2.1"   </span><span class="comment">// The first part of the second part<br /><br /></span><span class="default">print_r</span><span class="keyword">(</span><span class="default">imap_fetchbody</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$msgno</span><span class="keyword">, </span><span class="default">$partno</span><span class="keyword">));<br /></span><span class="comment">// TODO: replace print_r for the proper function<br /></span><span class="default">?&gt;<br /></span><br />And remember... you can fetch the structure with<br /><span class="default">&lt;?php<br />imap_fetchstructure</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$msgno</span><span class="keyword">);<br /></span><span class="default">?&gt;<br /></span>then iterate the array of parts fetching the body.</span></code></div>
  </div>
 </div>
  <div class="note" id="46253">  <div class="votes">
    <div id="Vu46253">
    <a href="https://www.php.net/manual/vote-note.php?id=46253&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd46253">
    <a href="https://www.php.net/manual/vote-note.php?id=46253&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V46253" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#46253" class="name">
  <strong class="user"><em>guru at php dot net</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#46253"> &para;</a><div class="date" title="2004-10-04 08:50"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom46253">
<div class="phpcode"><code><span class="html">After many battles with the imap extension I took it upon myself to write my own implementation using sockets. Below is what I came up with, and hopefully it will be usefull to others as well. I know that there are some parts of this that can be tweaked, however I will leave that for you to do. Use/abuse/mutilate this as you wish (no license).<br /><br />(Note: I am not placing the source here since it is well over 1900 lines ~48KB)<br /><br /><a href="http://www.nutextonline.com/cimap.phps" rel="nofollow" target="_blank">http://www.nutextonline.com/cimap.phps</a><br /><br />If enough people find this usefull I will continue to improve it and eventually commit it (or have it committed) to pear.<br /><br />Also worth noting is the fact that you can use the imap extensions on mbox format mailboxes. A combination of this class with the imap extension would certainly make a great combination of done correctly.</span></code></div>
  </div>
 </div>
  <div class="note" id="77180">  <div class="votes">
    <div id="Vu77180">
    <a href="https://www.php.net/manual/vote-note.php?id=77180&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd77180">
    <a href="https://www.php.net/manual/vote-note.php?id=77180&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V77180" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#77180" class="name">
  <strong class="user"><em>ted at qtis dot co dot nz</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#77180"> &para;</a><div class="date" title="2007-08-18 01:02"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom77180">
<div class="phpcode"><code><span class="html">Here's simple way of extending Makusnospam's little routine to flatten the entire message into an array which can be useful to quickly find the body and attachments just by walking through the array elements.<br /><br />function create_part_array($structure, $prefix="") {<br />   $part_array = array();<br /><br />    if (sizeof($structure-&gt;parts) &gt; 0) { <br />        foreach ($structure-&gt;parts as $count =&gt; $part) {<br />            add_part_to_array($part, $prefix.($count+1), $part_array);<br />        }<br />    }<br />    <br />   return $part_array;<br />}<br /><br />function add_part_to_array($obj, $partno, &amp; $part_array) {<br /><br />    if ($obj-&gt;type == TYPEMESSAGE) {<br />        parse_message($obj-&gt;parts[0], $partno.".");<br />    }<br />    else {<br />        if (sizeof($obj-&gt;parts) &gt; 0) {<br />            foreach ($obj-&gt;parts as $count =&gt; $p) {<br />                add_part_to_array($p, $partno.".".($count+1), $part_array);<br />            }<br />        }<br />    }<br />    <br />    $part_array[] = array('part_number' =&gt; $partno, 'part_object' =&gt; $obj);<br />}</span></code></div>
  </div>
 </div>
  <div class="note" id="74612">  <div class="votes">
    <div id="Vu74612">
    <a href="https://www.php.net/manual/vote-note.php?id=74612&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd74612">
    <a href="https://www.php.net/manual/vote-note.php?id=74612&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V74612" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#74612" class="name">
  <strong class="user"><em>phpnetlover at yoz dot us</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#74612"> &para;</a><div class="date" title="2007-04-19 10:15"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom74612">
<div class="phpcode"><code><span class="html">Hi everyone<br /><br />I have been inspecting the RFC's and the answer to what to display is not like Musawir Ali in 2 areas<br /><br />1- You can not rely on disposition being present, not all mail software composes mail to standard, and if you would just take a quick look at the RFC's you will find out that someone can send you email where your solution will fail even though the mail is "within standards"<br /><br />2- When you are presented with Alternative-multipart, assuming you will find one text-plain and one text-html, you should NOT be looking for HTML then TEXT, the last mentioned subtype is the most loyal to the original composition, you check if you can support the last, if not you simply go one step back and see the one before it, if your client supports it, you take that, and so on, this is how Alternative works, Just because HTML is best colored does not mean we should chose that, we are looking for the closest representation of the original and not for any in specific</span></code></div>
  </div>
 </div>
  <div class="note" id="30653">  <div class="votes">
    <div id="Vu30653">
    <a href="https://www.php.net/manual/vote-note.php?id=30653&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd30653">
    <a href="https://www.php.net/manual/vote-note.php?id=30653&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V30653" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#30653" class="name">
  <strong class="user"><em>bubblocity at yahoo dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#30653"> &para;</a><div class="date" title="2003-03-24 08:18"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom30653">
<div class="phpcode"><code><span class="html">This is a well overdue addendum to the code submitted on<br />14-Jan-2002 02:58.  This function was called inside the GetParts function:<br /><br />function concat_ws($separator, $str1, $str2){<br />    if(strlen($str1) &amp;&amp; strlen($str2)){<br />        return $str1 . $separator . $str2;<br />    }<br />    else if (strlen($str1)){<br />        return $str1;<br />    }<br />    else if (strlen($str2)){<br />        return $str2;<br />    }    <br />    else return '';<br />        <br />}</span></code></div>
  </div>
 </div>
  <div class="note" id="68097">  <div class="votes">
    <div id="Vu68097">
    <a href="https://www.php.net/manual/vote-note.php?id=68097&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd68097">
    <a href="https://www.php.net/manual/vote-note.php?id=68097&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V68097" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#68097" class="name">
  <strong class="user"><em>Musawir Ali</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#68097"> &para;</a><div class="date" title="2006-07-12 10:04"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom68097">
<div class="phpcode"><code><span class="html">For those of you trying to create a "flexible" email reader, I suggest doing the following.<br /><br />Firstly, instead of going through each part of the email and decoding it, I suggest you go in a specific order. <br /><br />1) First go through all the parts and search for the part that has subtype=='HTML'. If found, use that as your message body, else go to Step 2.<br />2) If HTML component not found, search all parts for subtype=='PLAIN'. If found, use that as your message body else print out an error message (this should never occur).<br />3) At this point, you already have the main body of the email that you should display. The next thing to do is to find all the attachments. You do this by going through all parts, searching for the parts with ifdisposition==1 (there can be multiple).<br /><br />This is the way I did my email reader program and it works perfectly. I started off by using the methods recommended in a lot of webpages (i.e. going through the parts tree like 1.2.1, 1, 2, etc) but the problem is the message body is never in some fixed part! Sometimes its in 1, somtimes 1.1.2, sometimes 2, and sometimes in some totally unexpected place! So my approach was to "search" for the parts that I'm interested. Hope this helps. I also managed to crack the problem with emails containing embedded images. I will probably write a tutorial on that soon.</span></code></div>
  </div>
 </div>
  <div class="note" id="24312">  <div class="votes">
    <div id="Vu24312">
    <a href="https://www.php.net/manual/vote-note.php?id=24312&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd24312">
    <a href="https://www.php.net/manual/vote-note.php?id=24312&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V24312" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#24312" class="name">
  <strong class="user"><em>markusNOSPAM at broede dot NO_SPAM dot de</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#24312"> &para;</a><div class="date" title="2002-08-12 08:54"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom24312">
<div class="phpcode"><code><span class="html">Maybe you prefer a short and recursive way to parse a message<br />and get the part numbers built:<br />-------------------------------------------------------------<br /><br />function parse_message($obj, $prefix="") {<br />/* Here you can process the data of the main "part" of the message, e.g.: */<br />  do_anything_with_message_struct($obj);<br /><br />  if (sizeof($obj-&gt;parts) &gt; 0)<br />    foreach ($obj-&gt;parts as $count=&gt;$p)<br />      parse_part($p, $prefix.($count+1));<br />}<br /><br />function parse_part($obj, $partno) {<br />/* Here you can process the part number and the data of the parts of the message, e.g.: */<br />  do_anything_with_part_struct($obj,$partno);<br /><br />  if ($obj-&gt;type == TYPEMESSAGE)<br />    parse_message($obj-&gt;parts[0], $partno.".");<br />  else<br />    if (sizeof($obj-&gt;parts) &gt; 0)<br />      foreach ($obj-&gt;parts as $count=&gt;$p)<br />        parse_part($p, $partno.".".($count+1));<br />}<br /><br />/* Let's say, you have an already opened mailbox stream $mbox<br />   and you like to parse through the first message: */<br /><br />$msgno = 1;<br />parse_message(imap_fetchstructure($mbox,$msgno));</span></code></div>
  </div>
 </div>
  <div class="note" id="19578">  <div class="votes">
    <div id="Vu19578">
    <a href="https://www.php.net/manual/vote-note.php?id=19578&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd19578">
    <a href="https://www.php.net/manual/vote-note.php?id=19578&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V19578" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#19578" class="name">
  <strong class="user"><em>sarachaga at yahoo dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#19578"> &para;</a><div class="date" title="2002-03-04 11:23"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom19578">
<div class="phpcode"><code><span class="html">For those guys trying to extract a message/rfc822 parts correctly here is a hint:<br /><br />As you may note, if you recurse over the structure object returned by imap_fetchstructure, when you reach the message/rfc822 you find that the message itself counts as a part too, so an attachment in that message should be 2.1.2 (the .1. is the whole rfc822 msg), but if you use that part number in imap_fetchbody you get nothing.<br /><br />What i did is: my recursing function checks if the part/subtype of a particular part is message/rfc822, and only in that case i do not concatenate the .1 to the part number, because as far as i know, this only happens with this kind of message. And for all the other parts (non rfc822) it concats the dot-partnumber.</span></code></div>
  </div>
 </div>
  <div class="note" id="19138">  <div class="votes">
    <div id="Vu19138">
    <a href="https://www.php.net/manual/vote-note.php?id=19138&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd19138">
    <a href="https://www.php.net/manual/vote-note.php?id=19138&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V19138" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#19138" class="name">
  <strong class="user"><em>ac at artcenter dot ac</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#19138"> &para;</a><div class="date" title="2002-02-17 05:24"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom19138">
<div class="phpcode"><code><span class="html">Lets say your email has this structure:<br />1 multipart<br />    plain<br />    html<br />2 x-vcard<br />and... you can't seem to figure out how to get either plain or HTML part of the multipart message? have you been going through all the trouble looking for a PHP mime parser? well here is a simple solution which SHOULD BE documented in this manual. From example above, if you want to get the plain part of the "multipart" message do this:<br />$text=imap_fetchbody($mbox,$msg_num,"1.1");<br />all you do is instead of part number 1, put 1.1 or to get the HTML part put 1.2<br /><br />EASY!</span></code></div>
  </div>
 </div>
  <div class="note" id="50560">  <div class="votes">
    <div id="Vu50560">
    <a href="https://www.php.net/manual/vote-note.php?id=50560&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd50560">
    <a href="https://www.php.net/manual/vote-note.php?id=50560&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V50560" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#50560" class="name">
  <strong class="user"><em>se at designlinks dot net</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#50560"> &para;</a><div class="date" title="2005-03-03 03:36"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom50560">
<div class="phpcode"><code><span class="html">If you insist on using imap_fetchbody() to retrieve a mail body that doesn't contain 'parts' [normally you'd use imap_body() ], then note that the header text is in part '0' and the body text in part '1'.<br />So, imap_fetchbody($mbox,$msg,'0') will return the header and imap_fetchbody($mbox,$msg,'1') will return the body text.</span></code></div>
  </div>
 </div>
  <div class="note" id="46041">  <div class="votes">
    <div id="Vu46041">
    <a href="https://www.php.net/manual/vote-note.php?id=46041&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd46041">
    <a href="https://www.php.net/manual/vote-note.php?id=46041&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V46041" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#46041" class="name">
  <strong class="user"><em>Adam</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#46041"> &para;</a><div class="date" title="2004-09-27 11:12"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom46041">
<div class="phpcode"><code><span class="html">It took me a while to figure out how part id's(numbers) are assigned to different parts of a message.  After getting a few AOL e-mails that had a semi-complex structure I was finally able to break it down. <br /><br />0 multipart/mixed<br />    1 multipart/alternative<br />        1.1 text/plain<br />        1.2 text/html<br />    2 message/rfc822<br />        2 multipart/mixed<br />            2.1 multipart/alternative<br />                2.1.1 text/plain<br />                2.1.2 text/html<br />            2.2 message/rfc822<br />                2.2 multipart/alternative<br />                    2.2.1 text/plain<br />                    2.2.2 text/html<br /><br />Hopefully this will help others get the different body parts of a message.</span></code></div>
  </div>
 </div>
  <div class="note" id="35407">  <div class="votes">
    <div id="Vu35407">
    <a href="https://www.php.net/manual/vote-note.php?id=35407&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd35407">
    <a href="https://www.php.net/manual/vote-note.php?id=35407&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V35407" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#35407" class="name">
  <strong class="user"><em>asfd at aasdfa dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#35407"> &para;</a><div class="date" title="2003-08-30 02:48"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom35407">
<div class="phpcode"><code><span class="html">PLEASE DOCUMENT THIS POST AND SAVE US SOME TIME! :)<br />ac at artcenter dot ac<br />17-Feb-2002 04:24 <br />Lets say your email has this structure:<br />1 multipart<br />    plain<br />    html<br />2 x-vcard<br />and... you can't seem to figure out how to get either plain or HTML part of the multipart message? have you been going through all the trouble looking for a PHP mime parser? well here is a simple solution which SHOULD BE documented in this manual. From example above, if you want to get the plain part of the "multipart" message do this:<br />$text=imap_fetchbody($mbox,$msg_num,"1.1");<br />all you do is instead of part number 1, put 1.1 or to get the HTML part put 1.2<br /><br />EASY!</span></code></div>
  </div>
 </div>
  <div class="note" id="4880">  <div class="votes">
    <div id="Vu4880">
    <a href="https://www.php.net/manual/vote-note.php?id=4880&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd4880">
    <a href="https://www.php.net/manual/vote-note.php?id=4880&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V4880" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#4880" class="name">
  <strong class="user"><em>cleong at organic dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#4880"> &para;</a><div class="date" title="2000-04-04 09:19"><strong>23 years ago</strong></div>
  <div class="text" id="Hcom4880">
<div class="phpcode"><code><span class="html">Here's a routine that yields the part of a message with a particular MIME type:<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">function </span><span class="default">get_mime_type</span><span class="keyword">(&amp;</span><span class="default">$structure</span><span class="keyword">) {<br />    </span><span class="default">$primary_mime_type </span><span class="keyword">= array(</span><span class="string">"TEXT"</span><span class="keyword">, </span><span class="string">"MULTIPART"</span><span class="keyword">, </span><span class="string">"MESSAGE"</span><span class="keyword">, </span><span class="string">"APPLICATION"</span><span class="keyword">, </span><span class="string">"AUDIO"</span><span class="keyword">, </span><span class="string">"IMAGE"</span><span class="keyword">, </span><span class="string">"VIDEO"</span><span class="keyword">, </span><span class="string">"OTHER"</span><span class="keyword">);<br />    if(</span><span class="default">$structure</span><span class="keyword">-&gt;</span><span class="default">subtype</span><span class="keyword">) {<br />         return </span><span class="default">$primary_mime_type</span><span class="keyword">[(int) </span><span class="default">$structure</span><span class="keyword">-&gt;</span><span class="default">type</span><span class="keyword">] . </span><span class="string">'/' </span><span class="keyword">. </span><span class="default">$structure</span><span class="keyword">-&gt;</span><span class="default">subtype</span><span class="keyword">;<br />     }<br />     return </span><span class="string">"TEXT/PLAIN"</span><span class="keyword">;<br />}<br /><br />function </span><span class="default">get_part</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">$msg_number</span><span class="keyword">, </span><span class="default">$mime_type</span><span class="keyword">, </span><span class="default">$structure </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">, </span><span class="default">$part_number </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">) {<br />    if (!</span><span class="default">$structure</span><span class="keyword">) {<br />         </span><span class="default">$structure </span><span class="keyword">= </span><span class="default">imap_fetchstructure</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">$msg_number</span><span class="keyword">);<br />     }<br />    if(</span><span class="default">$structure</span><span class="keyword">) {<br />         if(</span><span class="default">$mime_type </span><span class="keyword">== </span><span class="default">get_mime_type</span><span class="keyword">(</span><span class="default">$structure</span><span class="keyword">)) {<br />              if(!</span><span class="default">$part_number</span><span class="keyword">) {<br />                   </span><span class="default">$part_number </span><span class="keyword">= </span><span class="string">"1"</span><span class="keyword">;<br />               }<br />              </span><span class="default">$text </span><span class="keyword">= </span><span class="default">imap_fetchbody</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">$msg_number</span><span class="keyword">, </span><span class="default">$part_number</span><span class="keyword">);<br />              if(</span><span class="default">$structure</span><span class="keyword">-&gt;</span><span class="default">encoding </span><span class="keyword">== </span><span class="default">3</span><span class="keyword">) {<br />                   return </span><span class="default">imap_base64</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />               } else if (</span><span class="default">$structure</span><span class="keyword">-&gt;</span><span class="default">encoding </span><span class="keyword">== </span><span class="default">4</span><span class="keyword">) {<br />                   return </span><span class="default">imap_qprint</span><span class="keyword">(</span><span class="default">$text</span><span class="keyword">);<br />               } else {<br />                   return </span><span class="default">$text</span><span class="keyword">;<br />            }<br />        }<br />         if (</span><span class="default">$structure</span><span class="keyword">-&gt;</span><span class="default">type </span><span class="keyword">== </span><span class="default">1</span><span class="keyword">) { </span><span class="comment">/* multipart */<br />              </span><span class="keyword">while (list(</span><span class="default">$index</span><span class="keyword">, </span><span class="default">$sub_structure</span><span class="keyword">) = </span><span class="default">each</span><span class="keyword">(</span><span class="default">$structure</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">)) {<br />                if (</span><span class="default">$part_number</span><span class="keyword">) {<br />                    </span><span class="default">$prefix </span><span class="keyword">= </span><span class="default">$part_number </span><span class="keyword">. </span><span class="string">'.'</span><span class="keyword">;<br />                }<br />                </span><span class="default">$data </span><span class="keyword">= </span><span class="default">get_part</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">$msg_number</span><span class="keyword">, </span><span class="default">$mime_type</span><span class="keyword">, </span><span class="default">$sub_structure</span><span class="keyword">, </span><span class="default">$prefix </span><span class="keyword">. (</span><span class="default">$index </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">));<br />                if (</span><span class="default">$data</span><span class="keyword">) {<br />                    return </span><span class="default">$data</span><span class="keyword">;<br />                }<br />            }<br />        }<br />    }<br />    return </span><span class="default">false</span><span class="keyword">;<br />}<br /><br /></span><span class="comment">// get plain text<br /></span><span class="default">$data </span><span class="keyword">= </span><span class="default">get_part</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">$msg_number</span><span class="keyword">, </span><span class="string">"TEXT/PLAIN"</span><span class="keyword">);<br /></span><span class="comment">// get HTML text<br /></span><span class="default">$data </span><span class="keyword">= </span><span class="default">get_part</span><span class="keyword">(</span><span class="default">$stream</span><span class="keyword">, </span><span class="default">$msg_number</span><span class="keyword">, </span><span class="string">"TEXT/HTML"</span><span class="keyword">);<br /></span><span class="default">?&gt;<br /></span><br />Right now only the first part with the matching MIME type is returned. A more useful version would create an array and return all matching parts (for GIFs, for instance).</span></code></div>
  </div>
 </div>
  <div class="note" id="45408">  <div class="votes">
    <div id="Vu45408">
    <a href="https://www.php.net/manual/vote-note.php?id=45408&amp;page=function.imap-fetchbody&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd45408">
    <a href="https://www.php.net/manual/vote-note.php?id=45408&amp;page=function.imap-fetchbody&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V45408" title="41% like this...">
    -3
    </div>
  </div>
  <a href="function.imap-fetchbody.php.html#45408" class="name">
  <strong class="user"><em>sales at nocwizard dot com</em></strong></a><a class="genanchor" href="function.imap-fetchbody.php.html#45408"> &para;</a><div class="date" title="2004-09-05 05:59"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom45408">
<div class="phpcode"><code><span class="html">I'm adding this for those of you like me who are scouring the web looking for code to break down a message.  These two functions will break down a multi-part and non multi-part message and return the contents of the message in the array $message.  It doesn't do attachments.  This assumes you've already opened the mailbox and pass it VIA the $mbox.<br /><br />function retrieve_message($mbox, $messageid)<br />{<br />   $message = array();<br />    <br />   $header = imap_header($mbox, $messageid);<br />   $structure = imap_fetchstructure($mbox, $messageid);<br /><br />   $message['subject'] = $header-&gt;subject;<br />   $message['fromaddress'] =   $header-&gt;fromaddress;<br />   $message['toaddress'] =   $header-&gt;toaddress;<br />   $message['ccaddress'] =   $header-&gt;ccaddress;<br />   $message['date'] =   $header-&gt;date;<br /><br />  if (check_type($structure))<br />  {<br />   $message['body'] = imap_fetchbody($mbox,$messageid,"1"); ## GET THE BODY OF MULTI-PART MESSAGE<br />   if(!$message['body']) {$message['body'] = '[NO TEXT ENTERED INTO THE MESSAGE]\n\n';}<br />  }<br />  else<br />  {<br />   $message['body'] = imap_body($mbox, $messageid);<br />   if(!$message['body']) {$message['body'] = '[NO TEXT ENTERED INTO THE MESSAGE]\n\n';}<br />  }<br />   <br />  return $message;<br />}<br /><br />function check_type($structure) ## CHECK THE TYPE<br />{<br />  if($structure-&gt;type == 1) <br />    {<br />     return(true); ## YES THIS IS A MULTI-PART MESSAGE<br />    }<br /> else<br />    {<br />     return(false); ## NO THIS IS NOT A MULTI-PART MESSAGE<br />    }<br />}</span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=function.imap-fetchbody&amp;redirect=https://www.php.net/manual/ru/function.imap-fetchbody.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="ref.imap.php.html">Функции IMAP</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="function.imap-8bit.php.html" title="imap_&#8203;8bit">imap_&#8203;8bit</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-alerts.php.html" title="imap_&#8203;alerts">imap_&#8203;alerts</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-append.php.html" title="imap_&#8203;append">imap_&#8203;append</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-base64.php.html" title="imap_&#8203;base64">imap_&#8203;base64</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-binary.php.html" title="imap_&#8203;binary">imap_&#8203;binary</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-body.php.html" title="imap_&#8203;body">imap_&#8203;body</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-bodystruct.php.html" title="imap_&#8203;bodystruct">imap_&#8203;bodystruct</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-check.php.html" title="imap_&#8203;check">imap_&#8203;check</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-clearflag-full.php.html" title="imap_&#8203;clearflag_&#8203;full">imap_&#8203;clearflag_&#8203;full</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-close.php.html" title="imap_&#8203;close">imap_&#8203;close</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-create.php.html" title="imap_&#8203;create">imap_&#8203;create</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-createmailbox.php.html" title="imap_&#8203;createmailbox">imap_&#8203;createmailbox</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-delete.php.html" title="imap_&#8203;delete">imap_&#8203;delete</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-deletemailbox.php.html" title="imap_&#8203;deletemailbox">imap_&#8203;deletemailbox</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-errors.php.html" title="imap_&#8203;errors">imap_&#8203;errors</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-expunge.php.html" title="imap_&#8203;expunge">imap_&#8203;expunge</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-fetch-overview.php.html" title="imap_&#8203;fetch_&#8203;overview">imap_&#8203;fetch_&#8203;overview</a>
                        </li>
                                                <li class="current">
                            <a href="function.imap-fetchbody.php.html" title="imap_&#8203;fetchbody">imap_&#8203;fetchbody</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-fetchheader.php.html" title="imap_&#8203;fetchheader">imap_&#8203;fetchheader</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-fetchmime.php.html" title="imap_&#8203;fetchmime">imap_&#8203;fetchmime</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-fetchstructure.php.html" title="imap_&#8203;fetchstructure">imap_&#8203;fetchstructure</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-fetchtext.php.html" title="imap_&#8203;fetchtext">imap_&#8203;fetchtext</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-gc.php.html" title="imap_&#8203;gc">imap_&#8203;gc</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-get-quota.php.html" title="imap_&#8203;get_&#8203;quota">imap_&#8203;get_&#8203;quota</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-get-quotaroot.php.html" title="imap_&#8203;get_&#8203;quotaroot">imap_&#8203;get_&#8203;quotaroot</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-getacl.php.html" title="imap_&#8203;getacl">imap_&#8203;getacl</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-getmailboxes.php.html" title="imap_&#8203;getmailboxes">imap_&#8203;getmailboxes</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-getsubscribed.php.html" title="imap_&#8203;getsubscribed">imap_&#8203;getsubscribed</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-header.php.html" title="imap_&#8203;header">imap_&#8203;header</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-headerinfo.php.html" title="imap_&#8203;headerinfo">imap_&#8203;headerinfo</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-headers.php.html" title="imap_&#8203;headers">imap_&#8203;headers</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-is-open.php.html" title="imap_&#8203;is_&#8203;open">imap_&#8203;is_&#8203;open</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-last-error.php.html" title="imap_&#8203;last_&#8203;error">imap_&#8203;last_&#8203;error</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-list.php.html" title="imap_&#8203;list">imap_&#8203;list</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-listmailbox.php.html" title="imap_&#8203;listmailbox">imap_&#8203;listmailbox</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-listscan.php.html" title="imap_&#8203;listscan">imap_&#8203;listscan</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-listsubscribed.php.html" title="imap_&#8203;listsubscribed">imap_&#8203;listsubscribed</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-lsub.php.html" title="imap_&#8203;lsub">imap_&#8203;lsub</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mail-compose.php.html" title="imap_&#8203;mail_&#8203;compose">imap_&#8203;mail_&#8203;compose</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mail-copy.php.html" title="imap_&#8203;mail_&#8203;copy">imap_&#8203;mail_&#8203;copy</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mail-move.php.html" title="imap_&#8203;mail_&#8203;move">imap_&#8203;mail_&#8203;move</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mail.php.html" title="imap_&#8203;mail">imap_&#8203;mail</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mailboxmsginfo.php.html" title="imap_&#8203;mailboxmsginfo">imap_&#8203;mailboxmsginfo</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mime-header-decode.php.html" title="imap_&#8203;mime_&#8203;header_&#8203;decode">imap_&#8203;mime_&#8203;header_&#8203;decode</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-msgno.php.html" title="imap_&#8203;msgno">imap_&#8203;msgno</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mutf7-to-utf8.php.html" title="imap_&#8203;mutf7_&#8203;to_&#8203;utf8">imap_&#8203;mutf7_&#8203;to_&#8203;utf8</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-num-msg.php.html" title="imap_&#8203;num_&#8203;msg">imap_&#8203;num_&#8203;msg</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-num-recent.php.html" title="imap_&#8203;num_&#8203;recent">imap_&#8203;num_&#8203;recent</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-open.php.html" title="imap_&#8203;open">imap_&#8203;open</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-ping.php.html" title="imap_&#8203;ping">imap_&#8203;ping</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-qprint.php.html" title="imap_&#8203;qprint">imap_&#8203;qprint</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-rename.php.html" title="imap_&#8203;rename">imap_&#8203;rename</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-renamemailbox.php.html" title="imap_&#8203;renamemailbox">imap_&#8203;renamemailbox</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-reopen.php.html" title="imap_&#8203;reopen">imap_&#8203;reopen</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-rfc822-parse-adrlist.php.html" title="imap_&#8203;rfc822_&#8203;parse_&#8203;adrlist">imap_&#8203;rfc822_&#8203;parse_&#8203;adrlist</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-rfc822-parse-headers.php.html" title="imap_&#8203;rfc822_&#8203;parse_&#8203;headers">imap_&#8203;rfc822_&#8203;parse_&#8203;headers</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-rfc822-write-address.php.html" title="imap_&#8203;rfc822_&#8203;write_&#8203;address">imap_&#8203;rfc822_&#8203;write_&#8203;address</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-savebody.php.html" title="imap_&#8203;savebody">imap_&#8203;savebody</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-scan.php.html" title="imap_&#8203;scan">imap_&#8203;scan</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-scanmailbox.php.html" title="imap_&#8203;scanmailbox">imap_&#8203;scanmailbox</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-search.php.html" title="imap_&#8203;search">imap_&#8203;search</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-set-quota.php.html" title="imap_&#8203;set_&#8203;quota">imap_&#8203;set_&#8203;quota</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-setacl.php.html" title="imap_&#8203;setacl">imap_&#8203;setacl</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-setflag-full.php.html" title="imap_&#8203;setflag_&#8203;full">imap_&#8203;setflag_&#8203;full</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-sort.php.html" title="imap_&#8203;sort">imap_&#8203;sort</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-status.php.html" title="imap_&#8203;status">imap_&#8203;status</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-subscribe.php.html" title="imap_&#8203;subscribe">imap_&#8203;subscribe</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-thread.php.html" title="imap_&#8203;thread">imap_&#8203;thread</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-timeout.php.html" title="imap_&#8203;timeout">imap_&#8203;timeout</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-uid.php.html" title="imap_&#8203;uid">imap_&#8203;uid</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-undelete.php.html" title="imap_&#8203;undelete">imap_&#8203;undelete</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-unsubscribe.php.html" title="imap_&#8203;unsubscribe">imap_&#8203;unsubscribe</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-utf7-decode.php.html" title="imap_&#8203;utf7_&#8203;decode">imap_&#8203;utf7_&#8203;decode</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-utf7-encode.php.html" title="imap_&#8203;utf7_&#8203;encode">imap_&#8203;utf7_&#8203;encode</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-utf8-to-mutf7.php.html" title="imap_&#8203;utf8_&#8203;to_&#8203;mutf7">imap_&#8203;utf8_&#8203;to_&#8203;mutf7</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-utf8.php.html" title="imap_&#8203;utf8">imap_&#8203;utf8</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
