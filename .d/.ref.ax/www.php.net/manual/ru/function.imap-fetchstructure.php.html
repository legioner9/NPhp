<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: imap_fetchstructure - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.imap-fetchstructure.php.html">
 <link rel="shorturl" href="https://www.php.net/imap-fetchstructure">
 <link rel="alternate" href="https://www.php.net/imap-fetchstructure" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="ref.imap.php.html">
 <link rel="prev" href="function.imap-fetchmime.php.html">
 <link rel="next" href="function.imap-fetchtext.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/function.imap-fetchstructure.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/function.imap-fetchstructure.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/function.imap-fetchstructure.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.imap-fetchstructure.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/function.imap-fetchstructure.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.imap-fetchstructure.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.imap-fetchstructure.php" hreflang="pt_BR">
 <link rel="alternate" href="function.imap-fetchstructure.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.imap-fetchstructure.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.imap-fetchstructure.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="function.imap-fetchtext.php.html">
          imap_fetchtext &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="function.imap-fetchmime.php.html">
          &laquo; imap_fetchmime        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='funcref.php.html'>Справочник функций</a></li>      <li><a href='refs.remote.mail.php.html'>Модули для работы с почтой</a></li>      <li><a href='book.imap.php.html'>IMAP</a></li>      <li><a href='ref.imap.php.html'>Функции IMAP</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/function.imap-fetchstructure.php'>English</option>
            <option value='de/function.imap-fetchstructure.php'>German</option>
            <option value='es/function.imap-fetchstructure.php'>Spanish</option>
            <option value='fr/function.imap-fetchstructure.php'>French</option>
            <option value='it/function.imap-fetchstructure.php'>Italian</option>
            <option value='ja/function.imap-fetchstructure.php'>Japanese</option>
            <option value='pt_BR/function.imap-fetchstructure.php'>Brazilian Portuguese</option>
            <option value='ru/function.imap-fetchstructure.php' selected="selected">Russian</option>
            <option value='tr/function.imap-fetchstructure.php'>Turkish</option>
            <option value='zh/function.imap-fetchstructure.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/reference/imap/functions/imap-fetchstructure.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Ffunction.imap-fetchstructure%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="function.imap-fetchstructure" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imap_fetchstructure</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">imap_fetchstructure</span> &mdash; <span class="dc-title">Читает структуру указанного сообщения</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imap-fetchstructure-description">
  <h3 class="title">Описание</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>imap_fetchstructure</strong></span>(<span class="methodparam"><span class="type"><a href="class.imap-connection.php.html" class="type IMAP\Connection">IMAP\Connection</a></span> <code class="parameter">$imap</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$message_num</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code><span class="initializer"> = 0</span></span>): <span class="type"><span class="type"><a href="class.stdclass.php.html" class="type stdClass">stdClass</a></span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   Извлекает информацию о структуре указанного сообщения.
  </p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imap-fetchstructure-parameters">
  <h3 class="title">Список параметров</h3>
  <p class="para">
   <dl>
    <dt>

<code class="parameter">imap</code></dt>
<dd>
<p class="para">Экземпляр <span class="classname"><a href="class.imap-connection.php.html" class="classname">IMAP\Connection</a></span>.</p></dd>

    
     <dt>
<code class="parameter">message_num</code></dt>

     <dd>

      <p class="para">
       Номер сообщения
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
       Если задано как <strong><code>FT_UID</code></strong>, то в
       <code class="parameter">message_num</code> должны быть <code class="literal">UID</code> сообщений,
       а не их номера.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imap-fetchstructure-returnvalues">
  <h3 class="title">Возвращаемые значения</h3>
  <p class="para">
   Возвращает объект со свойствами, перечисленными в таблице ниже или <strong><code>false</code></strong> в случае возникновения ошибки.
  </p>
  <p class="para">
   <table class="doctable table">
    <caption><strong>
     Объект, возвращаемый <span class="function"><strong>imap_fetchstructure()</strong></span>
    </strong></caption>
    
     <tbody class="tbody">
      <tr>
       <td>type</td>
       <td>Первичный тип тела</td>
      </tr>

      <tr>
       <td>encoding</td>
       <td>Кодировка тела</td>
      </tr>

      <tr>
       <td>ifsubtype</td>
       <td><strong><code>true</code></strong>, если есть строка подтипа</td>
      </tr>

      <tr>
       <td>subtype</td>
       <td><abbr title="Multipurpose Internet Mail Extensions">MIME</abbr>-подтип</td>
      </tr>

      <tr>
       <td>ifdescription</td>
       <td><strong><code>true</code></strong>, если есть строка описания</td>
      </tr>

      <tr>
       <td>description</td>
       <td>Контент строки описания</td>
      </tr>

      <tr>
       <td>ifid</td>
       <td><strong><code>true</code></strong>, если есть строка идентификатор</td>
      </tr>

      <tr>
       <td>id</td>
       <td>Строка идентификатор</td>
      </tr>

      <tr>
       <td>lines</td>
       <td>Количество строк</td>
      </tr>

      <tr>
       <td>bytes</td>
       <td>Количество байт</td>
      </tr>

      <tr>
       <td>ifdisposition</td>
       <td><strong><code>true</code></strong>, если есть строка расположения</td>
      </tr>

      <tr>
       <td>disposition</td>
       <td>Строка расположения</td>
      </tr>

      <tr>
       <td>ifdparameters</td>
       <td><strong><code>true</code></strong>, если есть массив <var class="varname">dparameters</var></td>
      </tr>

      <tr>
       <td>dparameters</td>
       <td>Массив объектов, каждый из которых имеет свойства
        <code class="literal">&quot;attribute&quot;</code> и <code class="literal">&quot;value&quot;</code>, соответствующие
        параметрам <code class="literal">Content-disposition</code> заголовка
        <abbr title="Multipurpose Internet Mail Extensions">MIME</abbr>.</td>
      </tr>

      <tr>
       <td>ifparameters</td>
       <td><strong><code>true</code></strong>, если есть массив параметров</td>
      </tr>

      <tr>
       <td>parameters</td>
       <td>Массив объектов, каждый из которых имеет свойства
        <code class="literal">&quot;attribute&quot;</code> и <code class="literal">&quot;value&quot;</code>.</td>
      </tr>

      <tr>
       <td>parts</td>
       <td>Массив объектов идентичных по структуре с верхнеуровневым объектом,
        каждый из которых соответствует <abbr title="Multipurpose Internet Mail Extensions">MIME</abbr> части тела.</td>
      </tr>

     </tbody>
    
   </table>

  </p>
  <p class="para">
   <table class="doctable table">
    <caption><strong>Первичный тип тела (значения могут отличаться в зависимости от используемой
     библиотеки, так что рекомендуется использовать константы)</strong></caption>
    
     <thead>
      <tr><th>Значение</th><th>Тип</th><th>Константа</th></tr>

     </thead>

     <tbody class="tbody">
      <tr><td>0</td><td>text</td><td>TYPETEXT</td></tr>

      <tr><td>1</td><td>multipart</td><td>TYPEMULTIPART</td></tr>

      <tr><td>2</td><td>message</td><td>TYPEMESSAGE</td></tr>

      <tr><td>3</td><td>application</td><td>TYPEAPPLICATION</td></tr>

      <tr><td>4</td><td>audio</td><td>TYPEAUDIO</td></tr>

      <tr><td>5</td><td>image</td><td>TYPEIMAGE</td></tr>

      <tr><td>6</td><td>video</td><td>TYPEVIDEO</td></tr>

      <tr><td>7</td><td>model</td><td>TYPEMODEL</td></tr>

      <tr><td>8</td><td>other</td><td>TYPEOTHER</td></tr>

     </tbody>
    
   </table>

  </p>
  <p class="para">
   <table class="doctable table">
    <caption><strong>Кодировка (значения могут отличаться в зависимости от используемой
     библиотеки, так что рекомендуется использовать константы)</strong></caption>
    
     <thead>
      <tr><th>Значение</th><th>Тип</th><th>Константа</th></tr>

     </thead>

     <tbody class="tbody">
      <tr><td>0</td><td>7bit</td><td>ENC7BIT</td></tr>

      <tr><td>1</td><td>8bit</td><td>ENC8BIT</td></tr>

      <tr><td>2</td><td>Binary</td><td>ENCBINARY</td></tr>

      <tr><td>3</td><td>Base64</td><td>ENCBASE64</td></tr>

      <tr><td>4</td><td>Quoted-Printable</td><td>ENCQUOTEDPRINTABLE</td></tr>

      <tr><td>5</td><td>other</td><td>ENCOTHER</td></tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.imap-fetchstructure-changelog">
  <h3 class="title">Список изменений</h3>
  <table class="doctable informaltable">
   
    <thead>
     <tr>
      <th>Версия</th>
      <th>Описание</th>
     </tr>

    </thead>

    <tbody class="tbody">
     <tr>
 <td>8.1.0</td>
 <td>
  Параметр <code class="parameter">imap</code> теперь ожидает экземпляр <span class="classname"><a href="class.imap-connection.php.html" class="classname">IMAP\Connection</a></span>; ранее ожидался ресурс (<a href="language.types.resource.php.html" class="link">resource</a>) <code class="literal">imap</code>.
 </td>
</tr>

    </tbody>
   
  </table>

 </div>


 <div class="refsect1 seealso" id="refsect1-function.imap-fetchstructure-seealso">
  <h3 class="title">Смотрите также</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imap-fetchbody.php.html" class="function" rel="rdfs-seeAlso">imap_fetchbody()</a> - Извлекает конкретную секцию тела сообщения</span></li>
    <li class="member"><span class="function"><a href="function.imap-bodystruct.php.html" class="function" rel="rdfs-seeAlso">imap_bodystruct()</a> - Читает структуру указанной секции тела заданного сообщения</span></li>
   </ul>
  </p>
 </div>

</div><section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=function.imap-fetchstructure&amp;redirect=https://www.php.net/manual/ru/function.imap-fetchstructure.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">33 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="12632">  <div class="votes">
    <div id="Vu12632">
    <a href="https://www.php.net/manual/vote-note.php?id=12632&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd12632">
    <a href="https://www.php.net/manual/vote-note.php?id=12632&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V12632" title="100% like this...">
    3
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#12632" class="name">
  <strong class="user"><em>mkknapp at quadrapod dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#12632"> &para;</a><div class="date" title="2001-04-25 06:48"><strong>22 years ago</strong></div>
  <div class="text" id="Hcom12632">
<div class="phpcode"><code><span class="html">Assuming $struct = imap_fetchstructure($x,$y);<br /><br />It is important to note that if a message has NO attachements, $struct-&gt;parts is an empty array, and $struct-&gt;bytes has a value.  If a message as ANY attachements, $struct-&gt;bytes ALWAYS = 0. To get the size of the primary body, you have to call structure-&gt;part[0]-&gt;bytes.  To get the size of the whole message, either strlen(imap_body) or add up the -&gt;bytes of all the parts.<br /><br />Another interesting note: <br />When there is body text and no attachements:<br />count($struct-&gt;parts) = 0<br />When there is body text and 1 attachement:<br />count($struct-&gt;parts) = 2<br /><br />These imap functions could really use better documentation. Like giving the meathods for the dparameter and parameter classes...</span></code></div>
  </div>
 </div>
  <div class="note" id="85486">  <div class="votes">
    <div id="Vu85486">
    <a href="https://www.php.net/manual/vote-note.php?id=85486&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd85486">
    <a href="https://www.php.net/manual/vote-note.php?id=85486&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V85486" title="60% like this...">
    47
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#85486" class="name">
  <strong class="user"><em>david at hundsness dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#85486"> &para;</a><div class="date" title="2008-09-02 02:31"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom85486">
<div class="phpcode"><code><span class="html">Here is code to parse and decode all types of messages, including attachments. I've been using something like this for awhile now, so it's pretty robust.<br /><br />&lt;?<br />function getmsg($mbox,$mid) {<br />    // input $mbox = IMAP stream, $mid = message id<br />    // output all the following:<br />    global $charset,$htmlmsg,$plainmsg,$attachments;<br />    $htmlmsg = $plainmsg = $charset = '';<br />    $attachments = array();<br /><br />    // HEADER<br />    $h = imap_header($mbox,$mid);<br />    // add code here to get date, from, to, cc, subject...<br /><br />    // BODY<br />    $s = imap_fetchstructure($mbox,$mid);<br />    if (!$s-&gt;parts)  // simple<br />        getpart($mbox,$mid,$s,0);  // pass 0 as part-number<br />    else {  // multipart: cycle through each part<br />        foreach ($s-&gt;parts as $partno0=&gt;$p)<br />            getpart($mbox,$mid,$p,$partno0+1);<br />    }<br />}<br /><br />function getpart($mbox,$mid,$p,$partno) {<br />    // $partno = '1', '2', '2.1', '2.1.3', etc for multipart, 0 if simple<br />    global $htmlmsg,$plainmsg,$charset,$attachments;<br /><br />    // DECODE DATA<br />    $data = ($partno)?<br />        imap_fetchbody($mbox,$mid,$partno):  // multipart<br />        imap_body($mbox,$mid);  // simple<br />    // Any part may be encoded, even plain text messages, so check everything.<br />    if ($p-&gt;encoding==4)<br />        $data = quoted_printable_decode($data);<br />    elseif ($p-&gt;encoding==3)<br />        $data = base64_decode($data);<br /><br />    // PARAMETERS<br />    // get all parameters, like charset, filenames of attachments, etc.<br />    $params = array();<br />    if ($p-&gt;parameters)<br />        foreach ($p-&gt;parameters as $x)<br />            $params[strtolower($x-&gt;attribute)] = $x-&gt;value;<br />    if ($p-&gt;dparameters)<br />        foreach ($p-&gt;dparameters as $x)<br />            $params[strtolower($x-&gt;attribute)] = $x-&gt;value;<br /><br />    // ATTACHMENT<br />    // Any part with a filename is an attachment,<br />    // so an attached text file (type 0) is not mistaken as the message.<br />    if ($params['filename'] || $params['name']) {<br />        // filename may be given as 'Filename' or 'Name' or both<br />        $filename = ($params['filename'])? $params['filename'] : $params['name'];<br />        // filename may be encoded, so see imap_mime_header_decode()<br />        $attachments[$filename] = $data;  // this is a problem if two files have same name<br />    }<br /><br />    // TEXT<br />    if ($p-&gt;type==0 &amp;&amp; $data) {<br />        // Messages may be split in different parts because of inline attachments,<br />        // so append parts together with blank row.<br />        if (strtolower($p-&gt;subtype)=='plain')<br />            $plainmsg. = trim($data) ."\n\n";<br />        else<br />            $htmlmsg. = $data ."&lt;br&gt;&lt;br&gt;";<br />        $charset = $params['charset'];  // assume all parts are same charset<br />    }<br /><br />    // EMBEDDED MESSAGE<br />    // Many bounce notifications embed the original message as type 2,<br />    // but AOL uses type 1 (multipart), which is not handled here.<br />    // There are no PHP functions to parse embedded messages,<br />    // so this just appends the raw source to the main message.<br />    elseif ($p-&gt;type==2 &amp;&amp; $data) {<br />        $plainmsg. = $data."\n\n";<br />    }<br /><br />    // SUBPART RECURSION<br />    if ($p-&gt;parts) {<br />        foreach ($p-&gt;parts as $partno0=&gt;$p2)<br />            getpart($mbox,$mid,$p2,$partno.'.'.($partno0+1));  // 1.2, 1.2.1, etc.<br />    }<br />}<br />?&gt;</span></code></div>
  </div>
 </div>
  <div class="note" id="22616">  <div class="votes">
    <div id="Vu22616">
    <a href="https://www.php.net/manual/vote-note.php?id=22616&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd22616">
    <a href="https://www.php.net/manual/vote-note.php?id=22616&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V22616" title="80% like this...">
    3
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#22616" class="name">
  <strong class="user"><em>kmakaveev(at)yahoo(dot)com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#22616"> &para;</a><div class="date" title="2002-06-25 07:29"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom22616">
<div class="phpcode"><code><span class="html">There's a little mistake in the code above!<br />The second echo must return "The message has no attachment!".<br />And that code must have some some additional  thing to work properly! Maybe I must use -&gt;parts to determine how many parts has a particular message!</span></code></div>
  </div>
 </div>
  <div class="note" id="57058">  <div class="votes">
    <div id="Vu57058">
    <a href="https://www.php.net/manual/vote-note.php?id=57058&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd57058">
    <a href="https://www.php.net/manual/vote-note.php?id=57058&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V57058" title="75% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#57058" class="name">
  <strong class="user"><em>hans at lintoo dot dk</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#57058"> &para;</a><div class="date" title="2005-09-22 07:07"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom57058">
<div class="phpcode"><code><span class="html">To fetch a single part (for example to investigate a charset or something like that)<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">class </span><span class="default">StructureEngine </span><span class="keyword">{<br />    private </span><span class="default">$structureObject</span><span class="keyword">;<br />    public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$structureInfo</span><span class="keyword">) {<br />        </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">structureObject </span><span class="keyword">= </span><span class="default">$structureInfo</span><span class="keyword">;<br />        <br />    }<br /><br />    </span><span class="comment">// snip....<br /><br />    </span><span class="keyword">public function </span><span class="default">getPart</span><span class="keyword">(</span><span class="default">$partNum</span><span class="keyword">) {<br />        </span><span class="default">$path </span><span class="keyword">= </span><span class="default">split</span><span class="keyword">(</span><span class="string">"[.]"</span><span class="keyword">,</span><span class="default">$partNum</span><span class="keyword">);<br />        </span><span class="default">$currentPart </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">structureObject</span><span class="keyword">;<br />        foreach (</span><span class="default">$path </span><span class="keyword">as </span><span class="default">$key </span><span class="keyword">=&gt; </span><span class="default">$num</span><span class="keyword">) {<br />            </span><span class="default">$currentPart </span><span class="keyword">= </span><span class="default">$currentPart</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">[</span><span class="default">$num</span><span class="keyword">-</span><span class="default">1</span><span class="keyword">];<br />        }<br />        return </span><span class="default">$currentPart</span><span class="keyword">;<br />    }<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="19172">  <div class="votes">
    <div id="Vu19172">
    <a href="https://www.php.net/manual/vote-note.php?id=19172&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd19172">
    <a href="https://www.php.net/manual/vote-note.php?id=19172&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V19172" title="75% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#19172" class="name">
  <strong class="user"><em>php AT firstnetimpressions.com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#19172"> &para;</a><div class="date" title="2002-02-18 01:15"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom19172">
<div class="phpcode"><code><span class="html">Point of clarification:<br /><br />The seventh primary body type is not "Other" as documented, but actually "Model".  This encompasses IGES, VRML, MESH, DWF, etc.<br /><br /><a href="http://www.isi.edu/in-notes/iana/assignments/media-types/media-types" rel="nofollow" target="_blank">http://www.isi.edu/in-notes/iana/assignments/media-types/media-types</a><br /><br />"Other" is the eigth primary body type.</span></code></div>
  </div>
 </div>
  <div class="note" id="60361">  <div class="votes">
    <div id="Vu60361">
    <a href="https://www.php.net/manual/vote-note.php?id=60361&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd60361">
    <a href="https://www.php.net/manual/vote-note.php?id=60361&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V60361" title="66% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#60361" class="name">
  <strong class="user"><em>sirber at detritus dot qc dot ca</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#60361"> &para;</a><div class="date" title="2006-01-04 11:48"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom60361">
<div class="phpcode"><code><span class="html">"Primary body type" of "unknown/unknown" will be int(9).</span></code></div>
  </div>
 </div>
  <div class="note" id="43279">  <div class="votes">
    <div id="Vu43279">
    <a href="https://www.php.net/manual/vote-note.php?id=43279&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd43279">
    <a href="https://www.php.net/manual/vote-note.php?id=43279&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V43279" title="66% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#43279" class="name">
  <strong class="user"><em>aperez at informatica dot 24ruedas dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#43279"> &para;</a><div class="date" title="2004-06-16 12:10"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom43279">
<div class="phpcode"><code><span class="html">About above comment and source code I wrote: certainly, plain/html text files are attachments, but I've written my code thinking about web IMAP clients, where text parts are not for downloading, simply they are shown. That's the reason.<br /><br />Thanks anyway. :)</span></code></div>
  </div>
 </div>
  <div class="note" id="36816">  <div class="votes">
    <div id="Vu36816">
    <a href="https://www.php.net/manual/vote-note.php?id=36816&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd36816">
    <a href="https://www.php.net/manual/vote-note.php?id=36816&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V36816" title="66% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#36816" class="name">
  <strong class="user"><em>chrislhill at &quot;O_o&quot; hotmail dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#36816"> &para;</a><div class="date" title="2003-10-23 11:36"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom36816">
<div class="phpcode"><code><span class="html">For people just beging this may help alot as I spent a couple hours just trying to relize how exact the array was stored. (at the time I did not know the print_r function :P)<br /><br />$struct = imap_fetchstructure($mbox, $msgnumber);<br />print_r($struct);<br /><br />Will give you a better example for your messages but they are called as $struct using the varible method above.<br /><br />$struct-&gt;type; //would return the type<br />$struct-&gt;encoding //would return the encoding <br /><br />and etc..<br /><br />This can be done many different ways but that is the basics on pulling the info out of the structure of fetchstructure itself, I hope it helps someone starting because it wouldve helped me :/.</span></code></div>
  </div>
 </div>
  <div class="note" id="100038">  <div class="votes">
    <div id="Vu100038">
    <a href="https://www.php.net/manual/vote-note.php?id=100038&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd100038">
    <a href="https://www.php.net/manual/vote-note.php?id=100038&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V100038" title="63% like this...">
    3
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#100038" class="name">
  <strong class="user"><em>raulggonzalez at gmail dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#100038"> &para;</a><div class="date" title="2010-09-21 05:54"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom100038">
<div class="phpcode"><code><span class="html">Hello eveybody,<br /><br />After reading plenty of posts (some good, some others not so good) I want to post a function to find out whether an email is coming with attachments<br /><br />The function can be called passing the object returned by imap_fetchstructure() or any of its parts (recursively)<br /><br /><span class="default">&lt;?php<br />$inbox </span><span class="keyword">= </span><span class="default">imap_open</span><span class="keyword">(</span><span class="default">$hostname</span><span class="keyword">,</span><span class="default">$username</span><span class="keyword">,</span><span class="default">$password</span><span class="keyword">) or die(</span><span class="string">'Cannot connect to mail: ' </span><span class="keyword">. </span><span class="default">imap_last_error</span><span class="keyword">());<br /></span><span class="default">$struct </span><span class="keyword">= </span><span class="default">imap_fetchstructure</span><span class="keyword">(</span><span class="default">$inbox</span><span class="keyword">,</span><span class="default">$uid</span><span class="keyword">,</span><span class="default">FT_UID</span><span class="keyword">);<br /></span><span class="default">$existAttachments </span><span class="keyword">= </span><span class="default">existAttachment</span><span class="keyword">(</span><span class="default">$struct</span><span class="keyword">);<br /><br />function </span><span class="default">existAttachment</span><span class="keyword">(</span><span class="default">$part</span><span class="keyword">){<br />    if (isset(</span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">)){<br />        foreach (</span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">parts </span><span class="keyword">as </span><span class="default">$partOfPart</span><span class="keyword">){<br />            </span><span class="default">existAttachment</span><span class="keyword">(</span><span class="default">$partOfPart</span><span class="keyword">);<br />        }<br />    }<br />    else{<br />        if (isset(</span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">disposition</span><span class="keyword">)){<br />            if (</span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">disposition </span><span class="keyword">== </span><span class="string">'attachment'</span><span class="keyword">){<br />                echo </span><span class="string">'&lt;p&gt;' </span><span class="keyword">. </span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">dparameters</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-&gt;</span><span class="default">value </span><span class="keyword">. </span><span class="string">'&lt;/p&gt;'</span><span class="keyword">;<br /></span><span class="comment">// here you can create a link to the file whose name is  $part-&gt;dparameters[0]-&gt;value to download it<br />                </span><span class="keyword">return </span><span class="default">true</span><span class="keyword">;<br />            }<br />        }<br />    }<br />}<br /></span><span class="default">?&gt;<br /></span><br />Hopefully somebody can use it as well</span></code></div>
  </div>
 </div>
  <div class="note" id="12485">  <div class="votes">
    <div id="Vu12485">
    <a href="https://www.php.net/manual/vote-note.php?id=12485&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd12485">
    <a href="https://www.php.net/manual/vote-note.php?id=12485&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V12485" title="66% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#12485" class="name">
  <strong class="user"><em>jbrandt at europa dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#12485"> &para;</a><div class="date" title="2001-04-16 03:45"><strong>22 years ago</strong></div>
  <div class="text" id="Hcom12485">
<div class="phpcode"><code><span class="html">Parsing the recursive object returned from imap_fetchstructure is easy. However trying to figure out the name of the section to pass to imap_fetchbody() isn't quite so straight forward because the naming conventions for the MIME sections are odd. If you copy and paste the following function you can pass an UID of an IMAP message and it will print out a hierarchy of the message and label each section.<br /><br />The only required parameters are $mbox and $em_uid. The other parameters are used when the function needs to call itself.<br /><br />Two functions mime_encoding() and mime_type() are not included. All they do is return string for the integer represention of a mime type/encoding.<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">function </span><span class="default">imap_dbody</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$em_uid</span><span class="keyword">, </span><span class="default">$mimeobj</span><span class="keyword">, </span><span class="default">$depth </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$section </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">)<br />{<br />        </span><span class="comment">// If this is the first run of the function then grab a object of the MIME structure of the message<br /><br />        </span><span class="keyword">if(</span><span class="default">$section </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) </span><span class="default">$mimeobj </span><span class="keyword">= </span><span class="default">imap_fetchstructure</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$em_uid</span><span class="keyword">, </span><span class="default">FT_UID</span><span class="keyword">);<br /><br />        for(</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$depth</span><span class="keyword">; </span><span class="default">$y</span><span class="keyword">++) echo(</span><span class="string">"       "</span><span class="keyword">);<br /><br />        echo(</span><span class="default">mime_type</span><span class="keyword">(</span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">type</span><span class="keyword">) . </span><span class="string">"/</span><span class="keyword">{</span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">subtype</span><span class="keyword">}</span><span class="string">, "</span><span class="keyword">);<br />        echo(</span><span class="default">mime_encoding</span><span class="keyword">(</span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">encoding</span><span class="keyword">) . </span><span class="string">" (&lt;B&gt;</span><span class="default">$section</span><span class="string">&lt;/B&gt;)&lt;BR&gt;"</span><span class="keyword">);<br /><br />        for(</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">count</span><span class="keyword">(</span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">); </span><span class="default">$x</span><span class="keyword">++)<br />        {<br />                </span><span class="comment">// If we are in the root of the object increment by whole integers<br /><br />                </span><span class="keyword">if(</span><span class="default">$section </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">) </span><span class="default">$nsection </span><span class="keyword">= </span><span class="default">$x </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">;<br /><br />                </span><span class="comment">// If we are in the object and the first sub-object of our object isn't multipart<br />                // then increment the postfix by ".1" otherwise we are multipart or a message<br />                // and leave the section id alone to be handled by the next code block<br /><br />                </span><span class="keyword">else if((</span><span class="default">$pos </span><span class="keyword">= </span><span class="default">strrpos</span><span class="keyword">(</span><span class="default">$section</span><span class="keyword">, </span><span class="string">"."</span><span class="keyword">)) &amp;&amp; </span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-&gt;</span><span class="default">type </span><span class="keyword">!= </span><span class="default">TYPEMULTIPART</span><span class="keyword">)<br />                        </span><span class="default">$nsection </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$section</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">$pos</span><span class="keyword">) . </span><span class="string">"." </span><span class="keyword">. (</span><span class="default">$x </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">);<br />                else<br />                        </span><span class="default">$nsection </span><span class="keyword">= </span><span class="default">$section</span><span class="keyword">;<br /><br />                </span><span class="comment">// If there are more parts to the part about to be processed reference it as a header with ".0"<br />                // but only if the child of this child isn't MULTIPART<br /><br />                </span><span class="keyword">if(</span><span class="default">count</span><span class="keyword">(</span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">]-&gt;</span><span class="default">parts</span><span class="keyword">))<br />                {<br />                        </span><span class="comment">// Funny really, if a mime section is a inline message that has a multipart body you reference the message<br />                        // mime section with "2" the inline message header with "2.0" and the subsections with "2.x"<br />                        // However if the mime section is a inline message with only 1 part then you reference the<br />                        // mime section in the message with 2.0 and the inline message body with 2.1<br /><br />                        </span><span class="keyword">if(!(</span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">]-&gt;</span><span class="default">type </span><span class="keyword">== </span><span class="default">TYPEMESSAGE </span><span class="keyword">&amp;&amp; </span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">]-&gt;</span><span class="default">parts</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-&gt;</span><span class="default">type </span><span class="keyword">== </span><span class="default">TYPEMULTIPART</span><span class="keyword">))<br />                                </span><span class="default">$nsection </span><span class="keyword">.= </span><span class="string">".0"</span><span class="keyword">;<br />                        else<br />                                </span><span class="default">$nsection </span><span class="keyword">.= </span><span class="string">""</span><span class="keyword">;<br />                }<br /><br />                </span><span class="default">imap_dbody</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$em_uid</span><span class="keyword">, </span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">[</span><span class="default">$x</span><span class="keyword">], </span><span class="default">$depth </span><span class="keyword">+ </span><span class="default">1</span><span class="keyword">, </span><span class="default">$nsection</span><span class="keyword">);<br /><br />        }<br /><br />        </span><span class="comment">// If after processing the entire MIME object the $x variable is still zero then we didn't<br />        // process a multipart mime message, it's just normal email so say so here.<br /><br />        </span><span class="keyword">if(</span><span class="default">$x </span><span class="keyword">== </span><span class="default">0 </span><span class="keyword">&amp;&amp; </span><span class="default">$section </span><span class="keyword">== </span><span class="default">0</span><span class="keyword">)<br />        {<br />                echo(</span><span class="default">mime_type</span><span class="keyword">(</span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">type</span><span class="keyword">) . </span><span class="string">"/</span><span class="keyword">{</span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">subtype</span><span class="keyword">}</span><span class="string">, "</span><span class="keyword">);<br />                echo(</span><span class="default">mime_encoding</span><span class="keyword">(</span><span class="default">$mimeobj</span><span class="keyword">-&gt;</span><span class="default">encoding</span><span class="keyword">) . </span><span class="string">" (&lt;B&gt;1&lt;/B&gt;) (&lt;B&gt;NOT MIME MULTIPART&lt;/B&gt;)&lt;BR&gt;"</span><span class="keyword">);<br />        }<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="54438">  <div class="votes">
    <div id="Vu54438">
    <a href="https://www.php.net/manual/vote-note.php?id=54438&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd54438">
    <a href="https://www.php.net/manual/vote-note.php?id=54438&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V54438" title="62% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#54438" class="name">
  <strong class="user"><em>john at vetsurgeon dot org dot uk</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#54438"> &para;</a><div class="date" title="2005-07-04 09:07"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom54438">
<div class="phpcode"><code><span class="html">A little script I threw together to break a message down and process it into a usable array<br /><br />&lt;?<br />//script will fetch an email identified by $msgid, and parse the its parts into an<br />//array $partsarray<br />//structure of array:<br />//$partsarray[&lt;name of part&gt;][&lt;attachment/text&gt;]<br />//if attachment- subarray is [filename][binary data]<br />//if text- subarray is [type of text(HTML/PLAIN)][text string]<br /><br />//i.e.<br />//$partsarray[3.1][attachment][filename]=filename of attachment in part 3.1<br />//$partsarray[3.1][attachment][binary]=binary data of attachment in part 3.1<br />//$partsarray[2][text][type]=type of text in part 2<br />//$partsarray[2][text][string]=decoded text string in part 2<br />//$partsarray[not multipart][text][string]=decoded text string in message that isn't multipart<br /><br />function parsepart($p,$i){<br />    global $link,$msgid,$partsarray;<br />    //where to write file attachments to:<br />    $filestore = '[full/path/to/attachment/store/(chmod777)]';<br /><br />    //fetch part<br />    $part=imap_fetchbody($link,$msgid,$i);<br />    //if type is not text<br />    if ($p-&gt;type!=0){<br />        //DECODE PART        <br />        //decode if base64<br />        if ($p-&gt;encoding==3)$part=base64_decode($part);<br />        //decode if quoted printable<br />        if ($p-&gt;encoding==4)$part=quoted_printable_decode($part);<br />        //no need to decode binary or 8bit!<br />        <br />        //get filename of attachment if present<br />        $filename='';<br />        // if there are any dparameters present in this part<br />        if (count($p-&gt;dparameters)&gt;0){<br />            foreach ($p-&gt;dparameters as $dparam){<br />                if ((strtoupper($dparam-&gt;attribute)=='NAME') ||(strtoupper($dparam-&gt;attribute)=='FILENAME')) $filename=$dparam-&gt;value;<br />                }<br />            }<br />        //if no filename found<br />        if ($filename==''){<br />            // if there are any parameters present in this part<br />            if (count($p-&gt;parameters)&gt;0){<br />                foreach ($p-&gt;parameters as $param){<br />                    if ((strtoupper($param-&gt;attribute)=='NAME') ||(strtoupper($param-&gt;attribute)=='FILENAME')) $filename=$param-&gt;value;<br />                    }<br />                }<br />            }<br />        //write to disk and set partsarray variable<br />        if ($filename!=''){<br />            $partsarray[$i][attachment] = array('filename'=&gt;$filename,'binary'=&gt;$part);<br />            $fp=fopen($filestore.$filename,"w+");<br />            fwrite($fp,$part);<br />            fclose($fp);<br />            }<br />    //end if type!=0        <br />    }<br />    <br />    //if part is text<br />    else if($p-&gt;type==0){<br />        //decode text<br />        //if QUOTED-PRINTABLE<br />        if ($p-&gt;encoding==4) $part=quoted_printable_decode($part);<br />        //if base 64<br />        if ($p-&gt;encoding==3) $part=base64_decode($part);<br />        <br />        //OPTIONAL PROCESSING e.g. nl2br for plain text<br />        //if plain text<br /><br />        if (strtoupper($p-&gt;subtype)=='PLAIN')1;<br />        //if HTML<br />        else if (strtoupper($p-&gt;subtype)=='HTML')1;<br />        $partsarray[$i][text] = array('type'=&gt;$p-&gt;subtype,'string'=&gt;$part);<br />    }<br />    <br />    //if subparts... recurse into function and parse them too!<br />    if (count($p-&gt;parts)&gt;0){<br />        foreach ($p-&gt;parts as $pno=&gt;$parr){<br />            parsepart($parr,($i.'.'.($pno+1)));            <br />            }<br />        }<br />return;<br />}<br /><br />//open resource<br />$link=imap_open("{localhost:110/pop3}INBOX",'[YOUR USERNAME]','[YOUR PASSWORD]');<br /><br />//fetch structure of message<br />$s=imap_fetchstructure($link,$msgid);<br /><br />//see if there are any parts<br />if (count($s-&gt;parts)&gt;0){<br />foreach ($s-&gt;parts as $partno=&gt;$partarr){<br />    //parse parts of email<br />    parsepart($partarr,$partno+1);<br />    }<br />}<br /><br />//for not multipart messages<br />else{<br />    //get body of message<br />    $text=imap_body($link,$msgid);<br />    //decode if quoted-printable<br />    if ($s-&gt;encoding==4) $text=quoted_printable_decode($text);<br />    //OPTIONAL PROCESSING<br />    if (strtoupper($s-&gt;subtype)=='PLAIN') $text=$text;<br />    if (strtoupper($s-&gt;subtype)=='HTML') $text=$text;<br />    <br />    $partsarray['not multipart'][text]=array('type'=&gt;$s-&gt;subtype,'string'=&gt;$text);<br />}<br /><br />print_r($partsarray);<br />?&gt;</span></code></div>
  </div>
 </div>
  <div class="note" id="28043">  <div class="votes">
    <div id="Vu28043">
    <a href="https://www.php.net/manual/vote-note.php?id=28043&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd28043">
    <a href="https://www.php.net/manual/vote-note.php?id=28043&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V28043" title="61% like this...">
    3
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#28043" class="name">
  <strong class="user"><em>as1 at powersite dot com dot ar</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#28043"> &para;</a><div class="date" title="2002-12-30 01:57"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom28043">
<div class="phpcode"><code><span class="html">Sorry, my before code is not complet:<br /><br />$struct = imap_fetchstructure( $conn, $curMsg );<br /><br />$i = 1;<br />while( imap_fetchbody( $conn, $curMsg, $i ) ){<br />  $struct-&gt;parts[$i-1] = imap_bodystruct( $conn, $curMsg, $i );<br />  $j = 1;<br />  while( imap_fetchbody( $conn, $curMsg, "$i.$j" ) ){<br />    $struct-&gt;parts[$i-1]-&gt;parts[$j-1] = imap_bodystruct( $conn, $curMsg, "$i.$j" );<br />    $j++;<br />    }<br />  $i++;<br />}</span></code></div>
  </div>
 </div>
  <div class="note" id="52007">  <div class="votes">
    <div id="Vu52007">
    <a href="https://www.php.net/manual/vote-note.php?id=52007&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd52007">
    <a href="https://www.php.net/manual/vote-note.php?id=52007&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V52007" title="60% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#52007" class="name">
  <strong class="user"><em>masterbassist</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#52007"> &para;</a><div class="date" title="2005-04-18 09:52"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom52007">
<div class="phpcode"><code><span class="html">I think the following line (when building attachment information)<br /><br />&gt;&gt;&gt; "filename" =&gt; $parts[$i]-&gt;parameters[0]-&gt;value<br /><br />needs to be<br /><br />&gt;&gt;&gt; "filename" =&gt; $parts[$i]-&gt;dparameters[0]-&gt;value<br /><br />The first version generated a PHP warning under PHP 5.0.3.  The second version actually gets the filename.</span></code></div>
  </div>
 </div>
  <div class="note" id="48352">  <div class="votes">
    <div id="Vu48352">
    <a href="https://www.php.net/manual/vote-note.php?id=48352&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd48352">
    <a href="https://www.php.net/manual/vote-note.php?id=48352&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V48352" title="60% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#48352" class="name">
  <strong class="user"><em>y dot daradkeh at gmail dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#48352"> &para;</a><div class="date" title="2004-12-20 07:40"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom48352">
<div class="phpcode"><code><span class="html">Hey people, get the message attachments with this code:<br /><br /><span class="default">&lt;?php<br /><br />$mbox </span><span class="keyword">= </span><span class="default">imap_open</span><span class="keyword">(</span><span class="string">"</span><span class="default">$imap_server</span><span class="string">"</span><span class="keyword">.</span><span class="default">$f</span><span class="keyword">,</span><span class="default">$name</span><span class="keyword">,</span><span class="default">$pass</span><span class="keyword">);<br /><br /></span><span class="comment">// delibertely choose a message with an attachment<br /><br /></span><span class="default">$info </span><span class="keyword">= </span><span class="default">imap_fetchstructure</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$mno</span><span class="keyword">);<br /><br /></span><span class="comment">// find out how may parts the object has<br /></span><span class="default">$numparts </span><span class="keyword">= </span><span class="default">count</span><span class="keyword">(</span><span class="default">$info</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">);<br /><br /></span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br /></span><span class="comment">// find if multipart message<br /></span><span class="keyword">if (</span><span class="default">$numparts </span><span class="keyword">&gt;</span><span class="default">1</span><span class="keyword">)<br />{<br />   echo </span><span class="string">"&lt;b&gt;More than one part&lt;/b&gt;&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br /><br />   foreach (</span><span class="default">$info</span><span class="keyword">-&gt;</span><span class="default">parts </span><span class="keyword">as </span><span class="default">$part</span><span class="keyword">)<br />   {<br />      if (</span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">disposition </span><span class="keyword">== </span><span class="string">"INLINE"</span><span class="keyword">)<br />         </span><span class="default">printf</span><span class="keyword">(</span><span class="string">"Inline message has %s lines&lt;BR&gt;"</span><span class="keyword">, </span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">lines</span><span class="keyword">);<br />     elseif (</span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">disposition </span><span class="keyword">== </span><span class="string">"attachment"</span><span class="keyword">)<br />     {<br />       </span><span class="default">$i</span><span class="keyword">++;<br />       echo </span><span class="default">$i</span><span class="keyword">.</span><span class="string">" Attachment/s found!&lt;br&gt;"</span><span class="keyword">;<br />       echo </span><span class="string">"Filename: "</span><span class="keyword">.</span><span class="default">$part</span><span class="keyword">-&gt;</span><span class="default">dparameters</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-&gt;</span><span class="default">value</span><span class="keyword">.</span><span class="string">"&lt;br&gt;&lt;br&gt;"</span><span class="keyword">;<br />     }<br />   }<br />}<br />else<br />   echo </span><span class="string">"Only one part"</span><span class="keyword">;<br /><br /></span><span class="default">imap_close</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">);<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="78076">  <div class="votes">
    <div id="Vu78076">
    <a href="https://www.php.net/manual/vote-note.php?id=78076&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd78076">
    <a href="https://www.php.net/manual/vote-note.php?id=78076&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V78076" title="58% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#78076" class="name">
  <strong class="user"><em>phpnet,a,emailaddress,cjb,net</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#78076"> &para;</a><div class="date" title="2007-09-26 07:13"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom78076">
<div class="phpcode"><code><span class="html">Another comment to inform people about something that should really be in the function description:<br /><br />imap_fetchstructure() downloads the entire email, attachments and all, rather than just the structure.<br />I guess it's an undocumented feature, not a bug.<br /><br />I had assumed that the script would have only downloaded the amount of data that was returned, but my script downloaded a cumulative 2.5gig before i noticed.  Hopefully no-one else will have this happen.</span></code></div>
  </div>
 </div>
  <div class="note" id="42656">  <div class="votes">
    <div id="Vu42656">
    <a href="https://www.php.net/manual/vote-note.php?id=42656&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd42656">
    <a href="https://www.php.net/manual/vote-note.php?id=42656&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V42656" title="57% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#42656" class="name">
  <strong class="user"><em>aperez at informatica dot 24ruedas dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#42656"> &para;</a><div class="date" title="2004-05-25 12:12"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom42656">
<div class="phpcode"><code><span class="html">This is my function to check attachments:<br /><br /><span class="default">&lt;?php<br />  $est</span><span class="keyword">=</span><span class="default">imap_fetchstructure</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">,</span><span class="default">$msg</span><span class="keyword">);<br /><br />  if(</span><span class="default">checkAttachments</span><span class="keyword">(</span><span class="default">$est</span><span class="keyword">))<br />  {<br />    echo(</span><span class="string">"You have attachment(s)"</span><span class="keyword">);<br />  }<br />  else<br />  {<br />    echo(</span><span class="string">"You don't have attachment(s)"</span><span class="keyword">);<br />  }<br />  <br />  function </span><span class="default">checkAttachments</span><span class="keyword">(</span><span class="default">$estMsg</span><span class="keyword">)<br />  {<br />    if((</span><span class="default">$estMsg</span><span class="keyword">-&gt;</span><span class="default">type</span><span class="keyword">!=</span><span class="default">0</span><span class="keyword">) &amp;&amp; (</span><span class="default">$estMsg</span><span class="keyword">-&gt;</span><span class="default">type</span><span class="keyword">!=</span><span class="default">1</span><span class="keyword">))<br />    {<br />      </span><span class="comment">// Text and multipart parts will not be shown as attachments<br />      </span><span class="keyword">return(</span><span class="default">true</span><span class="keyword">);<br />    }<br />    else<br />    {<br />      </span><span class="comment">// If there's no attachments, parts inside will be checked<br />      </span><span class="keyword">if(</span><span class="default">$estMsg</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">)<br />      {<br />        </span><span class="default">$partMsg</span><span class="keyword">=</span><span class="default">$estMsg</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">;<br />        </span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />        </span><span class="comment">// Parts will be checked while no attachments found or not all of them checked<br />        </span><span class="keyword">while(!(</span><span class="default">checkAttachments</span><span class="keyword">(</span><span class="default">$partMsg</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">])) &amp;&amp; (</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$estMsg</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">)))<br />        {<br />          </span><span class="default">$i</span><span class="keyword">++;<br />        }<br /><br />        </span><span class="comment">// If any 'checkAttachment' calls returned 'true', 'i' should be<br />        // equal to number of parts(after increased in while). So, no<br />        // attachments found<br />        </span><span class="keyword">if(</span><span class="default">$i</span><span class="keyword">==</span><span class="default">sizeof</span><span class="keyword">(</span><span class="default">$estMsg</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">))<br />        {<br />          return(</span><span class="default">false</span><span class="keyword">);<br />        }<br />        else<br />        {<br />          return(</span><span class="default">true</span><span class="keyword">);<br />        }<br />      }<br />      else<br />      {<br />        </span><span class="comment">// If no parts and text or multipart type, no attachments<br />        </span><span class="keyword">return(</span><span class="default">false</span><span class="keyword">);  <br />      }<br />    }<br />  }<br />  </span><span class="default">imap_close</span><span class="keyword">(</span><span class="default">$con</span><span class="keyword">);<br /></span><span class="default">?&gt;<br /></span><br />I hope this helps somebody else(if bugs, thanks for your fixes).</span></code></div>
  </div>
 </div>
  <div class="note" id="123759">  <div class="votes">
    <div id="Vu123759">
    <a href="https://www.php.net/manual/vote-note.php?id=123759&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd123759">
    <a href="https://www.php.net/manual/vote-note.php?id=123759&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V123759" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#123759" class="name">
  <strong class="user"><em>hello at ivanbogomolov dot ru</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#123759"> &para;</a><div class="date" title="2019-04-08 11:33"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom123759">
<div class="phpcode"><code><span class="html">If you logic based on compare structure strings, you must compare it case insensetive.<br /><span class="default">&lt;?php<br /><br />$p </span><span class="keyword">= </span><span class="default">imap_fetchstructure</span><span class="keyword">(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_imap_resource</span><span class="keyword">, </span><span class="default">$mid</span><span class="keyword">);<br /></span><span class="comment">//do not compare $p-&gt;disposition == 'INLINE' <br /></span><span class="keyword">if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/inline/i'</span><span class="keyword">, </span><span class="default">$p</span><span class="keyword">-&gt;</span><span class="default">disposition</span><span class="keyword">)) <br />{<br /> </span><span class="comment">//this works<br /></span><span class="keyword">}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="123542">  <div class="votes">
    <div id="Vu123542">
    <a href="https://www.php.net/manual/vote-note.php?id=123542&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd123542">
    <a href="https://www.php.net/manual/vote-note.php?id=123542&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V123542" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#123542" class="name">
  <strong class="user"><em>alchrystal88 at web dot de</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#123542"> &para;</a><div class="date" title="2019-01-24 11:44"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom123542">
<div class="phpcode"><code><span class="html">If you have errors with wrong attachment names like this:<br /><br />correct name:<br />String -&gt; Prüfbericht Hersteller.pdf<br /><br />fetchstructure object name:<br /> =?ISO-8859-1?Q?Pr=FCfbericht_Hersteller=2Epdf?=<br /><br />Workaround to reconvert:<br /><br />imap_mime_header_decode($fetchstructure-&gt;dparameters-&gt;value)[0]-&gt;text<br /><br />imap_mime_header_decode($filename)[0]-&gt;text</span></code></div>
  </div>
 </div>
  <div class="note" id="34952">  <div class="votes">
    <div id="Vu34952">
    <a href="https://www.php.net/manual/vote-note.php?id=34952&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd34952">
    <a href="https://www.php.net/manual/vote-note.php?id=34952&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V34952" title="100% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#34952" class="name">
  <strong class="user"><em>es96 at hotmail dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#34952"> &para;</a><div class="date" title="2003-08-13 02:38"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom34952">
<div class="phpcode"><code><span class="html">If you are getting CHARSET as US-ASCII even if the header has a Content-Type: field, make sure the header also has a MIME-Version: field.<br /><br />For example, the following header will correcty report charset as KOI8-R<br /><br />MIME-Version: 1.0<br />Content-Type: text/plain; charset="koi8-r"<br /><br />Without the MIME-Version it will be reported as US-ASII</span></code></div>
  </div>
 </div>
  <div class="note" id="25368">  <div class="votes">
    <div id="Vu25368">
    <a href="https://www.php.net/manual/vote-note.php?id=25368&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd25368">
    <a href="https://www.php.net/manual/vote-note.php?id=25368&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V25368" title="100% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#25368" class="name">
  <strong class="user"><em>jcastro at elnuevodia dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#25368"> &para;</a><div class="date" title="2002-09-20 01:16"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom25368">
<div class="phpcode"><code><span class="html">I think the above note about attachments is wrong. I tested sending files with and without attachments and I get the following&lt;br&gt;<br />with attachment: type=3 bytes=343648<br />no attachment: type=0 bytes=2<br />so checking for $struct-&gt;bytes == " " means nothing. At least in my test<br />running windows 2000, php4.2.1 using outlook and exchange. It seems that cheking the type will be more reliable</span></code></div>
  </div>
 </div>
  <div class="note" id="99208">  <div class="votes">
    <div id="Vu99208">
    <a href="https://www.php.net/manual/vote-note.php?id=99208&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd99208">
    <a href="https://www.php.net/manual/vote-note.php?id=99208&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V99208" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#99208" class="name">
  <strong class="user"><em>burninleo at gmx dot net</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#99208"> &para;</a><div class="date" title="2010-08-03 09:42"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom99208">
<div class="phpcode"><code><span class="html">Use imap_errors() to get rid of sticky error messages about incorrect MIME headers.</span></code></div>
  </div>
 </div>
  <div class="note" id="2758">  <div class="votes">
    <div id="Vu2758">
    <a href="https://www.php.net/manual/vote-note.php?id=2758&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd2758">
    <a href="https://www.php.net/manual/vote-note.php?id=2758&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V2758" title="100% like this...">
    2
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#2758" class="name">
  <strong class="user"><em>hholzgra at media-engineering dot de</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#2758"> &para;</a><div class="date" title="1999-12-15 01:59"><strong>24 years ago</strong></div>
  <div class="text" id="Hcom2758">
<div class="phpcode"><code><span class="html">the parts objects are identical in<br />structure to those returned by imap_fetchstructure, describing one subfolder each<br /><br />parameters and dparameters are MIME-specific, theese contain the<br />extra parameters provided in the Content-Type and Content-Disposion Header lines such as Charset or Filename</span></code></div>
  </div>
 </div>
  <div class="note" id="86753">  <div class="votes">
    <div id="Vu86753">
    <a href="https://www.php.net/manual/vote-note.php?id=86753&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd86753">
    <a href="https://www.php.net/manual/vote-note.php?id=86753&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V86753" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#86753" class="name">
  <strong class="user"><em>Rui Torre rui_sharkye at hotmail dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#86753"> &para;</a><div class="date" title="2008-11-02 02:34"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom86753">
<div class="phpcode"><code><span class="html">I've made this two functions to decode mime headers and so far they are working just fine decoding all headers. Please let me know if you find any error. Hope they are useful for you too.<br /><br /><span class="default">&lt;?php<br /><br /></span><span class="keyword">function </span><span class="default">decode_headers</span><span class="keyword">(</span><span class="default">$cabecalho</span><span class="keyword">){<br />        while (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^(.*)=\?([^?]*)\?(Q|B)\?(.*)$/Ui'</span><span class="keyword">, </span><span class="default">$cabecalho</span><span class="keyword">)){<br />            </span><span class="default">$cabecalho </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/(\t|\r|\n)/"</span><span class="keyword">, </span><span class="string">""</span><span class="keyword">, </span><span class="default">$cabecalho</span><span class="keyword">); <br />            </span><span class="default">$cabecalho </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/\?(Q|B)\?=/Ui"</span><span class="keyword">, </span><span class="string">"?\\1? ="</span><span class="keyword">, </span><span class="default">$cabecalho</span><span class="keyword">); <br />               <br />            </span><span class="default">$partes_cabecalho </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">"?="</span><span class="keyword">, </span><span class="default">$cabecalho</span><span class="keyword">);<br />            <br />            </span><span class="default">$resultado </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />            foreach (</span><span class="default">$partes_cabecalho </span><span class="keyword">as </span><span class="default">$texto</span><span class="keyword">){<br />                </span><span class="default">$texto </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/\?(Q|B)\?\s=/Ui"</span><span class="keyword">, </span><span class="string">"?\\1?="</span><span class="keyword">, </span><span class="default">$texto</span><span class="keyword">);<br />                </span><span class="default">$texto </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">"/\?(Q|B)\?/Ui"</span><span class="keyword">, </span><span class="string">"=?\\1=?"</span><span class="keyword">, </span><span class="default">$texto</span><span class="keyword">);<br />                <br />                if (</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/^(.*)=\?([^?]*)=\?(Q|B)=\?(.*)$/Ui'</span><span class="keyword">, </span><span class="default">$texto</span><span class="keyword">)){<br />                    </span><span class="default">$partes_texto </span><span class="keyword">= </span><span class="default">explode </span><span class="keyword">(</span><span class="string">"=?"</span><span class="keyword">, </span><span class="default">$texto</span><span class="keyword">);  <br />                    <br />                    </span><span class="default">$parte </span><span class="keyword">= </span><span class="default">descodificar_parte</span><span class="keyword">(</span><span class="default">$partes_texto</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$partes_texto</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />                    </span><span class="default">$parte </span><span class="keyword">.= </span><span class="default">descodificar_parte</span><span class="keyword">(</span><span class="default">$partes_texto</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">], </span><span class="default">$partes_texto</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]);<br />                } else { <br />                    </span><span class="default">$parte </span><span class="keyword">= </span><span class="default">$texto</span><span class="keyword">;  <br />                }  <br />                <br />                if (</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$partes_texto</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]) == </span><span class="string">"UTF-8"</span><span class="keyword">){ </span><span class="default">$parte </span><span class="keyword">= </span><span class="default">utf8_decode</span><span class="keyword">(</span><span class="default">$parte</span><span class="keyword">);}  <br />                </span><span class="default">$resultado </span><span class="keyword">.= </span><span class="default">$parte</span><span class="keyword">;  <br />            }<br />            </span><span class="default">$cabecalho </span><span class="keyword">= </span><span class="default">$resultado</span><span class="keyword">;<br />        } <br />        <br />        return </span><span class="default">trim</span><span class="keyword">(</span><span class="default">$cabecalho</span><span class="keyword">);       <br />    }<br />    <br />    function </span><span class="default">descodificar_parte</span><span class="keyword">(</span><span class="default">$texto</span><span class="keyword">, </span><span class="default">$codificacao</span><span class="keyword">){<br />        if (</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$texto</span><span class="keyword">) == </span><span class="string">""</span><span class="keyword">){ return </span><span class="string">""</span><span class="keyword">;}<br />        <br />        if (</span><span class="default">ucfirst</span><span class="keyword">(</span><span class="default">$codificacao</span><span class="keyword">) == </span><span class="string">"B"</span><span class="keyword">){<br />            </span><span class="default">$texto </span><span class="keyword">= </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$texto</span><span class="keyword">);<br />            </span><span class="default">$texto </span><span class="keyword">= </span><span class="default">htmlspecialchars</span><span class="keyword">(</span><span class="default">$texto</span><span class="keyword">);<br />        } else if (</span><span class="default">ucfirst</span><span class="keyword">(</span><span class="default">$codificacao</span><span class="keyword">) == </span><span class="string">"Q"</span><span class="keyword">){<br />            </span><span class="default">$texto </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">"_"</span><span class="keyword">, </span><span class="string">" "</span><span class="keyword">, </span><span class="default">$texto</span><span class="keyword">); <br />            </span><span class="default">$texto </span><span class="keyword">= </span><span class="default">quoted_printable_decode</span><span class="keyword">(</span><span class="default">$texto</span><span class="keyword">);  <br />        } <br />        return </span><span class="default">$texto</span><span class="keyword">;<br />    }<br /><br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="61280">  <div class="votes">
    <div id="Vu61280">
    <a href="https://www.php.net/manual/vote-note.php?id=61280&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd61280">
    <a href="https://www.php.net/manual/vote-note.php?id=61280&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V61280" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#61280" class="name">
  <strong class="user"><em>oersoep at gmail dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#61280"> &para;</a><div class="date" title="2006-01-29 11:58"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom61280">
<div class="phpcode"><code><span class="html">Please keep in mind that the "parameters" array is a stdClass object when there are no parameters, and NOT a zero-size array.<br />In PHP5 you'll get this error when iterating structure-&gt;parts[x]-&gt;parameters if there aren't any parameters for this part:<br /><br />PHP Fatal error:  Cannot use object of type stdClass as array in file.php on line 100</span></code></div>
  </div>
 </div>
  <div class="note" id="51497">  <div class="votes">
    <div id="Vu51497">
    <a href="https://www.php.net/manual/vote-note.php?id=51497&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd51497">
    <a href="https://www.php.net/manual/vote-note.php?id=51497&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V51497" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#51497" class="name">
  <strong class="user"><em>spam at emielmols dot info</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#51497"> &para;</a><div class="date" title="2005-04-01 03:47"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom51497">
<div class="phpcode"><code><span class="html">I've created a function which simply extracts basic message content as a string ($content) and attachments as an array ($attachments). I've tested it with messages from Outlook, Outlook Express and Hotmail. Perhaps it's useful to anyone.<br /><br /><span class="default">&lt;?php<br />        $struct </span><span class="keyword">= </span><span class="default">imap_fetchstructure</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$mid</span><span class="keyword">);<br />        <br />        </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">$struct</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">;<br />        </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br /><br />        if (!</span><span class="default">$parts</span><span class="keyword">) { </span><span class="comment">/* Simple message, only 1 piece */<br />          </span><span class="default">$attachment </span><span class="keyword">= array(); </span><span class="comment">/* No attachments */<br />          </span><span class="default">$content </span><span class="keyword">= </span><span class="default">imap_body</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$mid</span><span class="keyword">);<br />        } else { </span><span class="comment">/* Complicated message, multiple parts */<br />        <br />          </span><span class="default">$endwhile </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br />        <br />          </span><span class="default">$stack </span><span class="keyword">= array(); </span><span class="comment">/* Stack while parsing message */<br />          </span><span class="default">$content </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;    </span><span class="comment">/* Content of message */<br />          </span><span class="default">$attachment </span><span class="keyword">= array(); </span><span class="comment">/* Attachments */<br />        <br />          </span><span class="keyword">while (!</span><span class="default">$endwhile</span><span class="keyword">) {<br />            if (!</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) {<br />              if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {<br />                </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">][</span><span class="string">"p"</span><span class="keyword">];<br />                </span><span class="default">$i     </span><span class="keyword">= </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">][</span><span class="string">"i"</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">;<br />                </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />              } else {<br />                </span><span class="default">$endwhile </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />              }<br />            }<br />          <br />            if (!</span><span class="default">$endwhile</span><span class="keyword">) {<br />              </span><span class="comment">/* Create message part first (example '1.2.3') */<br />              </span><span class="default">$partstring </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />              foreach (</span><span class="default">$stack </span><span class="keyword">as </span><span class="default">$s</span><span class="keyword">) {<br />                </span><span class="default">$partstring </span><span class="keyword">.= (</span><span class="default">$s</span><span class="keyword">[</span><span class="string">"i"</span><span class="keyword">]+</span><span class="default">1</span><span class="keyword">) . </span><span class="string">"."</span><span class="keyword">;<br />              }<br />              </span><span class="default">$partstring </span><span class="keyword">.= (</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);<br />            <br />              if (</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">disposition</span><span class="keyword">) == </span><span class="string">"ATTACHMENT"</span><span class="keyword">) { </span><span class="comment">/* Attachment */<br />                </span><span class="default">$attachment</span><span class="keyword">[] = array(</span><span class="string">"filename" </span><span class="keyword">=&gt; </span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">parameters</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-&gt;</span><span class="default">value</span><span class="keyword">,<br />                                      </span><span class="string">"filedata" </span><span class="keyword">=&gt; </span><span class="default">imap_fetchbody</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$mid</span><span class="keyword">, </span><span class="default">$partstring</span><span class="keyword">));<br />              } elseif (</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">subtype</span><span class="keyword">) == </span><span class="string">"PLAIN"</span><span class="keyword">) { </span><span class="comment">/* Message */<br />                </span><span class="default">$content </span><span class="keyword">.= </span><span class="default">imap_fetchbody</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$mid</span><span class="keyword">, </span><span class="default">$partstring</span><span class="keyword">);<br />              }<br />            }<br /><br />            if (</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">parts</span><span class="keyword">) {<br />              </span><span class="default">$stack</span><span class="keyword">[] = array(</span><span class="string">"p" </span><span class="keyword">=&gt; </span><span class="default">$parts</span><span class="keyword">, </span><span class="string">"i" </span><span class="keyword">=&gt; </span><span class="default">$i</span><span class="keyword">);<br />              </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">parts</span><span class="keyword">;<br />              </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />            } else {<br />              </span><span class="default">$i</span><span class="keyword">++;<br />            }<br />          } </span><span class="comment">/* while */<br />        </span><span class="keyword">} </span><span class="comment">/* complicated message */<br /><br />        </span><span class="keyword">echo </span><span class="string">"Analyzed message </span><span class="default">$mid</span><span class="string">, result: &lt;br /&gt;"</span><span class="keyword">;<br />        echo </span><span class="string">"Content: </span><span class="default">$content</span><span class="string">&lt;br /&gt;&lt;br /&gt;"</span><span class="keyword">;<br />        echo </span><span class="string">"Attachments:"</span><span class="keyword">; </span><span class="default">print_r </span><span class="keyword">(</span><span class="default">$attachment</span><span class="keyword">);<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="43244">  <div class="votes">
    <div id="Vu43244">
    <a href="https://www.php.net/manual/vote-note.php?id=43244&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd43244">
    <a href="https://www.php.net/manual/vote-note.php?id=43244&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V43244" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#43244" class="name">
  <strong class="user"><em>passeniermaxime at hotmail dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#43244"> &para;</a><div class="date" title="2004-06-15 08:15"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom43244">
<div class="phpcode"><code><span class="html">I have written a code that check's for attachments.<br />There is a slight problem with the above code; <br />when you send a mail with a .txt document as attachment<br />the type will be 0 and so there won't be a attachment found.<br /><br />I check for the disposition of the body part witch can be inline or attachment. <br />If this is an attachment he will display it.<br />You an also mix up both codes by checking on the type and the disposition.<br /><br />//////////////////////////////////<br />///   $mbox = connection <br />///   $a_mails_sort[$i] = message id<br /><br />$structuur = imap_fetchstructure($mbox,$a_mails_sort[$i]);<br />$bericht_delen=$structuur-&gt;parts;<br />for($i_delen = 0; $i_delen&lt;=count($bericht_delen);$i_delen++)<br />  {<br />  if($bericht_delen[$i_delen]-&gt;disposition == "attachment")<br />    {<br />    $attachment = "OK";<br />    }// end if<br />  }//end for</span></code></div>
  </div>
 </div>
  <div class="note" id="28040">  <div class="votes">
    <div id="Vu28040">
    <a href="https://www.php.net/manual/vote-note.php?id=28040&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd28040">
    <a href="https://www.php.net/manual/vote-note.php?id=28040&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V28040" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#28040" class="name">
  <strong class="user"><em>as1 at powersite dot com dot ar</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#28040"> &para;</a><div class="date" title="2002-12-30 01:01"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom28040">
<div class="phpcode"><code><span class="html">If your imap_fetchstructure not retrive all parts, write it:<br /><br />$struct = imap_fetchstructure( $conn, $curMsg );<br /><br />$i = 1;<br />while( imap_fetchbody( $conn, $curMsg, $i ) ){<br />   $struct-&gt;parts[$i-1] = imap_bodystruct( $conn, $curMsg, $i );<br />   $i++;<br />}</span></code></div>
  </div>
 </div>
  <div class="note" id="27396">  <div class="votes">
    <div id="Vu27396">
    <a href="https://www.php.net/manual/vote-note.php?id=27396&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd27396">
    <a href="https://www.php.net/manual/vote-note.php?id=27396&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V27396" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#27396" class="name">
  <strong class="user"><em>paradise at ml75 dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#27396"> &para;</a><div class="date" title="2002-12-04 07:40"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom27396">
<div class="phpcode"><code><span class="html">I'm using freeBSD and had lots of problems with all functions/mail applications i could find on the net...<br /><br />So i'm writing my own now..<br /><br />Most of the stuff works fine now.. but i'm still working on the chooser to select the best part to show. (plain or HTML).<br /><br />The #1 problem is that most functions give the wrong ID numbers beck to fetch the body.<br /><br />Here's a sollution to that problem.. :P<br /><br />// Debug function.. always handy until it's 100% completed..<br />   $attachments = array(); $dispos=0;<br />   $debug=true;<br />   function doDebug($msg){<br />      global $debug, $debug_depth, $dispos;<br />      if($debug){<br />         for($y = 0; $y &lt; $debug_depth; $y++) echo("&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;");<br />         if($dispos == 0) echo($msg."&lt;br/&gt;"); else echo("&lt;i&gt;".$msg."&lt;/i&gt;&lt;br/&gt;");<br />      }<br />   }<br /><br />   function Check_Part($part,$id){<br />      global $attachments, $debug, $debug_depth, $dispos; $ans=sizeof($attachments);<br />      doDebug("+Checking part $id");<br />      $debug_depth++;<br />      doDebug("Parttype=".$part-&gt;type ."/". mimetype($part-&gt;type) ."/". $part-&gt;subtype);<br /><br />      if($part-&gt;ifdisposition){ $dispos++; doDebug("&lt;b&gt;Disposition&lt;/b&gt;"); }<br />      if($part-&gt;ifdescription){ doDebug("&lt;b&gt;Description=".$part-&gt;description."&lt;/b&gt;"); }<br /><br />         switch($part-&gt;type){<br />           case 1: if((strtolower($part-&gt;subtype) == "mixed") <br />                        or (strtolower($part-&gt;subtype)  == "alternative")<br />                        or (strtolower($part-&gt;subtype) == "related")) break;<br /><br />           default: $an = sizeof($attachments);<br />                    if($part-&gt;ifdparameters){<br />                       $dpara = $part-&gt;dparameters;<br />                       for ($v=0;$v&lt;sizeof($dpara);$v++){<br />                          if (eregi("filename", $dpara[$v]-&gt;attribute)) <br />                             $fname = $dpara[$v]-&gt;value;}<br />                    }<br />                    if($part-&gt;ifparameters){<br />                       if(empty($fname)){<br />                          $para = $part-&gt;parameters;<br />                          for ($v=0;$v&lt;sizeof($para);$v++){<br />                             if (eregi("name", $para[$v]-&gt;attribute)) $fname = $para[$v]-&gt;value;<br />                          }<br />                       }<br />                    }<br />                    if(empty($fname))$fname = "Onbekend";<br /><br />                  $attachments[$an]-&gt;id = ($an+1);<br />                  $attachments[$an]-&gt;part = $id;<br />                    $attachments[$an]-&gt;filename = $fname;<br />                   $attachments[$an]-&gt;type=$part-&gt;type;<br />                   $attachments[$an]-&gt;subtype=$part-&gt;subtype;<br />                   $attachments[$an]-&gt;dispos=$dispos;<br />                   $attachments[$an]-&gt;size=$part-&gt;bytes;<br />                  doDebug("Filename=".$attachments[$an]-&gt;filename); break;<br />         }<br /><br />      for($x = 0; $x &lt; count($part-&gt;parts); $x++){<br />         Check_Part($part-&gt;parts[$x], $id.".".($x+1));<br />      }<br />      doDebug("Dit deel had iets nuttigs.");<br />      if($part-&gt;ifdisposition) $dispos--;<br />      $debug_depth--;<br />      doDebug("-End of part $id");<br />   }<br /><br />   function decode_mail($mbox, $msg){<br />      global $attachments, $debug, $debug_depth;<br />      doDebug("+Decoding message $msg"); $debug_depth++;<br />      $obj = imap_fetchstructure($mbox, $msg, FT_UID); $moet_werken=true; $id=1;<br />      while($moet_werken){<br />         Check_Part($obj, $id);<br /><br />         $moet_werken=false;<br />      }<br />      $debug_depth--; doDebug("-End of message $msg");<br />   }<br /><br />Now to get this to work..<br />Decode_Mail([Mailbox connection], [Message Number]);<br /><br />this is the outpu attachment array..<br />1--1.1.1--Onbekend--0--PLAIN--0--31 <br />2--1.1.2--Onbekend--0--HTML--0--29 <br />3--1.2--Beschrijving Nieuw E.doc--3--MSWORD--1--613718 <br />--------------------------------------<br /><br />PS.. "Onbekend" is dutch for "Unknown".<br /><br />Good luck.<br />Paradise (www.ml75.nl)</span></code></div>
  </div>
 </div>
  <div class="note" id="25328">  <div class="votes">
    <div id="Vu25328">
    <a href="https://www.php.net/manual/vote-note.php?id=25328&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd25328">
    <a href="https://www.php.net/manual/vote-note.php?id=25328&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V25328" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#25328" class="name"><strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#25328"> &para;</a><div class="date" title="2002-09-19 03:20"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom25328">
<div class="phpcode"><code><span class="html">This function sets MIME charset <br />parameter value to US-ASCII when<br />either Content-Type header is missing <br />or Content-Type header doesn't have<br />charset parameter. This may be compliant<br />to RFC 822, but this poses<br />a problem for  a calling function that<br />has to deal with untagged messages <br />in MIME charset other than US-ASCII.<br />To work around this,  US-ASCII<br />has to be treated as the absence of MIME charset.</span></code></div>
  </div>
 </div>
  <div class="note" id="3560">  <div class="votes">
    <div id="Vu3560">
    <a href="https://www.php.net/manual/vote-note.php?id=3560&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd3560">
    <a href="https://www.php.net/manual/vote-note.php?id=3560&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V3560" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#3560" class="name">
  <strong class="user"><em>vksgeneric at hotmail dot com</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#3560"> &para;</a><div class="date" title="2000-02-02 05:22"><strong>24 years ago</strong></div>
  <div class="text" id="Hcom3560">
<div class="phpcode"><code><span class="html">It looks like some clients (e.g. outlook) can attach a file that has two mime-types associated with it, like:<br /><br />Content-Type: model/vrml,x-world/x-vrml<br /><br />This bombs the parsing procedure somewhere in c-client, I guess, and as a result ifparameters is set to false for the respective part, and you can not retrieve filename, mimetype, or any other parameters.</span></code></div>
  </div>
 </div>
  <div class="note" id="57054">  <div class="votes">
    <div id="Vu57054">
    <a href="https://www.php.net/manual/vote-note.php?id=57054&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd57054">
    <a href="https://www.php.net/manual/vote-note.php?id=57054&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V57054" title="42% like this...">
    -1
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#57054" class="name">
  <strong class="user"><em>hans at lintoo dot dk</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#57054"> &para;</a><div class="date" title="2005-09-22 06:14"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom57054">
<div class="phpcode"><code><span class="html">A class for searching through a stucture object. <br />You can search matching 1-3 parameters or use the methods included. <br />Feel free to use it, correct it or extend it if you please. Enjoy!<br /><br /><a href="http://lintoo.dk/public/structureengine.class.phps" rel="nofollow" target="_blank">http://lintoo.dk/public/structureengine.class.phps</a><br /><br />The code was too wide for this manual, so I hope the link above will do. Here a quick overview instead:<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">class </span><span class="default">StructureEngine </span><span class="keyword">{<br />    private </span><span class="default">$structureObject</span><span class="keyword">;<br />    public function </span><span class="default">__construct</span><span class="keyword">(</span><span class="default">$structureInfo</span><span class="keyword">) {}<br />    public function </span><span class="default">locatePlain</span><span class="keyword">() {}<br />    public function </span><span class="default">locateHTML</span><span class="keyword">() {}<br />    public function </span><span class="default">locateAttachments</span><span class="keyword">() {}<br />    private function </span><span class="default">checkParam</span><span class="keyword">(</span><span class="default">$part</span><span class="keyword">, </span><span class="default">$type</span><span class="keyword">, </span><span class="default">$value</span><span class="keyword">) {}<br />    private function </span><span class="default">findParts</span><span class="keyword">(</span><span class="default">$partsArray</span><span class="keyword">, </span><span class="default">$prefix</span><span class="keyword">, </span><span class="default">$param1Type </span><span class="keyword">= </span><span class="string">'type'</span><span class="keyword">, </span><span class="default">$param1Value </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">, </span><span class="default">$param2Type </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">, ...) {}<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="112486">  <div class="votes">
    <div id="Vu112486">
    <a href="https://www.php.net/manual/vote-note.php?id=112486&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd112486">
    <a href="https://www.php.net/manual/vote-note.php?id=112486&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V112486" title="37% like this...">
    -4
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#112486" class="name">
  <strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#112486"> &para;</a><div class="date" title="2013-06-20 10:52"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom112486">
<div class="phpcode"><code><span class="html">I improved the code from this post (<br /><a href="http://www.php.net/manual/en/function.imap-fetchstructure.php#51497" rel="nofollow" target="_blank">http://www.php.net/manual/en/function.imap-fetchstructure.php#51497</a>) a bit, now it handles multi embedded email correctly, and gives you a content with not marking character, like the '=' (soft line break).<br /><br /><span class="default">&lt;?php<br /></span><span class="comment">//return is structured as<br />// $mail = array ( 'body' =&gt; ...<br />//          'attachment' =&gt; array() );<br /></span><span class="keyword">function </span><span class="default">_get_body_attach</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$mid</span><span class="keyword">) {<br />    </span><span class="default">$struct </span><span class="keyword">= </span><span class="default">imap_fetchstructure</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$mid</span><span class="keyword">);<br /><br />    </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">$struct</span><span class="keyword">-&gt;</span><span class="default">parts</span><span class="keyword">;<br />    </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />    if (!</span><span class="default">$parts</span><span class="keyword">) { </span><span class="comment">/* Simple message, only 1 piece */<br />        </span><span class="default">$attachment </span><span class="keyword">= array(); </span><span class="comment">/* No attachments */<br />        </span><span class="default">$content </span><span class="keyword">= </span><span class="default">imap_body</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$mid</span><span class="keyword">);<br />    } else { </span><span class="comment">/* Complicated message, multiple parts */<br /><br />        </span><span class="default">$endwhile </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br /><br />        </span><span class="default">$stack </span><span class="keyword">= array(); </span><span class="comment">/* Stack while parsing message */<br />        </span><span class="default">$content </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;    </span><span class="comment">/* Content of message */<br />        </span><span class="default">$attachment </span><span class="keyword">= array(); </span><span class="comment">/* Attachments */<br /><br />        </span><span class="keyword">while (!</span><span class="default">$endwhile</span><span class="keyword">) {<br />            if (!</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]) {<br />                if (</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">) &gt; </span><span class="default">0</span><span class="keyword">) {<br />                    </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">][</span><span class="string">"p"</span><span class="keyword">];<br />                    </span><span class="default">$i     </span><span class="keyword">= </span><span class="default">$stack</span><span class="keyword">[</span><span class="default">count</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">)-</span><span class="default">1</span><span class="keyword">][</span><span class="string">"i"</span><span class="keyword">] + </span><span class="default">1</span><span class="keyword">;<br />                    </span><span class="default">array_pop</span><span class="keyword">(</span><span class="default">$stack</span><span class="keyword">);<br />                } else {<br />                    </span><span class="default">$endwhile </span><span class="keyword">= </span><span class="default">true</span><span class="keyword">;<br />                }<br />            }<br /><br />            if (!</span><span class="default">$endwhile</span><span class="keyword">) {<br />                </span><span class="comment">/* Create message part first (example '1.2.3') */<br />                </span><span class="default">$partstring </span><span class="keyword">= </span><span class="string">""</span><span class="keyword">;<br />                foreach (</span><span class="default">$stack </span><span class="keyword">as </span><span class="default">$s</span><span class="keyword">) {<br />                    </span><span class="default">$partstring </span><span class="keyword">.= (</span><span class="default">$s</span><span class="keyword">[</span><span class="string">"i"</span><span class="keyword">]+</span><span class="default">1</span><span class="keyword">) . </span><span class="string">"."</span><span class="keyword">;<br />                }<br />                </span><span class="default">$partstring </span><span class="keyword">.= (</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">);<br /><br />                if (</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">disposition</span><span class="keyword">) == </span><span class="string">"ATTACHMENT" </span><span class="keyword">|| </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">disposition</span><span class="keyword">) == </span><span class="string">"INLINE"</span><span class="keyword">) { </span><span class="comment">/* Attachment or inline images */<br />                    </span><span class="default">$filedata </span><span class="keyword">= </span><span class="default">imap_fetchbody</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$mid</span><span class="keyword">, </span><span class="default">$partstring</span><span class="keyword">);<br />                    if ( </span><span class="default">$filedata </span><span class="keyword">!= </span><span class="string">'' </span><span class="keyword">) {<br />                        </span><span class="comment">// handles base64 encoding or plain text<br />                        </span><span class="default">$decoded_data </span><span class="keyword">= </span><span class="default">base64_decode</span><span class="keyword">(</span><span class="default">$filedata</span><span class="keyword">);<br />                        if ( </span><span class="default">$decoded_data </span><span class="keyword">== </span><span class="default">false </span><span class="keyword">) {<br />                            </span><span class="default">$attachment</span><span class="keyword">[] = array(</span><span class="string">"filename" </span><span class="keyword">=&gt; </span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">parameters</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-&gt;</span><span class="default">value</span><span class="keyword">,<br />                                </span><span class="string">"filedata" </span><span class="keyword">=&gt; </span><span class="default">$filedata</span><span class="keyword">);<br />                        } else {<br />                            </span><span class="default">$attachment</span><span class="keyword">[] = array(</span><span class="string">"filename" </span><span class="keyword">=&gt; </span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">parameters</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]-&gt;</span><span class="default">value</span><span class="keyword">,<br />                                </span><span class="string">"filedata" </span><span class="keyword">=&gt; </span><span class="default">$decoded_data</span><span class="keyword">);<br />                        }<br />                    }<br />                } elseif (</span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">subtype</span><span class="keyword">) == </span><span class="string">"PLAIN" </span><span class="keyword">&amp;&amp; </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">+</span><span class="default">1</span><span class="keyword">]-&gt;</span><span class="default">subtype</span><span class="keyword">) != </span><span class="string">"HTML"</span><span class="keyword">) { </span><span class="comment">/* plain text message */<br />                    </span><span class="default">$content </span><span class="keyword">.= </span><span class="default">imap_fetchbody</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$mid</span><span class="keyword">, </span><span class="default">$partstring</span><span class="keyword">);<br />                } elseif ( </span><span class="default">strtoupper</span><span class="keyword">(</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">subtype</span><span class="keyword">) == </span><span class="string">"HTML" </span><span class="keyword">) {<br />                    </span><span class="comment">/* HTML message takes priority */<br />                    </span><span class="default">$content </span><span class="keyword">.= </span><span class="default">imap_fetchbody</span><span class="keyword">(</span><span class="default">$mbox</span><span class="keyword">, </span><span class="default">$mid</span><span class="keyword">, </span><span class="default">$partstring</span><span class="keyword">);<br />                }<br />            }<br /><br />            if (</span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">parts</span><span class="keyword">) {<br />                if ( </span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">subtype </span><span class="keyword">!= </span><span class="string">'RELATED' </span><span class="keyword">) {<br />                    </span><span class="comment">// a glitch: embedded email message have one additional stack in the structure with subtype 'RELATED', but this stack is not present when using imap_fetchbody() to fetch parts.<br />                    </span><span class="default">$stack</span><span class="keyword">[] = array(</span><span class="string">"p" </span><span class="keyword">=&gt; </span><span class="default">$parts</span><span class="keyword">, </span><span class="string">"i" </span><span class="keyword">=&gt; </span><span class="default">$i</span><span class="keyword">);<br />                }<br />                </span><span class="default">$parts </span><span class="keyword">= </span><span class="default">$parts</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]-&gt;</span><span class="default">parts</span><span class="keyword">;<br />                </span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;<br />            } else {<br />                </span><span class="default">$i</span><span class="keyword">++;<br />            }<br />        } </span><span class="comment">/* while */<br />    </span><span class="keyword">} </span><span class="comment">/* complicated message */<br /><br />    </span><span class="default">$ret </span><span class="keyword">= array();<br />    </span><span class="default">$ret</span><span class="keyword">[</span><span class="string">'body'</span><span class="keyword">] = </span><span class="default">quoted_printable_decode</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br />    </span><span class="default">$ret</span><span class="keyword">[</span><span class="string">'attachment'</span><span class="keyword">] = </span><span class="default">$attachment</span><span class="keyword">;<br />    return </span><span class="default">$ret</span><span class="keyword">;<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="39420">  <div class="votes">
    <div id="Vu39420">
    <a href="https://www.php.net/manual/vote-note.php?id=39420&amp;page=function.imap-fetchstructure&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd39420">
    <a href="https://www.php.net/manual/vote-note.php?id=39420&amp;page=function.imap-fetchstructure&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V39420" title="33% like this...">
    -1
    </div>
  </div>
  <a href="function.imap-fetchstructure.php.html#39420" class="name">
  <strong class="user"><em>richy at smilingsouls dot net</em></strong></a><a class="genanchor" href="function.imap-fetchstructure.php.html#39420"> &para;</a><div class="date" title="2004-01-28 03:08"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom39420">
<div class="phpcode"><code><span class="html">After many long hours of pouring over the object returned by imap_fetchstructure() I came up with the solution posted at the following url:<br /><br /><a href="http://p2p.wrox.com/topic.asp?TOPIC_ID=9063" rel="nofollow" target="_blank">http://p2p.wrox.com/topic.asp?TOPIC_ID=9063</a><br /><br />The url above provides an example of how to access variables in the object returned by imap_fetchstructure().  This class creates an object with member variables containing the correct part numbers which are compatible with the imap_fetchbody() function.<br /><br />The structure returned looks something like this:<br /><br />                       0 Raw Headers<br />$this-&gt;pid[$mid][0]  =  1 text/plain                        top level message<br />$this-&gt;pid[$mid][1]  =  2 message/rfc822                    entire unparsed message<br />                                                             multipart/mixed - part is skipped!<br />                           2.0 Raw Headers<br />$this-&gt;pid[$mid][2]  =      2.1 multipart/alternative       contains unparsed contents of next subpart (text/plain &amp;&amp; text/html)<br />                                2.1.0 Raw Headers<br />$this-&gt;pid[$mid][3]  =          2.1.1 text/plain            2nd level inline embedded message<br />$this-&gt;pid[$mid][4]  =          2.1.2 text/html<br /><br />$this-&gt;pid[$mid][5]  =      2.2 message/rfc822              entire unparsed message<br />                                                             multipart/mixed - part is skipped!<br />                                2.2.0 Raw Headers<br />$this-&gt;pid[$mid][6]  =          2.2.1 multipart/alternative <br />$this-&gt;pid[$mid][7]  =              2.2.1.1 text/plain      3rd level inline embedded message<br />$this-&gt;pid[$mid][8]  =              2.2.1.2 text/html<br />$this-&gt;pid[$mid][9]  =            2.2.2 image/jpeg<br />$this-&gt;pid[$mid][10] =             2.2.3 image/jpeg<br />$this-&gt;pid[$mid][11] =            2.2.4 image/jpeg<br />$this-&gt;pid[$mid][12] =            2.2.5 image/gif<br /><br />Its important to note why multipart/related, multipart/mixed and certain multipart/alternative (if parent part is message/rfc822 &amp;&amp; not multipart/mixed) parts are skipped, imap_fetchbody **does not** retreive a message part for these parts.  Which isn't a bug, as I have read in other places, these parts exist for the purpose of designing the viewer portion of a mail application.  Also, headers aren't assigned part numbers here because they are easy to pick out.<br /><br />: )<br />Rich</span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=function.imap-fetchstructure&amp;redirect=https://www.php.net/manual/ru/function.imap-fetchstructure.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="ref.imap.php.html">Функции IMAP</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="function.imap-8bit.php.html" title="imap_&#8203;8bit">imap_&#8203;8bit</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-alerts.php.html" title="imap_&#8203;alerts">imap_&#8203;alerts</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-append.php.html" title="imap_&#8203;append">imap_&#8203;append</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-base64.php.html" title="imap_&#8203;base64">imap_&#8203;base64</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-binary.php.html" title="imap_&#8203;binary">imap_&#8203;binary</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-body.php.html" title="imap_&#8203;body">imap_&#8203;body</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-bodystruct.php.html" title="imap_&#8203;bodystruct">imap_&#8203;bodystruct</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-check.php.html" title="imap_&#8203;check">imap_&#8203;check</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-clearflag-full.php.html" title="imap_&#8203;clearflag_&#8203;full">imap_&#8203;clearflag_&#8203;full</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-close.php.html" title="imap_&#8203;close">imap_&#8203;close</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-create.php.html" title="imap_&#8203;create">imap_&#8203;create</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-createmailbox.php.html" title="imap_&#8203;createmailbox">imap_&#8203;createmailbox</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-delete.php.html" title="imap_&#8203;delete">imap_&#8203;delete</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-deletemailbox.php.html" title="imap_&#8203;deletemailbox">imap_&#8203;deletemailbox</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-errors.php.html" title="imap_&#8203;errors">imap_&#8203;errors</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-expunge.php.html" title="imap_&#8203;expunge">imap_&#8203;expunge</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-fetch-overview.php.html" title="imap_&#8203;fetch_&#8203;overview">imap_&#8203;fetch_&#8203;overview</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-fetchbody.php.html" title="imap_&#8203;fetchbody">imap_&#8203;fetchbody</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-fetchheader.php.html" title="imap_&#8203;fetchheader">imap_&#8203;fetchheader</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-fetchmime.php.html" title="imap_&#8203;fetchmime">imap_&#8203;fetchmime</a>
                        </li>
                                                <li class="current">
                            <a href="function.imap-fetchstructure.php.html" title="imap_&#8203;fetchstructure">imap_&#8203;fetchstructure</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-fetchtext.php.html" title="imap_&#8203;fetchtext">imap_&#8203;fetchtext</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-gc.php.html" title="imap_&#8203;gc">imap_&#8203;gc</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-get-quota.php.html" title="imap_&#8203;get_&#8203;quota">imap_&#8203;get_&#8203;quota</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-get-quotaroot.php.html" title="imap_&#8203;get_&#8203;quotaroot">imap_&#8203;get_&#8203;quotaroot</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-getacl.php.html" title="imap_&#8203;getacl">imap_&#8203;getacl</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-getmailboxes.php.html" title="imap_&#8203;getmailboxes">imap_&#8203;getmailboxes</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-getsubscribed.php.html" title="imap_&#8203;getsubscribed">imap_&#8203;getsubscribed</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-header.php.html" title="imap_&#8203;header">imap_&#8203;header</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-headerinfo.php.html" title="imap_&#8203;headerinfo">imap_&#8203;headerinfo</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-headers.php.html" title="imap_&#8203;headers">imap_&#8203;headers</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-is-open.php.html" title="imap_&#8203;is_&#8203;open">imap_&#8203;is_&#8203;open</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-last-error.php.html" title="imap_&#8203;last_&#8203;error">imap_&#8203;last_&#8203;error</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-list.php.html" title="imap_&#8203;list">imap_&#8203;list</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-listmailbox.php.html" title="imap_&#8203;listmailbox">imap_&#8203;listmailbox</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-listscan.php.html" title="imap_&#8203;listscan">imap_&#8203;listscan</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-listsubscribed.php.html" title="imap_&#8203;listsubscribed">imap_&#8203;listsubscribed</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-lsub.php.html" title="imap_&#8203;lsub">imap_&#8203;lsub</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mail-compose.php.html" title="imap_&#8203;mail_&#8203;compose">imap_&#8203;mail_&#8203;compose</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mail-copy.php.html" title="imap_&#8203;mail_&#8203;copy">imap_&#8203;mail_&#8203;copy</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mail-move.php.html" title="imap_&#8203;mail_&#8203;move">imap_&#8203;mail_&#8203;move</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mail.php.html" title="imap_&#8203;mail">imap_&#8203;mail</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mailboxmsginfo.php.html" title="imap_&#8203;mailboxmsginfo">imap_&#8203;mailboxmsginfo</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mime-header-decode.php.html" title="imap_&#8203;mime_&#8203;header_&#8203;decode">imap_&#8203;mime_&#8203;header_&#8203;decode</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-msgno.php.html" title="imap_&#8203;msgno">imap_&#8203;msgno</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-mutf7-to-utf8.php.html" title="imap_&#8203;mutf7_&#8203;to_&#8203;utf8">imap_&#8203;mutf7_&#8203;to_&#8203;utf8</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-num-msg.php.html" title="imap_&#8203;num_&#8203;msg">imap_&#8203;num_&#8203;msg</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-num-recent.php.html" title="imap_&#8203;num_&#8203;recent">imap_&#8203;num_&#8203;recent</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-open.php.html" title="imap_&#8203;open">imap_&#8203;open</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-ping.php.html" title="imap_&#8203;ping">imap_&#8203;ping</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-qprint.php.html" title="imap_&#8203;qprint">imap_&#8203;qprint</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-rename.php.html" title="imap_&#8203;rename">imap_&#8203;rename</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-renamemailbox.php.html" title="imap_&#8203;renamemailbox">imap_&#8203;renamemailbox</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-reopen.php.html" title="imap_&#8203;reopen">imap_&#8203;reopen</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-rfc822-parse-adrlist.php.html" title="imap_&#8203;rfc822_&#8203;parse_&#8203;adrlist">imap_&#8203;rfc822_&#8203;parse_&#8203;adrlist</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-rfc822-parse-headers.php.html" title="imap_&#8203;rfc822_&#8203;parse_&#8203;headers">imap_&#8203;rfc822_&#8203;parse_&#8203;headers</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-rfc822-write-address.php.html" title="imap_&#8203;rfc822_&#8203;write_&#8203;address">imap_&#8203;rfc822_&#8203;write_&#8203;address</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-savebody.php.html" title="imap_&#8203;savebody">imap_&#8203;savebody</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-scan.php.html" title="imap_&#8203;scan">imap_&#8203;scan</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-scanmailbox.php.html" title="imap_&#8203;scanmailbox">imap_&#8203;scanmailbox</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-search.php.html" title="imap_&#8203;search">imap_&#8203;search</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-set-quota.php.html" title="imap_&#8203;set_&#8203;quota">imap_&#8203;set_&#8203;quota</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-setacl.php.html" title="imap_&#8203;setacl">imap_&#8203;setacl</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-setflag-full.php.html" title="imap_&#8203;setflag_&#8203;full">imap_&#8203;setflag_&#8203;full</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-sort.php.html" title="imap_&#8203;sort">imap_&#8203;sort</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-status.php.html" title="imap_&#8203;status">imap_&#8203;status</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-subscribe.php.html" title="imap_&#8203;subscribe">imap_&#8203;subscribe</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-thread.php.html" title="imap_&#8203;thread">imap_&#8203;thread</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-timeout.php.html" title="imap_&#8203;timeout">imap_&#8203;timeout</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-uid.php.html" title="imap_&#8203;uid">imap_&#8203;uid</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-undelete.php.html" title="imap_&#8203;undelete">imap_&#8203;undelete</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-unsubscribe.php.html" title="imap_&#8203;unsubscribe">imap_&#8203;unsubscribe</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-utf7-decode.php.html" title="imap_&#8203;utf7_&#8203;decode">imap_&#8203;utf7_&#8203;decode</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-utf7-encode.php.html" title="imap_&#8203;utf7_&#8203;encode">imap_&#8203;utf7_&#8203;encode</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-utf8-to-mutf7.php.html" title="imap_&#8203;utf8_&#8203;to_&#8203;mutf7">imap_&#8203;utf8_&#8203;to_&#8203;mutf7</a>
                        </li>
                                                <li class="">
                            <a href="function.imap-utf8.php.html" title="imap_&#8203;utf8">imap_&#8203;utf8</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
