<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: ldap_search - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.ldap-search.php.html">
 <link rel="shorturl" href="https://www.php.net/ldap-search">
 <link rel="alternate" href="https://www.php.net/ldap-search" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="ref.ldap.php.html">
 <link rel="prev" href="function.ldap-sasl-bind.php.html">
 <link rel="next" href="function.ldap-set-option.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/function.ldap-search.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/function.ldap-search.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/function.ldap-search.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.ldap-search.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/function.ldap-search.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.ldap-search.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.ldap-search.php" hreflang="pt_BR">
 <link rel="alternate" href="function.ldap-search.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.ldap-search.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.ldap-search.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="function.ldap-set-option.php.html">
          ldap_set_option &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="function.ldap-sasl-bind.php.html">
          &laquo; ldap_sasl_bind        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='funcref.php.html'>Справочник функций</a></li>      <li><a href='refs.remote.other.php.html'>Другие службы</a></li>      <li><a href='book.ldap.php.html'>LDAP</a></li>      <li><a href='ref.ldap.php.html'>Функции LDAP</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/function.ldap-search.php'>English</option>
            <option value='de/function.ldap-search.php'>German</option>
            <option value='es/function.ldap-search.php'>Spanish</option>
            <option value='fr/function.ldap-search.php'>French</option>
            <option value='it/function.ldap-search.php'>Italian</option>
            <option value='ja/function.ldap-search.php'>Japanese</option>
            <option value='pt_BR/function.ldap-search.php'>Brazilian Portuguese</option>
            <option value='ru/function.ldap-search.php' selected="selected">Russian</option>
            <option value='tr/function.ldap-search.php'>Turkish</option>
            <option value='zh/function.ldap-search.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/reference/ldap/functions/ldap-search.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Ffunction.ldap-search%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="function.ldap-search" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ldap_search</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">ldap_search</span> &mdash; <span class="dc-title">Поиск по LDAP дереву</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.ldap-search-description">
  <h3 class="title">Описание</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>ldap_search</strong></span>(<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><span class="type"><a href="class.ldap-connection.php.html" class="type LDAP\Connection">LDAP\Connection</a></span>|<span class="type">array</span></span> <code class="parameter">$ldap</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><span class="type">array</span>|<span class="type">string</span></span> <code class="parameter">$base</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type"><span class="type">array</span>|<span class="type">string</span></span> <code class="parameter">$filter</code></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">array</span> <code class="parameter">$attributes</code><span class="initializer"> = []</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$attributes_only</code><span class="initializer"> = 0</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$sizelimit</code><span class="initializer"> = -1</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$timelimit</code><span class="initializer"> = -1</span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">int</span> <code class="parameter">$deref</code><span class="initializer"> = <strong><code>LDAP_DEREF_NEVER</code></strong></span></span>,<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="methodparam"><span class="type">?</span><span class="type"><span class="type">array</span><span class="type"></span></span> <code class="parameter">$controls</code><span class="initializer"> = <strong><code>null</code></strong></span></span><br>): <span class="type"><span class="type"><a href="class.ldap-result.php.html" class="type LDAP\Result">LDAP\Result</a></span>|<span class="type">array</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   Выполняет поиск для указанного фильтра в директории с границами
   <strong><code>LDAP_SCOPE_SUBTREE</code></strong>. Эквивалентно поиску по всему каталогу.
  </p>
  <p class="para">Также можно выполнять параллельный поиск. В этом случае первым аргументом должен быть массив
экземпляров <span class="classname"><a href="class.ldap-connection.php.html" class="classname">LDAP\Connection</a></span>, а не один экземпляр.
Если поиск не должен использовать один и тот же базовый DN и фильтр, в качестве аргументов можно передать массив базовых DN и/или массив фильтров.
Количество элементов в массивах должно совпадать с количеством экземпляров <span class="classname"><a href="class.ldap-connection.php.html" class="classname">LDAP\Connection</a></span>,
поскольку первые записи массивов используются для одного поиска, вторые — для другого и так далее.
При параллельном поиске возвращается массив экземпляров <span class="classname"><a href="class.ldap-result.php.html" class="classname">LDAP\Result</a></span>, за исключением возникновения ошибки, когда возвращается значение <strong><code>false</code></strong>.</p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ldap-search-parameters">
  <h3 class="title">Список параметров</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">ldap</code></dt>

     <dd>

      <p class="para">
       Экземпляр <span class="classname"><a href="class.ldap-connection.php.html" class="classname">LDAP\Connection</a></span>,
который возвращает функция <span class="function"><a href="function.ldap-connect.php.html" class="function">ldap_connect()</a></span>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">base</code></dt>

     <dd>

      <p class="para">
       Базовое DN для каталога.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">filter</code></dt>

     <dd>

      <p class="para">
       Поисковый фильтр может быть простым или расширенным, используя логические
       операторы в формате, описанном в документации LDAP
       (смотрите <a href="https://wiki.mozilla.org/Mozilla_LDAP_SDK_Programmer%27s_Guide/Searching_the_Directory_With_LDAP_C_SDK" class="link external">&raquo;&nbsp;Netscape Directory SDK</a> или
       <a href="http://www.faqs.org/rfcs/rfc4515" class="link external">&raquo;&nbsp;RFC4515</a> для полной информации о фильтрах).
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">attributes</code></dt>

     <dd>

      <p class="para">
       Массив необходимых атрибутов, например, <code class="literal">array(&quot;mail&quot;, &quot;sn&quot;, &quot;cn&quot;)</code>.
       Обратите внимание, что &quot;dn&quot; всегда возвращается, независимо от того,
       какие типы атрибутов требуются.
      </p>
      <p class="para">
       Использование этого параметра намного более эффективно, чем действие по умолчанию
       (которое должно возвратить все атрибуты и присвоенные им значения).
       Поэтому использование этого параметра считается хорошей практикой.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">attributes_only</code></dt>

     <dd>

      <p class="para">
       Должен быть равен 1, если требуются только типы атрибута.
       Если равен 0, то, по умолчанию, выбираются и типы атрибутов и значения.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">sizelimit</code></dt>

     <dd>

      <p class="para">
       Позволяет ограничить количество выбранных записей. Установка этого параметра
       равным 0 означает, что ограничение отсутствует.
      </p>
      <blockquote class="note"><p><strong class="note">Замечание</strong>: 
       <p class="para">
        Этот параметр НЕ может переопределять предустановку sizelimit на стороне
        сервера. Хотя его можно установить ниже.
       </p>
       <p class="para">
        Некоторые хосты серверов каталогов будут сконфигурированы так, чтобы
        возвратить не больше, чем предварительно установленное число записей.
        Если это произойдёт, то сервер укажет, что возвратил только частичный набор
        результатов. Это также происходит, если Вы используете этот параметр чтобы
        ограничить количество выбранных записей.
       </p>
      </p></blockquote>
     </dd>

    
    
     <dt>
<code class="parameter">timelimit</code></dt>

     <dd>

      <p class="para">
       Устанавливает число секунд, ограничивающее процесс поиска. Установка этого
       параметра равным 0 означает, что ограничение отсутствует.
      </p>
      <blockquote class="note"><p><strong class="note">Замечание</strong>: 
       <p class="para">
        Этот параметр НЕ может переопределять предустановку timelimit на стороне
        сервера. Хотя его можно установить ниже.
       </p>
      </p></blockquote>
     </dd>

    
    
     <dt>
<code class="parameter">deref</code></dt>

     <dd>

      <p class="para">
       Определяет как псевдонимы должны быть обработаны во время поиска. Может быть
       одним из следующих:
       <ul class="itemizedlist">
        <li class="listitem">
         <span class="simpara">
          <strong><code>LDAP_DEREF_NEVER</code></strong> - (по умолчанию) псевдонимы никогда не разыменовываются.
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          <strong><code>LDAP_DEREF_SEARCHING</code></strong> - псевдонимы должны быть разыменованы во время поиска,
          но не при определении местоположения базового объекта поиска.
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          <strong><code>LDAP_DEREF_FINDING</code></strong> - псевдонимы должны быть разыменованы
          при определении местоположения базового объекта, но не во время поиска.
         </span>
        </li>
        <li class="listitem">
         <span class="simpara">
          <strong><code>LDAP_DEREF_ALWAYS</code></strong> - псевдонимы должны разыменовываться всегда.
         </span>
        </li>
       </ul>
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">controls</code></dt>

     <dd>

      <p class="para">
       Массив <a href="ldap.controls.php.html" class="link">управляющих констант LDAP</a> для отправки в запросе.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ldap-search-returnvalues">
  <h3 class="title">Возвращаемые значения</h3>
  <p class="para">
   Возвращает экземпляр <span class="classname"><a href="class.ldap-result.php.html" class="classname">LDAP\Result</a></span>, массив экземпляров <span class="classname"><a href="class.ldap-result.php.html" class="classname">LDAP\Result</a></span> или <strong><code>false</code></strong> в случае возникновения ошибки.
  </p>
 </div>


 <div class="refsect1 changelog" id="refsect1-function.ldap-search-changelog">
  <h3 class="title">Список изменений</h3>
  <p class="para">
   <table class="doctable informaltable">
    
     <thead>
      <tr>
       <th>Версия</th>
       <th>Описание</th>
      </tr>

     </thead>

     <tbody class="tbody">
      <tr>
 <td>8.1.0</td>
 <td>
  Параметр <code class="parameter">ldap</code> теперь ожидает экземпляр <span class="classname"><a href="class.ldap-connection.php.html" class="classname">LDAP\Connection</a></span>;
  ранее ожидался ресурс (<a href="language.types.resource.php.html" class="link">resource</a>) <code class="literal">ldap link</code> .
 </td>
</tr>

      <tr>
 <td>8.1.0</td>
 <td>
  Возвращает экземпляр <span class="classname"><a href="class.ldap-result.php.html" class="classname">LDAP\Result</a></span>;
  ранее возвращался ресурс (<a href="language.types.resource.php.html" class="link">resource</a>).
 </td>
</tr>

      <tr>
 <td>8.0.0</td>
 <td>
  <code class="parameter">controls</code> теперь допускает значение null; ранее значение по умолчанию было <code class="literal">[]</code>.
 </td>
</tr>

      <tr>
       <td>7.3.0</td>
       <td>
        Добавлена поддержка параметра <code class="parameter">controls</code>
       </td>
      </tr>

     </tbody>
    
   </table>

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ldap-search-examples">
  <h3 class="title">Примеры</h3>
  <p class="para">
   Пример ниже получает организационную единицу, фамилию, имя и адрес
   электронной почты для всех людей в &quot;My Company&quot;, где фамилия или имя содержат
   подстроку <var class="varname">$person</var>. Этот пример использует логический фильтр,
   чтобы сказать серверу, что нужно искать информацию больше, чем в одном атрибуте.
   <div class="example" id="">
    <p><strong>Пример #1 LDAP поиск</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">// $ds допустимый экземпляр LDAP\Connection<br /><br />// $person всё или часть имени человека, н-р "Jo"<br /><br /></span><span style="color: #0000BB">$dn </span><span style="color: #007700">= </span><span style="color: #DD0000">"o=My Company, c=US"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$filter</span><span style="color: #007700">=</span><span style="color: #DD0000">"(|(sn=</span><span style="color: #0000BB">$person</span><span style="color: #DD0000">*)(givenname=</span><span style="color: #0000BB">$person</span><span style="color: #DD0000">*))"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$justthese </span><span style="color: #007700">= array(</span><span style="color: #DD0000">"ou"</span><span style="color: #007700">, </span><span style="color: #DD0000">"sn"</span><span style="color: #007700">, </span><span style="color: #DD0000">"givenname"</span><span style="color: #007700">, </span><span style="color: #DD0000">"mail"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$sr</span><span style="color: #007700">=</span><span style="color: #0000BB">ldap_search</span><span style="color: #007700">(</span><span style="color: #0000BB">$ds</span><span style="color: #007700">, </span><span style="color: #0000BB">$dn</span><span style="color: #007700">, </span><span style="color: #0000BB">$filter</span><span style="color: #007700">, </span><span style="color: #0000BB">$justthese</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$info </span><span style="color: #007700">= </span><span style="color: #0000BB">ldap_get_entries</span><span style="color: #007700">(</span><span style="color: #0000BB">$ds</span><span style="color: #007700">, </span><span style="color: #0000BB">$sr</span><span style="color: #007700">);<br /><br />echo </span><span style="color: #0000BB">$info</span><span style="color: #007700">[</span><span style="color: #DD0000">"count"</span><span style="color: #007700">].</span><span style="color: #DD0000">" записей возвращено\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
  </p>
 </div>


</div><section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=function.ldap-search&amp;redirect=https://www.php.net/manual/ru/function.ldap-search.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">34 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="28593">  <div class="votes">
    <div id="Vu28593">
    <a href="https://www.php.net/manual/vote-note.php?id=28593&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd28593">
    <a href="https://www.php.net/manual/vote-note.php?id=28593&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V28593" title="70% like this...">
    13
    </div>
  </div>
  <a href="function.ldap-search.php.html#28593" class="name">
  <strong class="user"><em>nick dot veitch at futurenet dot co dot</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#28593"> &para;</a><div class="date" title="2003-01-17 08:59"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom28593">
<div class="phpcode"><code><span class="html">It might be useful to list here the operators that work:<br /><br />=         - matches exact value<br />=*xxx  - matches values ending xxx<br />=xxx*  - matches values beginning xxx<br />=*xxx* - matches values containing xxx<br />=*       - matches all values (if set - NULLS are not returned)<br /><br />&gt;=xxx  - matches everthing from xxx to end of directory<br />&lt;=xxx  - matches everything up to xxx in directory<br /><br />~=xxx      - matches similar entries (not all systems)<br /><br />Boolean operators for constructing complex search<br /><br />&amp;(term1)(term2)  - matches term1 AND term2<br />| (term1)(term2)  - matches term1 OR term2<br />!(term1)                 - matches NOT term1<br />&amp;(|(term1)(term2))(!(&amp;(term1)(term2)) - matches XOR term1 term2<br /><br />some of the more compelx constructions seem to work with varying  degrees of efficiency - sometimes it can be better to filter some of the results with the search and do further filtering in PHP.</span></code></div>
  </div>
 </div>
  <div class="note" id="112191">  <div class="votes">
    <div id="Vu112191">
    <a href="https://www.php.net/manual/vote-note.php?id=112191&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd112191">
    <a href="https://www.php.net/manual/vote-note.php?id=112191&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V112191" title="56% like this...">
    18
    </div>
  </div>
  <a href="function.ldap-search.php.html#112191" class="name">
  <strong class="user"><em>jayleno at yahoo dot com</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#112191"> &para;</a><div class="date" title="2013-05-15 06:28"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom112191">
<div class="phpcode"><code><span class="html"><span class="default">&lt;?php<br />set_time_limit</span><span class="keyword">(</span><span class="default">30</span><span class="keyword">);<br /></span><span class="default">error_reporting</span><span class="keyword">(</span><span class="default">E_ALL</span><span class="keyword">);<br /></span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'error_reporting'</span><span class="keyword">, </span><span class="default">E_ALL</span><span class="keyword">);<br /></span><span class="default">ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">);<br /><br /></span><span class="comment">// config<br /></span><span class="default">$ldapserver </span><span class="keyword">= </span><span class="string">'svr.domain.com'</span><span class="keyword">;<br /></span><span class="default">$ldapuser      </span><span class="keyword">= </span><span class="string">'administrator'</span><span class="keyword">;  <br /></span><span class="default">$ldappass     </span><span class="keyword">= </span><span class="string">'PASSWORD_HERE'</span><span class="keyword">;<br /></span><span class="default">$ldaptree    </span><span class="keyword">= </span><span class="string">"OU=SBSUsers,OU=Users,OU=MyBusiness,DC=myDomain,DC=local"</span><span class="keyword">;<br /><br /></span><span class="comment">// connect <br /></span><span class="default">$ldapconn </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$ldapserver</span><span class="keyword">) or die(</span><span class="string">"Could not connect to LDAP server."</span><span class="keyword">);<br /><br />if(</span><span class="default">$ldapconn</span><span class="keyword">) {<br />    </span><span class="comment">// binding to ldap server<br />    </span><span class="default">$ldapbind </span><span class="keyword">= </span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">$ldapuser</span><span class="keyword">, </span><span class="default">$ldappass</span><span class="keyword">) or die (</span><span class="string">"Error trying to bind: "</span><span class="keyword">.</span><span class="default">ldap_error</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">));<br />    </span><span class="comment">// verify binding<br />    </span><span class="keyword">if (</span><span class="default">$ldapbind</span><span class="keyword">) {<br />        echo </span><span class="string">"LDAP bind successful...&lt;br /&gt;&lt;br /&gt;"</span><span class="keyword">;<br />        <br />        <br />        </span><span class="default">$result </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">,</span><span class="default">$ldaptree</span><span class="keyword">, </span><span class="string">"(cn=*)"</span><span class="keyword">) or die (</span><span class="string">"Error in search query: "</span><span class="keyword">.</span><span class="default">ldap_error</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">));<br />        </span><span class="default">$data </span><span class="keyword">= </span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">$result</span><span class="keyword">);<br />        <br />        </span><span class="comment">// SHOW ALL DATA<br />        </span><span class="keyword">echo </span><span class="string">'&lt;h1&gt;Dump all data&lt;/h1&gt;&lt;pre&gt;'</span><span class="keyword">;<br />        </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">);    <br />        echo </span><span class="string">'&lt;/pre&gt;'</span><span class="keyword">;<br />        <br />        <br />        </span><span class="comment">// iterate over array and print data for each entry<br />        </span><span class="keyword">echo </span><span class="string">'&lt;h1&gt;Show me the users&lt;/h1&gt;'</span><span class="keyword">;<br />        for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">$data</span><span class="keyword">[</span><span class="string">"count"</span><span class="keyword">]; </span><span class="default">$i</span><span class="keyword">++) {<br />            </span><span class="comment">//echo "dn is: ". $data[$i]["dn"] ."&lt;br /&gt;";<br />            </span><span class="keyword">echo </span><span class="string">"User: "</span><span class="keyword">. </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">"cn"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] .</span><span class="string">"&lt;br /&gt;"</span><span class="keyword">;<br />            if(isset(</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">"mail"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">])) {<br />                echo </span><span class="string">"Email: "</span><span class="keyword">. </span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">"mail"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] .</span><span class="string">"&lt;br /&gt;&lt;br /&gt;"</span><span class="keyword">;<br />            } else {<br />                echo </span><span class="string">"Email: None&lt;br /&gt;&lt;br /&gt;"</span><span class="keyword">;<br />            }<br />        }<br />        </span><span class="comment">// print number of entries found<br />        </span><span class="keyword">echo </span><span class="string">"Number of entries found: " </span><span class="keyword">. </span><span class="default">ldap_count_entries</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">$result</span><span class="keyword">);<br />    } else {<br />        echo </span><span class="string">"LDAP bind failed..."</span><span class="keyword">;<br />    }<br /><br />}<br /><br /></span><span class="comment">// all done? clean up<br /></span><span class="default">ldap_close</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">);<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="2376">  <div class="votes">
    <div id="Vu2376">
    <a href="https://www.php.net/manual/vote-note.php?id=2376&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd2376">
    <a href="https://www.php.net/manual/vote-note.php?id=2376&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V2376" title="76% like this...">
    7
    </div>
  </div>
  <a href="function.ldap-search.php.html#2376" class="name">
  <strong class="user"><em>aa529 at nospamchebucto dot ns dot ca</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#2376"> &para;</a><div class="date" title="1999-11-22 01:27"><strong>24 years ago</strong></div>
  <div class="text" id="Hcom2376">
<div class="phpcode"><code><span class="html">Be careful of special characters when generating filters from user input.<br /><br />*, (, ), \ and NUL should be backslash-escaped. See section 4 of RFC 2254 (I found it here:<br /><a href="http://www.cis.ohio-state.edu/htbin/rfc/rfc2254.html" rel="nofollow" target="_blank">http://www.cis.ohio-state.edu/htbin/rfc/rfc2254.html</a>)</span></code></div>
  </div>
 </div>
  <div class="note" id="124653">  <div class="votes">
    <div id="Vu124653">
    <a href="https://www.php.net/manual/vote-note.php?id=124653&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd124653">
    <a href="https://www.php.net/manual/vote-note.php?id=124653&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V124653" title="75% like this...">
    2
    </div>
  </div>
  <a href="function.ldap-search.php.html#124653" class="name">
  <strong class="user"><em>steven_bauman at outlook dot com</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#124653"> &para;</a><div class="date" title="2020-01-27 03:39"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom124653">
<div class="phpcode"><code><span class="html">Can an example using the new $serverctrls parameter please be added? I have no idea how to use this.</span></code></div>
  </div>
 </div>
  <div class="note" id="103918">  <div class="votes">
    <div id="Vu103918">
    <a href="https://www.php.net/manual/vote-note.php?id=103918&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd103918">
    <a href="https://www.php.net/manual/vote-note.php?id=103918&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V103918" title="68% like this...">
    6
    </div>
  </div>
  <a href="function.ldap-search.php.html#103918" class="name">
  <strong class="user"><em>Arnold</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#103918"> &para;</a><div class="date" title="2011-05-11 01:35"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom103918">
<div class="phpcode"><code><span class="html">I have been working on a script where I needed to get all the users who were member of a specific MS AD group. Because of PHP bug #42060 ( <a href="http://bugs.php.net/bug.php?id=42060" rel="nofollow" target="_blank">http://bugs.php.net/bug.php?id=42060</a> ) I could not get all the users back who were member of the group.<br />After googling for a day I found an article and a patch but it required that I downloaded the source code for php 5.1.6 or 5.2.10 run the patch and than recompile the code to fix the problem. <br />Problem was <br />1) I am not a Linux goeroe so I was not very comfortable doing this....<br />2) I am running the script on a production machine with other code using PHP and did not know what the consequence would bee for that code.<br />3) I could not update PHP anymore because in newer versions this patch would probably not work any more.<br /><br />But yesterday I saw the light and wrote some code to get around this problem, maybe other people can use it that have the same problem.<br /><br /><span class="default">&lt;?PHP<br />$startFilter        </span><span class="keyword">= </span><span class="string">"(&amp;(memberOf=" </span><span class="keyword">.</span><span class="default">$ADGroup</span><span class="keyword">. </span><span class="string">"))"</span><span class="keyword">;<br /></span><span class="default">$startResults        </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$ldapconnect</span><span class="keyword">, </span><span class="default">$userBase</span><span class="keyword">, </span><span class="default">$startFilter</span><span class="keyword">, </span><span class="default">$attr</span><span class="keyword">);<br /></span><span class="default">$countResult        </span><span class="keyword">= </span><span class="default">ldap_count_entries</span><span class="keyword">(</span><span class="default">$ldapconnect</span><span class="keyword">,</span><span class="default">$startResults</span><span class="keyword">);<br /><br />IF(</span><span class="default">$countResult </span><span class="keyword">== </span><span class="default">1000 </span><span class="keyword">OR </span><span class="default">$countResult </span><span class="keyword">== </span><span class="default">1500</span><span class="keyword">)<br />{<br />    </span><span class="comment">// loop trough the number 97-122 (ASCII number for the characters a-z)<br />    </span><span class="keyword">For(</span><span class="default">$a</span><span class="keyword">=</span><span class="default">97</span><span class="keyword">;</span><span class="default">$a</span><span class="keyword">&lt;=</span><span class="default">122</span><span class="keyword">;</span><span class="default">$a</span><span class="keyword">++)<br />    {<br />        </span><span class="comment">// translate the number to a character<br />        </span><span class="default">$character            </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$a</span><span class="keyword">); <br />        </span><span class="comment">// the new search filter withs returns all users with a last name starting with $character<br />        </span><span class="default">$filter            </span><span class="keyword">= </span><span class="string">"(&amp;(sn=</span><span class="default">$character</span><span class="string">*)(memberOf=</span><span class="default">$ADGroup</span><span class="string">))"</span><span class="keyword">; <br />        </span><span class="default">$results        </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$ldapconnect</span><span class="keyword">, </span><span class="default">$userBase</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">, </span><span class="default">$attr</span><span class="keyword">);<br />        </span><span class="default">$countResult2    </span><span class="keyword">= </span><span class="default">ldap_count_entries</span><span class="keyword">(</span><span class="default">$ldapconnect</span><span class="keyword">,</span><span class="default">$results</span><span class="keyword">);<br />            <br />        </span><span class="comment">// See if the search for all users starting with a specific character still hits the search limit<br />        // if so than do a new search to find all the users where the last name starts with "aa" and <br />        // than with "ab", "ac" etc. etc<br />        // In the best case we can now find 675.324 users per group when the search limit is 1000<br />        // ((26 * 999  for the fist character) * 26 for the second character)<br />        // and 1.013.324 when the search limit is 1500<br />        </span><span class="keyword">If(</span><span class="default">$countResult2 </span><span class="keyword">== </span><span class="default">1000 </span><span class="keyword">or </span><span class="default">$countResult2 </span><span class="keyword">== </span><span class="default">1500</span><span class="keyword">)<br />        {<br />            For(</span><span class="default">$b</span><span class="keyword">=</span><span class="default">97</span><span class="keyword">;</span><span class="default">$b</span><span class="keyword">&lt;=</span><span class="default">122</span><span class="keyword">;</span><span class="default">$b</span><span class="keyword">++)<br />            {<br />                </span><span class="default">$character2    </span><span class="keyword">= </span><span class="default">chr</span><span class="keyword">(</span><span class="default">$b</span><span class="keyword">);<br />                </span><span class="default">$filter2    </span><span class="keyword">= </span><span class="string">"(&amp;(sn=</span><span class="default">$character$character2</span><span class="string">*)(memberOf=</span><span class="default">$ADGroup</span><span class="string">))"</span><span class="keyword">;<br />                </span><span class="default">$results2    </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$ldapconnect</span><span class="keyword">, </span><span class="default">$userBase</span><span class="keyword">, </span><span class="default">$filter2</span><span class="keyword">, </span><span class="default">$attr</span><span class="keyword">);<br />                </span><span class="default">$count2        </span><span class="keyword">= </span><span class="default">ldap_count_entries</span><span class="keyword">(</span><span class="default">$ldapconnect</span><span class="keyword">,</span><span class="default">$results2</span><span class="keyword">);    <br />                </span><span class="default">$entries2    </span><span class="keyword">= </span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$ldapconnect</span><span class="keyword">,</span><span class="default">$results2</span><span class="keyword">);                        <br />                <br />                </span><span class="comment">// do your thing<br />            </span><span class="keyword">}<br />        }<br />        Else<br />        {<br />            </span><span class="default">$entries            </span><span class="keyword">= </span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$ldapconnect</span><span class="keyword">,</span><span class="default">$results</span><span class="keyword">);<br />            </span><span class="comment">// do your thing<br />        </span><span class="keyword">}<br />    }<br />}<br />else<br />{<br />    </span><span class="default">$entries            </span><span class="keyword">= </span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$ldapconnect</span><span class="keyword">,</span><span class="default">$startResults</span><span class="keyword">);<br />    </span><span class="comment">// do your thing<br /></span><span class="keyword">}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="56320">  <div class="votes">
    <div id="Vu56320">
    <a href="https://www.php.net/manual/vote-note.php?id=56320&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd56320">
    <a href="https://www.php.net/manual/vote-note.php?id=56320&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V56320" title="70% like this...">
    4
    </div>
  </div>
  <a href="function.ldap-search.php.html#56320" class="name">
  <strong class="user"><em>cruzfern at chuchuwa dot com dot ar</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#56320"> &para;</a><div class="date" title="2005-08-30 09:14"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom56320">
<div class="phpcode"><code><span class="html">The internal attributes (like createTimestamp, modifyTimestamp, etc), don't come by default (when the optional parameter attributes is not set). You have to specify it:<br /><br />&lt;?<br />$r=ldap_search($ds,$base,$filter,array("createTimestamp"));<br />?&gt;</span></code></div>
  </div>
 </div>
  <div class="note" id="76982">  <div class="votes">
    <div id="Vu76982">
    <a href="https://www.php.net/manual/vote-note.php?id=76982&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd76982">
    <a href="https://www.php.net/manual/vote-note.php?id=76982&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V76982" title="60% like this...">
    8
    </div>
  </div>
  <a href="function.ldap-search.php.html#76982" class="name">
  <strong class="user"><em>chrisbloom7 at gmail dot com</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#76982"> &para;</a><div class="date" title="2007-08-08 01:18"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom76982">
<div class="phpcode"><code><span class="html">Here are a couple of resources for proper construction of filters. <br /><br /><a href="http://msdn2.microsoft.com/En-US/library/aa746475.aspx" rel="nofollow" target="_blank">http://msdn2.microsoft.com/En-US/library/aa746475.aspx</a><br /><br /><a href="http://technet.microsoft.com/en-us/library/aa996205.aspx" rel="nofollow" target="_blank">http://technet.microsoft.com/en-us/library/aa996205.aspx</a><br /><br />Before finding these I had been stumped for hours on how to do something like "all users starting with "a" except those from OU 'foo'"</span></code></div>
  </div>
 </div>
  <div class="note" id="37317">  <div class="votes">
    <div id="Vu37317">
    <a href="https://www.php.net/manual/vote-note.php?id=37317&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd37317">
    <a href="https://www.php.net/manual/vote-note.php?id=37317&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V37317" title="66% like this...">
    3
    </div>
  </div>
  <a href="function.ldap-search.php.html#37317" class="name">
  <strong class="user"><em>francis dot tyers at hp dot com</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#37317"> &para;</a><div class="date" title="2003-11-10 07:53"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom37317">
<div class="phpcode"><code><span class="html">it seems that all fields must be used in lower case even if they are mixed case in the ldapsearch output.<br /><br />example:<br /><br />gidNumber: 1010<br />homeDirectory: /home/dnt<br /><br />must be:<br /><br />echo "gid: " . $info[$i]["gidnumber"][0] . "&lt;br&gt;";<br />echo "home directory: ". $info[$i]["homedirectory"][0] ."&lt;br&gt;";<br /><br />not ( $info[$i]["homeDirectory"][0] ) etc.</span></code></div>
  </div>
 </div>
  <div class="note" id="107340">  <div class="votes">
    <div id="Vu107340">
    <a href="https://www.php.net/manual/vote-note.php?id=107340&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd107340">
    <a href="https://www.php.net/manual/vote-note.php?id=107340&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V107340" title="59% like this...">
    5
    </div>
  </div>
  <a href="function.ldap-search.php.html#107340" class="name">
  <strong class="user"><em>Jean-Loup</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#107340"> &para;</a><div class="date" title="2012-02-01 06:27"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom107340">
<div class="phpcode"><code><span class="html">Example of parallel search :<br /><br /><span class="default">&lt;?php<br />$basedn</span><span class="keyword">=array(</span><span class="string">'dmdName=users,dc=foo,dc=fr'</span><span class="keyword">,</span><span class="string">'dmdName=users,dc=bar,dc=com'</span><span class="keyword">);  </span><span class="comment">// two basedn<br /></span><span class="default">$filter</span><span class="keyword">=</span><span class="string">'(&amp;(objectClass=inetOrgPerson)(uid=*))'</span><span class="keyword">;  </span><span class="comment">// single filter<br /></span><span class="default">$attributes</span><span class="keyword">=array(</span><span class="string">'dn'</span><span class="keyword">,</span><span class="string">'uid'</span><span class="keyword">,</span><span class="string">'sn'</span><span class="keyword">);<br /><br /></span><span class="default">$cnx </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="string">'localhost'</span><span class="keyword">,</span><span class="default">389</span><span class="keyword">); </span><span class="comment">// single connection<br /></span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$cnx</span><span class="keyword">, </span><span class="default">LDAP_OPT_PROTOCOL_VERSION</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br /><br /></span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$cnx</span><span class="keyword">,</span><span class="string">'uid=root,dc=foo,dc=fr'</span><span class="keyword">,</span><span class="string">'password'</span><span class="keyword">);  </span><span class="comment">// authentication on two BDB<br /></span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$cnx</span><span class="keyword">,</span><span class="string">'uid=root,dc=bar,dc=com'</span><span class="keyword">,</span><span class="string">'password'</span><span class="keyword">);<br /><br /></span><span class="default">$search </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(array(</span><span class="default">$cnx</span><span class="keyword">,</span><span class="default">$cnx</span><span class="keyword">),</span><span class="default">$basedn</span><span class="keyword">,</span><span class="default">$filter</span><span class="keyword">,</span><span class="default">$attributes</span><span class="keyword">);  </span><span class="comment">// search<br /><br />// result<br /></span><span class="keyword">for(</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;</span><span class="default">$i</span><span class="keyword">&lt;</span><span class="default">count</span><span class="keyword">(</span><span class="default">$search</span><span class="keyword">);</span><span class="default">$i</span><span class="keyword">++){<br />    </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$cnx</span><span class="keyword">,</span><span class="default">$search</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">]));<br />    print </span><span class="string">"\n"</span><span class="keyword">;<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="10421">  <div class="votes">
    <div id="Vu10421">
    <a href="https://www.php.net/manual/vote-note.php?id=10421&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd10421">
    <a href="https://www.php.net/manual/vote-note.php?id=10421&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V10421" title="66% like this...">
    1
    </div>
  </div>
  <a href="function.ldap-search.php.html#10421" class="name">
  <strong class="user"><em>cdaveb at csua dot berkeley dot edu</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#10421"> &para;</a><div class="date" title="2001-01-02 05:23"><strong>23 years ago</strong></div>
  <div class="text" id="Hcom10421">
<div class="phpcode"><code><span class="html">FYI, for those doing LDAP searches on Exchange servers, there seems to be some preference in Exchange to disallow searches that aren't initial searches (i.e. only x* will work, not * or *x). I'd been going nuts trying to figure out why I kept getting errors doing * searches.<br /><br />More info at:<br /><a href="http://www.microsoft.com/Exchange/en/55/help/documents/server/XOG16007.HTM" rel="nofollow" target="_blank">http://www.microsoft.com/Exchange/en/55/help/documents/server/XOG16007.HTM</a></span></code></div>
  </div>
 </div>
  <div class="note" id="37475">  <div class="votes">
    <div id="Vu37475">
    <a href="https://www.php.net/manual/vote-note.php?id=37475&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd37475">
    <a href="https://www.php.net/manual/vote-note.php?id=37475&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V37475" title="62% like this...">
    2
    </div>
  </div>
  <a href="function.ldap-search.php.html#37475" class="name">
  <strong class="user"><em>sembiance at cosmicrealms dot com</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#37475"> &para;</a><div class="date" title="2003-11-16 06:15"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom37475">
<div class="phpcode"><code><span class="html">When searching for BINARY data (such as an Active Directory objectGUID) you need to escape each hexadecimal character with a backslash.<br /><br />The following command line run of ldapsearch shows:<br />ldapsearch -b "dc=blahblah,dc=com" "(objectGUID=\AE\C3\23\35\F7)"<br /><br />In PHP, you need to escape the escape for the backslash:<br />ldap_search($ds,"dc=blahblah,dc=com", "(objectGUID=\\AE\\C3\\23\\35\\F7)");</span></code></div>
  </div>
 </div>
  <div class="note" id="35095">  <div class="votes">
    <div id="Vu35095">
    <a href="https://www.php.net/manual/vote-note.php?id=35095&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd35095">
    <a href="https://www.php.net/manual/vote-note.php?id=35095&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V35095" title="60% like this...">
    2
    </div>
  </div>
  <a href="function.ldap-search.php.html#35095" class="name">
  <strong class="user"><em>nicolas at atanis dot net</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#35095"> &para;</a><div class="date" title="2003-08-19 11:17"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom35095">
<div class="phpcode"><code><span class="html">Here is a little script that make a complete subtree search ( i know a script above seems do that but it doesnt work fine)<br />This is my version:<br /><br />Voila ce que j'ai fait aujourd'hui ...<br /><br />      $ldap_host = "192.168.0.50";<br />    $ldap_port = "389";<br />    $base_dn = "dc=fr";<br />    $filter = "(cn=*)";<br />    $ldap_user ="cn=admin,dc=fr";<br />    $ldap_pass = "hellodelu";<br />    $connect = ldap_connect( $ldap_host, $ldap_port);<br />    ldap_set_option($connect, LDAP_OPT_PROTOCOL_VERSION, 3);<br /><br />    $bind = ldap_bind($connect, $ldap_user, $ldap_pass);<br />    $read = ldap_search($connect, $base_dn, $filter);<br />    <br />    $info = ldap_get_entries($connect, $read); <br />    echo $info["count"]." entrees retournees&lt;BR&gt;&lt;BR&gt;"; <br />    for($ligne = 0; $ligne&lt;$info["count"]; $ligne++)<br />    {<br />        for($colonne = 0; $colonne&lt;$info[$ligne]["count"]; $colonne++)<br />        {<br />            $data = $info[$ligne][$colonne];<br />            echo $data.":".$info[$ligne][$data][0]."&lt;BR&gt;";<br />        }<br />        echo "&lt;BR&gt;";<br />    }<br />ldap_close($connect);<br /><br />--------<br />nicolas</span></code></div>
  </div>
 </div>
  <div class="note" id="45388">  <div class="votes">
    <div id="Vu45388">
    <a href="https://www.php.net/manual/vote-note.php?id=45388&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd45388">
    <a href="https://www.php.net/manual/vote-note.php?id=45388&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V45388" title="56% like this...">
    3
    </div>
  </div>
  <a href="function.ldap-search.php.html#45388" class="name">
  <strong class="user"><em>sema at technion dot ac dot il</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#45388"> &para;</a><div class="date" title="2004-09-04 10:54"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom45388">
<div class="phpcode"><code><span class="html">In order to perform the searches on Windows 2003 Server Active Directory you have to set the LDAP_OPT_REFERRALS option to 0:<br /><br />ldap_set_option($ldap, LDAP_OPT_REFERRALS, 0);<br /><br />Without this, you will get "Operations error" if you try to search the whole AD schema (using root of the domain as a $base_dn).<br /><br />As opposed to Windows 2000 Server, where this option was optional and only increased the performance.</span></code></div>
  </div>
 </div>
  <div class="note" id="22728">  <div class="votes">
    <div id="Vu22728">
    <a href="https://www.php.net/manual/vote-note.php?id=22728&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd22728">
    <a href="https://www.php.net/manual/vote-note.php?id=22728&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V22728" title="58% like this...">
    2
    </div>
  </div>
  <a href="function.ldap-search.php.html#22728" class="name">
  <strong class="user"><em>john_taylor_1973 at yahoo dot com</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#22728"> &para;</a><div class="date" title="2002-06-27 02:26"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom22728">
<div class="phpcode"><code><span class="html">Try to use ldap_list(), if possible.  It is much faster.  ldap_search searches a scope of LDAP_SCOPE_SUBTREE, but ldap_list searches a scope of just LDAP_SCOPE_ONELEVEL.  This made a big difference on Novell eDirectory 8.6.1, even for a query that only returned 130 objects.  Using an attribute list, the 4th function parameter (of either function), also made queries faster.</span></code></div>
  </div>
 </div>
  <div class="note" id="25050">  <div class="votes">
    <div id="Vu25050">
    <a href="https://www.php.net/manual/vote-note.php?id=25050&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd25050">
    <a href="https://www.php.net/manual/vote-note.php?id=25050&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V25050" title="60% like this...">
    1
    </div>
  </div>
  <a href="function.ldap-search.php.html#25050" class="name">
  <strong class="user"><em>jpdalbec at ysu dot edu</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#25050"> &para;</a><div class="date" title="2002-09-09 07:33"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom25050">
<div class="phpcode"><code><span class="html">I've found that spaces need to be escaped in search filters ("\20"), at least using the Red Hat PHP 4.1.2 package.  Otherwise no results are returned.</span></code></div>
  </div>
 </div>
  <div class="note" id="37582">  <div class="votes">
    <div id="Vu37582">
    <a href="https://www.php.net/manual/vote-note.php?id=37582&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd37582">
    <a href="https://www.php.net/manual/vote-note.php?id=37582&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V37582" title="54% like this...">
    1
    </div>
  </div>
  <a href="function.ldap-search.php.html#37582" class="name">
  <strong class="user"><em>chester at the dot underground dot com dot au</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#37582"> &para;</a><div class="date" title="2003-11-20 01:45"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom37582">
<div class="phpcode"><code><span class="html">If you are searching active directory and are experiencing lag or time outs, it may be that you are being given ldap referrals from the ldap server. The following code will disable this.<br /><br />&lt;?<br />ldap_set_option($connect, LDAP_OPT_REFERRALS, 0);<br />?&gt;</span></code></div>
  </div>
 </div>
  <div class="note" id="35019">  <div class="votes">
    <div id="Vu35019">
    <a href="https://www.php.net/manual/vote-note.php?id=35019&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd35019">
    <a href="https://www.php.net/manual/vote-note.php?id=35019&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V35019" title="53% like this...">
    1
    </div>
  </div>
  <a href="function.ldap-search.php.html#35019" class="name">
  <strong class="user"><em>me at gavinadams dot org</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#35019"> &para;</a><div class="date" title="2003-08-15 01:38"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom35019">
<div class="phpcode"><code><span class="html">Minor clarification on AD LDAP searchs. Small typo in previous example, and does not display multiple values per attribute. Here's the for loop to enumerate all entries, attributes, and values:<br /><br />$bind = ldap_bind($connect) // asume anon connect or add user/pass<br />     or exit("&gt;&gt;Could not bind to $ldap_host&lt;&lt;");<br />$read = ldap_search($connect, $base_dn, $filter)<br />     or exit("&gt;&gt;Unable to search ldap server&lt;&lt;");<br />$info = ldap_get_entries($connect, $read);<br />echo $info["count"]." entries returned&lt;br&gt;";<br />// $i = entries<br />// $ii = attributes for entry<br />// $iii = values per attribute<br />for ($i = 0; $i&lt;$info["count"]; $i++) {<br />  for ($ii=0; $ii&lt;$info[$i]["count"]; $ii++){<br />     $data = $info[$i][$ii];<br />     for ($iii=0; $iii&lt;$info[$i][$data]["count"]; $iii++) {<br />       echo $data.":&amp;nbsp;&amp;nbsp;".$info[$i][$data][$iii]."&lt;br&gt;";<br />     }<br />  }<br />echo "&lt;p&gt;"; // separate entries</span></code></div>
  </div>
 </div>
  <div class="note" id="119463">  <div class="votes">
    <div id="Vu119463">
    <a href="https://www.php.net/manual/vote-note.php?id=119463&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd119463">
    <a href="https://www.php.net/manual/vote-note.php?id=119463&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V119463" title="100% like this...">
    2
    </div>
  </div>
  <a href="function.ldap-search.php.html#119463" class="name">
  <strong class="user"><em>mike at remi-designs dot net</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#119463"> &para;</a><div class="date" title="2016-06-13 10:27"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom119463">
<div class="phpcode"><code><span class="html">I ran into the problem, that the attribute I was search for had the matching rule of "exactMatch". <br /><br />Example:<br />E-Mail Address is stored in mixed case: John.Doe@example.com<br /><br />LDAP Search will not retrieve any values when the user enters: john.doe@example.com<br /><br />Solution: instead of comparing user input and attribute value by<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">if(</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'mail'</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] == </span><span class="default">$username</span><span class="keyword">) {<br />    </span><span class="comment">// this will run into nothing<br /></span><span class="keyword">}<br /></span><span class="default">?&gt;<br /></span><br />use strcasecmp instead:<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">if(</span><span class="default">strcasecmp</span><span class="keyword">(</span><span class="default">$data</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">'mail'</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">], </span><span class="default">$username</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) {<br />    </span><span class="comment">// works<br /></span><span class="keyword">}</span></span></code></div>
  </div>
 </div>
  <div class="note" id="125081">  <div class="votes">
    <div id="Vu125081">
    <a href="https://www.php.net/manual/vote-note.php?id=125081&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd125081">
    <a href="https://www.php.net/manual/vote-note.php?id=125081&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V125081" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.ldap-search.php.html#125081" class="name">
  <strong class="user"><em>peter dot mlich at volny dot cz</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#125081"> &para;</a><div class="date" title="2020-06-05 06:57"><strong>3 years ago</strong></div>
  <div class="text" id="Hcom125081">
<div class="phpcode"><code><span class="html">Example code from my ldap class.<br /><br />public function query($_filter, $_att, $_ref=2, $count_bool=true)<br />    {<br />    $fn     = 'query';<br />    $config = $this-&gt;config;<br />    $conn   = $this-&gt;conn;<br />    if (!$conn)<br />        {return $this-&gt;errorConnection($fn);}<br />    ldap_set_option($conn, LDAP_OPT_DEREF, $_ref);    <br />    $result = ldap_search($conn, $config['baseDn'], $_filter, $_att);    //  or die(ldap_error($conn))<br />    if ($result===false)<br />        {<br />        $this-&gt;error("Search error, neexistuje!");<br />        return false;<br />        }<br />    $count = ldap_count_entries($conn, $result);<br />    if ($count_bool &amp;&amp; $count!=1)<br />        {<br />        $this-&gt;error("Search error, neni unikatni! count=".$count);<br />        ldap_free_result($result);<br />        return false;<br />        }<br />    $data = ldap_get_entries($conn, $result);<br />    ldap_free_result($result);<br />    return $data;<br />    }<br /><br />// ---<br /><br />    $filter = "(&amp;(objectclass=person)(cn=" . $user_name . "))";<br />    $att    = array(<br />        'uid', <br />        'workforceID',<br />        'employeeID',<br />        'givenName',<br />        'sn',<br />        'mail'<br />        );<br />    $data   = $this-&gt;query($filter, $att, 2, true);</span></code></div>
  </div>
 </div>
  <div class="note" id="123556">  <div class="votes">
    <div id="Vu123556">
    <a href="https://www.php.net/manual/vote-note.php?id=123556&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd123556">
    <a href="https://www.php.net/manual/vote-note.php?id=123556&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V123556" title="no votes...">
    0
    </div>
  </div>
  <a href="function.ldap-search.php.html#123556" class="name">
  <strong class="user"><em>anze dot pratnemer at fe dot uni-lj dot si</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#123556"> &para;</a><div class="date" title="2019-01-28 08:59"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom123556">
<div class="phpcode"><code><span class="html">While developing a plugin, I had to search users on LDAP server using ldap_search() command and it was not finding them, but ldapsearch command in unix shell (ubuntu) did.<br /><br />Problem was few lines above in my code, around ldap_connect(). For server address I input ldap://server.hostname, which turned to be the culprit.<br /><br />Once I used only server.hostname, without protocol (ldap://), users where found and shown correctly.</span></code></div>
  </div>
 </div>
  <div class="note" id="73693">  <div class="votes">
    <div id="Vu73693">
    <a href="https://www.php.net/manual/vote-note.php?id=73693&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd73693">
    <a href="https://www.php.net/manual/vote-note.php?id=73693&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V73693" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.ldap-search.php.html#73693" class="name">
  <strong class="user"><em>Allie</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#73693"> &para;</a><div class="date" title="2007-03-06 02:38"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom73693">
<div class="phpcode"><code><span class="html">I just posted on the ldap_bind, but I figured it couldn't hurt here since this was the first place I stopped when trying to figure out my problem.  My error pointed to ldap_search, but specifying the ldap_connect port was the fix.<br /><br />When you want to search the entire directory for MS AD, you must specify port 3268 in your bind.  This is also true for apache auth_ldap.<br /><br /> $ldapserver = ldap_connect($server,3268);</span></code></div>
  </div>
 </div>
  <div class="note" id="15215">  <div class="votes">
    <div id="Vu15215">
    <a href="https://www.php.net/manual/vote-note.php?id=15215&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd15215">
    <a href="https://www.php.net/manual/vote-note.php?id=15215&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V15215" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.ldap-search.php.html#15215" class="name"><strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#15215"> &para;</a><div class="date" title="2001-08-31 07:13"><strong>22 years ago</strong></div>
  <div class="text" id="Hcom15215">
<div class="phpcode"><code><span class="html">I used the following to retrieve all entries from an ILS (Netmeeting) Server:&lt;p&gt;    $sr=ldap_search($ds, "objectclass=rtperson","(&amp;(cn=%)(objectclass=rtperson))");<br />&lt;p&gt;Have fun!<br />&lt;p&gt;Kees</span></code></div>
  </div>
 </div>
  <div class="note" id="31171">  <div class="votes">
    <div id="Vu31171">
    <a href="https://www.php.net/manual/vote-note.php?id=31171&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd31171">
    <a href="https://www.php.net/manual/vote-note.php?id=31171&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V31171" title="47% like this...">
    -1
    </div>
  </div>
  <a href="function.ldap-search.php.html#31171" class="name">
  <strong class="user"><em>php @ fccfurn dot com</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#31171"> &para;</a><div class="date" title="2003-04-11 03:35"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom31171">
<div class="phpcode"><code><span class="html">To do subtree search from top DN in Active Directory, Make sure you do your ldap_set_option().<br /><br /><span class="default">&lt;?php<br />$ldap_host </span><span class="keyword">= </span><span class="string">"pdc.php.net"</span><span class="keyword">;<br /></span><span class="default">$base_dn </span><span class="keyword">= </span><span class="string">"DC=php,DC=net"</span><span class="keyword">;<br /></span><span class="default">$filter </span><span class="keyword">= </span><span class="string">"(cn=Joe User)"</span><span class="keyword">;<br /></span><span class="default">$ldap_user  </span><span class="keyword">= </span><span class="string">"CN=Joe User,OU=Sales,DC=php,DC=net"</span><span class="keyword">;<br /></span><span class="default">$ldap_pass </span><span class="keyword">= </span><span class="string">"pass"</span><span class="keyword">;<br /></span><span class="default">$connect </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">( </span><span class="default">$ldap_host</span><span class="keyword">, </span><span class="default">$ldap_port</span><span class="keyword">)<br />         or exit(</span><span class="string">"&gt;&gt;Could not connect to LDAP server&lt;&lt;"</span><span class="keyword">);<br /></span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$connect</span><span class="keyword">, </span><span class="default">LDAP_OPT_PROTOCOL_VERSION</span><span class="keyword">, </span><span class="default">3</span><span class="keyword">);<br /></span><span class="default">ldap_set_option</span><span class="keyword">(</span><span class="default">$connect</span><span class="keyword">, </span><span class="default">LDAP_OPT_REFERRALS</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">);<br /></span><span class="default">$bind </span><span class="keyword">= </span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$connect</span><span class="keyword">, </span><span class="default">$ldap_user</span><span class="keyword">, </span><span class="default">$ldap_pass</span><span class="keyword">)<br />      or exit(</span><span class="string">"&gt;&gt;Could not bind to </span><span class="default">$ldap_host</span><span class="string">&lt;&lt;"</span><span class="keyword">);<br /></span><span class="default">$read </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$connect</span><span class="keyword">, </span><span class="default">$base_dn</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">)<br />      or exit(</span><span class="string">"&gt;&gt;Unable to search ldap server&lt;&lt;"</span><span class="keyword">);<br /></span><span class="default">$info </span><span class="keyword">= </span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$connect</span><span class="keyword">, </span><span class="default">$read</span><span class="keyword">);<br />echo </span><span class="default">$info</span><span class="keyword">[</span><span class="string">"count"</span><span class="keyword">].</span><span class="string">" entries returned&lt;p&gt;"</span><span class="keyword">;<br /></span><span class="default">$ii</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$ii</span><span class="keyword">&lt;</span><span class="default">$info</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="string">"count"</span><span class="keyword">]; </span><span class="default">$ii</span><span class="keyword">++){<br />    </span><span class="default">$data </span><span class="keyword">= </span><span class="default">$info</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="default">$ii</span><span class="keyword">];<br />    echo </span><span class="default">$data</span><span class="keyword">.</span><span class="string">":&amp;nbsp;&amp;nbsp;"</span><span class="keyword">.</span><span class="default">$info</span><span class="keyword">[</span><span class="default">$i</span><span class="keyword">][</span><span class="default">$data</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">].</span><span class="string">"&lt;br&gt;"</span><span class="keyword">;<br />}<br /></span><span class="default">ldap_close</span><span class="keyword">(</span><span class="default">$connect</span><span class="keyword">);<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="94554">  <div class="votes">
    <div id="Vu94554">
    <a href="https://www.php.net/manual/vote-note.php?id=94554&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd94554">
    <a href="https://www.php.net/manual/vote-note.php?id=94554&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V94554" title="45% like this...">
    -1
    </div>
  </div>
  <a href="function.ldap-search.php.html#94554" class="name">
  <strong class="user"><em>ben _at_ onshop_co_uk</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#94554"> &para;</a><div class="date" title="2009-11-11 10:24"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom94554">
<div class="phpcode"><code><span class="html">Example to illustrate searching more than one DN (multiple DNs):<br /><br /><span class="default">&lt;?php<br />$ds</span><span class="keyword">=</span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="default">$ldapserver</span><span class="keyword">);<br /><br /></span><span class="default">$dn</span><span class="keyword">[]=</span><span class="string">'OU=ABC,DC=xyz,DC=ac,DC=uk'</span><span class="keyword">;<br /></span><span class="default">$dn</span><span class="keyword">[]=</span><span class="string">'OU=DEF,DC=xyz,DC=ac,DC=uk'</span><span class="keyword">;<br /><br /></span><span class="default">$id</span><span class="keyword">[] = </span><span class="default">$ds</span><span class="keyword">;<br /></span><span class="default">$id</span><span class="keyword">[] = </span><span class="default">$ds</span><span class="keyword">;<br /><br /></span><span class="default">$filter </span><span class="keyword">= </span><span class="string">'samaccountname='</span><span class="keyword">.</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">];<br /> <br /></span><span class="default">$result </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$id</span><span class="keyword">,</span><span class="default">$dn</span><span class="keyword">,</span><span class="default">$filter</span><span class="keyword">);<br /><br /></span><span class="default">$search </span><span class="keyword">= </span><span class="default">false</span><span class="keyword">;<br /><br />foreach (</span><span class="default">$result </span><span class="keyword">as </span><span class="default">$value</span><span class="keyword">) {<br />    if(</span><span class="default">ldap_count_entries</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">,</span><span class="default">$value</span><span class="keyword">)&gt;</span><span class="default">0</span><span class="keyword">){<br />        </span><span class="default">$search </span><span class="keyword">= </span><span class="default">$value</span><span class="keyword">;<br />        break;<br />    }<br />}<br /><br />if(</span><span class="default">$search</span><span class="keyword">){<br />    </span><span class="default">$info </span><span class="keyword">= </span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$ds</span><span class="keyword">, </span><span class="default">$search</span><span class="keyword">);<br />}else{<br />    </span><span class="default">$info </span><span class="keyword">= </span><span class="string">'No results found'</span><span class="keyword">;<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="95746">  <div class="votes">
    <div id="Vu95746">
    <a href="https://www.php.net/manual/vote-note.php?id=95746&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd95746">
    <a href="https://www.php.net/manual/vote-note.php?id=95746&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V95746" title="44% like this...">
    -1
    </div>
  </div>
  <a href="function.ldap-search.php.html#95746" class="name">
  <strong class="user"><em>ben _at_ onshop.co.uk</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#95746"> &para;</a><div class="date" title="2010-01-19 02:11"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom95746">
<div class="phpcode"><code><span class="html">Following from my note of 11-Nov-2009 06:56 regarding DN issues when using LDAP instead of the Global Catalog when querying AD, further investigation was showing that although the results were in the packet, I was getting an error instead:<br /><br />'Search: Can't contact LDAP server' AKA Error 81.<br /><br />Using more detailed analysis:<br /><br />ldap_get_option($ds,LDAP_OPT_ERROR_STRING,$error);<br /><br />echo $error<br /><br />Displayed:<br /><br />Referral: ldap://DomainDnsZones.defg.de.bc.ac.uk/ DC=DomainDnsZonesDC=defg,DC=de,DC=abc,DC=ac,DC=uk<br /><br />By using trial and error, the error went away and results returned when using:<br /><br />ldap_set_option($ds, LDAP_OPT_PROTOCOL_VERSION, 3);</span></code></div>
  </div>
 </div>
  <div class="note" id="29838">  <div class="votes">
    <div id="Vu29838">
    <a href="https://www.php.net/manual/vote-note.php?id=29838&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd29838">
    <a href="https://www.php.net/manual/vote-note.php?id=29838&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V29838" title="42% like this...">
    -1
    </div>
  </div>
  <a href="function.ldap-search.php.html#29838" class="name">
  <strong class="user"><em>Kamil Kukura &lt;kamk at nexen dot cz&gt;</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#29838"> &para;</a><div class="date" title="2003-02-26 09:20"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom29838">
<div class="phpcode"><code><span class="html">When I tried to search with empty base DN on OpenLDAP server which had "" namingContext I got result "no such object". In the log file there was query for dn: dc=example,dc=com (!).<br />As a workaround, it seems it's enough to feed it with space (' ') as base DN - ldap_search($ds, ' ', '(...filter...)', ...</span></code></div>
  </div>
 </div>
  <div class="note" id="28991">  <div class="votes">
    <div id="Vu28991">
    <a href="https://www.php.net/manual/vote-note.php?id=28991&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd28991">
    <a href="https://www.php.net/manual/vote-note.php?id=28991&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V28991" title="42% like this...">
    -1
    </div>
  </div>
  <a href="function.ldap-search.php.html#28991" class="name">
  <strong class="user"><em>neumeyed at city dot bloomington dot in dot us</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#28991"> &para;</a><div class="date" title="2003-01-29 04:50"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom28991">
<div class="phpcode"><code><span class="html">A previous comment noted: "I've also noticed that the departmentNumber, employeeNumber (and maybe others in inetorgperson.schema) are not returned from a search."<br /><br />This is incorrect. These attributes are returned, but you must reference them with lowercase names. That is, instead of doing this:<br /><br />$entries[0]["departmentNumber"][0]<br /><br />Do this:<br /><br />$entries[0]["departmentnumber"][0]<br /><br />This doesn't seem like "correct" behavior to me, but I don't know enough about LDAP to say for sure.</span></code></div>
  </div>
 </div>
  <div class="note" id="105836">  <div class="votes">
    <div id="Vu105836">
    <a href="https://www.php.net/manual/vote-note.php?id=105836&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd105836">
    <a href="https://www.php.net/manual/vote-note.php?id=105836&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V105836" title="38% like this...">
    -3
    </div>
  </div>
  <a href="function.ldap-search.php.html#105836" class="name">
  <strong class="user"><em>info at acpower dot biz</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#105836"> &para;</a><div class="date" title="2011-09-19 03:07"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom105836">
<div class="phpcode"><code><span class="html">I'm a newbie, so I hope this helps some other newbie with a head scratcher...<br /><br />This code returned an error of 'No Such Object':<br /><br /><span class="default">&lt;?php<br /><br />    $search </span><span class="keyword">= </span><span class="default">ldap_search </span><span class="keyword">(</span><span class="default">$ldapcon</span><span class="keyword">, </span><span class="string">"cn=admin,dc=acpower,dc=biz"</span><span class="keyword">, </span><span class="string">"(filters)"</span><span class="keyword">);<br /><br /></span><span class="default">?&gt;<br /></span><br />I took out the cn, and magic! it works:<br /><br /><span class="default">&lt;?php<br /><br />    $search </span><span class="keyword">= </span><span class="default">ldap_search </span><span class="keyword">(</span><span class="default">$ldapcon</span><span class="keyword">, </span><span class="string">"dc=acpower,dc=biz"</span><span class="keyword">, </span><span class="string">"(filters)"</span><span class="keyword">);<br /><br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="49905">  <div class="votes">
    <div id="Vu49905">
    <a href="https://www.php.net/manual/vote-note.php?id=49905&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd49905">
    <a href="https://www.php.net/manual/vote-note.php?id=49905&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V49905" title="37% like this...">
    -2
    </div>
  </div>
  <a href="function.ldap-search.php.html#49905" class="name">
  <strong class="user"><em>openldap at mail dot doris dot cc</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#49905"> &para;</a><div class="date" title="2005-02-11 07:54"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom49905">
<div class="phpcode"><code><span class="html">PHP 4.3.10<br /><br />I was trying to do an ldapsearch without a basedn.  First, I tried with ' ', as suggested above, but it gave me invalid dn syntax error. <br /><br />ie: <br />$sr=ldap_search($ds, ' ', $filter);<br />Warning: ldap_search(): Search: Invalid DN syntax in ...<br /><br />Then I changed it to<br />$sr=ldap_search($ds, "", $filter);<br /><br />Which gave me the following error:<br />Warning: ldap_search(): Search: No such object in ...<br /><br />With that I then modified my ldap.conf file and commented out the BASE field<br />#BASE   dc=example, dc=com<br /><br />Then it worked!<br /><br />So it looks like if you supply a blank basedn, then it will use your default basedn in ldap.conf.</span></code></div>
  </div>
 </div>
  <div class="note" id="25629">  <div class="votes">
    <div id="Vu25629">
    <a href="https://www.php.net/manual/vote-note.php?id=25629&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd25629">
    <a href="https://www.php.net/manual/vote-note.php?id=25629&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V25629" title="33% like this...">
    -1
    </div>
  </div>
  <a href="function.ldap-search.php.html#25629" class="name">
  <strong class="user"><em>emrecio at netscape dot net</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#25629"> &para;</a><div class="date" title="2002-09-30 08:42"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom25629">
<div class="phpcode"><code><span class="html">implode(", ",$uentry[0]["rfc822mailalias"]);<br /><br />doesn't work as expected because "count" is in there... one /must/ use the 'for' loop to cycle through results (discarding "count" element).</span></code></div>
  </div>
 </div>
  <div class="note" id="50483">  <div class="votes">
    <div id="Vu50483">
    <a href="https://www.php.net/manual/vote-note.php?id=50483&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd50483">
    <a href="https://www.php.net/manual/vote-note.php?id=50483&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V50483" title="33% like this...">
    -2
    </div>
  </div>
  <a href="function.ldap-search.php.html#50483" class="name">
  <strong class="user"><em>fmouse at fmp dot com</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#50483"> &para;</a><div class="date" title="2005-03-01 10:53"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom50483">
<div class="phpcode"><code><span class="html">It appears that the Netscape Directory SDK (developer.netscape.com) referenced for LDAP filter information is no longer accepting connections.   The A copy of RFC 2254 which defines the standard for string representations of LDAP filters can be found  at <a href="http://www.ietf.org/rfc/rfc2254.txt" rel="nofollow" target="_blank">http://www.ietf.org/rfc/rfc2254.txt</a></span></code></div>
  </div>
 </div>
  <div class="note" id="105631">  <div class="votes">
    <div id="Vu105631">
    <a href="https://www.php.net/manual/vote-note.php?id=105631&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd105631">
    <a href="https://www.php.net/manual/vote-note.php?id=105631&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V105631" title="30% like this...">
    -4
    </div>
  </div>
  <a href="function.ldap-search.php.html#105631" class="name">
  <strong class="user"><em>nick</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#105631"> &para;</a><div class="date" title="2011-09-01 11:09"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom105631">
<div class="phpcode"><code><span class="html">Results from ActiveDirectory may be ordered by objectSid.<br />We can get all users for each page size by modify filter.<br /><br /><span class="default">&lt;?php<br /></span><span class="comment">// ... connect to ldap<br /></span><span class="default">$lastsid</span><span class="keyword">=</span><span class="string">''</span><span class="keyword">;<br />while (</span><span class="default">1</span><span class="keyword">) {<br />    </span><span class="default">$filter </span><span class="keyword">= </span><span class="string">'(objectClass=user)'</span><span class="keyword">;<br />    if (</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$lastsid</span><span class="keyword">)) {<br />        list(</span><span class="default">$v</span><span class="keyword">)=</span><span class="default">array_values</span><span class="keyword">(</span><span class="default">unpack</span><span class="keyword">(</span><span class="string">'V'</span><span class="keyword">,</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$lastsid</span><span class="keyword">,</span><span class="default">24</span><span class="keyword">))); </span><span class="comment">// id for user.<br />        </span><span class="default">$s </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$lastsid</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">24</span><span class="keyword">).</span><span class="default">pack</span><span class="keyword">(</span><span class="string">'V'</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">+</span><span class="default">$v</span><span class="keyword">); </span><span class="comment">// next sid.<br />        </span><span class="default">$s </span><span class="keyword">= </span><span class="default">preg_replace</span><span class="keyword">(</span><span class="string">'/../'</span><span class="keyword">,</span><span class="string">'\\\\$0'</span><span class="keyword">,</span><span class="default">bin2hex</span><span class="keyword">(</span><span class="default">$s</span><span class="keyword">)); </span><span class="comment">// escape for fiter<br />        </span><span class="default">$filter </span><span class="keyword">= </span><span class="string">'(&amp;'</span><span class="keyword">.</span><span class="default">$filter</span><span class="keyword">.</span><span class="string">'(objectSid&gt;='</span><span class="keyword">.</span><span class="default">$s</span><span class="keyword">.</span><span class="string">'))'</span><span class="keyword">; </span><span class="comment">// fiter for next entries.<br />    </span><span class="keyword">}<br />    </span><span class="default">$res </span><span class="keyword">= </span><span class="default">ldap_search</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">,</span><span class="default">$basedn</span><span class="keyword">,</span><span class="default">$filter</span><span class="keyword">,array(</span><span class="string">'objectSid'</span><span class="keyword">,</span><span class="string">'cn'</span><span class="keyword">));<br />    if (!</span><span class="default">ldap_count_entries</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">,</span><span class="default">$res</span><span class="keyword">)) {<br />        break;<br />    }<br />    for (</span><span class="default">$ent</span><span class="keyword">=</span><span class="default">ldap_first_entry</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">,</span><span class="default">$res</span><span class="keyword">); </span><span class="default">$ent</span><span class="keyword">; </span><span class="default">$ent</span><span class="keyword">=</span><span class="default">ldap_next_entry</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">,</span><span class="default">$ent</span><span class="keyword">)) {<br />        list(</span><span class="default">$lastsid</span><span class="keyword">) = </span><span class="default">ldap_get_values_len</span><span class="keyword">(</span><span class="default">$ldap</span><span class="keyword">,</span><span class="default">$ent</span><span class="keyword">,</span><span class="string">'objectSid'</span><span class="keyword">);<br />    }<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="61173">  <div class="votes">
    <div id="Vu61173">
    <a href="https://www.php.net/manual/vote-note.php?id=61173&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd61173">
    <a href="https://www.php.net/manual/vote-note.php?id=61173&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V61173" title="25% like this...">
    -8
    </div>
  </div>
  <a href="function.ldap-search.php.html#61173" class="name"><strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#61173"> &para;</a><div class="date" title="2006-01-27 03:53"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom61173">
<div class="phpcode"><code><span class="html">HOWTO list LDAP users.<br /><br />This CODE list one user from LDAP tree, but I' like list all user from LDAP one ou=Organization<br /><br /><span class="default">&lt;?php<br /><br />$ldaprdn </span><span class="keyword">= </span><span class="string">'cn=user,dc=domain,dc=org'</span><span class="keyword">; <br /></span><span class="default">$ldappass </span><span class="keyword">= </span><span class="string">'password'</span><span class="keyword">;<br /></span><span class="default">$sdn </span><span class="keyword">= </span><span class="string">'cn=user,ou=group,dc=domain,dc=org'</span><span class="keyword">;<br /><br /></span><span class="default">$ldapconn </span><span class="keyword">= </span><span class="default">ldap_connect</span><span class="keyword">(</span><span class="string">"ldap://localhost"</span><span class="keyword">, </span><span class="default">389</span><span class="keyword">) <br />or die(</span><span class="string">"Not connect: </span><span class="default">$ldaphost</span><span class="string"> "</span><span class="keyword">);<br /><br />if (</span><span class="default">$ldapconn</span><span class="keyword">) {<br /><br /></span><span class="comment">// binding to ldap server<br /></span><span class="default">$ldapbind </span><span class="keyword">= </span><span class="default">ldap_bind</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">$ldaprdn</span><span class="keyword">, </span><span class="default">$ldappass</span><span class="keyword">);<br /><br /></span><span class="comment">// verify binding<br /></span><span class="keyword">if (</span><span class="default">$ldapbind</span><span class="keyword">) {<br /></span><span class="default">$filter</span><span class="keyword">=</span><span class="string">"uid=*"</span><span class="keyword">; <br /></span><span class="default">$justthese </span><span class="keyword">= array(</span><span class="string">"uid"</span><span class="keyword">); <br /><br /></span><span class="default">$sr</span><span class="keyword">=</span><span class="default">ldap_read</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">$srdn</span><span class="keyword">, </span><span class="default">$filter</span><span class="keyword">, </span><span class="default">$justthese</span><span class="keyword">);<br /></span><span class="default">$entry </span><span class="keyword">= </span><span class="default">ldap_get_entries</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">, </span><span class="default">$sr</span><span class="keyword">);<br /><br />} else {<br />echo </span><span class="string">"LDAP conn ok..."</span><span class="keyword">;<br />}<br /><br />}<br /><br /></span><span class="default">ldap_close</span><span class="keyword">(</span><span class="default">$ldapconn</span><span class="keyword">);<br /><br /></span><span class="default">?&gt;</span> <br /><span class="default">&lt;?php<br /></span><span class="keyword">echo </span><span class="default">$entry</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">"mail"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] . </span><span class="string">" mail adress "</span><span class="keyword">;<br />echo </span><span class="default">$entry</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">][</span><span class="string">"sn"</span><span class="keyword">][</span><span class="default">0</span><span class="keyword">] . </span><span class="string">" Name "</span><span class="keyword">;<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="49889">  <div class="votes">
    <div id="Vu49889">
    <a href="https://www.php.net/manual/vote-note.php?id=49889&amp;page=function.ldap-search&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd49889">
    <a href="https://www.php.net/manual/vote-note.php?id=49889&amp;page=function.ldap-search&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V49889" title="11% like this...">
    -7
    </div>
  </div>
  <a href="function.ldap-search.php.html#49889" class="name">
  <strong class="user"><em>rsu_friend at yahoo dot com</em></strong></a><a class="genanchor" href="function.ldap-search.php.html#49889"> &para;</a><div class="date" title="2005-02-11 01:03"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom49889">
<div class="phpcode"><code><span class="html">I was doing a ldap_search with<br />$searchbasedn = "miDomainName=" . $_SESSION['selectDomain'] ."," . LDAP_DOMAINBASE;<br />$filter = "(&amp;(mpsAccountNumber=". $acctNumber .")(objectclass=mpsAccountDetails))";    <br />$attributes = array("mpsparentchild");<br /><br /> $sr = ldap_search($ldapconn, $searchbasedn, $filter,$attributes);  <br /><br />For some reasone this search was failing<br />but I was able to do successful search only when I gave the search filter as<br />$filter = "(&amp;(mpsAccountNumber= $acctNumber )(objectclass=mpsAccountDetails))";    <br /><br />I did not get why the ldap_search was not able to search in the first case.</span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=function.ldap-search&amp;redirect=https://www.php.net/manual/ru/function.ldap-search.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="ref.ldap.php.html">Функции LDAP</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="function.ldap-8859-to-t61.php.html" title="ldap_&#8203;8859_&#8203;to_&#8203;t61">ldap_&#8203;8859_&#8203;to_&#8203;t61</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-add-ext.php.html" title="ldap_&#8203;add_&#8203;ext">ldap_&#8203;add_&#8203;ext</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-add.php.html" title="ldap_&#8203;add">ldap_&#8203;add</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-bind-ext.php.html" title="ldap_&#8203;bind_&#8203;ext">ldap_&#8203;bind_&#8203;ext</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-bind.php.html" title="ldap_&#8203;bind">ldap_&#8203;bind</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-close.php.html" title="ldap_&#8203;close">ldap_&#8203;close</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-compare.php.html" title="ldap_&#8203;compare">ldap_&#8203;compare</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-connect-wallet.php.html" title="ldap_&#8203;connect_&#8203;wallet">ldap_&#8203;connect_&#8203;wallet</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-connect.php.html" title="ldap_&#8203;connect">ldap_&#8203;connect</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-count-entries.php.html" title="ldap_&#8203;count_&#8203;entries">ldap_&#8203;count_&#8203;entries</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-count-references.php.html" title="ldap_&#8203;count_&#8203;references">ldap_&#8203;count_&#8203;references</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-delete-ext.php.html" title="ldap_&#8203;delete_&#8203;ext">ldap_&#8203;delete_&#8203;ext</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-delete.php.html" title="ldap_&#8203;delete">ldap_&#8203;delete</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-dn2ufn.php.html" title="ldap_&#8203;dn2ufn">ldap_&#8203;dn2ufn</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-err2str.php.html" title="ldap_&#8203;err2str">ldap_&#8203;err2str</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-errno.php.html" title="ldap_&#8203;errno">ldap_&#8203;errno</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-error.php.html" title="ldap_&#8203;error">ldap_&#8203;error</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-escape.php.html" title="ldap_&#8203;escape">ldap_&#8203;escape</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-exop-passwd.php.html" title="ldap_&#8203;exop_&#8203;passwd">ldap_&#8203;exop_&#8203;passwd</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-exop-refresh.php.html" title="ldap_&#8203;exop_&#8203;refresh">ldap_&#8203;exop_&#8203;refresh</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-exop-sync.php.html" title="ldap_&#8203;exop_&#8203;sync">ldap_&#8203;exop_&#8203;sync</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-exop-whoami.php.html" title="ldap_&#8203;exop_&#8203;whoami">ldap_&#8203;exop_&#8203;whoami</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-exop.php.html" title="ldap_&#8203;exop">ldap_&#8203;exop</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-explode-dn.php.html" title="ldap_&#8203;explode_&#8203;dn">ldap_&#8203;explode_&#8203;dn</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-first-attribute.php.html" title="ldap_&#8203;first_&#8203;attribute">ldap_&#8203;first_&#8203;attribute</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-first-entry.php.html" title="ldap_&#8203;first_&#8203;entry">ldap_&#8203;first_&#8203;entry</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-first-reference.php.html" title="ldap_&#8203;first_&#8203;reference">ldap_&#8203;first_&#8203;reference</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-free-result.php.html" title="ldap_&#8203;free_&#8203;result">ldap_&#8203;free_&#8203;result</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-get-attributes.php.html" title="ldap_&#8203;get_&#8203;attributes">ldap_&#8203;get_&#8203;attributes</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-get-dn.php.html" title="ldap_&#8203;get_&#8203;dn">ldap_&#8203;get_&#8203;dn</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-get-entries.php.html" title="ldap_&#8203;get_&#8203;entries">ldap_&#8203;get_&#8203;entries</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-get-option.php.html" title="ldap_&#8203;get_&#8203;option">ldap_&#8203;get_&#8203;option</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-get-values-len.php.html" title="ldap_&#8203;get_&#8203;values_&#8203;len">ldap_&#8203;get_&#8203;values_&#8203;len</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-get-values.php.html" title="ldap_&#8203;get_&#8203;values">ldap_&#8203;get_&#8203;values</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-list.php.html" title="ldap_&#8203;list">ldap_&#8203;list</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-mod_add-ext.php.html" title="ldap_&#8203;mod_&#8203;add_&#8203;ext">ldap_&#8203;mod_&#8203;add_&#8203;ext</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-mod-add.php.html" title="ldap_&#8203;mod_&#8203;add">ldap_&#8203;mod_&#8203;add</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-mod_del-ext.php.html" title="ldap_&#8203;mod_&#8203;del_&#8203;ext">ldap_&#8203;mod_&#8203;del_&#8203;ext</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-mod-del.php.html" title="ldap_&#8203;mod_&#8203;del">ldap_&#8203;mod_&#8203;del</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-mod_replace-ext.php.html" title="ldap_&#8203;mod_&#8203;replace_&#8203;ext">ldap_&#8203;mod_&#8203;replace_&#8203;ext</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-mod-replace.php.html" title="ldap_&#8203;mod_&#8203;replace">ldap_&#8203;mod_&#8203;replace</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-modify-batch.php.html" title="ldap_&#8203;modify_&#8203;batch">ldap_&#8203;modify_&#8203;batch</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-modify.php.html" title="ldap_&#8203;modify">ldap_&#8203;modify</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-next-attribute.php.html" title="ldap_&#8203;next_&#8203;attribute">ldap_&#8203;next_&#8203;attribute</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-next-entry.php.html" title="ldap_&#8203;next_&#8203;entry">ldap_&#8203;next_&#8203;entry</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-next-reference.php.html" title="ldap_&#8203;next_&#8203;reference">ldap_&#8203;next_&#8203;reference</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-parse-exop.php.html" title="ldap_&#8203;parse_&#8203;exop">ldap_&#8203;parse_&#8203;exop</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-parse-reference.php.html" title="ldap_&#8203;parse_&#8203;reference">ldap_&#8203;parse_&#8203;reference</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-parse-result.php.html" title="ldap_&#8203;parse_&#8203;result">ldap_&#8203;parse_&#8203;result</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-read.php.html" title="ldap_&#8203;read">ldap_&#8203;read</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-rename-ext.php.html" title="ldap_&#8203;rename_&#8203;ext">ldap_&#8203;rename_&#8203;ext</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-rename.php.html" title="ldap_&#8203;rename">ldap_&#8203;rename</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-sasl-bind.php.html" title="ldap_&#8203;sasl_&#8203;bind">ldap_&#8203;sasl_&#8203;bind</a>
                        </li>
                                                <li class="current">
                            <a href="function.ldap-search.php.html" title="ldap_&#8203;search">ldap_&#8203;search</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-set-option.php.html" title="ldap_&#8203;set_&#8203;option">ldap_&#8203;set_&#8203;option</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-set-rebind-proc.php.html" title="ldap_&#8203;set_&#8203;rebind_&#8203;proc">ldap_&#8203;set_&#8203;rebind_&#8203;proc</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-sort.php.html" title="ldap_&#8203;sort">ldap_&#8203;sort</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-start-tls.php.html" title="ldap_&#8203;start_&#8203;tls">ldap_&#8203;start_&#8203;tls</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-t61-to-8859.php.html" title="ldap_&#8203;t61_&#8203;to_&#8203;8859">ldap_&#8203;t61_&#8203;to_&#8203;8859</a>
                        </li>
                                                <li class="">
                            <a href="function.ldap-unbind.php.html" title="ldap_&#8203;unbind">ldap_&#8203;unbind</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                        <li>
                <span class="header">Deprecated</span>
                <ul class="child-menu-list">
                                    <li class="">
                        <a href="function.ldap-control-paged-result-response.php.html" title="ldap_&#8203;control_&#8203;paged_&#8203;result_&#8203;response">ldap_&#8203;control_&#8203;paged_&#8203;result_&#8203;response</a>
                    </li>
                                    <li class="">
                        <a href="function.ldap-control-paged-result.php.html" title="ldap_&#8203;control_&#8203;paged_&#8203;result">ldap_&#8203;control_&#8203;paged_&#8203;result</a>
                    </li>
                                </ul>
            </li>
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
