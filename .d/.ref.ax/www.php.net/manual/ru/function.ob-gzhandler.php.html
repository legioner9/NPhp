<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: ob_gzhandler - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.ob-gzhandler.php.html">
 <link rel="shorturl" href="https://www.php.net/ob-gzhandler">
 <link rel="alternate" href="https://www.php.net/ob-gzhandler" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="ref.zlib.php.html">
 <link rel="prev" href="function.inflate-init.php.html">
 <link rel="next" href="function.readgzfile.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/function.ob-gzhandler.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/function.ob-gzhandler.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/function.ob-gzhandler.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.ob-gzhandler.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/function.ob-gzhandler.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.ob-gzhandler.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.ob-gzhandler.php" hreflang="pt_BR">
 <link rel="alternate" href="function.ob-gzhandler.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.ob-gzhandler.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.ob-gzhandler.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="function.readgzfile.php.html">
          readgzfile &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="function.inflate-init.php.html">
          &laquo; inflate_init        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='funcref.php.html'>Справочник функций</a></li>      <li><a href='refs.compression.php.html'>Модули для сжатия и архивации</a></li>      <li><a href='book.zlib.php.html'>Zlib</a></li>      <li><a href='ref.zlib.php.html'>Функции Zlib</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/function.ob-gzhandler.php'>English</option>
            <option value='de/function.ob-gzhandler.php'>German</option>
            <option value='es/function.ob-gzhandler.php'>Spanish</option>
            <option value='fr/function.ob-gzhandler.php'>French</option>
            <option value='it/function.ob-gzhandler.php'>Italian</option>
            <option value='ja/function.ob-gzhandler.php'>Japanese</option>
            <option value='pt_BR/function.ob-gzhandler.php'>Brazilian Portuguese</option>
            <option value='ru/function.ob-gzhandler.php' selected="selected">Russian</option>
            <option value='tr/function.ob-gzhandler.php'>Turkish</option>
            <option value='zh/function.ob-gzhandler.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/reference/zlib/functions/ob-gzhandler.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Ffunction.ob-gzhandler%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="function.ob-gzhandler" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">ob_gzhandler</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.0.4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">ob_gzhandler</span> &mdash; <span class="dc-title">Сжимает буфер вывода в gzip, действуя как callback-функция — параметр функции ob_start</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.ob-gzhandler-description">
  <h3 class="title">Описание</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>ob_gzhandler</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$data</code></span>, <span class="methodparam"><span class="type">int</span> <code class="parameter">$flags</code></span>): <span class="type"><span class="type">string</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   Функция <span class="function"><strong>ob_gzhandler()</strong></span> выступает в роли
   callback-функции — параметра функции <span class="function"><a href="function.ob-start.php.html" class="function">ob_start()</a></span>, чтобы упростить отправку
   gz-кодированных данных для веб-браузеров, которые поддерживают обработку сжатых веб-страниц.
   Перед тем как функция <span class="function"><strong>ob_gzhandler()</strong></span> отправит сжатые данные,
   определит принимаемый браузером тип кодирования содержимого
   (gzip, deflate или вообще никакой), и вернёт свой вывод.
   Поддерживаются все браузеры, поскольку браузер сам отправляет правильный заголовок,
   сообщающий, что он принимает сжатые веб-страницы. Если браузер
   не поддерживает сжатие страниц, эта функция вернёт <strong><code>false</code></strong>.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.ob-gzhandler-parameters">
  <h3 class="title">Список параметров</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">data</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">flags</code></dt>

     <dd>

      <p class="para">
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.ob-gzhandler-returnvalues">
  <h3 class="title">Возвращаемые значения</h3>
  <p class="para">

  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.ob-gzhandler-examples">
  <h3 class="title">Примеры</h3>
  <p class="para">
   <div class="example" id="example-2692">
    <p><strong>Пример #1 Пример использования функции <span class="function"><strong>ob_gzhandler()</strong></span></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br />ob_start</span><span style="color: #007700">(</span><span style="color: #DD0000">"ob_gzhandler"</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;<br /></span>&lt;html&gt;<br />&lt;body&gt;<br />&lt;p&gt;Это должно быть сжатой страницей.&lt;/p&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;</span></code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.ob-gzhandler-notes">
  <h3 class="title">Примечания</h3>
  <blockquote class="note"><p><strong class="note">Замечание</strong>: 
   <p class="para">
    Функции <span class="function"><strong>ob_gzhandler()</strong></span> нужен модуль <a href="ref.zlib.php.html" class="link">zlib</a>.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Замечание</strong>: 
   <p class="para">
    Нельзя одновременно вызывать функцию <span class="function"><strong>ob_gzhandler()</strong></span>
    и включать настройку <a href="zlib.configuration.php.html#ini.zlib.output-compression" class="link">zlib.output_compression</a>.
    Обратите также внимание, включение опции
    <a href="zlib.configuration.php.html#ini.zlib.output-compression" class="link">zlib.output_compression</a>
    приоритетнее вызова функции <span class="function"><strong>ob_gzhandler()</strong></span>.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.ob-gzhandler-seealso">
  <h3 class="title">Смотрите также</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.ob-start.php.html" class="function" rel="rdfs-seeAlso">ob_start()</a> - Включает буферизацию вывода</span></li>
    <li class="member"><span class="function"><a href="function.ob-end-flush.php.html" class="function" rel="rdfs-seeAlso">ob_end_flush()</a> - Сбрасывает (отправляет) возвращаемое значение активного обработчика вывода
   и отключает активный буфер вывода</span></li>
   </ul>
  </p>
 </div>


</div><section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=function.ob-gzhandler&amp;redirect=https://www.php.net/manual/ru/function.ob-gzhandler.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">29 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="97385">  <div class="votes">
    <div id="Vu97385">
    <a href="https://www.php.net/manual/vote-note.php?id=97385&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd97385">
    <a href="https://www.php.net/manual/vote-note.php?id=97385&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V97385" title="62% like this...">
    9
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#97385" class="name">
  <strong class="user"><em>Jer</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#97385"> &para;</a><div class="date" title="2010-04-16 04:17"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom97385">
<div class="phpcode"><code><span class="html">I've just spent 5 hours fighting a bug in my application and outcome is:<br /><br /><span class="default">&lt;?php<br /></span><span class="comment">// do not use<br /></span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"ob_gzhandler"</span><span class="keyword">);<br /></span><span class="comment">// along with<br /></span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.1 304 Not Modified'</span><span class="keyword">);<br /><br /></span><span class="comment">// or in the end use<br /></span><span class="default">ob_end_clean</span><span class="keyword">();<br /></span><span class="default">?&gt;<br /></span><br />W3C Standart requires response body to be empty if 304 header set. With compression on it will at least contain a gzip stream header even if your output is completely empty! <br /><br />This affects firefox (current ver.3.6.3) in a very subtle way: one of the requests after the one that gets 304 with not empty body gets it response prepended with contents of that body. In my case it was a css file and styles was not rendered at all, which made problem show up.</span></code></div>
  </div>
 </div>
  <div class="note" id="91685">  <div class="votes">
    <div id="Vu91685">
    <a href="https://www.php.net/manual/vote-note.php?id=91685&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd91685">
    <a href="https://www.php.net/manual/vote-note.php?id=91685&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V91685" title="60% like this...">
    6
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#91685" class="name">
  <strong class="user"><em>przemekryciuk at gmail dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#91685"> &para;</a><div class="date" title="2009-06-23 02:34"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom91685">
<div class="phpcode"><code><span class="html">The simplest way for gzip compression is:<br /><span class="default">&lt;?php<br /></span><span class="keyword">if(!</span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"ob_gzhandler"</span><span class="keyword">)) </span><span class="default">ob_start</span><span class="keyword">();<br /></span><span class="default">?&gt;<br /></span>ob_start("ob_gzhandler") returns FALSE if browser doesn't support gzip, so then is called normal ob_start();</span></code></div>
  </div>
 </div>
  <div class="note" id="35585">  <div class="votes">
    <div id="Vu35585">
    <a href="https://www.php.net/manual/vote-note.php?id=35585&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd35585">
    <a href="https://www.php.net/manual/vote-note.php?id=35585&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V35585" title="75% like this...">
    2
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#35585" class="name">
  <strong class="user"><em>daijoubu at videotron dot ca</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#35585"> &para;</a><div class="date" title="2003-09-06 04:35"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom35585">
<div class="phpcode"><code><span class="html">About the previous note from Davey:<br /><br />ob_start(array('ob_gzhandler',9));<br /><br />Does not work. The output size isn?t affected at all, stays the same.<br /><br />ob_gzhandler compression level use zlib.output_compression_level, which is -1 per default, level 6.<br /><br />To change the compression level on the fly, simply use ini_set:<br /><span class="default">&lt;?php<br />ini_set</span><span class="keyword">(</span><span class="string">'zlib.output_compression_level'</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">);<br /></span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br />echo </span><span class="string">'This is compressed at level 1'</span><span class="keyword">;<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="61474">  <div class="votes">
    <div id="Vu61474">
    <a href="https://www.php.net/manual/vote-note.php?id=61474&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd61474">
    <a href="https://www.php.net/manual/vote-note.php?id=61474&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V61474" title="66% like this...">
    1
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#61474" class="name">
  <strong class="user"><em>mariusads[at]helpedia[dot]com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#61474"> &para;</a><div class="date" title="2006-02-04 09:56"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom61474">
<div class="phpcode"><code><span class="html">Please be aware that, as other users have already mentioned, the compression will fail if there are characters before the php start tag "&lt; ?". <br /><br />This is also the case when saving files in UTF-8 format with editors such as Ultraedit. Make sure you save the file using the defined option UTF-8 NO BOM or delete the BOM otherwise the two UTF BOM characters will be written at the start of the file.</span></code></div>
  </div>
 </div>
  <div class="note" id="53827">  <div class="votes">
    <div id="Vu53827">
    <a href="https://www.php.net/manual/vote-note.php?id=53827&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd53827">
    <a href="https://www.php.net/manual/vote-note.php?id=53827&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V53827" title="66% like this...">
    1
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#53827" class="name">
  <strong class="user"><em>Tony Piper</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#53827"> &para;</a><div class="date" title="2005-06-14 07:11"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom53827">
<div class="phpcode"><code><span class="html">I just spent 30 minutes wondering why my browser wasn't getting the gzipped version :-O<br /><br />If you're using Google Web Access your pages will  be delivered to the browser uncompressed unless you tell GWA to ignore the specific site. <br /><br />Obvious, really.</span></code></div>
  </div>
 </div>
  <div class="note" id="51949">  <div class="votes">
    <div id="Vu51949">
    <a href="https://www.php.net/manual/vote-note.php?id=51949&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd51949">
    <a href="https://www.php.net/manual/vote-note.php?id=51949&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V51949" title="66% like this...">
    1
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#51949" class="name">
  <strong class="user"><em>m at rtij dot nl</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#51949"> &para;</a><div class="date" title="2005-04-16 05:29"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom51949">
<div class="phpcode"><code><span class="html">All versions of MSIE have a bug where they don't cache gzipd contents. If your application depends on caching, this is something to keep in mind. In the end, I did:<br /><br /><span class="default">&lt;?php<br /><br /></span><span class="comment">// These are so benificial, they default to true.<br /></span><span class="keyword">if (!isset(</span><span class="default">$use_page_cache</span><span class="keyword">))<br />    </span><span class="default">$use_page_cache </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br />if (!isset(</span><span class="default">$use_compression</span><span class="keyword">))<br />    </span><span class="default">$use_compression </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">;<br /><br /></span><span class="comment">// Add browsers here as we must detect them. Opera is an oddball, if we don't detect<br />// it specifically, it will turn up as MSIE<br /><br /></span><span class="default">$browser</span><span class="keyword">=</span><span class="string">"other"</span><span class="keyword">;<br />if (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">])) {<br />    </span><span class="default">$agent </span><span class="keyword">= </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_USER_AGENT'</span><span class="keyword">];<br />    if (</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"opera"</span><span class="keyword">,</span><span class="default">$agent</span><span class="keyword">)){<br />    </span><span class="default">$browser</span><span class="keyword">=</span><span class="string">"opera"</span><span class="keyword">;<br />    }elseif(</span><span class="default">eregi</span><span class="keyword">(</span><span class="string">"msie"</span><span class="keyword">,</span><span class="default">$agent</span><span class="keyword">)){<br />    </span><span class="default">$browser</span><span class="keyword">=</span><span class="string">"msie"</span><span class="keyword">;<br />    }<br />}<br /><br />if (</span><span class="default">$use_compression </span><span class="keyword">&amp;&amp; !( </span><span class="default">$use_page_cache </span><span class="keyword">&amp;&amp; </span><span class="default">$browser </span><span class="keyword">== </span><span class="string">"msie"</span><span class="keyword">)) {<br />    </span><span class="comment">// Turn on compression, makes quite a difference in bandwith usage.<br />    // However, MSIE (all versions) have a bug with compression and caching. So for MSIE<br />    // it's either compression or caching. We choose caching.<br />    </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br />}<br /><br /></span><span class="default">session_cache_limiter</span><span class="keyword">(</span><span class="string">"must-revalidate"</span><span class="keyword">);<br /><br /></span><span class="default">session_start</span><span class="keyword">();<br /><br /></span><span class="comment">// ... put stuff in $content ...<br /><br /></span><span class="keyword">if (</span><span class="default">$use_page_cache</span><span class="keyword">) {<br />    </span><span class="comment">// MD5 is slow, however with a fast server (PIII or better) we should be OK<br />    </span><span class="default">$hash </span><span class="keyword">= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">$content</span><span class="keyword">);<br />    </span><span class="default">$headers </span><span class="keyword">= </span><span class="default">getallheaders</span><span class="keyword">();<br />    if (isset(</span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'If-None-Match'</span><span class="keyword">]) &amp;&amp; </span><span class="default">ereg</span><span class="keyword">(</span><span class="default">$hash</span><span class="keyword">, </span><span class="default">$headers</span><span class="keyword">[</span><span class="string">'If-None-Match'</span><span class="keyword">]))<br />    {<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.1 304 Not Modified'</span><span class="keyword">);<br />    exit;<br />    }<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">"ETag: \"</span><span class="default">$hash</span><span class="string">\""</span><span class="keyword">);<br />}<br /><br />print </span><span class="default">$content</span><span class="keyword">;<br /><br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="35893">  <div class="votes">
    <div id="Vu35893">
    <a href="https://www.php.net/manual/vote-note.php?id=35893&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd35893">
    <a href="https://www.php.net/manual/vote-note.php?id=35893&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V35893" title="66% like this...">
    1
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#35893" class="name">
  <strong class="user"><em>jazfresh at SPAM-JAVELIN dot hotmail dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#35893"> &para;</a><div class="date" title="2003-09-18 07:54"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom35893">
<div class="phpcode"><code><span class="html">In the set_error_handler notes, there is a technique described for capturing all errors (even parse errors) before they are displayed the user, using a special error handler and output handler. If this output handler detects a fatal error in the output buffer, it's captured and dealt with before it can be displayed to the user. If no error was detected, then output buffer is displayed verbatim (i.e. without being compressed).<br /><br />If you are using this method, you can still take advantage of ob_gzhandler's compression. However, you MUST specify a mode argument (I'm using 4.2.2 on RedHat9). The mode value affects which headers are automatically added (Content-Encoding, etc). A value of '5' worked for me. '0' or discarding the argument produces a blank screen under Mozilla. <br /><br /><span class="default">&lt;?php<br /><br /></span><span class="keyword">function </span><span class="default">my_output_handler</span><span class="keyword">(&amp;</span><span class="default">$buffer</span><span class="keyword">) {<br />  </span><span class="comment">// Detect errors in the output<br />  </span><span class="keyword">if(</span><span class="default">ereg</span><span class="keyword">(</span><span class="string">"(error&lt;/b&gt;:)(.+) in &lt;b&gt;(.+)&lt;/b&gt; on line &lt;b&gt;(.+)&lt;/b&gt;"</span><span class="keyword">, </span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">)) {<br />    </span><span class="default">my_error_handler</span><span class="keyword">(</span><span class="default">E_ERROR</span><span class="keyword">, </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">], </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">3</span><span class="keyword">], </span><span class="default">$regs</span><span class="keyword">[</span><span class="default">4</span><span class="keyword">]);<br />    </span><span class="comment">// ...<br />    // ... Insert your error handling here ...<br />    // ...<br />    </span><span class="keyword">return </span><span class="string">'An internal error occurred.'</span><span class="keyword">;<br />  } else {<br />    </span><span class="comment">// The page rendered without any errors, so compress<br />    // and output.<br />    </span><span class="keyword">return </span><span class="default">ob_gzhandler</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">5</span><span class="keyword">);<br />  }<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="20704">  <div class="votes">
    <div id="Vu20704">
    <a href="https://www.php.net/manual/vote-note.php?id=20704&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd20704">
    <a href="https://www.php.net/manual/vote-note.php?id=20704&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V20704" title="57% like this...">
    1
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#20704" class="name">
  <strong class="user"><em>xn at bnw dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#20704"> &para;</a><div class="date" title="2002-04-12 08:40"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom20704">
<div class="phpcode"><code><span class="html">if you call ob_end_clean() after ob_start("ob_gzhandler"), the "Content-Encoding: gzip" header will still get sent (assuming the browser supports the encoding).  if you don't call ob_start() again with the ob_gzhandler callback function, the output will not be compressed, but the header will say it is.  this causes mozilla (as of build 2002032808) to display a blank page.</span></code></div>
  </div>
 </div>
  <div class="note" id="77447">  <div class="votes">
    <div id="Vu77447">
    <a href="https://www.php.net/manual/vote-note.php?id=77447&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd77447">
    <a href="https://www.php.net/manual/vote-note.php?id=77447&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V77447" title="100% like this...">
    2
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#77447" class="name">
  <strong class="user"><em>maratd at gmail dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#77447"> &para;</a><div class="date" title="2007-08-29 08:51"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom77447">
<div class="phpcode"><code><span class="html">Someone previously mentioned that MSIE doesn't cache gzipped content. This is false. He misread the source of information. In fact, IE will cache gzipped content no matter what. Here is the quote from the mailing list:<br /><br />The reason the COMPRESSED responses are, in fact,<br />always getting cached no matter what "Vary:" field name<br />is present is just as I suspected... it is because MSIE<br />decides it MUST cache responses that arrive with<br />"Content-Encoding: gzip" because it MUST have a<br />disk ( cache ) file to work with in order to do the<br />decompression.<br /><br />Source: <a href="http://lists.over.net/pipermail/mod_gzip/2002-December/006826.html" rel="nofollow" target="_blank">http://lists.over.net/pipermail/mod_gzip/2002-December/006826.html</a></span></code></div>
  </div>
 </div>
  <div class="note" id="85327">  <div class="votes">
    <div id="Vu85327">
    <a href="https://www.php.net/manual/vote-note.php?id=85327&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd85327">
    <a href="https://www.php.net/manual/vote-note.php?id=85327&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V85327" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#85327" class="name">
  <strong class="user"><em>ronald at hidden dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#85327"> &para;</a><div class="date" title="2008-08-26 01:15"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom85327">
<div class="phpcode"><code><span class="html">Hi,<br /><br />if you are using apache, I think you are much better of using apache's compression, as this will also compress static text files (css, js, html, etc) and it will keep your php-code clean.<br /><br />See <a href="http://httpd.apache.org/docs/2.0/mod/mod_deflate.html" rel="nofollow" target="_blank">http://httpd.apache.org/docs/2.0/mod/mod_deflate.html</a> for an excellent how to.<br /><br />And for other webservers, I'm pretty sure they have equivalents.<br /><br />Cheers, Ronald</span></code></div>
  </div>
 </div>
  <div class="note" id="56550">  <div class="votes">
    <div id="Vu56550">
    <a href="https://www.php.net/manual/vote-note.php?id=56550&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd56550">
    <a href="https://www.php.net/manual/vote-note.php?id=56550&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V56550" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#56550" class="name">
  <strong class="user"><em>lapoint2 at msu dot edu</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#56550"> &para;</a><div class="date" title="2005-09-06 06:40"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom56550">
<div class="phpcode"><code><span class="html">So why doesn't the web server just do this by default?  <br />This works for me if I do:<br />ini_set('zlib.output_compression_level', 3);  ob_start("ob_gzhandler"); <br />or even just:<br />ob_start("ob_gzhandler"); <br /><br />I did the level 3 compression, I think the default was 6 and I didn't want to put too much load on the server.  For a 895k file (my largest) the compression levels were:<br />1 = 189k<br />3 = 178k<br />4 = 163k<br />6 = 156k    (I believe 6 is the default if you leave out the ini_set)<br />9 = 155k<br />I use <a href="http://www.whatsmyip.org/mod_gzip_test/" rel="nofollow" target="_blank">http://www.whatsmyip.org/mod_gzip_test/</a> to check the sizes.<br /><br />FYI: This works with dynamic files in Movable Type 3.x (I'm testing it in 3.2) I've got the above command in the first line of my mtview.php file.<br /><br />More info here: <a href="http://www.whatsmyip.org/forum/viewtopic.php?t=43" rel="nofollow" target="_blank">http://www.whatsmyip.org/forum/viewtopic.php?t=43</a><br /><br />On several sites I've read the some browsers don't like compressed CSS.</span></code></div>
  </div>
 </div>
  <div class="note" id="24157">  <div class="votes">
    <div id="Vu24157">
    <a href="https://www.php.net/manual/vote-note.php?id=24157&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd24157">
    <a href="https://www.php.net/manual/vote-note.php?id=24157&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V24157" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#24157" class="name">
  <strong class="user"><em>psychones at ifrance dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#24157"> &para;</a><div class="date" title="2002-08-08 05:18"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom24157">
<div class="phpcode"><code><span class="html">Problem revelate by xn@bnw.com<br /><br />cause real problem when you have a global call<br />to ob_gzhandler , for example in an include configuration<br />file , and you want send a non gzip content , for any reason ...<br /><br />To resolve it ,<br /><br />put this after your global call to ob_gzhandler <br /><br />include("conf_that_call_ob_gzhandler.php");<br />--&gt;ob_end_clean();<br />--&gt;header("Content-Encoding: none");<br /><br />If you try to overload the header before the the ob_gzhandler call<br />or during the buffering output , it will not work .<br />( probably erase at the call of ob_gzhandler  and not allow during<br />buffering ).<br /><br />Hope this help</span></code></div>
  </div>
 </div>
  <div class="note" id="87595">  <div class="votes">
    <div id="Vu87595">
    <a href="https://www.php.net/manual/vote-note.php?id=87595&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd87595">
    <a href="https://www.php.net/manual/vote-note.php?id=87595&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V87595" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#87595" class="name">
  <strong class="user"><em>walter</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#87595"> &para;</a><div class="date" title="2008-12-11 07:48"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom87595">
<div class="phpcode"><code><span class="html">I have a very well tested module in my framework (ie: running in production environments for a couple of years) called 'fastpage', which takes care of both memcaching and gzipping for frequently requested content.  It memcaches one version of each unique page both gzipped and non-gzipped, and returns the appropriate version based upon the browser's Accept-encoding header.<br /><br />Use is: <br />$page_spec = array($dependent,$variables,$go,$here);<br />if(!fastpage_display('content_id',$page_spec)) {<br /> ... make page here ...<br /> fastpage_displayed('content_id',$page_spec);<br />}<br /><br />Unfortunately, on IE8 beta (in IE8 mode, or in IE7 emulation mode), the fastpage-enabled content was not being un-gzipped.  IE would request the content, a 200 status and correct byte count would appear in the server logfile, and IE would show no errors.  However, CSS would not be applied and Javascript would not execute.<br /><br />The only fix I can find right now is to disable gzip entirely for this browser.  User agent string is: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0; .NET CLR 2.0.50727<br /><br />The same output works fine in firefox (windows, linux, mac), and in safari.<br /><br />Versions are: zlib 1.2.3-r1 / php 5.2.6-r7 / lighttpd 1.4.20<br /><br />So much for the 'this has been fixed in IE7' comment, above...</span></code></div>
  </div>
 </div>
  <div class="note" id="75468">  <div class="votes">
    <div id="Vu75468">
    <a href="https://www.php.net/manual/vote-note.php?id=75468&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd75468">
    <a href="https://www.php.net/manual/vote-note.php?id=75468&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V75468" title="no votes...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#75468" class="name">
  <strong class="user"><em>jsnell at e-normous dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#75468"> &para;</a><div class="date" title="2007-05-31 11:04"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom75468">
<div class="phpcode"><code><span class="html">If you want to suppress errors (such as for cases when headers are already sent) and you don't want to write or patch your error_handler, you need to create an intermediate callback: <br /><br />function ob_gz_handler_no_errors($buffer) <br />{<br />    @ob_gzhandler($buffer);<br />}<br /><br />ob_start('ob_gzhandler_no_errors');</span></code></div>
  </div>
 </div>
  <div class="note" id="72656">  <div class="votes">
    <div id="Vu72656">
    <a href="https://www.php.net/manual/vote-note.php?id=72656&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd72656">
    <a href="https://www.php.net/manual/vote-note.php?id=72656&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V72656" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#72656" class="name">
  <strong class="user"><em>nicolas dot grekas+php at gmail dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#72656"> &para;</a><div class="date" title="2007-01-28 10:45"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom72656">
<div class="phpcode"><code><span class="html">Here are some precisions :<br /><br />- the "mode" arg accepts a bit field composed of PHP_OUTPUT_HANDLER_START, PHP_OUTPUT_HANDLER_CONT and PHP_OUTPUT_HANDLER_END. See <a href="http://www.php.net/manual/fr/ref.zlib.php#56216" rel="nofollow" target="_blank">http://www.php.net/manual/fr/ref.zlib.php#56216</a> for an example. The value that jazfresh recommends below (5) is the good one, because 5 == PHP_OUTPUT_HANDLER_START | PHP_OUTPUT_HANDLER_END.<br /><br />- when called INSIDE an output buffering handler, ob_gzhandler DOES NOT return false when the browser doesn't support compressed pages. It rather returns the original string.</span></code></div>
  </div>
 </div>
  <div class="note" id="69206">  <div class="votes">
    <div id="Vu69206">
    <a href="https://www.php.net/manual/vote-note.php?id=69206&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd69206">
    <a href="https://www.php.net/manual/vote-note.php?id=69206&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V69206" title="no votes...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#69206" class="name">
  <strong class="user"><em>spam_this at zleelz dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#69206"> &para;</a><div class="date" title="2006-08-26 11:49"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom69206">
<div class="phpcode"><code><span class="html">When writing scripts for distribution, I would usually "null" out the following deprecated superglobals so that users who uses the script will not be able to use them.<br /><span class="default">&lt;?php<br />$HTTP_GET_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br /></span><span class="default">$HTTP_POST_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br /></span><span class="default">$HTTP_COOKIE_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br /></span><span class="default">$HTTP_POST_FILES </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br /></span><span class="default">$HTTP_SERVER_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br /></span><span class="default">?&gt;<br /></span><br />However, when using ob_start('ob_gzhandler'), one of those superglobals somehow disable this function.<br /><br />Found out that it was $HTTP_SERVER_VARS that's causing the problems.<br /><br /><span class="default">&lt;?php<br />ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br /><br /></span><span class="default">$HTTP_GET_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br /></span><span class="default">$HTTP_POST_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br /></span><span class="default">$HTTP_COOKIE_VARS </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br /></span><span class="default">$HTTP_POST_FILES </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br /></span><span class="comment">/**<br /> * Causing the trouble<br /> */<br />//$HTTP_SERVER_VARS = null;<br /></span><span class="default">?&gt;<br /></span><br />I don't know why it does that, but I just want to point that out.</span></code></div>
  </div>
 </div>
  <div class="note" id="68034">  <div class="votes">
    <div id="Vu68034">
    <a href="https://www.php.net/manual/vote-note.php?id=68034&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd68034">
    <a href="https://www.php.net/manual/vote-note.php?id=68034&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V68034" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#68034" class="name">
  <strong class="user"><em>richard at mf2fm dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#68034"> &para;</a><div class="date" title="2006-07-11 02:50"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom68034">
<div class="phpcode"><code><span class="html">According to the manual, if ob_gzhander detects that the browser is unable to support deflate or gzip it returns FALSE.  Does this mean that if you use ob_start("ob_gzhandler"), any browsers that do not support gzip/deflate will receive a blank page?<br /><br />I've been having problems with IE6 displaying gzipped pages and adding a test:<br /><br /><span class="default">&lt;?php<br /><br /></span><span class="keyword">if (</span><span class="default">substr_count</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_ACCEPT_ENCODING'</span><span class="keyword">], </span><span class="string">'gzip'</span><span class="keyword">)) </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">"ob_gzhandler"</span><span class="keyword">);<br /><br />else </span><span class="default">ob_start</span><span class="keyword">();<br /><br /></span><span class="default">?&gt;<br /></span><br />solved the problem.  Surely if ob_gzhandler detects a lack of support for deflation it should return the input unchanged and not FALSE?</span></code></div>
  </div>
 </div>
  <div class="note" id="40894">  <div class="votes">
    <div id="Vu40894">
    <a href="https://www.php.net/manual/vote-note.php?id=40894&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd40894">
    <a href="https://www.php.net/manual/vote-note.php?id=40894&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V40894" title="no votes...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#40894" class="name">
  <strong class="user"><em>mazsolt at yahoo dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#40894"> &para;</a><div class="date" title="2004-03-18 07:20"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom40894">
<div class="phpcode"><code><span class="html">if you want to send an output to the browser (which accepts gzip), and you haven't set the buffering callback ob_start("ob_gzhandler"), you may use the gzencode() function.<br /><br />header("Content-Encoding: gzip");<br />echo gzencode("some output", 9, FORCE_GZIP);</span></code></div>
  </div>
 </div>
  <div class="note" id="35969">  <div class="votes">
    <div id="Vu35969">
    <a href="https://www.php.net/manual/vote-note.php?id=35969&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd35969">
    <a href="https://www.php.net/manual/vote-note.php?id=35969&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V35969" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#35969" class="name">
  <strong class="user"><em>brewthatistrue at plzYnoAspamHorOevilO dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#35969"> &para;</a><div class="date" title="2003-09-21 02:04"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom35969">
<div class="phpcode"><code><span class="html">i had a LOT of trouble trying to get gzipping working correctly<br />i kept getting a blank page on the first load, although subsequent pages loaded fine.<br />i tried stuff with ob_flush and ob_end_clean and all kinds of stuff i didn't understand. i'm totally confused about different versions of php and different methods of gzipping.<br /><br />in the end, i got it working (maybe i'll understand it later).<br />i ended up using phpBB's code (stripped of non-gz stuff, and ever-so-slightly modified)<br /><a href="http://phpbb.com/" rel="nofollow" target="_blank">http://phpbb.com/</a><br /><br />index.php:<br />------------<br /><span class="default">&lt;?php<br /></span><span class="keyword">require_once(</span><span class="string">'top.php'</span><span class="keyword">);<br /><br />echo </span><span class="string">"&lt;html&gt;\n&lt;head&gt;\n&lt;title&gt;Gzip Test&lt;/title&gt;\n&lt;body&gt;\n&lt;h1&gt;testing&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;"</span><span class="keyword">;<br /><br />require_once(</span><span class="string">'bottom.php'</span><span class="keyword">);<br /></span><span class="default">?&gt;<br /></span><br />gz_header.php - taken form phpBB's page_header.php<br />--------------<br /><span class="default">&lt;?php<br />    $phpver </span><span class="keyword">= </span><span class="default">phpversion</span><span class="keyword">();<br /><br />    </span><span class="default">$useragent </span><span class="keyword">= (isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"HTTP_USER_AGENT"</span><span class="keyword">]) ) ? </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">"HTTP_USER_AGENT"</span><span class="keyword">] : </span><span class="default">$HTTP_USER_AGENT</span><span class="keyword">;<br /><br />    if ( </span><span class="default">$phpver </span><span class="keyword">&gt;= </span><span class="string">'4.0.4pl1' </span><span class="keyword">&amp;&amp; ( </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$useragent</span><span class="keyword">,</span><span class="string">'compatible'</span><span class="keyword">) || </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$useragent</span><span class="keyword">,</span><span class="string">'Gecko'</span><span class="keyword">) ) )<br />    {<br />        if ( </span><span class="default">extension_loaded</span><span class="keyword">(</span><span class="string">'zlib'</span><span class="keyword">) )<br />        {<br />            </span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler'</span><span class="keyword">);<br />        }<br />    }<br />    else if ( </span><span class="default">$phpver </span><span class="keyword">&gt; </span><span class="string">'4.0' </span><span class="keyword">)<br />    {<br />        if ( </span><span class="default">strstr</span><span class="keyword">(</span><span class="default">$HTTP_SERVER_VARS</span><span class="keyword">[</span><span class="string">'HTTP_ACCEPT_ENCODING'</span><span class="keyword">], </span><span class="string">'gzip'</span><span class="keyword">) )<br />        {<br />            if ( </span><span class="default">extension_loaded</span><span class="keyword">(</span><span class="string">'zlib'</span><span class="keyword">) )<br />            {<br />                </span><span class="default">$do_gzip_compress </span><span class="keyword">= </span><span class="default">TRUE</span><span class="keyword">;<br />                </span><span class="default">ob_start</span><span class="keyword">();<br />                </span><span class="default">ob_implicit_flush</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br /><br />                </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Encoding: gzip'</span><span class="keyword">);<br />            }<br />        }<br />    }<br /></span><span class="default">?&gt;<br /></span>gz_footer.php - taken form phpBB's page_tail.php<br />------------<br /><span class="default">&lt;?php<br /></span><span class="comment">// Compress buffered output if required and send to browser<br /></span><span class="keyword">if ( </span><span class="default">$do_gzip_compress </span><span class="keyword">)<br />{<br />    </span><span class="comment">//<br />    // Borrowed from php.net!<br />    //<br />    </span><span class="default">$gzip_contents </span><span class="keyword">= </span><span class="default">ob_get_contents</span><span class="keyword">();<br />    </span><span class="default">ob_end_clean</span><span class="keyword">();<br /><br />    </span><span class="default">$gzip_size </span><span class="keyword">= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">);<br />    </span><span class="default">$gzip_crc </span><span class="keyword">= </span><span class="default">crc32</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">);<br /><br />    </span><span class="default">$gzip_contents </span><span class="keyword">= </span><span class="default">gzcompress</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">, </span><span class="default">9</span><span class="keyword">);<br />    </span><span class="default">$gzip_contents </span><span class="keyword">= </span><span class="default">substr</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$gzip_contents</span><span class="keyword">) - </span><span class="default">4</span><span class="keyword">);<br /><br />    echo </span><span class="string">"\x1f\x8b\x08\x00\x00\x00\x00\x00"</span><span class="keyword">;<br />    echo </span><span class="default">$gzip_contents</span><span class="keyword">;<br />    echo </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'V'</span><span class="keyword">, </span><span class="default">$gzip_crc</span><span class="keyword">);<br />    echo </span><span class="default">pack</span><span class="keyword">(</span><span class="string">'V'</span><span class="keyword">, </span><span class="default">$gzip_size</span><span class="keyword">);<br />}<br /><br />exit;<br /></span><span class="default">?&gt;<br /></span><br />i must admit to not seeing this working in opera 7.11. perhaps i will figure that one out.<br />if there is anything i should change email me and i can edit my post</span></code></div>
  </div>
 </div>
  <div class="note" id="31096">  <div class="votes">
    <div id="Vu31096">
    <a href="https://www.php.net/manual/vote-note.php?id=31096&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd31096">
    <a href="https://www.php.net/manual/vote-note.php?id=31096&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V31096" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#31096" class="name"><strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#31096"> &para;</a><div class="date" title="2003-04-09 10:47"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom31096">
<div class="phpcode"><code><span class="html">When using ob_start("ob_gzhandler"), be aware that the output buffer has to be flushed in order to invoke the ob_gzhandler callback function. <br /><br />This may not always happen. For example, if you use ob_get_contents() to copy the output buffer to a string for further manipulation and then silently discard the buffer with ob_end_clean(), the output buffer is never "flushed" and as a result, the ob_gzhandler callback function is never invoked. And your pages won't be compressed.<br /><br />This will be the case, for example, if you use the PHP Fusebox architecture/framework.</span></code></div>
  </div>
 </div>
  <div class="note" id="30159">  <div class="votes">
    <div id="Vu30159">
    <a href="https://www.php.net/manual/vote-note.php?id=30159&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd30159">
    <a href="https://www.php.net/manual/vote-note.php?id=30159&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V30159" title="no votes...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#30159" class="name">
  <strong class="user"><em>nospam at 1111-internet dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#30159"> &para;</a><div class="date" title="2003-03-08 03:23"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom30159">
<div class="phpcode"><code><span class="html">Differences between zlib.output_compression and ob_gzhandler:<br /><br />zlib.output_compression runs in parallel with script execution - it begins compressing as soon as it receives any output from your script, and sends data to the client each time its buffer (4K by default) gets full. ob_gzhandler (actually 'ob_start("ob_gzhandler");') will not start compressing until the script flushes (or, usually, exits), and will in turn send the entire compressed document at once - which makes it more susceptible to causing a perception of latency.<br /><br />Advantage: zlib.output_compression<br /><br />On the other hand, ob_gzhandler gives you script-level control allowing you to use it selectively or to unset it after setting it in certain cases. Despite some documentation to the contrary, zlib.output_compression does not appear to be able to be set or unset on a script level; you must instead set it globally (in php.ini) or in your webserver configs or .htaccess files, possibly using FilesMatch-type mechanisms to control which scripts it will or won't apply to - which could get unwieldy for large projects - particularly those which employ PHP to produce images and other non-text output in addition to normal text output.<br /><br />Advantage: ob_gzhandler<br /><br />Net advantage: depends on your particular needs. I'm trying zlib.output_compression for now, but I miss the flexibility that ob_gzhandler would provide.<br /><br />p.s. here's an Apache 1.3.* httpd.conf/.htaccess file snippet that demonstrates the syntax for conditionally setting zlib.output_compression:<br /><br />&lt;FilesMatch "\.(php|html?)$"&gt;<br /># turn it on with the buffer set to 2K using php_value<br />php_value zlib.output_compression 2048<br /># or just turn it on using php_flag<br /># php_flag zlib.output_compression On<br />&lt;/FilesMatch&gt;</span></code></div>
  </div>
 </div>
  <div class="note" id="26619">  <div class="votes">
    <div id="Vu26619">
    <a href="https://www.php.net/manual/vote-note.php?id=26619&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd26619">
    <a href="https://www.php.net/manual/vote-note.php?id=26619&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V26619" title="no votes...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#26619" class="name">
  <strong class="user"><em>dsugar100 at dolphinsoft dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#26619"> &para;</a><div class="date" title="2002-11-06 03:33"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom26619">
<div class="phpcode"><code><span class="html">I have noticed that if you have the php setting for zlib.output_compression set to 'On' AND you attempt to use hte ob_gzhandler handler to ob_start () the output you get in the browser WILL be garbled in PHP 4.2.3.  I'm guessing that the output buffering is compressing the output to be sent, and then zlib is doing it a second time, but the browser is only uncompressing it once.<br /><br />But using either one will give you the same results (compressed output from the script)</span></code></div>
  </div>
 </div>
  <div class="note" id="22593">  <div class="votes">
    <div id="Vu22593">
    <a href="https://www.php.net/manual/vote-note.php?id=22593&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd22593">
    <a href="https://www.php.net/manual/vote-note.php?id=22593&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V22593" title="no votes...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#22593" class="name">
  <strong class="user"><em>isoma at altavista dot net</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#22593"> &para;</a><div class="date" title="2002-06-24 07:44"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom22593">
<div class="phpcode"><code><span class="html">RFC 2616 suggests that a more correct way to compress documents on the fly is to use gzip transfer encoding rather than gzip content encoding.    However, it's perhaps not advisable to use this since client support for it is extremely limited.<br /><br />The difference is most evident when you come to save a file from your browser.  If it's gzip content encoded then the browser should (and may well) save it gzipped.  If it's gzip transfer encoded then the browser should uncompress it first.</span></code></div>
  </div>
 </div>
  <div class="note" id="19573">  <div class="votes">
    <div id="Vu19573">
    <a href="https://www.php.net/manual/vote-note.php?id=19573&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd19573">
    <a href="https://www.php.net/manual/vote-note.php?id=19573&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V19573" title="no votes...">
    0
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#19573" class="name">
  <strong class="user"><em>junior at jaj dot com</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#19573"> &para;</a><div class="date" title="2002-03-04 10:12"><strong>21 years ago</strong></div>
  <div class="text" id="Hcom19573">
<div class="phpcode"><code><span class="html">To get this to work properly, you have to compile PHP with "--with-zlib". If you don't, you won't get any errors, it just won't actually compress anything. This is a phenomenal thing. For just a small bit of processor time, you can DRASTICALLY reduce the bandwidth requirement of your scripts. There are very few circumstances in which this should not be used.</span></code></div>
  </div>
 </div>
  <div class="note" id="30943">  <div class="votes">
    <div id="Vu30943">
    <a href="https://www.php.net/manual/vote-note.php?id=30943&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd30943">
    <a href="https://www.php.net/manual/vote-note.php?id=30943&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V30943" title="0% like this...">
    -1
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#30943" class="name">
  <strong class="user"><em>davey at its-explosive dot net</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#30943"> &para;</a><div class="date" title="2003-04-03 06:41"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom30943">
<div class="phpcode"><code><span class="html">To pass the second argument to ob_gzhandler() which specifies what level of compression should be used (which I assume is 1-9 as with the gzip binary, with 9 using the most processor and time to do, 4 is the standard IIRC) you must call ob_start() like so:<br /><br />ob_start(array('ob_gzhandler',9));<br /><br />- Davey</span></code></div>
  </div>
 </div>
  <div class="note" id="30030">  <div class="votes">
    <div id="Vu30030">
    <a href="https://www.php.net/manual/vote-note.php?id=30030&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd30030">
    <a href="https://www.php.net/manual/vote-note.php?id=30030&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V30030" title="0% like this...">
    -2
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#30030" class="name">
  <strong class="user"><em>aki at robotnik dot net</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#30030"> &para;</a><div class="date" title="2003-03-04 11:13"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom30030">
<div class="phpcode"><code><span class="html">if you get errors like:<br />"output handler 'ob_gzhandler' cannot be used twice"<br />if you are using <br />"ob_start("ob_gzhandler");"<br /><br />check for your php.ini file, it should look like this:<br /><br />output_buffering = Off  ; delete the 4096k value<br />output_handler = <br />zlib.output_compression = Off</span></code></div>
  </div>
 </div>
  <div class="note" id="76845">  <div class="votes">
    <div id="Vu76845">
    <a href="https://www.php.net/manual/vote-note.php?id=76845&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd76845">
    <a href="https://www.php.net/manual/vote-note.php?id=76845&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V76845" title="33% like this...">
    -1
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#76845" class="name">
  <strong class="user"><em>tehjosh at gamingg dot net</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#76845"> &para;</a><div class="date" title="2007-08-01 04:18"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom76845">
<div class="phpcode"><code><span class="html">faisun at sina dot com:<br />If you read up on output buffering, you'll see that if an output buffer callback returns false, this instructs PHP to output the original string untouched.  That's why ob_gzhandler() returns false if the encoding is not supported.   When ob_start("ob_gzhandler") is used and encoding is not supported, ob_gzhandler() will return false and PHP outputs the original, uncompressed string.<br /><br />jsnell at e-normous dot com:<br />Output buffering callback functions accept up to two parameters, so this would probably work better for your situation:<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">function </span><span class="default">ob_gz_handler_no_errors</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">)<br />{<br />    @</span><span class="default">ob_gzhandler</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">, </span><span class="default">$mode</span><span class="keyword">);<br />}<br /><br /></span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_gzhandler_no_errors'</span><span class="keyword">);<br /></span><span class="default">?&gt;<br /></span><br />However, if you're trying to suppress errors caused by headers already being sent, it would be better to start the output buffering earlier, before any output can be sent.</span></code></div>
  </div>
 </div>
  <div class="note" id="50691">  <div class="votes">
    <div id="Vu50691">
    <a href="https://www.php.net/manual/vote-note.php?id=50691&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd50691">
    <a href="https://www.php.net/manual/vote-note.php?id=50691&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V50691" title="33% like this...">
    -2
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#50691" class="name">
  <strong class="user"><em>grange (at) club-internet (dot) fr</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#50691"> &para;</a><div class="date" title="2005-03-07 07:17"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom50691">
<div class="phpcode"><code><span class="html">It may seem obvious but if you use ob_start("ob_gzhandler"),  make sure no content is unintentionally echo'ed before : this could be blank lines before '&lt;?php' or after '?&gt;' tags in included files or even errors.<br /><br />Otherwise, only a part of the content (the content sent after ob_start()) will be compressed, which will confuse the client.<br /><br />Setting compression using zlib.output_compression either in php.ini or in Apache configuration file (with directive php_flag) is safer in this regard.</span></code></div>
  </div>
 </div>
  <div class="note" id="53157">  <div class="votes">
    <div id="Vu53157">
    <a href="https://www.php.net/manual/vote-note.php?id=53157&amp;page=function.ob-gzhandler&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd53157">
    <a href="https://www.php.net/manual/vote-note.php?id=53157&amp;page=function.ob-gzhandler&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V53157" title="0% like this...">
    -3
    </div>
  </div>
  <a href="function.ob-gzhandler.php.html#53157" class="name"><strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="function.ob-gzhandler.php.html#53157"> &para;</a><div class="date" title="2005-05-24 03:27"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom53157">
<div class="phpcode"><code><span class="html">No matter the circumstances, you MUST NOT check the user agent string to find out if gzip compression is enabled. HTTP defines the Accept-Encoding header for exactly this purpose and you MUST check it before enabling compression.</span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=function.ob-gzhandler&amp;redirect=https://www.php.net/manual/ru/function.ob-gzhandler.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="ref.zlib.php.html">Функции Zlib</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="function.deflate-add.php.html" title="deflate_&#8203;add">deflate_&#8203;add</a>
                        </li>
                                                <li class="">
                            <a href="function.deflate-init.php.html" title="deflate_&#8203;init">deflate_&#8203;init</a>
                        </li>
                                                <li class="">
                            <a href="function.gzclose.php.html" title="gzclose">gzclose</a>
                        </li>
                                                <li class="">
                            <a href="function.gzcompress.php.html" title="gzcompress">gzcompress</a>
                        </li>
                                                <li class="">
                            <a href="function.gzdecode.php.html" title="gzdecode">gzdecode</a>
                        </li>
                                                <li class="">
                            <a href="function.gzdeflate.php.html" title="gzdeflate">gzdeflate</a>
                        </li>
                                                <li class="">
                            <a href="function.gzencode.php.html" title="gzencode">gzencode</a>
                        </li>
                                                <li class="">
                            <a href="function.gzeof.php.html" title="gzeof">gzeof</a>
                        </li>
                                                <li class="">
                            <a href="function.gzfile.php.html" title="gzfile">gzfile</a>
                        </li>
                                                <li class="">
                            <a href="function.gzgetc.php.html" title="gzgetc">gzgetc</a>
                        </li>
                                                <li class="">
                            <a href="function.gzgets.php.html" title="gzgets">gzgets</a>
                        </li>
                                                <li class="">
                            <a href="function.gzgetss.php.html" title="gzgetss">gzgetss</a>
                        </li>
                                                <li class="">
                            <a href="function.gzinflate.php.html" title="gzinflate">gzinflate</a>
                        </li>
                                                <li class="">
                            <a href="function.gzopen.php.html" title="gzopen">gzopen</a>
                        </li>
                                                <li class="">
                            <a href="function.gzpassthru.php.html" title="gzpassthru">gzpassthru</a>
                        </li>
                                                <li class="">
                            <a href="function.gzputs.php.html" title="gzputs">gzputs</a>
                        </li>
                                                <li class="">
                            <a href="function.gzread.php.html" title="gzread">gzread</a>
                        </li>
                                                <li class="">
                            <a href="function.gzrewind.php.html" title="gzrewind">gzrewind</a>
                        </li>
                                                <li class="">
                            <a href="function.gzseek.php.html" title="gzseek">gzseek</a>
                        </li>
                                                <li class="">
                            <a href="function.gztell.php.html" title="gztell">gztell</a>
                        </li>
                                                <li class="">
                            <a href="function.gzuncompress.php.html" title="gzuncompress">gzuncompress</a>
                        </li>
                                                <li class="">
                            <a href="function.gzwrite.php.html" title="gzwrite">gzwrite</a>
                        </li>
                                                <li class="">
                            <a href="function.inflate-add.php.html" title="inflate_&#8203;add">inflate_&#8203;add</a>
                        </li>
                                                <li class="">
                            <a href="function.inflate-get-read-len.php.html" title="inflate_&#8203;get_&#8203;read_&#8203;len">inflate_&#8203;get_&#8203;read_&#8203;len</a>
                        </li>
                                                <li class="">
                            <a href="function.inflate-get-status.php.html" title="inflate_&#8203;get_&#8203;status">inflate_&#8203;get_&#8203;status</a>
                        </li>
                                                <li class="">
                            <a href="function.inflate-init.php.html" title="inflate_&#8203;init">inflate_&#8203;init</a>
                        </li>
                                                <li class="current">
                            <a href="function.ob-gzhandler.php.html" title="ob_&#8203;gzhandler">ob_&#8203;gzhandler</a>
                        </li>
                                                <li class="">
                            <a href="function.readgzfile.php.html" title="readgzfile">readgzfile</a>
                        </li>
                                                <li class="">
                            <a href="function.zlib-decode.php.html" title="zlib_&#8203;decode">zlib_&#8203;decode</a>
                        </li>
                                                <li class="">
                            <a href="function.zlib-encode.php.html" title="zlib_&#8203;encode">zlib_&#8203;encode</a>
                        </li>
                                                <li class="">
                            <a href="function.zlib-get-coding-type.php.html" title="zlib_&#8203;get_&#8203;coding_&#8203;type">zlib_&#8203;get_&#8203;coding_&#8203;type</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
