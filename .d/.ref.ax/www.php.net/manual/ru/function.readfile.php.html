<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: readfile - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.readfile.php.html">
 <link rel="shorturl" href="https://www.php.net/readfile">
 <link rel="alternate" href="https://www.php.net/readfile" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="ref.filesystem.php.html">
 <link rel="prev" href="function.popen.php.html">
 <link rel="next" href="function.readlink.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/function.readfile.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/function.readfile.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/function.readfile.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.readfile.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/function.readfile.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.readfile.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.readfile.php" hreflang="pt_BR">
 <link rel="alternate" href="function.readfile.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.readfile.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.readfile.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="function.readlink.php.html">
          readlink &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="function.popen.php.html">
          &laquo; popen        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='funcref.php.html'>Справочник функций</a></li>      <li><a href='refs.fileprocess.file.php.html'>Модули для работы с файловой системой</a></li>      <li><a href='book.filesystem.php.html'>Файловая система</a></li>      <li><a href='ref.filesystem.php.html'>Функции файловой системы</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/function.readfile.php'>English</option>
            <option value='de/function.readfile.php'>German</option>
            <option value='es/function.readfile.php'>Spanish</option>
            <option value='fr/function.readfile.php'>French</option>
            <option value='it/function.readfile.php'>Italian</option>
            <option value='ja/function.readfile.php'>Japanese</option>
            <option value='pt_BR/function.readfile.php'>Brazilian Portuguese</option>
            <option value='ru/function.readfile.php' selected="selected">Russian</option>
            <option value='tr/function.readfile.php'>Turkish</option>
            <option value='zh/function.readfile.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/reference/filesystem/functions/readfile.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Ffunction.readfile%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="function.readfile" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">readfile</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">readfile</span> &mdash; <span class="dc-title">Выводит файл</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.readfile-description">
  <h3 class="title">Описание</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>readfile</strong></span>(<span class="methodparam"><span class="type">string</span> <code class="parameter">$filename</code></span>, <span class="methodparam"><span class="type">bool</span> <code class="parameter">$use_include_path</code><span class="initializer"> = <strong><code>false</code></strong></span></span>, <span class="methodparam"><span class="type">?</span><span class="type"><span class="type">resource</span><span class="type"></span></span> <code class="parameter">$context</code><span class="initializer"> = <strong><code>null</code></strong></span></span>): <span class="type"><span class="type">int</span>|<span class="type"><span class="type false">false</span></span></span></div>

  <p class="para rdfs-comment">
   Читает файл и записывает его в буфер вывода.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.readfile-parameters">
  <h3 class="title">Список параметров</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">filename</code></dt>

     <dd>

      <p class="para">
       Имя читаемого файла.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">use_include_path</code></dt>

     <dd>

      <p class="para">
       Если вы хотите, чтобы использовался поиск файла в <a href="ini.core.php.html#ini.include-path" class="link">include_path</a>,
       установите этот параметр в <strong><code>true</code></strong>.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">context</code></dt>

     <dd>

       <p class="para">Ресурс (<span class="type">resource</span>)
с <a href="stream.contexts.php.html" class="link">контекстом потока</a>.</p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.readfile-returnvalues">
  <h3 class="title">Возвращаемые значения</h3>
  <p class="para">
   Возвращает количество прочитанных из файла байт в случае успешного выполнения или <strong><code>false</code></strong> в случае возникновения ошибки
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.readfile-errors">
  <h3 class="title">Ошибки</h3>
  <p class="para">
В случае неудачного завершения работы генерируется ошибка уровня <strong><code>E_WARNING</code></strong>.
</p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.readfile-examples">
  <h3 class="title">Примеры</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Пример #1 Принудительная загрузка с помощью <span class="function"><strong>readfile()</strong></span></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$file </span><span style="color: #007700">= </span><span style="color: #DD0000">'monkey.gif'</span><span style="color: #007700">;<br /><br />if (</span><span style="color: #0000BB">file_exists</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)) {<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Description: File Transfer'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Type: application/octet-stream'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Disposition: attachment; filename="'</span><span style="color: #007700">.</span><span style="color: #0000BB">basename</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">).</span><span style="color: #DD0000">'"'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Expires: 0'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Cache-Control: must-revalidate'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Pragma: public'</span><span style="color: #007700">);<br />    </span><span style="color: #0000BB">header</span><span style="color: #007700">(</span><span style="color: #DD0000">'Content-Length: ' </span><span style="color: #007700">. </span><span style="color: #0000BB">filesize</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">));<br />    </span><span style="color: #0000BB">readfile</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">);<br />    exit;<br />}<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

    
<div class="example-contents"><p>
 Вывод приведённого примера будет похож на:
</p></div>

    <div class="mediaobject">
     
     <div class="imageobject">
      <img src="images/e88cefb5c3fca5060e2490b9763c4433-readfile.png" alt="Диалог открытия / сохранения файла" width="319" height="245" />
     </div>
    </div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.readfile-notes">
  <h3 class="title">Примечания</h3>

  <blockquote class="note"><p><strong class="note">Замечание</strong>: 
   <p class="para">
    <span class="function"><strong>readfile()</strong></span> сама по себе не приводит
    к каким-либо проблемам с памятью, даже при отправке больших
    файлов. При возникновении ошибки превышения памяти убедитесь,
    что буферизация вывода отключена с помощью
    <span class="function"><a href="function.ob-get-level.php.html" class="function">ob_get_level()</a></span>.
   </p>
  </p></blockquote>

  <div class="tip"><strong class="tip">Подсказка</strong><p class="simpara">В эту функцию в качестве имени файла
можно передавать URL-адреса, если была включена директива <a href="filesystem.configuration.php.html#ini.allow-url-fopen" class="link">fopen wrappers</a>.
Подробнее о том, как указать имя файла, рассказано в описании функции <span class="function"><a href="function.fopen.php.html" class="function">fopen()</a></span>.
В разделе «<a href="wrappers.php.html" class="xref">Поддерживаемые протоколы и обёртки</a>» также даны ссылки на информацию о способностях поддерживаемых обёрток,
замечания по работе с ними и список
предопределённых переменных, которые они дают.</p></div>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.readfile-seealso">
  <h3 class="title">Смотрите также</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.fpassthru.php.html" class="function" rel="rdfs-seeAlso">fpassthru()</a> - Выводит все оставшиеся данные из файлового указателя</span></li>
    <li class="member"><span class="function"><a href="function.file.php.html" class="function" rel="rdfs-seeAlso">file()</a> - Читает содержимое файла и помещает его в массив</span></li>
    <li class="member"><span class="function"><a href="function.fopen.php.html" class="function" rel="rdfs-seeAlso">fopen()</a> - Открывает файл или URL</span></li>
    <li class="member"><span class="function"><a href="function.include.php.html" class="function" rel="rdfs-seeAlso">include</a> - include</span></li>
    <li class="member"><span class="function"><a href="function.require.php.html" class="function" rel="rdfs-seeAlso">require</a> - require</span></li>
    <li class="member"><span class="function"><a href="function.virtual.php.html" class="function" rel="rdfs-seeAlso">virtual()</a> - Выполняет подзапрос Apache</span></li>
    <li class="member"><span class="function"><a href="function.file-get-contents.php.html" class="function" rel="rdfs-seeAlso">file_get_contents()</a> - Читает содержимое файла в строку</span></li>
    <li class="member"><a href="wrappers.php.html" class="xref">Поддерживаемые протоколы и обёртки</a></li>
   </ul>
  </p>
 </div>


</div><section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=function.readfile&amp;redirect=https://www.php.net/manual/ru/function.readfile.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">36 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="114450">  <div class="votes">
    <div id="Vu114450">
    <a href="https://www.php.net/manual/vote-note.php?id=114450&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd114450">
    <a href="https://www.php.net/manual/vote-note.php?id=114450&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V114450" title="68% like this...">
    61
    </div>
  </div>
  <a href="function.readfile.php.html#114450" class="name">
  <strong class="user"><em>riksoft at gmail dot com</em></strong></a><a class="genanchor" href="function.readfile.php.html#114450"> &para;</a><div class="date" title="2014-02-21 06:03"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom114450">
<div class="phpcode"><code><span class="html">Just a note for those who face problems on names containing spaces (e.g. "test test.pdf").<br /><br />In the examples (99% of the time) you can find<br />header('Content-Disposition: attachment; filename='.basename($file));<br /><br />but the correct way to set the filename is quoting it (double quote):<br />header('Content-Disposition: attachment; filename="'.basename($file).'"' );<br /><br />Some browsers may work without quotation, but for sure not Firefox and as Mozilla explains, the quotation of the filename in the content-disposition is according to the RFC<br /><a href="http://kb.mozillazine.org/Filenames_with_spaces_are_truncated_upon_download" rel="nofollow" target="_blank">http://kb.mozillazine.org/Filenames_with_spaces_are_truncated_upon_download</a></span></code></div>
  </div>
 </div>
  <div class="note" id="83653">  <div class="votes">
    <div id="Vu83653">
    <a href="https://www.php.net/manual/vote-note.php?id=83653&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd83653">
    <a href="https://www.php.net/manual/vote-note.php?id=83653&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V83653" title="63% like this...">
    65
    </div>
  </div>
  <a href="function.readfile.php.html#83653" class="name">
  <strong class="user"><em>yura_imbp at mail dot ru</em></strong></a><a class="genanchor" href="function.readfile.php.html#83653"> &para;</a><div class="date" title="2008-06-05 09:46"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom83653">
<div class="phpcode"><code><span class="html">if you need to limit download rate, use this code <br /><br /><span class="default">&lt;?php<br />$local_file </span><span class="keyword">= </span><span class="string">'file.zip'</span><span class="keyword">;<br /></span><span class="default">$download_file </span><span class="keyword">= </span><span class="string">'name.zip'</span><span class="keyword">;<br /><br /></span><span class="comment">// set the download rate limit (=&gt; 20,5 kb/s)<br /></span><span class="default">$download_rate </span><span class="keyword">= </span><span class="default">20.5</span><span class="keyword">;<br />if(</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$local_file</span><span class="keyword">) &amp;&amp; </span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$local_file</span><span class="keyword">))<br />{<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Cache-control: private'</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: application/octet-stream'</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length: '</span><span class="keyword">.</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$local_file</span><span class="keyword">));<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Disposition: filename='</span><span class="keyword">.</span><span class="default">$download_file</span><span class="keyword">);<br /><br />    </span><span class="default">flush</span><span class="keyword">();<br />    </span><span class="default">$file </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$local_file</span><span class="keyword">, </span><span class="string">"r"</span><span class="keyword">);<br />    while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">))<br />    {<br />        </span><span class="comment">// send the current file part to the browser<br />        </span><span class="keyword">print </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">, </span><span class="default">round</span><span class="keyword">(</span><span class="default">$download_rate </span><span class="keyword">* </span><span class="default">1024</span><span class="keyword">));<br />        </span><span class="comment">// flush the content to the browser<br />        </span><span class="default">flush</span><span class="keyword">();<br />        </span><span class="comment">// sleep one second<br />        </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />    }<br />    </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);}<br />else {<br />    die(</span><span class="string">'Error: The file '</span><span class="keyword">.</span><span class="default">$local_file</span><span class="keyword">.</span><span class="string">' does not exist!'</span><span class="keyword">);<br />}<br /><br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="78582">  <div class="votes">
    <div id="Vu78582">
    <a href="https://www.php.net/manual/vote-note.php?id=78582&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd78582">
    <a href="https://www.php.net/manual/vote-note.php?id=78582&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V78582" title="62% like this...">
    13
    </div>
  </div>
  <a href="function.readfile.php.html#78582" class="name">
  <strong class="user"><em>Hayley Watson</em></strong></a><a class="genanchor" href="function.readfile.php.html#78582"> &para;</a><div class="date" title="2007-10-17 09:27"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom78582">
<div class="phpcode"><code><span class="html">To avoid the risk of choosing themselves which files to download by messing with the request and doing things like inserting "../" into the "filename", simply remember that URLs are not file paths, and there's no reason why the mapping between them has to be so literal as "download.php?file=thingy.mpg" resulting in the download of the file "thingy.mpg".<br /><br />It's your script and you have full control over how it maps file requests to file names, and which requests retrieve which files.<br /><br />But even then, as ever, never trust ANYTHING in the request. Basic first-day-at-school security principle, that.</span></code></div>
  </div>
 </div>
  <div class="note" id="52598">  <div class="votes">
    <div id="Vu52598">
    <a href="https://www.php.net/manual/vote-note.php?id=52598&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd52598">
    <a href="https://www.php.net/manual/vote-note.php?id=52598&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V52598" title="62% like this...">
    13
    </div>
  </div>
  <a href="function.readfile.php.html#52598" class="name">
  <strong class="user"><em>flobee at gmail dot com</em></strong></a><a class="genanchor" href="function.readfile.php.html#52598"> &para;</a><div class="date" title="2005-05-06 11:17"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom52598">
<div class="phpcode"><code><span class="html">regarding php5:<br />i found out that there is already a disscussion @php-dev  about readfile() and fpassthru() where only exactly 2 MB will be delivered.<br /><br />so you may use this on php5 to get lager files<br /><span class="default">&lt;?php<br /></span><span class="keyword">function </span><span class="default">readfile_chunked</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">$retbytes</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {<br />    </span><span class="default">$chunksize </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">*(</span><span class="default">1024</span><span class="keyword">*</span><span class="default">1024</span><span class="keyword">); </span><span class="comment">// how many bytes per chunk<br />    </span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />    </span><span class="default">$cnt </span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />    </span><span class="comment">// $handle = fopen($filename, 'rb');<br />    </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">);<br />    if (</span><span class="default">$handle </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br />        return </span><span class="default">false</span><span class="keyword">;<br />    }<br />    while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br />        </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$chunksize</span><span class="keyword">);<br />        echo </span><span class="default">$buffer</span><span class="keyword">;<br />        if (</span><span class="default">$retbytes</span><span class="keyword">) {<br />            </span><span class="default">$cnt </span><span class="keyword">+= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">);<br />        }<br />    }<br />        </span><span class="default">$status </span><span class="keyword">= </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />    if (</span><span class="default">$retbytes </span><span class="keyword">&amp;&amp; </span><span class="default">$status</span><span class="keyword">) {<br />        return </span><span class="default">$cnt</span><span class="keyword">; </span><span class="comment">// return num. bytes delivered like readfile() does.<br />    </span><span class="keyword">} <br />    return </span><span class="default">$status</span><span class="keyword">;<br /><br />} <br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="81925">  <div class="votes">
    <div id="Vu81925">
    <a href="https://www.php.net/manual/vote-note.php?id=81925&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd81925">
    <a href="https://www.php.net/manual/vote-note.php?id=81925&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V81925" title="57% like this...">
    20
    </div>
  </div>
  <a href="function.readfile.php.html#81925" class="name">
  <strong class="user"><em>marro at email dot cz</em></strong></a><a class="genanchor" href="function.readfile.php.html#81925"> &para;</a><div class="date" title="2008-03-19 11:17"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom81925">
<div class="phpcode"><code><span class="html">My script working correctly on IE6 and Firefox 2 with any typ e of files (I hope :))<br /><br />function DownloadFile($file) { // $file = include path <br />        if(file_exists($file)) {<br />            header('Content-Description: File Transfer');<br />            header('Content-Type: application/octet-stream');<br />            header('Content-Disposition: attachment; filename='.basename($file));<br />            header('Content-Transfer-Encoding: binary');<br />            header('Expires: 0');<br />            header('Cache-Control: must-revalidate, post-check=0, pre-check=0');<br />            header('Pragma: public');<br />            header('Content-Length: ' . filesize($file));<br />            ob_clean();<br />            flush();<br />            readfile($file);<br />            exit;<br />        }<br /><br />    }<br /><br />Run on Apache 2 (WIN32) PHP5</span></code></div>
  </div>
 </div>
  <div class="note" id="81032">  <div class="votes">
    <div id="Vu81032">
    <a href="https://www.php.net/manual/vote-note.php?id=81032&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd81032">
    <a href="https://www.php.net/manual/vote-note.php?id=81032&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V81032" title="58% like this...">
    15
    </div>
  </div>
  <a href="function.readfile.php.html#81032" class="name">
  <strong class="user"><em>TimB</em></strong></a><a class="genanchor" href="function.readfile.php.html#81032"> &para;</a><div class="date" title="2008-02-11 02:23"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom81032">
<div class="phpcode"><code><span class="html">To anyone that's had problems with Readfile() reading large files into memory the problem is not Readfile() itself, it's because you have output buffering on. Just turn off output buffering immediately before the call to Readfile(). Use something like ob_end_flush().</span></code></div>
  </div>
 </div>
  <div class="note" id="86478">  <div class="votes">
    <div id="Vu86478">
    <a href="https://www.php.net/manual/vote-note.php?id=86478&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd86478">
    <a href="https://www.php.net/manual/vote-note.php?id=86478&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V86478" title="62% like this...">
    7
    </div>
  </div>
  <a href="function.readfile.php.html#86478" class="name">
  <strong class="user"><em>levhita at gmail dot com</em></strong></a><a class="genanchor" href="function.readfile.php.html#86478"> &para;</a><div class="date" title="2008-10-21 12:59"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom86478">
<div class="phpcode"><code><span class="html">A note on the smartReadFile function from gaosipov:<br /><br />Change the indexes on the preg_match matches to:<br />      <br />      $begin = intval($matches[1]);<br />      if( !empty($matches[2]) ) {<br />        $end = intval($matches[2]);<br />      }<br /><br />Otherwise the $begin would be set to the entire section matched and the $end to what should be the begin.<br /><br />See preg_match for more details on this.</span></code></div>
  </div>
 </div>
  <div class="note" id="122771">  <div class="votes">
    <div id="Vu122771">
    <a href="https://www.php.net/manual/vote-note.php?id=122771&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd122771">
    <a href="https://www.php.net/manual/vote-note.php?id=122771&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V122771" title="61% like this...">
    5
    </div>
  </div>
  <a href="function.readfile.php.html#122771" class="name">
  <strong class="user"><em>Paulinator</em></strong></a><a class="genanchor" href="function.readfile.php.html#122771"> &para;</a><div class="date" title="2018-05-27 09:45"><strong>5 years ago</strong></div>
  <div class="text" id="Hcom122771">
<div class="phpcode"><code><span class="html">Always using MIME-Type 'application/octet-stream' is not optimal. Most if not all browsers will simply download files with that type.<br /><br />If you use proper MIME types (and inline Content-Disposition), browsers will have better default actions for some of them. Eg. in case of images, browsers will display them, which is probably what you'd want.<br /><br />To deliver the file with the proper MIME type, the easiest way is to use:<br /><br />header('Content-Type: ' . mime_content_type($file)); <br />header('Content-Disposition: inline; filename="'.basename($file).'"');</span></code></div>
  </div>
 </div>
  <div class="note" id="125826">  <div class="votes">
    <div id="Vu125826">
    <a href="https://www.php.net/manual/vote-note.php?id=125826&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd125826">
    <a href="https://www.php.net/manual/vote-note.php?id=125826&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V125826" title="57% like this...">
    1
    </div>
  </div>
  <a href="function.readfile.php.html#125826" class="name">
  <strong class="user"><em>simbiat at outlook dot com</em></strong></a><a class="genanchor" href="function.readfile.php.html#125826"> &para;</a><div class="date" title="2021-02-15 08:28"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom125826">
<div class="phpcode"><code><span class="html">flobee.at.gmail.dot.com shared "readfile_chunked" function. It does work, but you may encounter memory exhaustion using "fread". Meanwhile "stream_copy_to_stream" seems to utilize the same amount of memory as "readfile". At least, when I was testing "download" function for my <a href="https://github.com/Simbiat/HTTP20" rel="nofollow" target="_blank">https://github.com/Simbiat/HTTP20</a> library on 1.5G file with 256M memory limitation that was the case: "fread" I got peak memory usage of ~240M, while with "stream_copy_to_stream" - ~150M.<br />It does not mean that you can fully escape memory exhaustion, though: if you are reading too much at a time, you can still encounter it. That is why in my library I use a helper function ("speedLimit") to calculate whether selected speed limit will fit the available memory (while allowing some headroom).<br />You can read comments in the code itself for more details and raise issues for the library, if you think something is incorrect there (especially since it's WIP at the moment of writing this), but so far I am able to get consistent behavior with it.</span></code></div>
  </div>
 </div>
  <div class="note" id="86244">  <div class="votes">
    <div id="Vu86244">
    <a href="https://www.php.net/manual/vote-note.php?id=86244&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd86244">
    <a href="https://www.php.net/manual/vote-note.php?id=86244&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V86244" title="54% like this...">
    5
    </div>
  </div>
  <a href="function.readfile.php.html#86244" class="name">
  <strong class="user"><em>gaosipov at gmail dot com</em></strong></a><a class="genanchor" href="function.readfile.php.html#86244"> &para;</a><div class="date" title="2008-10-09 02:08"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom86244">
<div class="phpcode"><code><span class="html">Send file with HTTPRange support (partial download):<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">function </span><span class="default">smartReadFile</span><span class="keyword">(</span><span class="default">$location</span><span class="keyword">, </span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$mimeType</span><span class="keyword">=</span><span class="string">'application/octet-stream'</span><span class="keyword">)<br />{ if(!</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$location</span><span class="keyword">))<br />  { </span><span class="default">header </span><span class="keyword">(</span><span class="string">"HTTP/1.0 404 Not Found"</span><span class="keyword">);<br />    return;<br />  }<br />  <br />  </span><span class="default">$size</span><span class="keyword">=</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$location</span><span class="keyword">);<br />  </span><span class="default">$time</span><span class="keyword">=</span><span class="default">date</span><span class="keyword">(</span><span class="string">'r'</span><span class="keyword">,</span><span class="default">filemtime</span><span class="keyword">(</span><span class="default">$location</span><span class="keyword">));<br />  <br />  </span><span class="default">$fm</span><span class="keyword">=@</span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$location</span><span class="keyword">,</span><span class="string">'rb'</span><span class="keyword">);<br />  if(!</span><span class="default">$fm</span><span class="keyword">)<br />  { </span><span class="default">header </span><span class="keyword">(</span><span class="string">"HTTP/1.0 505 Internal server error"</span><span class="keyword">);<br />    return;<br />  }<br />  <br />  </span><span class="default">$begin</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />  </span><span class="default">$end</span><span class="keyword">=</span><span class="default">$size</span><span class="keyword">;<br />  <br />  if(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_RANGE'</span><span class="keyword">]))<br />  { if(</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">'/bytes=\h*(\d+)-(\d*)[\D.*]?/i'</span><span class="keyword">, </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_RANGE'</span><span class="keyword">], </span><span class="default">$matches</span><span class="keyword">))<br />    { </span><span class="default">$begin</span><span class="keyword">=</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">]);<br />      if(!empty(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]))<br />        </span><span class="default">$end</span><span class="keyword">=</span><span class="default">intval</span><span class="keyword">(</span><span class="default">$matches</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">]);<br />    }<br />  }<br />  <br />  if(</span><span class="default">$begin</span><span class="keyword">&gt;</span><span class="default">0</span><span class="keyword">||</span><span class="default">$end</span><span class="keyword">&lt;</span><span class="default">$size</span><span class="keyword">)<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 206 Partial Content'</span><span class="keyword">);<br />  else<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 200 OK'</span><span class="keyword">);  <br />  <br />  </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: </span><span class="default">$mimeType</span><span class="string">"</span><span class="keyword">); <br />  </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Cache-Control: public, must-revalidate, max-age=0'</span><span class="keyword">);<br />  </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Pragma: no-cache'</span><span class="keyword">);  <br />  </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Accept-Ranges: bytes'</span><span class="keyword">);<br />  </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length:'</span><span class="keyword">.(</span><span class="default">$end</span><span class="keyword">-</span><span class="default">$begin</span><span class="keyword">));<br />  </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Range: bytes </span><span class="default">$begin</span><span class="string">-</span><span class="default">$end</span><span class="string">/</span><span class="default">$size</span><span class="string">"</span><span class="keyword">);<br />  </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Disposition: inline; filename=</span><span class="default">$filename</span><span class="string">"</span><span class="keyword">);<br />  </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Transfer-Encoding: binary\n"</span><span class="keyword">);<br />  </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Last-Modified: </span><span class="default">$time</span><span class="string">"</span><span class="keyword">);<br />  </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Connection: close'</span><span class="keyword">);  <br />  <br />  </span><span class="default">$cur</span><span class="keyword">=</span><span class="default">$begin</span><span class="keyword">;<br />  </span><span class="default">fseek</span><span class="keyword">(</span><span class="default">$fm</span><span class="keyword">,</span><span class="default">$begin</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br /><br />  while(!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$fm</span><span class="keyword">)&amp;&amp;</span><span class="default">$cur</span><span class="keyword">&lt;</span><span class="default">$end</span><span class="keyword">&amp;&amp;(</span><span class="default">connection_status</span><span class="keyword">()==</span><span class="default">0</span><span class="keyword">))<br />  { print </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$fm</span><span class="keyword">,</span><span class="default">min</span><span class="keyword">(</span><span class="default">1024</span><span class="keyword">*</span><span class="default">16</span><span class="keyword">,</span><span class="default">$end</span><span class="keyword">-</span><span class="default">$cur</span><span class="keyword">));<br />    </span><span class="default">$cur</span><span class="keyword">+=</span><span class="default">1024</span><span class="keyword">*</span><span class="default">16</span><span class="keyword">;<br />  }<br />}<br /></span><span class="default">?&gt;<br /></span><br />Usage:<br /><br /><span class="default">&lt;?php<br />smartReadFile</span><span class="keyword">(</span><span class="string">"/tmp/filename"</span><span class="keyword">,</span><span class="string">"myfile.mp3"</span><span class="keyword">,</span><span class="string">"audio/mpeg"</span><span class="keyword">)<br /></span><span class="default">?&gt;<br /></span><br />It can be slow for big files to read by fread, but this is a single way to read file in strict bounds. You can modify this and add fpassthru instead of fread and while, but it sends all data from begin --- it would be not fruitful if request is bytes from 100 to 200 from 100mb file.</span></code></div>
  </div>
 </div>
  <div class="note" id="103837">  <div class="votes">
    <div id="Vu103837">
    <a href="https://www.php.net/manual/vote-note.php?id=103837&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd103837">
    <a href="https://www.php.net/manual/vote-note.php?id=103837&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V103837" title="52% like this...">
    2
    </div>
  </div>
  <a href="function.readfile.php.html#103837" class="name">
  <strong class="user"><em>daren -remove-me- schwenke</em></strong></a><a class="genanchor" href="function.readfile.php.html#103837"> &para;</a><div class="date" title="2011-05-05 08:52"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom103837">
<div class="phpcode"><code><span class="html">If you are lucky enough to not be on shared hosting and have apache, look at installing mod_xsendfile.<br />This was the only way I found to both protect and transfer very large files with PHP (gigabytes).  <br />It's also proved to be much faster for basically any file.<br />Available directives have changed since the other note on this and XSendFileAllowAbove was replaced with XSendFilePath to allow more control over access to files outside of webroot.<br /><br />Download the source.<br /><br />Install with: apxs -cia mod_xsendfile.c<br /><br />Add the appropriate configuration directives to your .htaccess or httpd.conf files:<br /># Turn it on<br />XSendFile on<br /># Whitelist a target directory.<br />XSendFilePath /tmp/blah<br /><br />Then to use it in your script:<br /><span class="default">&lt;?php<br />$file </span><span class="keyword">= </span><span class="string">'/tmp/blah/foo.iso'</span><span class="keyword">;<br /></span><span class="default">$download_name </span><span class="keyword">= </span><span class="default">basename</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)) {<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: application/octet-stream'</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Disposition: attachment; filename='</span><span class="keyword">.</span><span class="default">$download_name</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'X-Sendfile: '</span><span class="keyword">.</span><span class="default">$file</span><span class="keyword">);<br />    exit;<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="126169">  <div class="votes">
    <div id="Vu126169">
    <a href="https://www.php.net/manual/vote-note.php?id=126169&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd126169">
    <a href="https://www.php.net/manual/vote-note.php?id=126169&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V126169" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.readfile.php.html#126169" class="name">
  <strong class="user"><em>jorensmerenjanu at gmail dot com</em></strong></a><a class="genanchor" href="function.readfile.php.html#126169"> &para;</a><div class="date" title="2021-06-14 08:31"><strong>2 years ago</strong></div>
  <div class="text" id="Hcom126169">
<div class="phpcode"><code><span class="html">For anyone having the problem of your html page being outputted in the downloaded file: call the functions ob_clean() and flush() before readfile()</span></code></div>
  </div>
 </div>
  <div class="note" id="54295">  <div class="votes">
    <div id="Vu54295">
    <a href="https://www.php.net/manual/vote-note.php?id=54295&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd54295">
    <a href="https://www.php.net/manual/vote-note.php?id=54295&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V54295" title="52% like this...">
    2
    </div>
  </div>
  <a href="function.readfile.php.html#54295" class="name">
  <strong class="user"><em>chrisputnam at gmail dot com</em></strong></a><a class="genanchor" href="function.readfile.php.html#54295"> &para;</a><div class="date" title="2005-06-29 01:44"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom54295">
<div class="phpcode"><code><span class="html">In response to flowbee@gmail.com --<br /><br />When using the readfile_chunked function noted here with files larger than 10MB or so I am still having memory errors. It's because the writers have left out the all important flush() after each read. So this is the proper chunked readfile (which isn't really readfile at all, and should probably be crossposted to passthru(), fopen(), and popen() just so browsers can find this information):<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">function </span><span class="default">readfile_chunked</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">,</span><span class="default">$retbytes</span><span class="keyword">=</span><span class="default">true</span><span class="keyword">) {<br />   </span><span class="default">$chunksize </span><span class="keyword">= </span><span class="default">1</span><span class="keyword">*(</span><span class="default">1024</span><span class="keyword">*</span><span class="default">1024</span><span class="keyword">); </span><span class="comment">// how many bytes per chunk<br />   </span><span class="default">$buffer </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">;<br />   </span><span class="default">$cnt </span><span class="keyword">=</span><span class="default">0</span><span class="keyword">;<br />   </span><span class="comment">// $handle = fopen($filename, 'rb');<br />   </span><span class="default">$handle </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="string">'rb'</span><span class="keyword">);<br />   if (</span><span class="default">$handle </span><span class="keyword">=== </span><span class="default">false</span><span class="keyword">) {<br />       return </span><span class="default">false</span><span class="keyword">;<br />   }<br />   while (!</span><span class="default">feof</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">)) {<br />       </span><span class="default">$buffer </span><span class="keyword">= </span><span class="default">fread</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">, </span><span class="default">$chunksize</span><span class="keyword">);<br />       echo </span><span class="default">$buffer</span><span class="keyword">;<br />       </span><span class="default">ob_flush</span><span class="keyword">();<br />       </span><span class="default">flush</span><span class="keyword">();<br />       if (</span><span class="default">$retbytes</span><span class="keyword">) {<br />           </span><span class="default">$cnt </span><span class="keyword">+= </span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$buffer</span><span class="keyword">);<br />       }<br />   }<br />       </span><span class="default">$status </span><span class="keyword">= </span><span class="default">fclose</span><span class="keyword">(</span><span class="default">$handle</span><span class="keyword">);<br />   if (</span><span class="default">$retbytes </span><span class="keyword">&amp;&amp; </span><span class="default">$status</span><span class="keyword">) {<br />       return </span><span class="default">$cnt</span><span class="keyword">; </span><span class="comment">// return num. bytes delivered like readfile() does.<br />   </span><span class="keyword">}<br />   return </span><span class="default">$status</span><span class="keyword">;<br /><br />}<br /></span><span class="default">?&gt;<br /></span><br />All I've added is a flush(); after the echo line. Be sure to include this!</span></code></div>
  </div>
 </div>
  <div class="note" id="70296">  <div class="votes">
    <div id="Vu70296">
    <a href="https://www.php.net/manual/vote-note.php?id=70296&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd70296">
    <a href="https://www.php.net/manual/vote-note.php?id=70296&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V70296" title="50% like this...">
    0
    </div>
  </div>
  <a href="function.readfile.php.html#70296" class="name">
  <strong class="user"><em>mAu</em></strong></a><a class="genanchor" href="function.readfile.php.html#70296"> &para;</a><div class="date" title="2006-10-10 12:25"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom70296">
<div class="phpcode"><code><span class="html">Instead of using<br /><span class="default">&lt;?php<br />header</span><span class="keyword">(</span><span class="string">'Content-Type: application/force-download'</span><span class="keyword">);<br /></span><span class="default">?&gt;<br /></span>use<br /><span class="default">&lt;?php<br />header</span><span class="keyword">(</span><span class="string">'Content-Type: application/octet-stream'</span><span class="keyword">);<br /></span><span class="default">?&gt;<br /></span>Some browsers have troubles with force-download.</span></code></div>
  </div>
 </div>
  <div class="note" id="56986">  <div class="votes">
    <div id="Vu56986">
    <a href="https://www.php.net/manual/vote-note.php?id=56986&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd56986">
    <a href="https://www.php.net/manual/vote-note.php?id=56986&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V56986" title="48% like this...">
    -1
    </div>
  </div>
  <a href="function.readfile.php.html#56986" class="name">
  <strong class="user"><em>antispam [at] rdx page [dot] com</em></strong></a><a class="genanchor" href="function.readfile.php.html#56986"> &para;</a><div class="date" title="2005-09-20 02:14"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom56986">
<div class="phpcode"><code><span class="html">Just a note:  If you're using bw_mod (current version 0.6) to limit bandwidth in Apache 2, it *will not* limit bandwidth during readfile events.</span></code></div>
  </div>
 </div>
  <div class="note" id="114483">  <div class="votes">
    <div id="Vu114483">
    <a href="https://www.php.net/manual/vote-note.php?id=114483&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd114483">
    <a href="https://www.php.net/manual/vote-note.php?id=114483&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V114483" title="45% like this...">
    -5
    </div>
  </div>
  <a href="function.readfile.php.html#114483" class="name">
  <strong class="user"><em>Brian</em></strong></a><a class="genanchor" href="function.readfile.php.html#114483"> &para;</a><div class="date" title="2014-02-25 01:01"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom114483">
<div class="phpcode"><code><span class="html">If you are looking for an algorithm that will allow you to download (force download) a big file, may this one will help you.<br /><br />$filename = "file.csv";<br />$filepath = "/path/to/file/" . $filename;<br /><br />// Close sessions to prevent user from waiting until <br />// download will finish (uncomment if needed)<br />//session_write_close();<br /><br />set_time_limit(0);<br />ignore_user_abort(false);<br />ini_set('output_buffering', 0);<br />ini_set('zlib.output_compression', 0);<br /><br />$chunk = 10 * 1024 * 1024; // bytes per chunk (10 MB)<br /><br />$fh = fopen($filepath, "rb");<br /><br />if ($fh === false) { <br />    echo "Unable open file"; <br />}<br /><br />header('Content-Description: File Transfer');<br />header('Content-Type: application/octet-stream');<br />header('Content-Disposition: attachment; filename="' . $filename . '"'); <br />header('Expires: 0');<br />header('Cache-Control: must-revalidate');<br />header('Pragma: public');<br />header('Content-Length: ' . filesize($filepath));<br /><br />// Repeat reading until EOF<br />while (!feof($fh)) { <br />    echo fread($handle, $chunk);<br />    <br />    ob_flush();  // flush output<br />    flush();<br />}<br /><br />exit;</span></code></div>
  </div>
 </div>
  <div class="note" id="123819">  <div class="votes">
    <div id="Vu123819">
    <a href="https://www.php.net/manual/vote-note.php?id=123819&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd123819">
    <a href="https://www.php.net/manual/vote-note.php?id=123819&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V123819" title="41% like this...">
    -2
    </div>
  </div>
  <a href="function.readfile.php.html#123819" class="name">
  <strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="function.readfile.php.html#123819"> &para;</a><div class="date" title="2019-05-03 11:35"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom123819">
<div class="phpcode"><code><span class="html">To avoid errors, <br />just be careful whether slash "/" is allowed or not at the beginning of $file_name parameter.<br /><br />In my case, trying to send PDF files thru PHP after access-logging,<br />the beginning "/" must be removed in PHP 7.1.</span></code></div>
  </div>
 </div>
  <div class="note" id="57972">  <div class="votes">
    <div id="Vu57972">
    <a href="https://www.php.net/manual/vote-note.php?id=57972&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd57972">
    <a href="https://www.php.net/manual/vote-note.php?id=57972&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V57972" title="43% like this...">
    -4
    </div>
  </div>
  <a href="function.readfile.php.html#57972" class="name">
  <strong class="user"><em>peavey at pixelpickers dot com</em></strong></a><a class="genanchor" href="function.readfile.php.html#57972"> &para;</a><div class="date" title="2005-10-20 06:38"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom57972">
<div class="phpcode"><code><span class="html">A mime-type-independent forced download can also be conducted by using:<br /><br />&lt;?<br />(...)<br />header("Expires: Mon, 26 Jul 1997 05:00:00 GMT"); // some day in the past<br />header("Last-Modified: " . gmdate("D, d M Y H:i:s") . " GMT");<br />header("Content-type: application/x-download");<br />header("Content-Disposition: attachment; filename={$new_name}");<br />header("Content-Transfer-Encoding: binary");<br />?&gt;<br /><br />Cheers,<br /><br />Peavey</span></code></div>
  </div>
 </div>
  <div class="note" id="46838">  <div class="votes">
    <div id="Vu46838">
    <a href="https://www.php.net/manual/vote-note.php?id=46838&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd46838">
    <a href="https://www.php.net/manual/vote-note.php?id=46838&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V46838" title="41% like this...">
    -4
    </div>
  </div>
  <a href="function.readfile.php.html#46838" class="name">
  <strong class="user"><em>Thomas Jespersen</em></strong></a><a class="genanchor" href="function.readfile.php.html#46838"> &para;</a><div class="date" title="2004-10-25 06:06"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom46838">
<div class="phpcode"><code><span class="html">Remember if you make a "force download" script like mentioned below that you SANITIZE YOUR INPUT!<br /><br />I have seen a lot of  download scripts that does not test so you are able to download anything you want on the server.<br /><br />Test especially for strings like ".." which makes directory traversal possible. If possible only permit characters a-z, A-Z and 0-9 and make it possible to only download from one "download-folder".</span></code></div>
  </div>
 </div>
  <div class="note" id="57861">  <div class="votes">
    <div id="Vu57861">
    <a href="https://www.php.net/manual/vote-note.php?id=57861&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd57861">
    <a href="https://www.php.net/manual/vote-note.php?id=57861&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V57861" title="41% like this...">
    -5
    </div>
  </div>
  <a href="function.readfile.php.html#57861" class="name">
  <strong class="user"><em>planetmaster at planetgac dot com</em></strong></a><a class="genanchor" href="function.readfile.php.html#57861"> &para;</a><div class="date" title="2005-10-16 11:44"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom57861">
<div class="phpcode"><code><span class="html">Using pieces of the forced download script, adding in MySQL database functions, and hiding the file location for security was what we needed for downloading wmv files from our members creations without prompting Media player as well as secure the file itself and use only database queries. Something to the effect below, very customizable for private access, remote files, and keeping order of your online media.<br /><br />&lt;?<br />    # Protect Script against SQL-Injections<br />    $fileid=intval($_GET[id]);<br />    # setup SQL statement<br />    $sql = " SELECT id, fileurl, filename, filesize FROM ibf_movies WHERE id=' $fileid' ";<br /><br />    # execute SQL statement<br />    $res = mysql_query($sql);<br /><br />        # display results<br />        while ($row = mysql_fetch_array($res)) {<br />        $fileurl = $row['fileurl'];<br />        $filename= $row['filename'];<br />        $filesize= $row['filesize'];<br /><br />           $file_extension = strtolower(substr(strrchr($filename,"."),1));<br /><br />           switch ($file_extension) {<br />               case "wmv": $ctype="video/x-ms-wmv"; break;<br />               default: $ctype="application/force-download";<br />           }<br /><br />// required for IE, otherwise Content-disposition is ignored<br />if(ini_get('zlib.output_compression'))<br />ini_set('zlib.output_compression', 'Off');<br /><br />           header("Pragma: public");<br />           header("Expires: 0");<br />           header("Cache-Control: must-revalidate, post-check=0, pre-check=0");<br />           header("Cache-Control: private",false);<br />           header("Content-Type: video/x-ms-wmv");<br />           header("Content-Type: $ctype");<br />           header("Content-Disposition: attachment; filename=\"".basename($filename)."\";");<br />           header("Content-Transfer-Encoding: binary");<br />           header("Content-Length: ".@filesize($filename));<br />           set_time_limit(0);<br />           @readfile("$fileurl") or die("File not found."); <br /><br />}<br /><br />$donwloaded = "downloads + 1";<br /><br />    if ($_GET["hit"]) {<br />        mysql_query("UPDATE ibf_movies SET downloads = $donwloaded WHERE id=' $fileid'");<br /><br />}<br /><br />?&gt;<br /><br />While at it I added into download.php a hit (download) counter. Of course you need to setup the DB, table, and columns. Email me for Full setup// Session marker is also a security/logging option<br />Used in the context of linking:<br /><a href="http://www.yourdomain.com/download.php?id=xx&amp;hit=1" rel="nofollow" target="_blank">http://www.yourdomain.com/download.php?id=xx&amp;hit=1</a><br /><br />[Edited by sp@php.net: Added Protection against SQL-Injection]</span></code></div>
  </div>
 </div>
  <div class="note" id="52077">  <div class="votes">
    <div id="Vu52077">
    <a href="https://www.php.net/manual/vote-note.php?id=52077&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd52077">
    <a href="https://www.php.net/manual/vote-note.php?id=52077&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V52077" title="40% like this...">
    -3
    </div>
  </div>
  <a href="function.readfile.php.html#52077" class="name">
  <strong class="user"><em>TheDayOfCondor</em></strong></a><a class="genanchor" href="function.readfile.php.html#52077"> &para;</a><div class="date" title="2005-04-20 09:10"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom52077">
<div class="phpcode"><code><span class="html">Beware - the chunky readfile suggested by Rob Funk can easily exceed you maximum script execution time (30 seconds by default).<br /><br />I suggest you to use the set_time_limit function inside the while loop to reset the php watchdog.</span></code></div>
  </div>
 </div>
  <div class="note" id="98046">  <div class="votes">
    <div id="Vu98046">
    <a href="https://www.php.net/manual/vote-note.php?id=98046&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd98046">
    <a href="https://www.php.net/manual/vote-note.php?id=98046&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V98046" title="38% like this...">
    -4
    </div>
  </div>
  <a href="function.readfile.php.html#98046" class="name">
  <strong class="user"><em>Zambz</em></strong></a><a class="genanchor" href="function.readfile.php.html#98046"> &para;</a><div class="date" title="2010-05-22 06:33"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom98046">
<div class="phpcode"><code><span class="html">If you are using the procedures outlined in this article to force sending a file to a user, you may find that the "Content-Length" header is not being sent on some servers.<br /><br />The reason this occurs is because some servers are setup by default to enable gzip compression, which sends an additional header for such operations.  This additional header is "Transfer-Encoding: chunked" which essentially overrides the "Content-Length" header and forces a chunked download.  Of course, this is not required if you are using the intelligent versions of readfile in this article. <br /><br />A missing Content-Length header implies the following:<br /><br />1) Your browser will not show a progress bar on downloads because it doesn't know their length<br />2) If you output anything (e.g. white space) after the readfile function (by mistake), the browser will add that to the end of the download, resulting in corrupt data.<br /><br />The easiest way to disable this behaviour is with the following .htaccess directive.<br /><br />SetEnv no-gzip dont-vary</span></code></div>
  </div>
 </div>
  <div class="note" id="56109">  <div class="votes">
    <div id="Vu56109">
    <a href="https://www.php.net/manual/vote-note.php?id=56109&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd56109">
    <a href="https://www.php.net/manual/vote-note.php?id=56109&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V56109" title="37% like this...">
    -9
    </div>
  </div>
  <a href="function.readfile.php.html#56109" class="name"><strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="function.readfile.php.html#56109"> &para;</a><div class="date" title="2005-08-23 02:39"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom56109">
<div class="phpcode"><code><span class="html">here is a nice force download scirpt<br /><br />            $filename = 'dummy.zip';<br />            $filename = realpath($filename);<br /><br />            $file_extension = strtolower(substr(strrchr($filename,"."),1));<br /><br />            switch ($file_extension) {<br />                case "pdf": $ctype="application/pdf"; break;<br />                case "exe": $ctype="application/octet-stream"; break;<br />                case "zip": $ctype="application/zip"; break;<br />                case "doc": $ctype="application/msword"; break;<br />                case "xls": $ctype="application/vnd.ms-excel"; break;<br />                case "ppt": $ctype="application/vnd.ms-powerpoint"; break;<br />                case "gif": $ctype="image/gif"; break;<br />                case "png": $ctype="image/png"; break;<br />                case "jpe": case "jpeg":<br />                case "jpg": $ctype="image/jpg"; break;<br />                default: $ctype="application/force-download";<br />            }<br /><br />            if (!file_exists($filename)) {<br />                die("NO FILE HERE");<br />            }<br /><br />            header("Pragma: public");<br />            header("Expires: 0");<br />            header("Cache-Control: must-revalidate, post-check=0, pre-check=0");<br />            header("Cache-Control: private",false);<br />            header("Content-Type: $ctype");<br />            header("Content-Disposition: attachment; filename=\"".basename($filename)."\";");<br />            header("Content-Transfer-Encoding: binary");<br />            header("Content-Length: ".@filesize($filename));<br />            set_time_limit(0);<br />            @readfile("$filename") or die("File not found.");</span></code></div>
  </div>
 </div>
  <div class="note" id="75981">  <div class="votes">
    <div id="Vu75981">
    <a href="https://www.php.net/manual/vote-note.php?id=75981&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd75981">
    <a href="https://www.php.net/manual/vote-note.php?id=75981&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V75981" title="35% like this...">
    -5
    </div>
  </div>
  <a href="function.readfile.php.html#75981" class="name">
  <strong class="user"><em>Elliott Brueggeman</em></strong></a><a class="genanchor" href="function.readfile.php.html#75981"> &para;</a><div class="date" title="2007-06-25 08:47"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom75981">
<div class="phpcode"><code><span class="html">I have noticed some unusual behavior with Internet Explorer 6 that’s worth taking note of. I have a link on my site to a script that outputs an XML file to the browser with the below code:<br /><br />header('Content-Type: application/octet-stream');<br />header('Content-Disposition: attachment; filename="'.$filename.'"');<br />@readfile($file);<br /><br />When the popular IE setting “Reuse Window for Launching Shortcuts” is unchecked (access this setting in the Tools Menu &gt; Internet Options &gt; Advanced Tab) this script will output the file to the browser and open it in a different window if the user clicks the open button on the IE prompt. However, if this setting is checked, and browser windows are being re-used, then it will open up on top of the page where the link was clicked to access the script.<br /><br />If I instead set the html link target option to be “_blank”, the script will open up in a new window as expected if the “Reuse Window for Launching Shortcuts” is checked. But, if the setting is unchecked, the output XML file will open up in a new window and there will be another blank window also open that has the address of the script, in addition to our original window.<br /><br />This is far from ideal, and there is no way of knowing whether users have this option checked or not. We are stuck with the distinct possibility of half of our visitors seeing either an annoying third blank window being opened or the script writing over their original window, depending on their “Reuse Window for Launching Shortcuts” setting.</span></code></div>
  </div>
 </div>
  <div class="note" id="120187">  <div class="votes">
    <div id="Vu120187">
    <a href="https://www.php.net/manual/vote-note.php?id=120187&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd120187">
    <a href="https://www.php.net/manual/vote-note.php?id=120187&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V120187" title="33% like this...">
    -5
    </div>
  </div>
  <a href="function.readfile.php.html#120187" class="name">
  <strong class="user"><em>anon</em></strong></a><a class="genanchor" href="function.readfile.php.html#120187"> &para;</a><div class="date" title="2016-11-19 02:30"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom120187">
<div class="phpcode"><code><span class="html">In the C source, this function simply opens the path in read+binary mode, without a lock, and uses fpassthru()<br /><br />If you need a locked read, use fopen(), flock(), and then fpassthru() directly.</span></code></div>
  </div>
 </div>
  <div class="note" id="85982">  <div class="votes">
    <div id="Vu85982">
    <a href="https://www.php.net/manual/vote-note.php?id=85982&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd85982">
    <a href="https://www.php.net/manual/vote-note.php?id=85982&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V85982" title="35% like this...">
    -6
    </div>
  </div>
  <a href="function.readfile.php.html#85982" class="name">
  <strong class="user"><em>johniskew</em></strong></a><a class="genanchor" href="function.readfile.php.html#85982"> &para;</a><div class="date" title="2008-09-26 12:17"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom85982">
<div class="phpcode"><code><span class="html">@marks suggestion-<br /><br />That is one way to do it, however this is avoidable.  For example in Zend Framework you could do <br /><br /><span class="default">&lt;?php<br /><br /></span><span class="comment">// Action controller<br /></span><span class="keyword">public function </span><span class="default">someAction</span><span class="keyword">() {<br /><br />    </span><span class="default">$response </span><span class="keyword">= </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_response</span><span class="keyword">;<br /><br />    </span><span class="comment">// Disable view and layout rendering<br />    </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_helper</span><span class="keyword">-&gt;</span><span class="default">viewRenderer</span><span class="keyword">-&gt;</span><span class="default">setNoRender</span><span class="keyword">();<br />    </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">_helper</span><span class="keyword">-&gt;</span><span class="default">layout</span><span class="keyword">()-&gt;</span><span class="default">disableLayout</span><span class="keyword">();<br /><br />    </span><span class="comment">// Process the file<br />    </span><span class="default">$file </span><span class="keyword">= </span><span class="string">'whatever.zip'</span><span class="keyword">;<br />    </span><span class="default">$bits </span><span class="keyword">= @</span><span class="default">file_get_contents</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />    if(</span><span class="default">strlen</span><span class="keyword">(</span><span class="default">$bits</span><span class="keyword">) == </span><span class="default">0</span><span class="keyword">) {<br />        </span><span class="default">$response</span><span class="keyword">-&gt;</span><span class="default">setBody</span><span class="keyword">(</span><span class="string">'Sorry, we could not find requested download file.'</span><span class="keyword">);<br />    }<br />    else {<br />        </span><span class="default">$response</span><span class="keyword">-&gt;</span><span class="default">setHeader</span><span class="keyword">(</span><span class="string">'Content-type'</span><span class="keyword">, </span><span class="string">'application/octet-stream'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">);<br />        </span><span class="default">$response</span><span class="keyword">-&gt;</span><span class="default">setBody</span><span class="keyword">(</span><span class="default">$bits</span><span class="keyword">);<br />    }<br />}<br /><br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="90459">  <div class="votes">
    <div id="Vu90459">
    <a href="https://www.php.net/manual/vote-note.php?id=90459&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd90459">
    <a href="https://www.php.net/manual/vote-note.php?id=90459&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V90459" title="34% like this...">
    -7
    </div>
  </div>
  <a href="function.readfile.php.html#90459" class="name">
  <strong class="user"><em>sakai at d4k dot net</em></strong></a><a class="genanchor" href="function.readfile.php.html#90459"> &para;</a><div class="date" title="2009-04-23 05:25"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom90459">
<div class="phpcode"><code><span class="html">To reduce the burden on the server, you might want to output "Etag" and/or "Last-Modified" on http response header.  But there are some headers, which PHP itself outputs automatically, disturbing this.  So I wrote this function with erasing these.<br /><br />If you guys know how to judge the return values of function "stat", in order to avoid using "is_file" or "is_readable" (or "is_dir"), please let me know or just write it here.<br /><br />If you don't have to do anything special on 404, "header('HTTP/1.x xxx xxxxx');" can be inside of the function.<br /><br /><span class="default">&lt;?php<br /><br />$filename </span><span class="keyword">= </span><span class="string">'/foo/bar/myfeed.rss'</span><span class="keyword">;<br /></span><span class="default">$http_stat_code </span><span class="keyword">= </span><span class="default">readfile_if_modified</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, array(</span><span class="string">'Content-Type: text/xml'</span><span class="keyword">));<br />switch(</span><span class="default">$http_stat_code</span><span class="keyword">) {<br />case </span><span class="default">404</span><span class="keyword">:<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'HTTP/1.0 404 Not Found'</span><span class="keyword">);<br />    echo </span><span class="string">'&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;a href="<a href="http://example.com/" rel="nofollow" target="_blank">http://example.com/</a>"&gt;<a href="http://example.com/&lt;a&gt;&lt;/body&gt;&lt;/html&gt;" rel="nofollow" target="_blank">http://example.com/&lt;a&gt;&lt;/body&gt;&lt;/html&gt;</a>'</span><span class="keyword">;<br />    exit;<br />default:<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'X-System-Url: <a href="http://example.com/" rel="nofollow" target="_blank">http://example.com/</a>'</span><span class="keyword">, </span><span class="default">true</span><span class="keyword">, </span><span class="default">$http_stat_code</span><span class="keyword">);<br />}<br /><br />function </span><span class="default">readfile_if_modified</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">, </span><span class="default">$http_header_additionals </span><span class="keyword">= array()) {<br /><br />    if(!</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)) {<br /></span><span class="comment">//      header('HTTP/1.0 404 Not Found');<br />        </span><span class="keyword">return </span><span class="default">404</span><span class="keyword">;<br />    }<br /><br />    if(!</span><span class="default">is_readable</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">)) {<br /></span><span class="comment">//      header('HTTP/1.0 403 Forbidden');<br />        </span><span class="keyword">return </span><span class="default">403</span><span class="keyword">;<br />    }<br /><br />    </span><span class="default">$stat </span><span class="keyword">= @</span><span class="default">stat</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">);<br />    </span><span class="default">$etag </span><span class="keyword">= </span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%x-%x-%x'</span><span class="keyword">, </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'ino'</span><span class="keyword">], </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">], </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'mtime'</span><span class="keyword">] * </span><span class="default">1000000</span><span class="keyword">);<br /><br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Expires: '</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Cache-Control: '</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Pragma: '</span><span class="keyword">);<br /><br />    if(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_IF_NONE_MATCH'</span><span class="keyword">]) &amp;&amp; </span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_IF_NONE_MATCH'</span><span class="keyword">] == </span><span class="default">$etag</span><span class="keyword">) {<br />        </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Etag: "' </span><span class="keyword">. </span><span class="default">$etag </span><span class="keyword">. </span><span class="string">'"'</span><span class="keyword">);<br /></span><span class="comment">//      header('HTTP/1.0 304 Not Modified');<br />        </span><span class="keyword">return </span><span class="default">304</span><span class="keyword">;<br />    } elseif(isset(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_IF_MODIFIED_SINCE'</span><span class="keyword">]) &amp;&amp; </span><span class="default">strtotime</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">[</span><span class="string">'HTTP_IF_MODIFIED_SINCE'</span><span class="keyword">]) &gt;= </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'mtime'</span><span class="keyword">]) {<br />        </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Last-Modified: ' </span><span class="keyword">. </span><span class="default">date</span><span class="keyword">(</span><span class="string">'r'</span><span class="keyword">, </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'mtime'</span><span class="keyword">]));<br /></span><span class="comment">//      header('HTTP/1.0 304 Not Modified');<br />        </span><span class="keyword">return </span><span class="default">304</span><span class="keyword">;<br />    }<br /><br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Last-Modified: ' </span><span class="keyword">. </span><span class="default">date</span><span class="keyword">(</span><span class="string">'r'</span><span class="keyword">, </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'mtime'</span><span class="keyword">]));<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Etag: "' </span><span class="keyword">. </span><span class="default">$etag </span><span class="keyword">. </span><span class="string">'"'</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Accept-Ranges: bytes'</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length:' </span><span class="keyword">. </span><span class="default">$stat</span><span class="keyword">[</span><span class="string">'size'</span><span class="keyword">]);<br />    foreach(</span><span class="default">$http_header_additionals </span><span class="keyword">as </span><span class="default">$header</span><span class="keyword">) {<br />        </span><span class="default">header</span><span class="keyword">(</span><span class="default">$header</span><span class="keyword">);<br />    }<br /><br />    if(@</span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$filename</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">) {<br /></span><span class="comment">//      header('HTTP/1.0 500 Internal Server Error');<br />        </span><span class="keyword">return </span><span class="default">500</span><span class="keyword">;<br />    } else {<br /></span><span class="comment">//      header('HTTP/1.0 200 OK');<br />        </span><span class="keyword">return </span><span class="default">200</span><span class="keyword">;<br />    }<br /><br />}<br /><br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="103200">  <div class="votes">
    <div id="Vu103200">
    <a href="https://www.php.net/manual/vote-note.php?id=103200&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd103200">
    <a href="https://www.php.net/manual/vote-note.php?id=103200&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V103200" title="33% like this...">
    -7
    </div>
  </div>
  <a href="function.readfile.php.html#103200" class="name">
  <strong class="user"><em>cOrti</em></strong></a><a class="genanchor" href="function.readfile.php.html#103200"> &para;</a><div class="date" title="2011-03-31 03:59"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom103200">
<div class="phpcode"><code><span class="html">Hello,<br /><br />Here's a simple trick for browsers (FF, IE) address spaces in filenames for Content-Disposition:<br /><br />eg: <span class="default">&lt;?php header </span><span class="keyword">(</span><span class="string">"Content-Disposition:attachment; filename=\"</span><span class="default">$filename</span><span class="string">\""</span><span class="keyword">); </span><span class="default">?&gt;<br /></span><br />The \ "before and after the file name makes the difference.</span></code></div>
  </div>
 </div>
  <div class="note" id="52302">  <div class="votes">
    <div id="Vu52302">
    <a href="https://www.php.net/manual/vote-note.php?id=52302&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd52302">
    <a href="https://www.php.net/manual/vote-note.php?id=52302&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V52302" title="33% like this...">
    -5
    </div>
  </div>
  <a href="function.readfile.php.html#52302" class="name">
  <strong class="user"><em>TheDayOfCondor</em></strong></a><a class="genanchor" href="function.readfile.php.html#52302"> &para;</a><div class="date" title="2005-04-27 06:24"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom52302">
<div class="phpcode"><code><span class="html">I think that readfile suffers from the maximum script execution time. The readfile is always completed even if it exceed the default 30 seconds limit, then the script is aborted.<br />Be warned that you can get very odd behaviour not only on large files, but also on small files if the user has a slow connection.<br /><br />The best thing to do is to use <br /><br />&lt;?<br />  set_time_limit(0);<br />?&gt;<br /><br />just before the readfile, to disable completely the watchdog if you intend to use the readfile call to tranfer a file to the user.</span></code></div>
  </div>
 </div>
  <div class="note" id="52722">  <div class="votes">
    <div id="Vu52722">
    <a href="https://www.php.net/manual/vote-note.php?id=52722&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd52722">
    <a href="https://www.php.net/manual/vote-note.php?id=52722&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V52722" title="29% like this...">
    -7
    </div>
  </div>
  <a href="function.readfile.php.html#52722" class="name">
  <strong class="user"><em>Philipp Heckel</em></strong></a><a class="genanchor" href="function.readfile.php.html#52722"> &para;</a><div class="date" title="2005-05-10 04:58"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom52722">
<div class="phpcode"><code><span class="html">To use readfile() it is absolutely necessary to set the mime-type before. If you are using an Apache, it's quite simple to figure out the correct mime type. Apache has a file called "mime.types" which can (in normal case) be read by all users.<br /><br />Use this (or another) function to get a list of mime-types:<br /><br /><span class="default">&lt;?php<br /><br />    </span><span class="keyword">function </span><span class="default">mimeTypes</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) {<br />        if (!</span><span class="default">is_file</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">) || !</span><span class="default">is_readable</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)) return </span><span class="default">false</span><span class="keyword">;<br />        </span><span class="default">$types </span><span class="keyword">= array();<br />        </span><span class="default">$fp </span><span class="keyword">= </span><span class="default">fopen</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">,</span><span class="string">"r"</span><span class="keyword">);<br />        while (</span><span class="default">false </span><span class="keyword">!= (</span><span class="default">$line </span><span class="keyword">= </span><span class="default">fgets</span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">,</span><span class="default">4096</span><span class="keyword">))) {<br />            if (!</span><span class="default">preg_match</span><span class="keyword">(</span><span class="string">"/^\s*(?!#)\s*(\S+)\s+(?=\S)(.+)/"</span><span class="keyword">,</span><span class="default">$line</span><span class="keyword">,</span><span class="default">$match</span><span class="keyword">)) continue;<br />            </span><span class="default">$tmp </span><span class="keyword">= </span><span class="default">preg_split</span><span class="keyword">(</span><span class="string">"/\s/"</span><span class="keyword">,</span><span class="default">trim</span><span class="keyword">(</span><span class="default">$match</span><span class="keyword">[</span><span class="default">2</span><span class="keyword">]));<br />            foreach(</span><span class="default">$tmp </span><span class="keyword">as </span><span class="default">$type</span><span class="keyword">) </span><span class="default">$types</span><span class="keyword">[</span><span class="default">strtolower</span><span class="keyword">(</span><span class="default">$type</span><span class="keyword">)] = </span><span class="default">$match</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">];<br />        }<br />        </span><span class="default">fclose </span><span class="keyword">(</span><span class="default">$fp</span><span class="keyword">);<br />        <br />        return </span><span class="default">$types</span><span class="keyword">;<br />    }<br /><br />    </span><span class="comment"># [...]<br /><br />    # read the mime-types<br />    </span><span class="default">$mimes </span><span class="keyword">= </span><span class="default">mimeTypes</span><span class="keyword">(</span><span class="string">'/usr/local/apache/current/conf/mime.types'</span><span class="keyword">);<br /><br />    </span><span class="comment"># use them ($ext is the extension of your file)<br />    </span><span class="keyword">if (isset(</span><span class="default">$mimes</span><span class="keyword">[</span><span class="default">$ext</span><span class="keyword">])) </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Type: "</span><span class="keyword">.</span><span class="default">$mimes</span><span class="keyword">[</span><span class="default">$ext</span><span class="keyword">]);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Length: "</span><span class="keyword">.@</span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$fullpath</span><span class="keyword">));<br />    </span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$fullpath</span><span class="keyword">); exit;<br /><br /></span><span class="default">?&gt;<br /></span><br />If you do not want to read from the mime.types file directly, you can of course make a copy in another folder!<br />Cheers Philipp Heckel</span></code></div>
  </div>
 </div>
  <div class="note" id="115948">  <div class="votes">
    <div id="Vu115948">
    <a href="https://www.php.net/manual/vote-note.php?id=115948&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd115948">
    <a href="https://www.php.net/manual/vote-note.php?id=115948&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V115948" title="29% like this...">
    -11
    </div>
  </div>
  <a href="function.readfile.php.html#115948" class="name">
  <strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="function.readfile.php.html#115948"> &para;</a><div class="date" title="2014-10-18 12:18"><strong>9 years ago</strong></div>
  <div class="text" id="Hcom115948">
<div class="phpcode"><code><span class="html">&lt;form action = "open.php" method = "post" &gt;<br />&lt;input ="text" name ="brian" &gt;<br />&lt;input type = "submit" name = "download" value = "download"&gt;<br />&lt;/form&gt;<br /><span class="default">&lt;?php<br /><br /></span><span class="keyword">if(isset(</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'download'</span><span class="keyword">]))<br />{<br /></span><span class="default">$img </span><span class="keyword">=</span><span class="string">'img'</span><span class="keyword">;<br /></span><span class="default">$pic </span><span class="keyword">= </span><span class="string">'\marcus2'</span><span class="keyword">;<br /></span><span class="default">$fad </span><span class="keyword">= </span><span class="string">'pdf'</span><span class="keyword">;<br /><br /></span><span class="default">$file </span><span class="keyword">= </span><span class="default">$img</span><span class="keyword">.</span><span class="string">''</span><span class="keyword">. </span><span class="default">$pic </span><span class="keyword">.</span><span class="string">'.'</span><span class="keyword">. </span><span class="default">$fad</span><span class="keyword">; <br /><br />echo </span><span class="default">$file</span><span class="keyword">;<br /><br />if (</span><span class="default">file_exists</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">)) {<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Description: File Transfer'</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Type: application/octet-stream'</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Disposition: attachment; filename='</span><span class="keyword">.</span><span class="default">basename</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Expires: 0'</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Cache-Control: must-revalidate'</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Pragma: public'</span><span class="keyword">);<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'Content-Length: ' </span><span class="keyword">. </span><span class="default">filesize</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">));<br />    </span><span class="default">readfile</span><span class="keyword">(</span><span class="default">$file</span><span class="keyword">);<br />    exit;<br />}<br /><br />}<br /><br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="75194">  <div class="votes">
    <div id="Vu75194">
    <a href="https://www.php.net/manual/vote-note.php?id=75194&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd75194">
    <a href="https://www.php.net/manual/vote-note.php?id=75194&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V75194" title="27% like this...">
    -8
    </div>
  </div>
  <a href="function.readfile.php.html#75194" class="name">
  <strong class="user"><em>chad 0x40 herballure 0x2e com</em></strong></a><a class="genanchor" href="function.readfile.php.html#75194"> &para;</a><div class="date" title="2007-05-17 07:53"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom75194">
<div class="phpcode"><code><span class="html">In reply to herbert dot fischer at NOSPAM dot gmail dot com:<br /><br />The streams API in PHP5 tries to make things as efficient as possible; in php-5.1.6 on Linux, fpassthru is faster than 'echo fread($fp, 8192)' in a loop, and readfile is even faster for files on disk. I didn't benchmark further, but I'd be willing to bet non-mmap'able streams still win because they can loop in C instead of PHP.</span></code></div>
  </div>
 </div>
  <div class="note" id="111535">  <div class="votes">
    <div id="Vu111535">
    <a href="https://www.php.net/manual/vote-note.php?id=111535&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd111535">
    <a href="https://www.php.net/manual/vote-note.php?id=111535&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V111535" title="30% like this...">
    -17
    </div>
  </div>
  <a href="function.readfile.php.html#111535" class="name">
  <strong class="user"><em>kevin dot goodman at itmsoil dot com</em></strong></a><a class="genanchor" href="function.readfile.php.html#111535"> &para;</a><div class="date" title="2013-03-01 04:16"><strong>10 years ago</strong></div>
  <div class="text" id="Hcom111535">
<div class="phpcode"><code><span class="html">I wasted days trying to figure this out before I found the problem was easily solved.<br /><br />I'm sure many of you out there have had similar problem when trying to use readfile to output images with a php file as the "src" of a "img" tag.<br />It works fine "as is" in Firefox but not in IE, Safari or g.Chrome.<br /><br />I found hundreds of results on google all saying things like "there must be white space at the end of you code", "you need this header or that header".<br />I couldn't believe what the solution was but here it is anyway!<br /><br />Remove the "Width" and "Height" attributes from your "img" tag</span></code></div>
  </div>
 </div>
  <div class="note" id="76260">  <div class="votes">
    <div id="Vu76260">
    <a href="https://www.php.net/manual/vote-note.php?id=76260&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd76260">
    <a href="https://www.php.net/manual/vote-note.php?id=76260&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V76260" title="26% like this...">
    -9
    </div>
  </div>
  <a href="function.readfile.php.html#76260" class="name">
  <strong class="user"><em>Kniht</em></strong></a><a class="genanchor" href="function.readfile.php.html#76260"> &para;</a><div class="date" title="2007-07-07 11:27"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom76260">
<div class="phpcode"><code><span class="html">@Elliott Brueggeman<br />What's the point of a user's settings if not to determine their environment? If they have it set a specific way, honor their setting.</span></code></div>
  </div>
 </div>
  <div class="note" id="76472">  <div class="votes">
    <div id="Vu76472">
    <a href="https://www.php.net/manual/vote-note.php?id=76472&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd76472">
    <a href="https://www.php.net/manual/vote-note.php?id=76472&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V76472" title="23% like this...">
    -11
    </div>
  </div>
  <a href="function.readfile.php.html#76472" class="name">
  <strong class="user"><em>Sinured</em></strong></a><a class="genanchor" href="function.readfile.php.html#76472"> &para;</a><div class="date" title="2007-07-17 06:00"><strong>16 years ago</strong></div>
  <div class="text" id="Hcom76472">
<div class="phpcode"><code><span class="html">In response to "grey - greywyvern - com":<br /><br />If you know the target _can't_ be a remote file (e.g. prefixing it with a directory), you should use include instead.<br />If the user manages to set the target to some kinda config-file (configuration.php in Joomla!), he will get a blank page - unless readfile() is used. Using include will just behave as a normal request (no output).<br />For remote files however use readfile().</span></code></div>
  </div>
 </div>
  <div class="note" id="99218">  <div class="votes">
    <div id="Vu99218">
    <a href="https://www.php.net/manual/vote-note.php?id=99218&amp;page=function.readfile&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd99218">
    <a href="https://www.php.net/manual/vote-note.php?id=99218&amp;page=function.readfile&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V99218" title="16% like this...">
    -16
    </div>
  </div>
  <a href="function.readfile.php.html#99218" class="name">
  <strong class="user"><em>Mike</em></strong></a><a class="genanchor" href="function.readfile.php.html#99218"> &para;</a><div class="date" title="2010-08-04 07:46"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom99218">
<div class="phpcode"><code><span class="html">Beware of using download managers.. I was trying to use readfile in IE8 and kept getting the message "failed to get data for 'type'". Eventually figured out the problem was that I had LeechGet installed and it was intercepting the download, which in turn prevented the download from taking place.</span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=function.readfile&amp;redirect=https://www.php.net/manual/ru/function.readfile.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="ref.filesystem.php.html">Функции файловой системы</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="function.basename.php.html" title="basename">basename</a>
                        </li>
                                                <li class="">
                            <a href="function.chgrp.php.html" title="chgrp">chgrp</a>
                        </li>
                                                <li class="">
                            <a href="function.chmod.php.html" title="chmod">chmod</a>
                        </li>
                                                <li class="">
                            <a href="function.chown.php.html" title="chown">chown</a>
                        </li>
                                                <li class="">
                            <a href="function.clearstatcache.php.html" title="clearstatcache">clearstatcache</a>
                        </li>
                                                <li class="">
                            <a href="function.copy.php.html" title="copy">copy</a>
                        </li>
                                                <li class="">
                            <a href="function.delete.php.html" title="delete">delete</a>
                        </li>
                                                <li class="">
                            <a href="function.dirname.php.html" title="dirname">dirname</a>
                        </li>
                                                <li class="">
                            <a href="function.disk-free-space.php.html" title="disk_&#8203;free_&#8203;space">disk_&#8203;free_&#8203;space</a>
                        </li>
                                                <li class="">
                            <a href="function.disk-total-space.php.html" title="disk_&#8203;total_&#8203;space">disk_&#8203;total_&#8203;space</a>
                        </li>
                                                <li class="">
                            <a href="function.diskfreespace.php.html" title="diskfreespace">diskfreespace</a>
                        </li>
                                                <li class="">
                            <a href="function.fclose.php.html" title="fclose">fclose</a>
                        </li>
                                                <li class="">
                            <a href="function.fdatasync.php.html" title="fdatasync">fdatasync</a>
                        </li>
                                                <li class="">
                            <a href="function.feof.php.html" title="feof">feof</a>
                        </li>
                                                <li class="">
                            <a href="function.fflush.php.html" title="fflush">fflush</a>
                        </li>
                                                <li class="">
                            <a href="function.fgetc.php.html" title="fgetc">fgetc</a>
                        </li>
                                                <li class="">
                            <a href="function.fgetcsv.php.html" title="fgetcsv">fgetcsv</a>
                        </li>
                                                <li class="">
                            <a href="function.fgets.php.html" title="fgets">fgets</a>
                        </li>
                                                <li class="">
                            <a href="function.fgetss.php.html" title="fgetss">fgetss</a>
                        </li>
                                                <li class="">
                            <a href="function.file-exists.php.html" title="file_&#8203;exists">file_&#8203;exists</a>
                        </li>
                                                <li class="">
                            <a href="function.file-get-contents.php.html" title="file_&#8203;get_&#8203;contents">file_&#8203;get_&#8203;contents</a>
                        </li>
                                                <li class="">
                            <a href="function.file-put-contents.php.html" title="file_&#8203;put_&#8203;contents">file_&#8203;put_&#8203;contents</a>
                        </li>
                                                <li class="">
                            <a href="function.file.php.html" title="file">file</a>
                        </li>
                                                <li class="">
                            <a href="function.fileatime.php.html" title="fileatime">fileatime</a>
                        </li>
                                                <li class="">
                            <a href="function.filectime.php.html" title="filectime">filectime</a>
                        </li>
                                                <li class="">
                            <a href="function.filegroup.php.html" title="filegroup">filegroup</a>
                        </li>
                                                <li class="">
                            <a href="function.fileinode.php.html" title="fileinode">fileinode</a>
                        </li>
                                                <li class="">
                            <a href="function.filemtime.php.html" title="filemtime">filemtime</a>
                        </li>
                                                <li class="">
                            <a href="function.fileowner.php.html" title="fileowner">fileowner</a>
                        </li>
                                                <li class="">
                            <a href="function.fileperms.php.html" title="fileperms">fileperms</a>
                        </li>
                                                <li class="">
                            <a href="function.filesize.php.html" title="filesize">filesize</a>
                        </li>
                                                <li class="">
                            <a href="function.filetype.php.html" title="filetype">filetype</a>
                        </li>
                                                <li class="">
                            <a href="function.flock.php.html" title="flock">flock</a>
                        </li>
                                                <li class="">
                            <a href="function.fnmatch.php.html" title="fnmatch">fnmatch</a>
                        </li>
                                                <li class="">
                            <a href="function.fopen.php.html" title="fopen">fopen</a>
                        </li>
                                                <li class="">
                            <a href="function.fpassthru.php.html" title="fpassthru">fpassthru</a>
                        </li>
                                                <li class="">
                            <a href="function.fputcsv.php.html" title="fputcsv">fputcsv</a>
                        </li>
                                                <li class="">
                            <a href="function.fputs.php.html" title="fputs">fputs</a>
                        </li>
                                                <li class="">
                            <a href="function.fread.php.html" title="fread">fread</a>
                        </li>
                                                <li class="">
                            <a href="function.fscanf.php.html" title="fscanf">fscanf</a>
                        </li>
                                                <li class="">
                            <a href="function.fseek.php.html" title="fseek">fseek</a>
                        </li>
                                                <li class="">
                            <a href="function.fstat.php.html" title="fstat">fstat</a>
                        </li>
                                                <li class="">
                            <a href="function.fsync.php.html" title="fsync">fsync</a>
                        </li>
                                                <li class="">
                            <a href="function.ftell.php.html" title="ftell">ftell</a>
                        </li>
                                                <li class="">
                            <a href="function.ftruncate.php.html" title="ftruncate">ftruncate</a>
                        </li>
                                                <li class="">
                            <a href="function.fwrite.php.html" title="fwrite">fwrite</a>
                        </li>
                                                <li class="">
                            <a href="function.glob.php.html" title="glob">glob</a>
                        </li>
                                                <li class="">
                            <a href="function.is-dir.php.html" title="is_&#8203;dir">is_&#8203;dir</a>
                        </li>
                                                <li class="">
                            <a href="function.is-executable.php.html" title="is_&#8203;executable">is_&#8203;executable</a>
                        </li>
                                                <li class="">
                            <a href="function.is-file.php.html" title="is_&#8203;file">is_&#8203;file</a>
                        </li>
                                                <li class="">
                            <a href="function.is-link.php.html" title="is_&#8203;link">is_&#8203;link</a>
                        </li>
                                                <li class="">
                            <a href="function.is-readable.php.html" title="is_&#8203;readable">is_&#8203;readable</a>
                        </li>
                                                <li class="">
                            <a href="function.is-uploaded-file.php.html" title="is_&#8203;uploaded_&#8203;file">is_&#8203;uploaded_&#8203;file</a>
                        </li>
                                                <li class="">
                            <a href="function.is-writable.php.html" title="is_&#8203;writable">is_&#8203;writable</a>
                        </li>
                                                <li class="">
                            <a href="function.is-writeable.php.html" title="is_&#8203;writeable">is_&#8203;writeable</a>
                        </li>
                                                <li class="">
                            <a href="function.lchgrp.php.html" title="lchgrp">lchgrp</a>
                        </li>
                                                <li class="">
                            <a href="function.lchown.php.html" title="lchown">lchown</a>
                        </li>
                                                <li class="">
                            <a href="function.link.php.html" title="link">link</a>
                        </li>
                                                <li class="">
                            <a href="function.linkinfo.php.html" title="linkinfo">linkinfo</a>
                        </li>
                                                <li class="">
                            <a href="function.lstat.php.html" title="lstat">lstat</a>
                        </li>
                                                <li class="">
                            <a href="function.mkdir.php.html" title="mkdir">mkdir</a>
                        </li>
                                                <li class="">
                            <a href="function.move-uploaded-file.php.html" title="move_&#8203;uploaded_&#8203;file">move_&#8203;uploaded_&#8203;file</a>
                        </li>
                                                <li class="">
                            <a href="function.parse-ini-file.php.html" title="parse_&#8203;ini_&#8203;file">parse_&#8203;ini_&#8203;file</a>
                        </li>
                                                <li class="">
                            <a href="function.parse-ini-string.php.html" title="parse_&#8203;ini_&#8203;string">parse_&#8203;ini_&#8203;string</a>
                        </li>
                                                <li class="">
                            <a href="function.pathinfo.php.html" title="pathinfo">pathinfo</a>
                        </li>
                                                <li class="">
                            <a href="function.pclose.php.html" title="pclose">pclose</a>
                        </li>
                                                <li class="">
                            <a href="function.popen.php.html" title="popen">popen</a>
                        </li>
                                                <li class="current">
                            <a href="function.readfile.php.html" title="readfile">readfile</a>
                        </li>
                                                <li class="">
                            <a href="function.readlink.php.html" title="readlink">readlink</a>
                        </li>
                                                <li class="">
                            <a href="function.realpath-cache-get.php.html" title="realpath_&#8203;cache_&#8203;get">realpath_&#8203;cache_&#8203;get</a>
                        </li>
                                                <li class="">
                            <a href="function.realpath-cache-size.php.html" title="realpath_&#8203;cache_&#8203;size">realpath_&#8203;cache_&#8203;size</a>
                        </li>
                                                <li class="">
                            <a href="function.realpath.php.html" title="realpath">realpath</a>
                        </li>
                                                <li class="">
                            <a href="function.rename.php.html" title="rename">rename</a>
                        </li>
                                                <li class="">
                            <a href="function.rewind.php.html" title="rewind">rewind</a>
                        </li>
                                                <li class="">
                            <a href="function.rmdir.php.html" title="rmdir">rmdir</a>
                        </li>
                                                <li class="">
                            <a href="function.set-file-buffer.php.html" title="set_&#8203;file_&#8203;buffer">set_&#8203;file_&#8203;buffer</a>
                        </li>
                                                <li class="">
                            <a href="function.stat.php.html" title="stat">stat</a>
                        </li>
                                                <li class="">
                            <a href="function.symlink.php.html" title="symlink">symlink</a>
                        </li>
                                                <li class="">
                            <a href="function.tempnam.php.html" title="tempnam">tempnam</a>
                        </li>
                                                <li class="">
                            <a href="function.tmpfile.php.html" title="tmpfile">tmpfile</a>
                        </li>
                                                <li class="">
                            <a href="function.touch.php.html" title="touch">touch</a>
                        </li>
                                                <li class="">
                            <a href="function.umask.php.html" title="umask">umask</a>
                        </li>
                                                <li class="">
                            <a href="function.unlink.php.html" title="unlink">unlink</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
