<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: register_shutdown_function - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="function.register-shutdown-function.php.html">
 <link rel="shorturl" href="https://www.php.net/register-shutdown-function">
 <link rel="alternate" href="https://www.php.net/register-shutdown-function" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="ref.funchand.php.html">
 <link rel="prev" href="function.get-defined-functions.php.html">
 <link rel="next" href="function.register-tick-function.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/function.register-shutdown-function.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/function.register-shutdown-function.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/function.register-shutdown-function.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/function.register-shutdown-function.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/function.register-shutdown-function.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/function.register-shutdown-function.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/function.register-shutdown-function.php" hreflang="pt_BR">
 <link rel="alternate" href="function.register-shutdown-function.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/function.register-shutdown-function.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/function.register-shutdown-function.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="function.register-tick-function.php.html">
          register_tick_function &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="function.get-defined-functions.php.html">
          &laquo; get_defined_functions        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='funcref.php.html'>Справочник функций</a></li>      <li><a href='refs.basic.vartype.php.html'>Модули, относящиеся к переменным и типам</a></li>      <li><a href='book.funchand.php.html'>Управление функциями</a></li>      <li><a href='ref.funchand.php.html'>Функции управления функциями</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/function.register-shutdown-function.php'>English</option>
            <option value='de/function.register-shutdown-function.php'>German</option>
            <option value='es/function.register-shutdown-function.php'>Spanish</option>
            <option value='fr/function.register-shutdown-function.php'>French</option>
            <option value='it/function.register-shutdown-function.php'>Italian</option>
            <option value='ja/function.register-shutdown-function.php'>Japanese</option>
            <option value='pt_BR/function.register-shutdown-function.php'>Brazilian Portuguese</option>
            <option value='ru/function.register-shutdown-function.php' selected="selected">Russian</option>
            <option value='tr/function.register-shutdown-function.php'>Turkish</option>
            <option value='zh/function.register-shutdown-function.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/reference/funchand/functions/register-shutdown-function.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Ffunction.register-shutdown-function%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="function.register-shutdown-function" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">register_shutdown_function</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7, PHP 8)</p><p class="refpurpose"><span class="refname">register_shutdown_function</span> &mdash; <span class="dc-title">Регистрирует функцию, которая выполнится при завершении работы скрипта</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.register-shutdown-function-description">
  <h3 class="title">Описание</h3>
  <div class="methodsynopsis dc-description">
   <span class="methodname"><strong>register_shutdown_function</strong></span>(<span class="methodparam"><span class="type"><a href="language.types.callable.php.html" class="type callable">callable</a></span> <code class="parameter">$callback</code></span>, <span class="methodparam"><span class="type"><a href="language.types.declarations.php.html#language.types.declarations.mixed" class="type mixed">mixed</a></span> <code class="parameter">...$args</code></span>): <span class="type"><span class="type void">void</span></span></div>

  <p class="para rdfs-comment">
   Регистрирует функцию <code class="parameter">callback</code>, которая
   выполнится после завершения работы скрипта или при вызове функции
   <span class="function"><a href="function.exit.php.html" class="function">exit()</a></span>.
  </p>
  <p class="para">
   Возможна регистрация нескольких подобных функций с помощью
   <span class="function"><strong>register_shutdown_function()</strong></span>, при этом функции будут
   выполняться в том порядке, в каком они были зарегистрированы.
   Если вы вызовете <span class="function"><a href="function.exit.php.html" class="function">exit()</a></span> в одной из зарегистрированных
   завершающих функций, процесс будет полностью остановлен и последующие
   завершающие функции не будут вызваны.
  </p>
  <p class="para">
   Завершающие функции также могут сами вызывать <span class="function"><strong>register_shutdown_function()</strong></span>,
   чтобы добавить функцию выключения в конец очереди.
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.register-shutdown-function-parameters">
  <h3 class="title">Список параметров</h3>
  <p class="para">
   <dl>
    
     <dt>
<code class="parameter">callback</code></dt>

     <dd>

      <p class="para">
       Регистрируемая завершающая функция.
      </p>
      <p class="para">
       Завершающие функции выполняются как часть запроса, поэтому
    можно отправлять данные на вывод из них и получать доступ к буферизации вывода.
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">args</code></dt>

     <dd>

      <p class="para">
       Можно передавать параметры в завершающую функцию, передав
       дополнительные параметры.
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.register-shutdown-function-returnvalues">
  <h3 class="title">Возвращаемые значения</h3>
  <p class="para">
   Функция не возвращает значения после выполнения.
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.register-shutdown-function-examples">
  <h3 class="title">Примеры</h3>
  <p class="para">
   <div class="example" id="">
    <p><strong>Пример #1 Пример использования <span class="function"><strong>register_shutdown_function()</strong></span></strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">function </span><span style="color: #0000BB">shutdown</span><span style="color: #007700">()<br />{<br />    </span><span style="color: #FF8000">// Это наша завершающая функция,<br />    // здесь мы можем выполнить все последние операции<br />    // перед тем как скрипт полностью завершится.<br /><br />    </span><span style="color: #007700">echo </span><span style="color: #DD0000">'Скрипт успешно завершился'</span><span style="color: #007700">, </span><span style="color: #0000BB">PHP_EOL</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">register_shutdown_function</span><span style="color: #007700">(</span><span style="color: #DD0000">'shutdown'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.register-shutdown-function-notes">
  <h3 class="title">Примечания</h3>
  <blockquote class="note"><p><strong class="note">Замечание</strong>: 
   <p class="para">
    Рабочая директория скрипта может измениться внутри завершающей функции
    на некоторых веб-серверах, например, Apache.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Замечание</strong>: 
   <p class="para">
    Функции, выполняемые при завершении скрипта, не будут выполнены, если процесс был убит
    с сигналами SIGTERM или SIGKILL. Хотя вы и не можете перехватить SIGKILL, но
    вы можете использовать функцию <span class="function"><a href="function.pcntl-signal.php.html" class="function">pcntl_signal()</a></span>, чтобы
    задать обработчик сигнала SIGTERM, который использует функцию <span class="function"><a href="function.exit.php.html" class="function">exit()</a></span>, чтобы
    завершить скрипт правильно.
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">Замечание</strong>: 
   <p class="para">
    Завершающие функции выполняются отдельно от времени,
    отслеживаемого <a href="info.configuration.php.html#ini.max-execution-time" class="link">max_execution_time</a>.
    Это означает, что даже если процесс будет завершён из-за слишком долгого выполнения,
    завершающие функции всё равно будут вызваны.
    Кроме того, если <code class="literal">max_execution_time</code> истечёт
    во время работы завершающей функции, процесс не будет завершён.
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.register-shutdown-function-seealso">
  <h3 class="title">Смотрите также</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><a href="ini.core.php.html#ini.auto-append-file" class="link">auto_append_file</a></li>
    <li class="member"><span class="function"><a href="function.exit.php.html" class="function" rel="rdfs-seeAlso">exit()</a> - Выводит сообщение и прекращает выполнение текущего скрипта</span></li>
    <li class="member"><span class="function"><a href="function.fastcgi-finish-request.php.html" class="function" rel="rdfs-seeAlso">fastcgi_finish_request()</a> - Сбрасывает все запрошенные данные клиенту</span></li>
    <li class="member">Раздел <a href="features.connection-handling.php.html" class="link">Обработка соединений</a></li>
   </ul>
  </p>
 </div>


</div><section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=function.register-shutdown-function&amp;redirect=https://www.php.net/manual/ru/function.register-shutdown-function.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">14 notes</span></h3>
 </div><div id="allnotes">
  <div class="note" id="33575">  <div class="votes">
    <div id="Vu33575">
    <a href="https://www.php.net/manual/vote-note.php?id=33575&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd33575">
    <a href="https://www.php.net/manual/vote-note.php?id=33575&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V33575" title="90% like this...">
    256
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#33575" class="name">
  <strong class="user"><em>jules at sitepointAASASZZ dot com</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#33575"> &para;</a><div class="date" title="2003-07-01 12:41"><strong>20 years ago</strong></div>
  <div class="text" id="Hcom33575">
<div class="phpcode"><code><span class="html">If your script exceeds the maximum execution time, and terminates thusly:<br /><br />Fatal error: Maximum execution time of 20 seconds exceeded in - on line 12<br /><br />The registered shutdown functions will still be executed.<br /><br />I figured it was important that this be made clear!</span></code></div>
  </div>
 </div>
  <div class="note" id="59300">  <div class="votes">
    <div id="Vu59300">
    <a href="https://www.php.net/manual/vote-note.php?id=59300&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd59300">
    <a href="https://www.php.net/manual/vote-note.php?id=59300&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V59300" title="90% like this...">
    81
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#59300" class="name">
  <strong class="user"><em>http://livejournal.com/~sinde1/</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#59300"> &para;</a><div class="date" title="2005-12-02 04:49"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom59300">
<div class="phpcode"><code><span class="html">If you want to do something with files in function, that registered in register_shutdown_function(), use ABSOLUTE paths to files instead of relative. Because when script processing is complete current working directory chages to ServerRoot (see httpd.conf)</span></code></div>
  </div>
 </div>
  <div class="note" id="92657">  <div class="votes">
    <div id="Vu92657">
    <a href="https://www.php.net/manual/vote-note.php?id=92657&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd92657">
    <a href="https://www.php.net/manual/vote-note.php?id=92657&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V92657" title="75% like this...">
    14
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#92657" class="name">
  <strong class="user"><em>pgl at yoyo dot org</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#92657"> &para;</a><div class="date" title="2009-08-02 02:25"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom92657">
<div class="phpcode"><code><span class="html">You definitely need to be careful about using relative paths in after the shutdown function has been called, but the current working directory doesn't (necessarily) get changed to the web server's ServerRoot - I've tested on two different servers and they both have their CWD changed to '/' (which isn't the ServerRoot).<br /><br />This demonstrates the behaviour:<br /><br /><span class="default">&lt;?php<br /></span><span class="keyword">function </span><span class="default">echocwd</span><span class="keyword">() { echo </span><span class="string">'cwd: '</span><span class="keyword">, </span><span class="default">getcwd</span><span class="keyword">(), </span><span class="string">"\n"</span><span class="keyword">; }<br /><br /></span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">'echocwd'</span><span class="keyword">);<br /></span><span class="default">echocwd</span><span class="keyword">() and exit;<br /></span><span class="default">?&gt;<br /></span><br />Outputs:<br /><br />cwd: /path/to/my/site/docroot/test<br />cwd: /<br /><br />NB: CLI scripts are unaffected, and keep their CWD as the directory the script was called from.</span></code></div>
  </div>
 </div>
  <div class="note" id="100000">  <div class="votes">
    <div id="Vu100000">
    <a href="https://www.php.net/manual/vote-note.php?id=100000&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd100000">
    <a href="https://www.php.net/manual/vote-note.php?id=100000&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V100000" title="73% like this...">
    21
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#100000" class="name">
  <strong class="user"><em>emanueledelgrande ad email dot it</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#100000"> &para;</a><div class="date" title="2010-09-19 07:53"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom100000">
<div class="phpcode"><code><span class="html">A lot of useful services may be delegated to this useful trigger.<br />It is very effective because it is executed at the end of the script but before any object destruction, so all instantiations are still alive.<br /><br />Here's a simple shutdown events manager class which allows to manage either functions or static/dynamic methods, with an indefinite number of arguments without using any reflection, availing on a internal handling through func_get_args() and call_user_func_array() specific functions:<br /><br /><span class="default">&lt;?php<br /></span><span class="comment">// managing the shutdown callback events:<br /></span><span class="keyword">class </span><span class="default">shutdownScheduler </span><span class="keyword">{<br />    private </span><span class="default">$callbacks</span><span class="keyword">; </span><span class="comment">// array to store user callbacks<br />    <br />    </span><span class="keyword">public function </span><span class="default">__construct</span><span class="keyword">() {<br />        </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">callbacks </span><span class="keyword">= array();<br />        </span><span class="default">register_shutdown_function</span><span class="keyword">(array(</span><span class="default">$this</span><span class="keyword">, </span><span class="string">'callRegisteredShutdown'</span><span class="keyword">));<br />    }<br />    public function </span><span class="default">registerShutdownEvent</span><span class="keyword">() {<br />        </span><span class="default">$callback </span><span class="keyword">= </span><span class="default">func_get_args</span><span class="keyword">();<br />        <br />        if (empty(</span><span class="default">$callback</span><span class="keyword">)) {<br />            </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'No callback passed to '</span><span class="keyword">.</span><span class="default">__FUNCTION__</span><span class="keyword">.</span><span class="string">' method'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />            return </span><span class="default">false</span><span class="keyword">;<br />        }<br />        if (!</span><span class="default">is_callable</span><span class="keyword">(</span><span class="default">$callback</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">])) {<br />            </span><span class="default">trigger_error</span><span class="keyword">(</span><span class="string">'Invalid callback passed to the '</span><span class="keyword">.</span><span class="default">__FUNCTION__</span><span class="keyword">.</span><span class="string">' method'</span><span class="keyword">, </span><span class="default">E_USER_ERROR</span><span class="keyword">);<br />            return </span><span class="default">false</span><span class="keyword">;<br />        }<br />        </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">callbacks</span><span class="keyword">[] = </span><span class="default">$callback</span><span class="keyword">;<br />        return </span><span class="default">true</span><span class="keyword">;<br />    }<br />    public function </span><span class="default">callRegisteredShutdown</span><span class="keyword">() {<br />        foreach (</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">callbacks </span><span class="keyword">as </span><span class="default">$arguments</span><span class="keyword">) {<br />            </span><span class="default">$callback </span><span class="keyword">= </span><span class="default">array_shift</span><span class="keyword">(</span><span class="default">$arguments</span><span class="keyword">);<br />            </span><span class="default">call_user_func_array</span><span class="keyword">(</span><span class="default">$callback</span><span class="keyword">, </span><span class="default">$arguments</span><span class="keyword">);<br />        }<br />    }<br />    </span><span class="comment">// test methods:<br />    </span><span class="keyword">public function </span><span class="default">dynamicTest</span><span class="keyword">() {<br />        echo </span><span class="string">'_REQUEST array is '</span><span class="keyword">.</span><span class="default">count</span><span class="keyword">(</span><span class="default">$_REQUEST</span><span class="keyword">).</span><span class="string">' elements long.&lt;br /&gt;'</span><span class="keyword">;<br />    }<br />    public static function </span><span class="default">staticTest</span><span class="keyword">() {<br />        echo </span><span class="string">'_SERVER array is '</span><span class="keyword">.</span><span class="default">count</span><span class="keyword">(</span><span class="default">$_SERVER</span><span class="keyword">).</span><span class="string">' elements long.&lt;br /&gt;'</span><span class="keyword">;<br />    }<br />}<br /></span><span class="default">?&gt;<br /></span><br />A simple application:<br /><br /><span class="default">&lt;?php<br /></span><span class="comment">// a generic function<br /></span><span class="keyword">function </span><span class="default">say</span><span class="keyword">(</span><span class="default">$a </span><span class="keyword">= </span><span class="string">'a generic greeting'</span><span class="keyword">, </span><span class="default">$b </span><span class="keyword">= </span><span class="string">''</span><span class="keyword">) {<br />    echo </span><span class="string">"Saying </span><span class="keyword">{</span><span class="default">$a</span><span class="keyword">}</span><span class="string"> </span><span class="keyword">{</span><span class="default">$b</span><span class="keyword">}</span><span class="string">&lt;br /&gt;"</span><span class="keyword">;<br />}<br /><br /></span><span class="default">$scheduler </span><span class="keyword">= new </span><span class="default">shutdownScheduler</span><span class="keyword">();<br /><br /></span><span class="comment">// schedule a global scope function:<br /></span><span class="default">$scheduler</span><span class="keyword">-&gt;</span><span class="default">registerShutdownEvent</span><span class="keyword">(</span><span class="string">'say'</span><span class="keyword">, </span><span class="string">'hello!'</span><span class="keyword">);<br /><br /></span><span class="comment">// try to schedule a dyamic method:<br /></span><span class="default">$scheduler</span><span class="keyword">-&gt;</span><span class="default">registerShutdownEvent</span><span class="keyword">(array(</span><span class="default">$scheduler</span><span class="keyword">, </span><span class="string">'dynamicTest'</span><span class="keyword">));<br /></span><span class="comment">// try with a static call:<br /></span><span class="default">$scheduler</span><span class="keyword">-&gt;</span><span class="default">registerShutdownEvent</span><span class="keyword">(</span><span class="string">'scheduler::staticTest'</span><span class="keyword">);<br /><br /></span><span class="default">?&gt;<br /></span><br />It is easy to guess how to extend this example in a more complex context in which user defined functions and methods should be handled according to the priority depending on specific variables.<br /><br />Hope it may help somebody.<br />Happy coding!</span></code></div>
  </div>
 </div>
  <div class="note" id="95256">  <div class="votes">
    <div id="Vu95256">
    <a href="https://www.php.net/manual/vote-note.php?id=95256&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd95256">
    <a href="https://www.php.net/manual/vote-note.php?id=95256&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V95256" title="71% like this...">
    26
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#95256" class="name">
  <strong class="user"><em>ravenswd at gmail dot com</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#95256"> &para;</a><div class="date" title="2009-12-21 01:43"><strong>14 years ago</strong></div>
  <div class="text" id="Hcom95256">
<div class="phpcode"><code><span class="html">You may get the idea to call debug_backtrace or debug_print_backtrace from inside a shutdown function, to trace where a fatal error occurred. Unfortunately, these functions will not work inside a shutdown function.</span></code></div>
  </div>
 </div>
  <div class="note" id="85727">  <div class="votes">
    <div id="Vu85727">
    <a href="https://www.php.net/manual/vote-note.php?id=85727&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd85727">
    <a href="https://www.php.net/manual/vote-note.php?id=85727&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V85727" title="72% like this...">
    8
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#85727" class="name">
  <strong class="user"><em>RLK</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#85727"> &para;</a><div class="date" title="2008-09-14 02:26"><strong>15 years ago</strong></div>
  <div class="text" id="Hcom85727">
<div class="phpcode"><code><span class="html">Contrary to the the note that "headers are always sent" and some of the comments below - You CAN use header() inside of a shutdown function as you would anywhere else; when headers_sent() is false. You can do custom fatal handling this way:<br /><br /><span class="default">&lt;?php<br />ini_set</span><span class="keyword">(</span><span class="string">'display_errors'</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">);<br /></span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">'shutdown'</span><span class="keyword">);<br /><br /></span><span class="default">$obj </span><span class="keyword">= new </span><span class="default">stdClass</span><span class="keyword">();<br /></span><span class="default">$obj</span><span class="keyword">-&gt;</span><span class="default">method</span><span class="keyword">();<br /><br />function </span><span class="default">shutdown</span><span class="keyword">()<br />{<br />  if(!</span><span class="default">is_null</span><span class="keyword">(</span><span class="default">$e </span><span class="keyword">= </span><span class="default">error_get_last</span><span class="keyword">()))<br />  {<br />    </span><span class="default">header</span><span class="keyword">(</span><span class="string">'content-type: text/plain'</span><span class="keyword">);<br />    print </span><span class="string">"this is not html:\n\n"</span><span class="keyword">. </span><span class="default">print_r</span><span class="keyword">(</span><span class="default">$e</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />  }<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="63104">  <div class="votes">
    <div id="Vu63104">
    <a href="https://www.php.net/manual/vote-note.php?id=63104&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd63104">
    <a href="https://www.php.net/manual/vote-note.php?id=63104&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V63104" title="66% like this...">
    5
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#63104" class="name">
  <strong class="user"><em>dweingart at pobox dot com</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#63104"> &para;</a><div class="date" title="2006-03-13 08:53"><strong>17 years ago</strong></div>
  <div class="text" id="Hcom63104">
<div class="phpcode"><code><span class="html">I have discovered a change in behavior from PHP 5.0.4 to PHP 5.1.2 when using a shutdown function in conjunction with an output buffering callback.<br /><br />In PHP 5.0.4 (and earlier versions I believe) the shutdown function is called after the output buffering callback.<br /><br />In PHP 5.1.2 (not sure when the change occurred) the shutdown function is called before the output buffering callback.<br /><br />Test code:<br /><span class="default">&lt;?php<br /></span><span class="keyword">function </span><span class="default">ob_callback</span><span class="keyword">(</span><span class="default">$buf</span><span class="keyword">) {<br />    </span><span class="default">$buf </span><span class="keyword">.= </span><span class="string">'&lt;li&gt;' </span><span class="keyword">. </span><span class="default">__FUNCTION__ </span><span class="keyword">.</span><span class="string">'&lt;/li&gt;'</span><span class="keyword">;<br />    return </span><span class="default">$buf</span><span class="keyword">;<br />}<br /><br />function </span><span class="default">shutdown_func</span><span class="keyword">() {<br />    echo </span><span class="string">'&lt;li&gt;' </span><span class="keyword">. </span><span class="default">__FUNCTION__ </span><span class="keyword">.</span><span class="string">'&lt;/li&gt;'</span><span class="keyword">;<br />}<br /><br /></span><span class="default">ob_start</span><span class="keyword">(</span><span class="string">'ob_callback'</span><span class="keyword">);<br /></span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">'shutdown_func'</span><span class="keyword">);<br />echo </span><span class="string">'&lt;ol&gt;'</span><span class="keyword">;<br /></span><span class="default">?&gt;<br /></span><br />PHP 5.0.4:<br /><br />1. ob_callback<br />2. shutdown_func<br /><br />PHP 5.1.2:<br /><br />1. shutdown_func<br />2. ob_callback</span></code></div>
  </div>
 </div>
  <div class="note" id="97447">  <div class="votes">
    <div id="Vu97447">
    <a href="https://www.php.net/manual/vote-note.php?id=97447&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd97447">
    <a href="https://www.php.net/manual/vote-note.php?id=97447&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V97447" title="62% like this...">
    2
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#97447" class="name">
  <strong class="user"><em>jawsper at aximax dot nl</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#97447"> &para;</a><div class="date" title="2010-04-20 05:21"><strong>13 years ago</strong></div>
  <div class="text" id="Hcom97447">
<div class="phpcode"><code><span class="html">Something found out during testing:<br /><br />the ini auto_append_file will be included BEFORE the registered function(s) will be called.</span></code></div>
  </div>
 </div>
  <div class="note" id="108212">  <div class="votes">
    <div id="Vu108212">
    <a href="https://www.php.net/manual/vote-note.php?id=108212&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd108212">
    <a href="https://www.php.net/manual/vote-note.php?id=108212&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V108212" title="60% like this...">
    7
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#108212" class="name">
  <strong class="user"><em>alexyam at live dot com</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#108212"> &para;</a><div class="date" title="2012-04-08 03:50"><strong>11 years ago</strong></div>
  <div class="text" id="Hcom108212">
<div class="phpcode"><code><span class="html">When using php-fpm, fastcgi_finish_request() should be used instead of register_shutdown_function() and exit()<br /><br />For example, under nginx and php-fpm 5.3+, this will make browsers wait 10 seconds to show output:<br /><br /><span class="default">&lt;?php<br />    </span><span class="keyword">echo </span><span class="string">"You have to wait 10 seconds to see this.&lt;br&gt;"</span><span class="keyword">;<br />    </span><span class="default">register_shutdown_function</span><span class="keyword">(</span><span class="string">'shutdown'</span><span class="keyword">);<br />    exit;<br />    function </span><span class="default">shutdown</span><span class="keyword">(){<br />        </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />        echo </span><span class="string">"Because exit() doesn't terminate php-fpm calls immediately.&lt;br&gt;"</span><span class="keyword">;<br />    }<br /></span><span class="default">?&gt;<br /></span><br />This doesn't:<br /><br /><span class="default">&lt;?php<br />    </span><span class="keyword">echo </span><span class="string">"You can see this from the browser immediately.&lt;br&gt;"</span><span class="keyword">;<br />    </span><span class="default">fastcgi_finish_request</span><span class="keyword">();<br />    </span><span class="default">sleep</span><span class="keyword">(</span><span class="default">10</span><span class="keyword">);<br />    echo </span><span class="string">"You can't see this form the browser."</span><span class="keyword">;<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="61185">  <div class="votes">
    <div id="Vu61185">
    <a href="https://www.php.net/manual/vote-note.php?id=61185&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd61185">
    <a href="https://www.php.net/manual/vote-note.php?id=61185&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V61185" title="60% like this...">
    1
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#61185" class="name">
  <strong class="user"><em>kenneth dot kalmer at gmail dot com</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#61185"> &para;</a><div class="date" title="2006-01-27 09:26"><strong>18 years ago</strong></div>
  <div class="text" id="Hcom61185">
<div class="phpcode"><code><span class="html">I performed two tests on the register_shutdown_function() to see under what conditions it was called, and if a can call a static method from a class. Here are the results:<br /><br /><span class="default">&lt;?php<br /></span><span class="comment">/**<br /> * Tests the shutdown function being able to call a static methods<br /> */<br /></span><span class="keyword">class </span><span class="default">Shutdown<br /></span><span class="keyword">{<br />    public static function </span><span class="default">Method </span><span class="keyword">(</span><span class="default">$mixed </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">)<br />    {<br />        </span><span class="comment">// we need absolute<br />        </span><span class="default">$ap </span><span class="keyword">= </span><span class="default">dirname </span><span class="keyword">(</span><span class="default">__FILE__</span><span class="keyword">);<br />        </span><span class="default">$mixed </span><span class="keyword">= </span><span class="default">time </span><span class="keyword">() . </span><span class="string">" - </span><span class="default">$mixed</span><span class="string">\n"</span><span class="keyword">;<br />        </span><span class="default">file_put_contents </span><span class="keyword">(</span><span class="string">"</span><span class="default">$ap</span><span class="string">/shutdown.log"</span><span class="keyword">, </span><span class="default">$mixed</span><span class="keyword">, </span><span class="default">FILE_APPEND</span><span class="keyword">);<br />    }<br />}<br /></span><span class="comment">// 3. Throw an exception<br /></span><span class="default">register_shutdown_function </span><span class="keyword">(array (</span><span class="string">'Shutdown'</span><span class="keyword">, </span><span class="string">'Method'</span><span class="keyword">), </span><span class="string">'throw'</span><span class="keyword">);<br />throw new </span><span class="default">Exception </span><span class="keyword">(</span><span class="string">'bla bla'</span><span class="keyword">);<br /><br /></span><span class="comment">// 2. Use the exit command<br />//register_shutdown_function (array ('Shutdown', 'Method'), 'exit');<br />//exit ('exiting here...')<br /><br />// 1. Exit normally<br />//register_shutdown_function (array ('Shutdown', 'Method'));<br /></span><span class="default">?&gt;<br /></span><br />To test simply leave one of the three test lines uncommented and execute. Executing bottom-up yielded:<br /><br />1138382480 - 0<br />1138382503 - exit<br />1138382564 - throw<br /><br />HTH</span></code></div>
  </div>
 </div>
  <div class="note" id="40815">  <div class="votes">
    <div id="Vu40815">
    <a href="https://www.php.net/manual/vote-note.php?id=40815&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd40815">
    <a href="https://www.php.net/manual/vote-note.php?id=40815&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V40815" title="54% like this...">
    1
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#40815" class="name">
  <strong class="user"><em>sts at mail dot xubion dot hu</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#40815"> &para;</a><div class="date" title="2004-03-15 02:56"><strong>19 years ago</strong></div>
  <div class="text" id="Hcom40815">
<div class="phpcode"><code><span class="html">If you need the old (&lt;4.1) behavior of register_shutdown_function you can achieve the same with "Connection: close" and "Content-Length: xxxx" headers if you know the exact size of the sent data (which can be easily caught with output buffering).<br />An example:<br /><span class="default">&lt;?php<br />header</span><span class="keyword">(</span><span class="string">"Connection: close"</span><span class="keyword">);<br /></span><span class="default">ob_start</span><span class="keyword">();<br /></span><span class="default">phpinfo</span><span class="keyword">();<br /></span><span class="default">$size</span><span class="keyword">=</span><span class="default">ob_get_length</span><span class="keyword">(); <br /></span><span class="default">header</span><span class="keyword">(</span><span class="string">"Content-Length: </span><span class="default">$size</span><span class="string">"</span><span class="keyword">);<br /></span><span class="default">ob_end_flush</span><span class="keyword">();<br /></span><span class="default">flush</span><span class="keyword">();<br /></span><span class="default">sleep</span><span class="keyword">(</span><span class="default">13</span><span class="keyword">);<br /></span><span class="default">error_log</span><span class="keyword">(</span><span class="string">"do something in the background"</span><span class="keyword">);<br /></span><span class="default">?&gt;<br /></span><br />The same will work with registered functions.<br />According to http spec, browsers should close the connection when they got the amount of data specified in Content-Length header. At least it works fine for me in IE6 and Opera7.</span></code></div>
  </div>
 </div>
  <div class="note" id="129024">  <div class="votes">
    <div id="Vu129024">
    <a href="https://www.php.net/manual/vote-note.php?id=129024&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd129024">
    <a href="https://www.php.net/manual/vote-note.php?id=129024&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V129024" title="100% like this...">
    1
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#129024" class="name">
  <strong class="user"><em>josh at joshstrange dot com</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#129024"> &para;</a><div class="date" title="2023-11-09 04:27"><strong>3 months ago</strong></div>
  <div class="text" id="Hcom129024">
<div class="phpcode"><code><span class="html">&gt; Shutdown functions run separately from the time tracked by max_execution_time. That means even if a process is terminated for running too long, shutdown functions will still be called. Additionally, if the max_execution_time runs out while a shutdown function is running it will not be terminated.<br /><br />This does not appear to be true in our testing, specifically "Additionally, if the max_execution_time runs out while a shutdown function is running it will not be terminated".  For example:<br /><br /><span class="default">&lt;?php<br />set_time_limit</span><span class="keyword">(</span><span class="default">5</span><span class="keyword">);<br /><br /></span><span class="default">register_shutdown_function</span><span class="keyword">(function() {<br />    </span><span class="default">$start </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">();<br />    for(</span><span class="default">$i </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">40</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />        echo </span><span class="string">"Run 1: </span><span class="default">$i</span><span class="string">\n"</span><span class="keyword">;<br />        while(</span><span class="default">1</span><span class="keyword">) {<br />            </span><span class="default">$elapsed </span><span class="keyword">= </span><span class="default">time</span><span class="keyword">() - </span><span class="default">$start</span><span class="keyword">;<br />            if(</span><span class="default">$elapsed </span><span class="keyword">&gt; </span><span class="default">$i</span><span class="keyword">) {<br />                break;<br />            }<br />        }<br />    }<br />});<br /><br /></span><span class="default">?&gt;<br /></span><br />This will print out:<br /><br />Run 1: 0<br />Run 1: 1<br />Run 1: 2<br />Run 1: 3<br />Run 1: 4<br />Run 1: 5<br /><br />Then it will die with:<br /><br />Execution took longer than 5 seconds, sent SIGTERM and terminated<br /><br />If you register multiple shutdown functions and an earlier one exceeds the execution time the later ones will _not_ be run. <br /><br />If you need your shutdowns to have unlimited time (like the docs suggest it works) one solution might be to register a shutdown function like this early in your code:<br /><br /><span class="default">&lt;?php<br />register_shutdown_function</span><span class="keyword">(function() {<br />    </span><span class="default">set_time_limit</span><span class="keyword">(</span><span class="default">0</span><span class="keyword">);<br />});<br /></span><span class="default">?&gt;<br /></span><br />So that you give yourself unlimited time in your subsequent shutdown functions.<br /><br />See an example here: <a href="https://www.tehplayground.com/wJLtMi3Z5c1sTi9Y" rel="nofollow" target="_blank">https://www.tehplayground.com/wJLtMi3Z5c1sTi9Y</a> (Note, 5 seconds is the max you can set on this website. If you remove the first shutdown function you it will be killed after 3 seconds).</span></code></div>
  </div>
 </div>
  <div class="note" id="120620">  <div class="votes">
    <div id="Vu120620">
    <a href="https://www.php.net/manual/vote-note.php?id=120620&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd120620">
    <a href="https://www.php.net/manual/vote-note.php?id=120620&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V120620" title="100% like this...">
    2
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#120620" class="name">
  <strong class="user"><em>raat1979 at gmail dot com</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#120620"> &para;</a><div class="date" title="2017-02-08 07:31"><strong>7 years ago</strong></div>
  <div class="text" id="Hcom120620">
<div class="phpcode"><code><span class="html">I wanted to set the exit code for a CLI application from a shutdown function by using a class property, <br /><br />Unfortunataly (as per manual)  "If you call exit() within one registered shutdown function, processing will stop completely and no other registered shutdown functions will be called."  <br /><br />As a result if I call exit in my shutdown function I will break other shutdown functions (like one that logs fatal errors to syslog)  <br /><br />However! (as per manual)  "Multiple calls to register_shutdown_function() can be made, and each will be called in the same order as they were registered."<br /><br />As luck would have it you are also able to register a shutdown function from within a shutdown function (at least in PHP 7.0.15 and 5.6.30) <br /><br />in other words if you register a shutdown function inside a shutdown function it is appended to the shutdown function queue.<br /><br /><span class="default">&lt;?php <br /></span><span class="keyword">class </span><span class="default">SomeApplication</span><span class="keyword">{<br />    private </span><span class="default">$exitCode </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />        <br />    public function </span><span class="default">__construct</span><span class="keyword">(){<br />        </span><span class="default">register_shutdown_function</span><span class="keyword">(function(){<br />        echo </span><span class="string">"some registered shutdown function"</span><span class="keyword">;<br />            </span><span class="default">register_shutdown_function</span><span class="keyword">(function(){<br />                echo </span><span class="string">"last registered shutdown function"</span><span class="keyword">;<br />                </span><span class="comment">// one might even consider another register shutdown_function if one expects other shutdown functions to do the same...  <br />                </span><span class="keyword">exit(</span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">exitCode </span><span class="keyword">=== </span><span class="default">null </span><span class="keyword">? </span><span class="default">0 </span><span class="keyword">: </span><span class="default">$this</span><span class="keyword">-&gt;</span><span class="default">exitCode</span><span class="keyword">);<br />            });<br />        });<br />    }<br />}<br /></span><span class="default">?&gt;</span></span></code></div>
  </div>
 </div>
  <div class="note" id="123696">  <div class="votes">
    <div id="Vu123696">
    <a href="https://www.php.net/manual/vote-note.php?id=123696&amp;page=function.register-shutdown-function&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd123696">
    <a href="https://www.php.net/manual/vote-note.php?id=123696&amp;page=function.register-shutdown-function&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V123696" title="33% like this...">
    -1
    </div>
  </div>
  <a href="function.register-shutdown-function.php.html#123696" class="name">
  <strong class="user"><em>Anonymous</em></strong></a><a class="genanchor" href="function.register-shutdown-function.php.html#123696"> &para;</a><div class="date" title="2019-03-16 10:08"><strong>4 years ago</strong></div>
  <div class="text" id="Hcom123696">
<div class="phpcode"><code><span class="html">warning: in addition to SIGTERM and SIGKILL, the shutdown functions won't run in response to SIGINT either. (observed on php 7.1.16 on windows 7 SP1 x64 + cygwin  and php 7.2.15 on Ubuntu 18.04)</span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=function.register-shutdown-function&amp;redirect=https://www.php.net/manual/ru/function.register-shutdown-function.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="ref.funchand.php.html">Функции управления функциями</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="function.call-user-func-array.php.html" title="call_&#8203;user_&#8203;func_&#8203;array">call_&#8203;user_&#8203;func_&#8203;array</a>
                        </li>
                                                <li class="">
                            <a href="function.call-user-func.php.html" title="call_&#8203;user_&#8203;func">call_&#8203;user_&#8203;func</a>
                        </li>
                                                <li class="">
                            <a href="function.forward-static-call-array.php.html" title="forward_&#8203;static_&#8203;call_&#8203;array">forward_&#8203;static_&#8203;call_&#8203;array</a>
                        </li>
                                                <li class="">
                            <a href="function.forward-static-call.php.html" title="forward_&#8203;static_&#8203;call">forward_&#8203;static_&#8203;call</a>
                        </li>
                                                <li class="">
                            <a href="function.func-get-arg.php.html" title="func_&#8203;get_&#8203;arg">func_&#8203;get_&#8203;arg</a>
                        </li>
                                                <li class="">
                            <a href="function.func-get-args.php.html" title="func_&#8203;get_&#8203;args">func_&#8203;get_&#8203;args</a>
                        </li>
                                                <li class="">
                            <a href="function.func-num-args.php.html" title="func_&#8203;num_&#8203;args">func_&#8203;num_&#8203;args</a>
                        </li>
                                                <li class="">
                            <a href="function.function-exists.php.html" title="function_&#8203;exists">function_&#8203;exists</a>
                        </li>
                                                <li class="">
                            <a href="function.get-defined-functions.php.html" title="get_&#8203;defined_&#8203;functions">get_&#8203;defined_&#8203;functions</a>
                        </li>
                                                <li class="current">
                            <a href="function.register-shutdown-function.php.html" title="register_&#8203;shutdown_&#8203;function">register_&#8203;shutdown_&#8203;function</a>
                        </li>
                                                <li class="">
                            <a href="function.register-tick-function.php.html" title="register_&#8203;tick_&#8203;function">register_&#8203;tick_&#8203;function</a>
                        </li>
                                                <li class="">
                            <a href="function.unregister-tick-function.php.html" title="unregister_&#8203;tick_&#8203;function">unregister_&#8203;tick_&#8203;function</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                        <li>
                <span class="header">Deprecated</span>
                <ul class="child-menu-list">
                                    <li class="">
                        <a href="function.create-function.php.html" title="create_&#8203;function">create_&#8203;function</a>
                    </li>
                                </ul>
            </li>
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
