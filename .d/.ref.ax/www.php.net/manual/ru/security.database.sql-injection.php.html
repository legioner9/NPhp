<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru">
<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>PHP: SQL-инъекции - Manual </title>

 <link rel="icon" type="image/svg+xml" sizes="any" href="../../favicon.svg%3Fv=2">
 <link rel="icon" type="image/png" sizes="196x196" href="../../favicon-196x196.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png%3Fv=2">
 <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png%3Fv=2">
 <link rel="shortcut icon" href="../../favicon.ico%3Fv=2">

 <link rel="search" type="application/opensearchdescription+xml" href="http://php.net/phpnetimprovedsearch.src" title="Add PHP.net search">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/releases/feed.php" title="PHP Release feed">
 <link rel="alternate" type="application/atom+xml" href="https://www.php.net/feed.atom" title="PHP: Hypertext Preprocessor">

 <link rel="canonical" href="security.database.sql-injection.php.html">
 <link rel="shorturl" href="security.database.sql-injection.php.html">
 <link rel="alternate" href="security.database.sql-injection.php.html" hreflang="x-default">

 <link rel="contents" href="index.php.html">
 <link rel="index" href="security.database.php.html">
 <link rel="prev" href="security.database.storage.php.html">
 <link rel="next" href="security.errors.php.html">

 <link rel="alternate" href="https://www.php.net/manual/en/security.database.sql-injection.php" hreflang="en">
 <link rel="alternate" href="https://www.php.net/manual/de/security.database.sql-injection.php" hreflang="de">
 <link rel="alternate" href="https://www.php.net/manual/es/security.database.sql-injection.php" hreflang="es">
 <link rel="alternate" href="https://www.php.net/manual/fr/security.database.sql-injection.php" hreflang="fr">
 <link rel="alternate" href="https://www.php.net/manual/it/security.database.sql-injection.php" hreflang="it">
 <link rel="alternate" href="https://www.php.net/manual/ja/security.database.sql-injection.php" hreflang="ja">
 <link rel="alternate" href="https://www.php.net/manual/pt_BR/security.database.sql-injection.php" hreflang="pt_BR">
 <link rel="alternate" href="security.database.sql-injection.php.html" hreflang="ru">
 <link rel="alternate" href="https://www.php.net/manual/tr/security.database.sql-injection.php" hreflang="tr">
 <link rel="alternate" href="https://www.php.net/manual/zh/security.database.sql-injection.php" hreflang="zh">

<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1689765002&amp;f=%252Ffonts%252FFira%252Ffira.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1700771401&amp;f=%252Ffonts%252FFont-Awesome%252Fcss%252Ffontello.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1705413607&amp;f=%252Fstyles%252Ftheme-base.css" media="screen">
<link rel="stylesheet" type="text/css" href="../../cached.php%3Ft=1701958202&amp;f=%252Fstyles%252Ftheme-medium.css" media="screen">

 <base href="">


</head>
<body class="docs ">

<nav id="head-nav" class="navbar navbar-fixed-top">
  <div class="navbar-inner clearfix">
    <a href="https://www.php.net/" class="brand"><img src="../../images/logos/php-logo.svg" width="48" height="24" alt="php"></a>
    <div id="mainmenu-toggle-overlay"></div>
    <input type="checkbox" id="mainmenu-toggle">
    <ul class="nav">
      <li class=""><a href="https://www.php.net/downloads">Downloads</a></li>
      <li class="active"><a href="https://www.php.net/docs.php">Documentation</a></li>
      <li class=""><a href="https://www.php.net/get-involved" >Get Involved</a></li>
      <li class=""><a href="https://www.php.net/support">Help</a></li>
      <li class="">
        <a href="https://www.php.net/releases/8.3/index.php">
          <img src="../../images/php8/logo_php8_3.svg" alt="php8.3" height="22" width="60">
        </a>
      </li>
    </ul>
    <form class="navbar-search" id="topsearch" action="https://www.php.net/search.php">
      <input type="hidden" name="show" value="quickref">
      <input type="search" name="pattern" class="search-query" placeholder="Search" accesskey="s">
    </form>
  </div>
  <div id="flash-message"></div>
</nav>
<div class="headsup"><a href='https://www.php.net/conferences/index.php#2024-02-13-1'>Dutch PHP Conference 2024</a></div>
<nav id="trick"><div><dl>
<dt><a href='https://www.php.net/manual/en/getting-started.php'>Getting Started</a></dt>
	<dd><a href='https://www.php.net/manual/en/introduction.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/tutorial.php'>A simple tutorial</a></dd>
<dt><a href='https://www.php.net/manual/en/langref.php'>Language Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/language.basic-syntax.php'>Basic syntax</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.types.php'>Types</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.variables.php'>Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.constants.php'>Constants</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.expressions.php'>Expressions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.operators.php'>Operators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.control-structures.php'>Control Structures</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.functions.php'>Functions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.oop5.php'>Classes and Objects</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.namespaces.php'>Namespaces</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.enumerations.php'>Enumerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.errors.php'>Errors</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.exceptions.php'>Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.fibers.php'>Fibers</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.generators.php'>Generators</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.attributes.php'>Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/language.references.php'>References Explained</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.variables.php'>Predefined Variables</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.exceptions.php'>Predefined Exceptions</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.interfaces.php'>Predefined Interfaces and Classes</a></dd>
	<dd><a href='https://www.php.net/manual/en/reserved.attributes.php'>Predefined Attributes</a></dd>
	<dd><a href='https://www.php.net/manual/en/context.php'>Context options and parameters</a></dd>
	<dd><a href='https://www.php.net/manual/en/wrappers.php'>Supported Protocols and Wrappers</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/security.php'>Security</a></dt>
	<dd><a href='https://www.php.net/manual/en/security.intro.php'>Introduction</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.general.php'>General considerations</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.cgi-bin.php'>Installed as CGI binary</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.apache.php'>Installed as an Apache module</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.sessions.php'>Session Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.filesystem.php'>Filesystem Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.database.php'>Database Security</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.errors.php'>Error Reporting</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.variables.php'>User Submitted Data</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.hiding.php'>Hiding PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/security.current.php'>Keeping Current</a></dd>
<dt><a href='https://www.php.net/manual/en/features.php'>Features</a></dt>
	<dd><a href='https://www.php.net/manual/en/features.http-auth.php'>HTTP authentication with PHP</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.cookies.php'>Cookies</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.sessions.php'>Sessions</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.xforms.php'>Dealing with XForms</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.file-upload.php'>Handling file uploads</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.remote-files.php'>Using remote files</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.connection-handling.php'>Connection handling</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.persistent-connections.php'>Persistent Database Connections</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.commandline.php'>Command line usage</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.gc.php'>Garbage Collection</a></dd>
	<dd><a href='https://www.php.net/manual/en/features.dtrace.php'>DTrace Dynamic Tracing</a></dd>
</dl>
<dl>
<dt><a href='https://www.php.net/manual/en/funcref.php'>Function Reference</a></dt>
	<dd><a href='https://www.php.net/manual/en/refs.basic.php.php'>Affecting PHP's Behaviour</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.audio.php'>Audio Formats Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.auth.php'>Authentication Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.cmdline.php'>Command Line Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.compression.php'>Compression and Archive Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.crypto.php'>Cryptography Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.database.php'>Database Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.calendar.php'>Date and Time Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.file.php'>File System Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.international.php'>Human Language and Character Encoding Support</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.image.php'>Image Processing and Generation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.mail.php'>Mail Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.math.php'>Mathematical Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.nontext.php'>Non-Text MIME Output</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.fileprocess.process.php'>Process Control Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.other.php'>Other Basic Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.remote.other.php'>Other Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.search.php'>Search Engine Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.server.php'>Server Specific Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.session.php'>Session Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.text.php'>Text Processing</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.basic.vartype.php'>Variable and Type Related Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.webservice.php'>Web Services</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.utilspec.windows.php'>Windows Only Extensions</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.xml.php'>XML Manipulation</a></dd>
	<dd><a href='https://www.php.net/manual/en/refs.ui.php'>GUI Extensions</a></dd>
</dl>
<dl>
<dt>Keyboard Shortcuts</dt><dt>?</dt>
<dd>This help</dd>
<dt>j</dt>
<dd>Next menu item</dd>
<dt>k</dt>
<dd>Previous menu item</dd>
<dt>g p</dt>
<dd>Previous man page</dd>
<dt>g n</dt>
<dd>Next man page</dd>
<dt>G</dt>
<dd>Scroll to bottom</dd>
<dt>g g</dt>
<dd>Scroll to top</dd>
<dt>g h</dt>
<dd>Goto homepage</dd>
<dt>g s</dt>
<dd>Goto search<br>(current page)</dd>
<dt>/</dt>
<dd>Focus search box</dd>
</dl></div></nav>
<div id="goto">
    <div class="search">
         <div class="text"></div>
         <div class="results"><ul></ul></div>
   </div>
</div>

  <div id="breadcrumbs" class="clearfix">
    <div id="breadcrumbs-inner">
          <div class="next">
        <a href="security.errors.php.html">
          Сообщения об ошибках &raquo;
        </a>
      </div>
              <div class="prev">
        <a href="security.database.storage.php.html">
          &laquo; Шифрование хранилища базы данных        </a>
      </div>
          <ul>
            <li><a href='index.php.html'>Руководство по PHP</a></li>      <li><a href='security.php.html'>Безопасность</a></li>      <li><a href='security.database.php.html'>Безопасность баз данных</a></li>      </ul>
    </div>
  </div>




<div id="layout" class="clearfix">
  <section id="layout-content">
  <div class="page-tools">
    <div class="change-language">
      <form action="https://www.php.net/manual/change.php" method="get" id="changelang" name="changelang">
        <fieldset>
          <label for="changelang-langs">Change language:</label>
          <select onchange="document.changelang.submit()" name="page" id="changelang-langs">
            <option value='en/security.database.sql-injection.php'>English</option>
            <option value='de/security.database.sql-injection.php'>German</option>
            <option value='es/security.database.sql-injection.php'>Spanish</option>
            <option value='fr/security.database.sql-injection.php'>French</option>
            <option value='it/security.database.sql-injection.php'>Italian</option>
            <option value='ja/security.database.sql-injection.php'>Japanese</option>
            <option value='pt_BR/security.database.sql-injection.php'>Brazilian Portuguese</option>
            <option value='ru/security.database.sql-injection.php' selected="selected">Russian</option>
            <option value='tr/security.database.sql-injection.php'>Turkish</option>
            <option value='zh/security.database.sql-injection.php'>Chinese (Simplified)</option>
            <option value='help-translate.php'>Other</option>
          </select>
        </fieldset>
      </form>
    </div>
    <div class="edit-bug">
      <a href="https://github.com/php/doc-ru/blob/master/security/database.xml">Submit a Pull Request</a>
      <a href="https://github.com/php/doc-ru/issues/new?body=From%20manual%20page:%20https:%2F%2Fphp.net%2Fsecurity.database.sql-injection%0A%0A---">Report a Bug</a>
    </div>
  </div><div id="security.database.sql-injection" class="sect1">
  <h2 class="title">SQL-инъекции</h2>
  <p class="simpara">
   SQL-инъекция - это техника, при которой злоумышленник использует недостатки в коде приложения,
   отвечающего за построение динамических SQL-запросов.
   Злоумышленник может получить доступ к привилегированным разделам приложения,
   получить всю информацию из базы данных, подменить существующие данные
   или даже выполнить опасные команды системного уровня на узле базы данных.
   Уязвимость возникает, когда разработчики конкатенируют или интерполируют
   произвольный ввод в SQL-запросах.
  </p>
  <p class="para">
   <div class="example" id="example-1315">
    <p><strong>Пример #1 
     Постраничный вывод результата и создание суперпользователя в PostgreSQL
    </strong></p>
    <div class="example-contents"><p>
     В следующем примере пользовательский ввод напрямую интерполируется в SQL-запрос,
     что позволяет злоумышленнику получить учётную запись суперпользователя в базе данных.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br />$offset </span><span style="color: #007700">= </span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'offset'</span><span style="color: #007700">]; </span><span style="color: #FF8000">// осторожно, нет валидации ввода!<br /></span><span style="color: #0000BB">$query  </span><span style="color: #007700">= </span><span style="color: #DD0000">"SELECT id, name FROM products ORDER BY name LIMIT 20 OFFSET </span><span style="color: #0000BB">$offset</span><span style="color: #DD0000">;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$result </span><span style="color: #007700">= </span><span style="color: #0000BB">pg_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
   Обычно пользователи нажимают по ссылкам &#039;вперёд&#039; и &#039;назад&#039;, вследствие чего значение
   переменной <var class="varname">$offset</var> заносится в <abbr title="Uniform Resource Locator">URL</abbr>.
   Скрипт ожидает, что <var class="varname">$offset</var> - десятичное число.
   Однако, взломщик может попытаться взломать систему,
   присоединив к <abbr title="Uniform Resource Locator">URL</abbr> следующее значение:
   <div class="informalexample">
    <div class="example-contents">
<div class="sqlcode"><pre class="sqlcode">0;
insert into pg_shadow(usename,usesysid,usesuper,usecatupd,passwd)
  select &#039;crack&#039;, usesysid, &#039;t&#039;,&#039;t&#039;,&#039;crack&#039;
  from pg_shadow where usename=&#039;postgres&#039;;
--</pre>
</div>
    </div>

   </div>
   Если это произойдёт, скрипт предоставит злоумышленнику доступ суперпользователя.
   Обратите внимание, что значение <code class="literal">0;</code> использовано
   для того, чтобы задать правильное смещение для первого запроса и
   корректно его завершить.
  </p>
  <blockquote class="note"><p><strong class="note">Замечание</strong>: 
   <p class="para">
    Это распространённый приём, чтобы заставить синтаксический анализатор SQL
    игнорировать остальную часть запроса, написанного разработчиком
    с помощью <code class="literal">--</code>, который является знаком комментария в SQL.
   </p>
  </p></blockquote>
  <p class="para">
   Ещё один вероятный способ получить пароли учётных записей в БД - атака страниц,
   предоставляющих поиск по базе. Злоумышленнику нужно лишь проверить, используется
   ли в запросе передаваемая на сервер и необрабатываемая надлежащим образом переменная.
   Это может быть один из устанавливаемых на предыдущей странице фильтров,
   таких как <code class="literal">WHERE, ORDER BY, LIMIT</code> и <code class="literal">OFFSET</code>,
   используемых при построении запросов <code class="literal">SELECT</code>.
   В случае, если используемая вами база данных поддерживает
   конструкцию <code class="literal">UNION</code>, злоумышленник может присоединить
   к оригинальному запросу ещё один дополнительный, для извлечения пользовательских
   паролей. Настоятельно рекомендуем использовать только зашифрованные
   пароли.
   <div class="example" id="example-1318">
    <p><strong>Пример #2 
     Листинг статей... и некоторых паролей (для любой базы данных)
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br />$query  </span><span style="color: #007700">= </span><span style="color: #DD0000">"SELECT id, name, inserted, size FROM products<br />         WHERE size = '</span><span style="color: #0000BB">$size</span><span style="color: #DD0000">'"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$result </span><span style="color: #007700">= </span><span style="color: #0000BB">odbc_exec</span><span style="color: #007700">(</span><span style="color: #0000BB">$conn</span><span style="color: #007700">, </span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
   Статическая часть запроса может комбинироваться с другим
   <code class="literal">SELECT</code>-запросом, который выведет все пароли:
   <div class="informalexample">
    <div class="example-contents">
<div class="sqlcode"><pre class="sqlcode">&#039;
union select &#039;1&#039;, concat(uname||&#039;-&#039;||passwd) as name, &#039;1971-01-01&#039;, &#039;0&#039; from usertable;
--</pre>
</div>
    </div>

   </div>
  </p>
  <p class="para">
   Выражения <code class="literal">UPDATE</code> и <code class="literal">INSERT</code> также подвержены таким атакам.
   <div class="example" id="example-1321">
    <p><strong>Пример #3 
     От сброса пароля до получения дополнительных привилегий (любой сервер баз данных)
    </strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br />$query </span><span style="color: #007700">= </span><span style="color: #DD0000">"UPDATE usertable SET pwd='</span><span style="color: #0000BB">$pwd</span><span style="color: #DD0000">' WHERE uid='</span><span style="color: #0000BB">$uid</span><span style="color: #DD0000">';"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
   Но злоумышленник может ввести значение
   <code class="literal">&#039; or uid like&#039;%admin%&#039;</code> для переменной <var class="varname">$uid</var> для
   изменения пароля администратора или просто присвоить переменной <var class="varname">$pwd</var> значение
   <code class="literal">hehehe&#039;, trusted=100, admin=&#039;yes</code>
   для получения дополнительных привилегий. При выполнении запросы переплетаются:
   <div class="informalexample">
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">// $uid: ' or uid like '%admin%<br /></span><span style="color: #0000BB">$query </span><span style="color: #007700">= </span><span style="color: #DD0000">"UPDATE usertable SET pwd='...' WHERE uid='' or uid like '%admin%';"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">// $pwd: hehehe', trusted=100, admin='yes<br /></span><span style="color: #0000BB">$query </span><span style="color: #007700">= </span><span style="color: #DD0000">"UPDATE usertable SET pwd='hehehe', trusted=100, admin='yes' WHERE<br />...;"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
  </p>
  <p class="simpara">
   Хотя остаётся очевидным, что для проведения успешной атаки злоумышленник должен обладать
   хотя бы некоторыми знаниями об архитектуре базы данных, получить эту информацию зачастую очень просто.
   Например, код может быть частью программного обеспечения с открытым исходным кодом и находиться в открытом доступе.
   Эта информация также может быть раскрыта закрытым кодом - даже если он закодирован,
   обфусцирован или скомпилирован, и даже вашим собственным кодом через отображение сообщений об ошибках.
   Другие методы включают использование типичных имён таблиц и столбцов. Например, форма входа в систему,
   использующая таблицу &#039;users&#039; с именами столбцов &#039;id&#039;, &#039;username&#039; и &#039;password&#039;.
  </p>
  <p class="para">
   <div class="example" id="example-1324">
    <p><strong>Пример #4 Атака на операционную систему сервера базы данных (MSSQL Server)</strong></p>
    <div class="example-contents"><p>
     Пугающий пример того, как команды уровня операционной системы могут
     быть доступны на некоторых узлах баз данных.
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br />$query  </span><span style="color: #007700">= </span><span style="color: #DD0000">"SELECT * FROM products WHERE id LIKE '%</span><span style="color: #0000BB">$prod</span><span style="color: #DD0000">%'"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$result </span><span style="color: #007700">= </span><span style="color: #0000BB">mssql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
   Если злоумышленник передаст значение
   <code class="literal">a%&#039; exec master..xp_cmdshell &#039;net user test testpass /ADD&#039; --</code>
   в <var class="varname">$prod</var>, то <var class="varname">$query</var> будет:
   <div class="informalexample">
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br />$query  </span><span style="color: #007700">= </span><span style="color: #DD0000">"SELECT * FROM products<br />         WHERE id LIKE '%a%'<br />         exec master..xp_cmdshell 'net user test testpass /ADD' --%'"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$result </span><span style="color: #007700">= </span><span style="color: #0000BB">mssql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
    </div>

   </div>
   MSSQL Server выполняет SQL запросы в пакете, включая команду добавления
   нового пользователя в локальную базу данных учётных записей.
   Если бы это приложение было запущено от имени <code class="literal">sa</code>
   и служба MSSQLSERVER была запущена с достаточными привилегиями,
   у злоумышленника появилась бы учётная запись, с помощью которой
   он мог бы получить доступ к этой машине.
  </p>
  <blockquote class="note"><p><strong class="note">Замечание</strong>: 
   <p class="para">
    Некоторые примеры, приведённые выше, привязаны к конкретному серверу баз данных,
    но это не означает, что подобная атака невозможна на другие продукты.
    Ваш сервер баз данных может быть аналогично уязвим и другим способом.
   </p>
  </p></blockquote>
  <p class="para">
   <div class="mediaobject">
    
    <div class="imageobject">
     <img src="images/fa7c5b5f326e3c4a6cc9db19e7edbaf0-xkcd-bobby-tables.png" alt="Забавный пример проблем, связанных с SQL-инъекциями" width="666" height="205" />
    </div>
   </div>
   Изображение любезно предоставлено <a href="http://xkcd.com/327" class="link external">&raquo;&nbsp;xkcd</a>
  </p>

  <div class="sect2" id="security.database.avoiding">
   <h3 class="title">Способы защиты</h3>
   <p class="para">
    Рекомендуемый способ избежать SQL-инъекций - связывание всех данных с помощью подготовленных запросов.
    Использование подготовленных запросов недостаточно для полного предотвращения SQL-инъекций,
    но это самый простой и безопасный способ обеспечить ввод данных в SQL-запросы.
    Все динамические литералы данных в выражениях <code class="literal">WHERE</code>, <code class="literal">SET</code> и <code class="literal">VALUES</code>
    должны быть заменены заполнителями. Фактические данные будут связаны во время выполнения
    и отправлены отдельно от команды SQL.
   </p>
   <p class="para">
    Привязка параметров может использоваться только для данных.
    Другие динамические части SQL-запроса должны быть отфильтрованы по известному списку допустимых значений.
   </p>
   <p class="para">
    <div class="example" id="example-1327">
     <p><strong>Пример #5 Избегание SQL-инъекций с помощью подготовленных операторов PDO</strong></p>
     <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000"><span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">// Динамическая часть SQL проверяется на соответствие ожидаемым значениям<br /></span><span style="color: #0000BB">$sortingOrder </span><span style="color: #007700">= </span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'sortingOrder'</span><span style="color: #007700">] === </span><span style="color: #DD0000">'DESC' </span><span style="color: #007700">? </span><span style="color: #DD0000">'DESC' </span><span style="color: #007700">: </span><span style="color: #DD0000">'ASC'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$productId </span><span style="color: #007700">= </span><span style="color: #0000BB">$_GET</span><span style="color: #007700">[</span><span style="color: #DD0000">'productId'</span><span style="color: #007700">];<br /><br /></span><span style="color: #FF8000">// SQL подготавливается с заполнителем<br /></span><span style="color: #0000BB">$stmt </span><span style="color: #007700">= </span><span style="color: #0000BB">$pdo</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">prepare</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT * FROM products WHERE id LIKE ? ORDER BY price </span><span style="color: #007700">{</span><span style="color: #0000BB">$sortingOrder</span><span style="color: #007700">}</span><span style="color: #DD0000">"</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">// Значение предоставляется с подстановочными знаками LIKE<br /></span><span style="color: #0000BB">$stmt</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">execute</span><span style="color: #007700">([</span><span style="color: #DD0000">"%</span><span style="color: #007700">{</span><span style="color: #0000BB">$productId</span><span style="color: #007700">}</span><span style="color: #DD0000">%"</span><span style="color: #007700">]);<br /></span><span style="color: #0000BB">?&gt;</span></span></code></div>
     </div>

    </div>
   </p>

   <p class="simpara">
    Подготовленные операторы предоставляются <a href="pdo.prepared-statements.php.html" class="link">PDO</a>,
    <a href="mysqli.quickstart.prepared-statements.php.html" class="link">MySQLi</a>,
    а также другими библиотеками баз данных.
   </p>

   <p class="simpara">
    Атаки SQL-инъекций в основном основаны на использовании кода, написанного без учёта требований безопасности.
    Никогда не доверяйте любому вводу, особенно со стороны клиента, даже если он поступает из поля выбора,
    скрытого поля ввода или cookie. Первый пример показывает, что такой простой запрос может привести к катастрофе.
   </p>

   <p class="para">
    Стратегия &quot;защита в глубину&quot; включает в себя несколько эффективных методов написания кода:
    <ul class="itemizedlist">
     <li class="listitem">
      <span class="simpara">
       Никогда не подключайтесь к базе данных как суперпользователь или владелец базы данных.
       Всегда используйте настроенных пользователей с минимальными привилегиями.
      </span>
     </li>
     <li class="listitem">
      <span class="simpara">
       Всегда проверяйте введённые данные на соответствие ожидаемому типу.
       В <abbr title="PHP: Hypertext Preprocessor">PHP</abbr> есть множество функций для проверки данных: начиная от простейших
       <a href="ref.var.php.html" class="link">функций для работы с переменными</a> и
       <a href="ref.ctype.php.html" class="link">функций определения типа символов</a>
       (таких как <span class="function"><a href="function.is-numeric.php.html" class="function">is_numeric()</a></span> и <span class="function"><a href="function.ctype-digit.php.html" class="function">ctype_digit()</a></span>
       соответственно) и заканчивая
       <a href="ref.pcre.php.html" class="link">Perl-совместимыми регулярными выражениями</a>.
      </span>
     </li>
     <li class="listitem">
      <span class="simpara">
       В случае, если приложение ожидает цифровой ввод, примените функцию
       <span class="function"><a href="function.ctype-digit.php.html" class="function">ctype_digit()</a></span> для проверки введённых данных, или
       принудительно укажите их тип при помощи <span class="function"><a href="function.settype.php.html" class="function">settype()</a></span>,
       или просто используйте числовое представление при помощи функции
       <span class="function"><a href="function.sprintf.php.html" class="function">sprintf()</a></span>.
      </span>
     </li>
     <li class="listitem">
      <span class="simpara">
       Если на уровне базы данных не поддерживаются привязанные переменные, то
       всегда экранируйте любые нечисловые данные, используемый в запросах к БД при помощи
       специальных экранирующих функций, специфичных для используемой
       вами базы данных (например,
       <span class="function"><a href="function.mysql-real-escape-string.php.html" class="function">mysql_real_escape_string()</a></span>,
       <span class="function"><strong>sqlite_escape_string()</strong></span>  и т.д.).
       Общие функции такие как <span class="function"><a href="function.addslashes.php.html" class="function">addslashes()</a></span> полезны
       только в определённых случаях (например MySQL в однобайтной кодировке
       с отключённым <var class="varname">NO_BACKSLASH_ESCAPES</var>), поэтому лучше
       избегать их использование.
      </span>
     </li>
     <li class="listitem">
      <span class="simpara">
       Ни в коем случае не выводите никакой информации о БД, особенно о её структуре.
       Также ознакомьтесь с соответствующими разделами документации: &quot;<a href="security.errors.php.html" class="link">Сообщения об ошибках</a>&quot; и &quot;<a href="ref.errorfunc.php.html" class="link">Функции обработки и логирования ошибок</a>&quot;.
      </span>
     </li>
    </ul>
   </p>

   <p class="simpara">
    Помимо всего вышесказанного, вы можете логировать запросы в вашем скрипте либо
    на уровне базы данных, если она это поддерживает. Очевидно, что логирование
    не может предотвратить нанесение ущерба, но может помочь при трассировке взломанного
    приложения. Лог-файл полезен не сам по себе, а информацией, которая в нем содержится.
    Причём, в большинстве случаев полезно логировать все возможные детали.
   </p>
  </div>
 </div><section id="usernotes">
 <div class="head">
  <span class="action"><a href="https://www.php.net/manual/add-note.php?sect=security.database.sql-injection&amp;redirect=https://www.php.net/manual/ru/security.database.sql-injection.php">＋<small>add a note</small></a></span>
  <h3 class="title">User Contributed Notes <span class="count">1 note</span></h3>
 </div><div id="allnotes">
  <div class="note" id="106564">  <div class="votes">
    <div id="Vu106564">
    <a href="https://www.php.net/manual/vote-note.php?id=106564&amp;page=security.database.sql-injection&amp;vote=up" title="Vote up!" class="usernotes-voteu">up</a>
    </div>
    <div id="Vd106564">
    <a href="https://www.php.net/manual/vote-note.php?id=106564&amp;page=security.database.sql-injection&amp;vote=down" title="Vote down!" class="usernotes-voted">down</a>
    </div>
    <div class="tally" id="V106564" title="53% like this...">
    29
    </div>
  </div>
  <a href="security.database.sql-injection.php.html#106564" class="name">
  <strong class="user"><em>Richard dot Corfield at gmail dot com</em></strong></a><a class="genanchor" href="security.database.sql-injection.php.html#106564"> &para;</a><div class="date" title="2011-11-18 02:01"><strong>12 years ago</strong></div>
  <div class="text" id="Hcom106564">
<div class="phpcode"><code><span class="html">The best way has got to be parameterised queries. Then it doesn't matter what the user types in the data goes to the database as a value. <br /><br />A quick search online shows some possibilities in PHP which is great! Even on this site - <a href="http://php.net/manual/en/pdo.prepared-statements.php" rel="nofollow" target="_blank">http://php.net/manual/en/pdo.prepared-statements.php</a><br />which also gives the reasons this is good both for security and performance.</span></code></div>
  </div>
 </div></div>
<div class="foot"><a href="https://www.php.net/manual/add-note.php?sect=security.database.sql-injection&amp;redirect=https://www.php.net/manual/ru/security.database.sql-injection.php">＋<small>add a note</small></a></div>
</section>    </section><!-- layout-content -->
        <aside class='layout-menu'>

        <ul class='parent-menu-list'>
                                    <li>
                <a href="security.database.php.html">Безопасность баз данных</a>

                                    <ul class='child-menu-list'>

                                                <li class="">
                            <a href="security.database.design.php.html" title="Проектирование базы данных">Проектирование базы данных</a>
                        </li>
                                                <li class="">
                            <a href="security.database.connection.php.html" title="Соединение с базой данных">Соединение с базой данных</a>
                        </li>
                                                <li class="">
                            <a href="security.database.storage.php.html" title="Шифрование хранилища базы данных">Шифрование хранилища базы данных</a>
                        </li>
                                                <li class="current">
                            <a href="security.database.sql-injection.php.html" title="SQL-&#8203;инъекции">SQL-&#8203;инъекции</a>
                        </li>
                        
                    </ul>
                
            </li>
                        
                    </ul>
    </aside>


  </div><!-- layout -->

  <footer>
    <div class="container footer-content">
      <div class="row-fluid">
      <ul class="footmenu">
        <li><a href="https://www.php.net/copyright.php">Copyright &copy; 2001-2024 The PHP Group</a></li>
        <li><a href="https://www.php.net/my.php">My PHP.net</a></li>
        <li><a href="https://www.php.net/contact.php">Contact</a></li>
        <li><a href="https://www.php.net/sites.php">Other PHP.net sites</a></li>
        <li><a href="https://www.php.net/privacy.php">Privacy policy</a></li>
      </ul>
      </div>
    </div>
  </footer>

    
 <!-- External and third party libraries. -->
 <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fhogan-3.0.2.min.js"></script>
<script src="../../cached.php%3Ft=1421837618&amp;f=%252Fjs%252Fext%252Ftypeahead.min.js"></script>
<script src="../../cached.php%3Ft=1657876202&amp;f=%252Fjs%252Fext%252Fmousetrap.min.js"></script>
<script src="../../cached.php%3Ft=1657730402&amp;f=%252Fjs%252Fext%252Fjquery.scrollTo.min.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fsearch.js"></script>
<script src="../../cached.php%3Ft=1701958202&amp;f=%252Fjs%252Fcommon.js"></script>

<a id="toTop" href="javascript:;"><span id="toTopHover"></span><img width="40" height="40" alt="To Top" src="../../images/to-top@2x.png"></a>

</body>
</html>
